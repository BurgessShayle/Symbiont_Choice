---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "12/7/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---
This is data from the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 
Data: ddPCR 

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")

#knitr::opts_knit$set(root.dir = normalizePath("~/Desktop/Symb_choice/Symbiont Choice 2018"))
```

```{r}
rm(list=ls()) # Clear workspace
```
## Background

Authors: S. Matsuda, L. Chakravarti, R. Cunning, M.van Oppen, R. Gates
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. 

```{r}
# Set up workspace
setwd("~/Desktop/Symb_choice/Symbiont Choice 2018")

library(plyr)
library(dplyr)
library(ggplot2)
library("gridExtra") #arrange plots for output
library(reshape2)
```


Load in ddPCR data with Threshold set in QuantaSoft Analysis
```{r}
#Read in plate data

Plate1<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE1_20190424_threshold.csv")
Plate2<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE2_20190429_threshold.csv")
Plate3<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3_20190426_threshold.csv")
Plate3B<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3B_20190426_threshold.csv")
Plate3 <- rbind(Plate3,Plate3B) # merge plate 3 and 3b for metadata
Plate4<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE4_20190427_threshold.csv")
Plate5<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE5_20190428_threshold.csv")
Plate6<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE6_20190428_threshold.csv")
Plate7<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE7_20190429_threshold.csv")
Plate8<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE8_20190501_threshold.csv")
Plate9<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE9_20190501_threshold.csv")
Plate10<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE10_20190501_threshold.csv")
Plate11<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE11_20190502_threshold.csv")
Plate12<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE12_20190502_threshold.csv")
Plate13<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE13_20190503_threshold.csv")
Plate14<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE14_20190503_threshold.csv")
Plate15<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE15_20190507_threshold.csv")
Plate16<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE16_20190508_threshold.csv")
Plate17<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE17_20190509_threshold.csv")
Plate18<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE18_20190509_threshold.csv")
Plate19<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE19_20190509_threshold.csv")
Plate20<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE20_20190510_threshold.csv")

# read in metadata by plate (some samples are duplicate names, which is why)
meta1 <-read.csv("ddPCR_thresholdData/Plate1_meta.csv")
meta2 <-read.csv("ddPCR_thresholdData/Plate2_meta.csv")
meta3 <-read.csv("ddPCR_thresholdData/Plate3_meta.csv")
meta4 <-read.csv("ddPCR_thresholdData/Plate4_meta.csv")
meta5 <-read.csv("ddPCR_thresholdData/Plate5_meta.csv")
meta6 <-read.csv("ddPCR_thresholdData/Plate6_meta.csv")
meta7 <-read.csv("ddPCR_thresholdData/Plate7_meta.csv")
meta8 <-read.csv("ddPCR_thresholdData/Plate8_meta.csv")
meta9 <-read.csv("ddPCR_thresholdData/Plate9_meta.csv")
meta10 <-read.csv("ddPCR_thresholdData/Plate10_meta.csv")
meta11 <-read.csv("ddPCR_thresholdData/Plate11_meta.csv")
meta12 <-read.csv("ddPCR_thresholdData/Plate12_meta.csv")
meta13 <-read.csv("ddPCR_thresholdData/Plate13_meta.csv")
meta14 <-read.csv("ddPCR_thresholdData/Plate14_meta.csv")
meta15 <-read.csv("ddPCR_thresholdData/Plate15_meta.csv")
meta16 <-read.csv("ddPCR_thresholdData/Plate16_meta.csv")
meta17 <-read.csv("ddPCR_thresholdData/Plate17_meta.csv")
meta18 <-read.csv("ddPCR_thresholdData/Plate18_meta.csv")
meta19 <-read.csv("ddPCR_thresholdData/Plate19_meta.csv")
meta20 <-read.csv("ddPCR_thresholdData/Plate20_meta.csv")

# merge each plates meta with plate
P1<-merge(Plate1, meta1, by="Well")
P2<-merge(Plate2, meta2, by="Well")
P3<-merge(Plate3, meta3, by="Well")
P4<-merge(Plate4, meta4, by="Well")
P5<-merge(Plate5, meta5, by="Well")
P6<-merge(Plate6, meta6, by="Well")
P7<-merge(Plate7, meta7, by="Well")
P8<-merge(Plate8, meta8, by="Well")
P9<-merge(Plate9, meta9, by="Well")
P10<-merge(Plate10, meta10, by="Well")
P11<-merge(Plate11, meta11, by="Well")
P12<-merge(Plate12, meta12, by="Well")
P13<-merge(Plate13, meta13, by="Well")
P14<-merge(Plate14, meta14, by="Well")
P15<-merge(Plate15, meta15, by="Well")
P16<-merge(Plate16, meta16, by="Well")
P17<-merge(Plate17, meta17, by="Well")
P18<-merge(Plate18, meta18, by="Well")
P19<-merge(Plate19, meta19, by="Well")
P20<-merge(Plate20, meta20, by="Well")


```

Remove samples that I re-ddPCRd due to low droplet count that now have higher counts (remove olds by plate/well)
```{r}
# Plate 5
    P5<-P5[!(P5$Well=="B06"),]
    P5<-P5[!(P5$Well=="B09"),]
    P5<-P5[!(P5$Well=="B11"),]
    P5<-P5[!(P5$Well=="C06"),]
    P5<-P5[!(P5$Well=="C09"),]
    P5<-P5[!(P5$Well=="C12"),]
    P5<-P5[!(P5$Well=="D06"),]
    P5<-P5[!(P5$Well=="D10"),]
    P5<-P5[!(P5$Well=="D12"),]
    P5<-P5[!(P5$Well=="H03"),]
    P5<-P5[!(P5$Well=="H04"),]
# PLATE 6
    P6<-P6[!(P6$Well=="C12"),]
# PLATE 8
    P8<-P8[!(P8$Well=="A02"),]
    P8<-P8[!(P8$Well=="A04"),]
    P8<-P8[!(P8$Well=="A11"),]
    P8<-P8[!(P8$Well=="A12"),]
    P8<-P8[!(P8$Well=="B02"),]
    P8<-P8[!(P8$Well=="B04"),]
    P8<-P8[!(P8$Well=="B12"),]
    P8<-P8[!(P8$Well=="C02"),]
    P8<-P8[!(P8$Well=="C04"),]
    P8<-P8[!(P8$Well=="C12"),]
    P8<-P8[!(P8$Well=="E04"),]
    P8<-P8[!(P8$Well=="G04"),]
    P8<-P8[!(P8$Well=="G05"),]
    P8<-P8[!(P8$Well=="H04"),]
# PLATE 9
    P9<-P9[!(P9$Well=="B11"),]
    P9<-P9[!(P9$Well=="C10"),]
    P9<-P9[!(P9$Well=="C11"),]
    P9<-P9[!(P9$Well=="E02"),]
    P9<-P9[!(P9$Well=="E10"),]
    P9<-P9[!(P9$Well=="F04"),]
    P9<-P9[!(P9$Well=="F06"),]
    P9<-P9[!(P9$Well=="G02"),]
    P9<-P9[!(P9$Well=="H03"),]
# PLATE 10
    P10<-P10[!(P10$Well=="C01"),]
    P10<-P10[!(P10$Well=="C07"),]
    P10<-P10[!(P10$Well=="C12"),]
    P10<-P10[!(P10$Well=="D10"),]
    P10<-P10[!(P10$Well=="E05"),]
#PLATE 12
    P12<-P12[!(P12$Well=="A09"),]
    P12<-P12[!(P12$Well=="E05"),]
#PLATE 13
    P13<-P13[!(P13$Well=="A09"),]
    P13<-P13[!(P13$Well=="A12"),]
    P13<-P13[!(P13$Well=="B12"),]
    P13<-P13[!(P13$Well=="C10"),]
    P13<-P13[!(P13$Well=="D10"),]
    P13<-P13[!(P13$Well=="D11"),]
    P13<-P13[!(P13$Well=="E10"),]
    P13<-P13[!(P13$Well=="F05"),]
    P13<-P13[!(P13$Well=="F06"),]
#PLATE 14
    P14<-P14[!(P14$Well=="A09"),]
    P14<-P14[!(P14$Well=="A12"),]
    P14<-P14[!(P14$Well=="B09"),]
#PLATE 15
    P15<-P15[!(P15$Well=="C10"),]
    P15<-P15[!(P15$Well=="D10"),]
    P15<-P15[!(P15$Well=="G03"),]
#PLATE 16
    P16<-P16[!(P16$Well=="D05"),]
    P16<-P16[!(P16$Well=="F04"),]
    P16<-P16[!(P16$Well=="F05"),]
#PLATE 17
    P17<-P17[!(P17$Well=="D09"),]
    P17<-P17[!(P17$Well=="E09"),]
#PLATE 18
    P18<-P18[!(P18$Well=="E09"),]
    P18<-P18[!(P18$Well=="F04"),]
    P18<-P18[!(P18$Well=="H04"),]
#PLATE 19
    P19<-P19[!(P19$Well=="C08"),]
```


```{r}
#merge all plates
dData1 <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20)

 write.csv(dData, "dData.csv")
#only keep columns you need (Sample, Target, Conc(copies/µL), Copies/20ulWell, Accepted Droplets, Positives, Negatives, Threshold1, metadata)

dData<-dData1[,c(1,2:4,11,16:18,31,66 ,68:79)]
dData$Conc.copies.µL.<-as.numeric(dData$Conc.copies.µL.)
dData$Temp<-as.character(dData$Temp)
dData$Day<-as.numeric(dData$Day)
```





Calculate concentration per larvae <- is this correct
```{r}
# use copies/1ul pcr to calculate how many copies are in 1 larvae. (copies/1ul PCR)*(25ul PCR/y ul.DNA added)*(20uLDNA/1 larvae)
dData$copies.larvae<-(dData$Conc.copies.µL.)*(25/dData$ul.DNA)*20
```

Calculate copy number ***** When you do this, add this step here (will not significantly change results, prev done in excel )
```{r}
#CopyNumber<-subset(dData, Info=="CopyNumber")
#write.csv(CopyNumber,"CopyNumber_20191208.csv")
```


```{r}
# divide copies by copy number per clade (CALC IN EXCEL)
dData$copyNum[dData$Primer=="C1"]<-24
dData$copyNum[dData$Primer=="D1"]<-7
dData$copyNum[dData$Primer=="F1"]<-39
dData$copyNum[dData$Primer=="G3"]<-247

# calc number of Sym cells in larvae
dData$cells.larvae<-dData$copies.larvae/dData$copyNum
  dData<-dData[!(dData$Info=="NTC"),]
```

Subset data for diff analyses
```{r}
#subset only copynumber calc samples
CopyNumber<-subset(dData, Info=="CopyNumber")

#subset only FalsePositives
FalsePos<-subset(dData, Info=="CONTROL")
#write.csv(FalsePos, "FalsePos.csv")

#subset Samples
sData<-subset(dData, Info=="ALL"|Info=="C1"|Info=="D1"|Info=="F1"|Info=="G3")
AllAll<-subset(dData, Info=="ALL")
#write.csv(AllAll, "AllAll.csv")
```

Decide where your cut off for positive droplets is. Standard is 10,000. You should push down to 900. 
```{r}
# 9000 cutoff
sData1<-subset(sData, Accepted.Droplets>9000)# remove samples with less than 9000 droplets (we lose 60 samples)


#pull to view under 9000 droplet info
ALL1<-subset(sData, Info=="ALL")
#write.csv(ALL1, "Alldroptest9000.csv")

# 8000 cutoff
sData2<-subset(sData, Accepted.Droplets>8000)# remove samples with less than 9000 droplets (we lose 60 samples)
```
Just for the multi-infection (single infection numbers are ok)  
If we cutoff at 9000:  
Without adding together sep runs, we lose: 20 Larvae  
Adding together sep runs, we lose: 18 larvae

If we cutof at 8000:  
Without adding together sep runs, we lose:7  Larvae  
Adding together sep runs, we lose:  6 larvae

9000 Cut off
Subset for each Infection trial (C1, D1, F1, G3, ALL)
```{r}
C1_9000<-subset(sData1, Info=="C1")
D1_9000<-subset(sData1, Info=="D1")
F1_9000<-subset(sData1, Info=="F1")
G3_9000<-subset(sData1, Info=="G3")
ALL_9000<-subset(sData1, Info=="ALL")
#write.csv(ALL, "Alldroptest9000A.csv")

# for the Alls, cast for Primer
# remove unneeded columns
ALL_9000a<-ALL_9000[,c("ALL.number","Primer","cells.larvae","Day","Temp")]
#write.csv(ALL_9000a, "ALL_9000a.csv")
#cast by primers
 ALLcast_9000_cast<-dcast(ALL_9000a, ALL.number~Primer, value="cells.larvae",na.rm = TRUE) # cast()
# this returns 1s and 0s, since I have missing primers in some (20) samples here. In order to get this to work right, I need to remove the rest of those larvae before casting. There needs to be a beter way/ 
  
 
 # Remove rest of primers/larvae of missing ones (n=20 larvae)
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="136"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="135"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="236"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="227"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="111"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="120"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="137"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="204"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="30"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="188"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="130"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="138"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="231"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="125"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="187"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="209"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="122"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="208"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="232"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="233"),]


  #try to cast again
   All_9000_castTEST<-dcast(ALL_9000a, ALL.number~Primer, value.var="cells.larvae",na.rm = TRUE) # cast()

 
# try tidyverse spread
  library(tidyverse)
  test<-spread(ALL_9000a,Primer, cells.larvae, fill=NA) #not working, likely due to same error above. 
  
  

  
  ###### QC-ing data now  
  
  
  
  
  
```





##PLOT SINGLE INFECTIONS_9000 SUBSET
C1 single infection 9000
```{r}
C1_mean_9000 <- ddply(C1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_mean_9000 #display table
```
Plot C1 single infection
```{r}
C1_plot_9000<-ggplot(data=C1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10,400) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1 average infection per larvae_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_plot_9000
```

D1 single infection
```{r}
D1_mean_9000 <- ddply(D1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_mean_9000 #display table
```
Plot D1 single infection
```{r}
D1_plot_9000<-ggplot(data=D1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 400) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1 average infection per larvae")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_plot_9000
```

F1 single infection
```{r}
F1_mean_9000 <- ddply(F1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_mean_9000 #display table
```
Plot F1 single infection
```{r}
F1_plot_9000<-ggplot(data=F1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 400) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("F1 average infection per larvae")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_plot_9000
```

G3 single infection
```{r}
G3_mean_9000 <- ddply(G3_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_mean_9000 #display table
```
Plot G3 single infection
```{r}
G3_plot_9000<-ggplot(data=G3_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 400) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("G3 average infection per larvae")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_plot_9000
```

Plot all four SINGLE INFECTION together:
```{r}

C1_plot_9000<-C1_plot_9000+ theme(legend.position = "none") #remove legend
D1_plot_9000<-D1_plot_9000+ theme(legend.position = "none") #remove legend
F1_plot_9000<-F1_plot_9000+ theme(legend.position = "none") #remove legend
G3_plot_9000<-G3_plot_9000+ theme(legend.position = "none") #remove legend

grid.arrange(C1_plot_9000, D1_plot_9000, F1_plot_9000,G3_plot_9000, nrow = 2)
```

















#Multi-infection

A*************FIGURE OUT HOW TO SUBSET THE ALLS FOR ONLY LARVAE ("ALL.NUMBER"" COLUMN) THAT HAVE OVER 9000 DROPLETS FOR EACH OF THE FOUR PRIMERS***************** THen do that here before any of the stuff below. (you did in excel before by hand)

Subset by Temp treatments
```{r}
ALL_27<-subset(ALL_9000, Temp==27)
ALL_30<-subset(ALL, Temp==30)
ALL_31<-subset(ALL_9000, Temp==31)
```

Ambient 27C
```{r}
ALL_27_mean <- ddply(ALL_27, c("Day", "Temp","Primer"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_27_mean #display table
```

Plot All 27 single infection
```{r}
ALL_27_plot<-ggplot(data=ALL_27_mean, aes(x=Day, y=mean, group = Primer, color=Primer)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Primer), size=4, show.legend = T)+
  geom_line(aes(color=Primer))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("Multi-infection average infection per larvae")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_27_plot
```

High 30C
```{r}
ALL_30_mean <- ddply(ALL_30, c("Day", "Temp","Primer"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_30_mean #display table
```

Plot All 30 single infection
```{r}
ALL_30_plot<-ggplot(data=ALL_30_mean, aes(x=Day, y=mean, group = Primer, color=Primer)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Primer), size=4, show.legend = T)+
  geom_line(aes(color=Primer))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("Multi-infection average infection per larvae; 30C")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_30_plot
```

High 31C
```{r}
ALL_31_mean <- ddply(ALL_31, c("Day", "Temp","Primer"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_31_mean #display table
```

Plot All 31 single infection
```{r}
ALL_31_plot<-ggplot(data=ALL_31_mean, aes(x=Day, y=mean, group = Primer, color=Primer)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Primer), size=4, show.legend = T)+
  geom_line(aes(color=Primer))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("Multi-infection average infection per larvae")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_31_plot
```

Plot all three ALL temps together:
```{r}
ALL_27_plot<-ALL_27_plot+ theme(legend.position = "none") #remove legend
ALL_30_plot<-ALL_30_plot+ theme(legend.position = "none") #remove legend
ALL_31_plot<-ALL_31_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_27_plot, ALL_30_plot, ALL_31_plot, nrow = 1)
```

#Plot infection of individual larvae

27C Day 3
```{r}
ALL_27_Day3<-subset(ALL_27, Day==3)
ALL_27_Day3plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_27_Day3,
                           stat="identity");ALL_27_Day3plot
```
#Plot infection of individual larvae
27C Day 7
```{r}
ALL_27_Day7<-subset(ALL_27, Day==7)
ALL_27_Day7plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_27_Day7,
                           stat="identity");ALL_27_Day7plot
```

#Plot infection of individual larvae
27C Day 14
```{r}
ALL_27_Day14<-subset(ALL_27, Day==14)
ALL_27_Day14plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_27_Day14,
                           stat="identity");ALL_27_Day14plot
```

Plot all three ALL 27C days together:
```{r}
ALL_27_Day3plot<-ALL_27_Day3plot+ theme(legend.position = "none") #remove legend
ALL_27_Day7plot<-ALL_27_Day7plot+ theme(legend.position = "none") #remove legend
#ALL_27_Day14plot<-ALL_27_Day14plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_27_Day3plot, ALL_27_Day7plot, ALL_27_Day14plot, nrow = 1)
```

30C Day 3
```{r}
ALL_30_Day3<-subset(ALL_30, Day==3)
ALL_30_Day3plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_30_Day3,
                           stat="identity");ALL_30_Day3plot
```
#Plot infection of individual larvae
30C Day 7
```{r}
ALL_30_Day7<-subset(ALL_30, Day==7)
ALL_30_Day7plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_30_Day7,
                           stat="identity");ALL_30_Day7plot
```

#Plot infection of individual larvae
30C Day 14
```{r}
ALL_30_Day14<-subset(ALL_30, Day==14)
ALL_30_Day14plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_30_Day14,
                           stat="identity");ALL_30_Day14plot
```

Plot all three ALL 30C days together:
```{r}
ALL_30_Day3plot<-ALL_30_Day3plot+ theme(legend.position = "none") #remove legend
ALL_30_Day7plot<-ALL_30_Day7plot+ theme(legend.position = "none") #remove legend
#ALL_30_Day14plot<-ALL_30_Day14plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_30_Day3plot, ALL_30_Day7plot, ALL_30_Day14plot, nrow = 1)
```


31C Day 3
```{r}
ALL_31_Day3<-subset(ALL_31, Day==3)
ALL_31_Day3plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_31_Day3,
                           stat="identity");ALL_31_Day3plot
```
#Plot infection of individual larvae
31C Day 7
```{r}
ALL_31_Day7<-subset(ALL_31, Day==7)
ALL_31_Day7plot<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Primer), data = ALL_31_Day7,
                           stat="identity");ALL_31_Day7plot
```

Plot all three ALL 31C days together:
```{r}
ALL_31_Day3plot<-ALL_31_Day3plot+ theme(legend.position = "none") #remove legend
#ALL_31_Day7plot<-ALL_31_Day7plot+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_31_Day3plot, ALL_31_Day7plot, nrow = 1)
```

###Cut off at 8000
```{r}
C1_8000<-subset(sData2, Info=="C1")
D1_8000<-subset(sData2, Info=="D1")
F1_8000<-subset(sData2, Info=="F1")
G3_8000<-subset(sData2, Info=="G3")
ALL_8000<-subset(sData2, Info=="ALL")
```