---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "12/7/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

Ariana's Notes from 6/25: 
- I am not as familiar with this data, so it is pretty difficult for me to follow the script and understand what is happening in each part. It might be super helpful to add some headings and sections that break the script apart by hypotheses/analysis/question. Of course if you don't think this is necessary than no problem, its just a thought that might be helpful for others to follow the script and know where to look for certain analyses :) 
- See line 656 for confidence intervals on model2. The short answer is you have to use the base R plot() rather than ggplot to get the confidence interval lines. If you want to use that plot (see my code starting at 656), let me know and I can try to get the colorations, etc. to work the way you want them. 
- I'm wondering why you want to do an ANCOVA with model2? What would that tell you that is different from the model2? 


This is the data analysis of the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 

Authors: Matsuda, SB, Chakravarti, LC, Cunning, JR, Huffmyer, AS, Gates, RD, van Oppen, MJH
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. Digital droplet PCR was used to analyze data. 

Single infection: Individual infection of single clades: C1, D1, F1, and G3
Multi-infection: Mix of all four clades 
Pot: the containers larvae kept in (3 reps/clade/temp)

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")

#knitr::opts_knit$set(root.dir = normalizePath("~/Desktop/Symb_choice/Symbiont Choice 2018"))
```


Load in libraries 
```{r}
#rm(list=ls()) # Clear workspace

# Set up workspace: I def do not use all these
library(devtools) 
library(ggbiplot)
library(ggfortify)
library(vegan)
library("factoextra")
library(lmodel2) 
library(gplots)
library(MASS)
library(scales)
library(reshape) #for cast
library(lattice)
library(plyr)
library(dplyr)
library(ggplot2)
library("gridExtra") #arrange plots for output
library(reshape2)
library("ggsci")#set bar colors
library("qqplotr")
library(blmeco)
library("plotrix") #functions in tapply
library("pscl")
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("coefplot") #coefficient plotting
library("seacarb") #seawater carbonate chemistry
library("vegan") #calculating distance matrices
library(pscl) 
library(boot)
library(betareg)
library(coin)
library(exactRankTests)
library(mvtnorm)
library(DTK)
library(PMCMR)
library(MuMIn)
library(glmmTMB)
library(lme4)
library(lmerTest)
library(ggsignif)
library(HH)
library(PMCMR)
library(tidyverse)
library(arm)
library(jtools)
library(broom)
library(ggstance)
library(officer)
library(huxtable)
library(flextable)
```

#Load in data and setup dataframes:   
Load in Hemocytometer (Individuals subset, Days 7 and 14) and Scope (Individuals subset, Day 3) counts data: 
```{r}   
####Load in hemocytometer counts and fluorescent scope counts:  
Day3Counts<-read.csv("SC18_cellcounts_day3.csv")
Day7Counts<-read.csv("SC18_cellcounts_day7.csv")
Day14Counts<-read.csv("SC18_cellcounts_day14.csv")

#Day3
colnames(Day3Counts)[colnames(Day3Counts)=="Count"] <- "cells.larvae" #change col name

#remove cols you don't need Day 7
d7vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day7Counts<-Day7Counts[d7vars]
colnames(Day7Counts)[colnames(Day7Counts)=="Cells.per.larva"] <- "cells.larvae"
Day7Counts<-na.omit(Day7Counts)

#remove cols you don't need Day 14
d14vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day14Counts<-Day14Counts[d14vars]
colnames(Day14Counts)[colnames(Day14Counts)=="Cells.per.larva"] <- "cells.larvae"
Day14Counts<-na.omit(Day14Counts)

#combine days:
Countdat<-rbind(Day3Counts, Day7Counts, Day14Counts)
Countdat1<-Countdat[!(Countdat$Symbiont=="ALL"),] #remove ALLs
Countdat1<-Countdat1[!(Countdat1$Symbiont=="CONTROL"),] #remove controls
Countdat1$Temp<-as.factor(Countdat1$Temp)
Countdat1$cells.larvae<-as.numeric(Countdat1$cells.larvae) 
```
Load in ddPCR data with Threshold set in QuantaSoft Analysis:
```{r} 
#Read in ddPCR plate data: Each plate is a separte run:
Plate1<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE1_20190424_threshold.csv")
Plate2<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE2_20190429_threshold.csv")
Plate3<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3_20190426_threshold.csv")
Plate3B<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3B_20190426_threshold.csv")
Plate3 <- rbind(Plate3,Plate3B) # merge plate 3 and 3b for metadata
Plate4<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE4_20190427_threshold.csv")
Plate5<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE5_20190428_threshold.csv")
Plate6<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE6_20190428_threshold.csv")
Plate7<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE7_20190429_threshold.csv")
Plate8<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE8_20190501_threshold.csv")
Plate9<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE9_20190501_threshold.csv")
Plate10<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE10_20190501_threshold.csv")
Plate11<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE11_20190502_threshold.csv")
Plate12<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE12_20190502_threshold.csv")
Plate13<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE13_20190503_threshold.csv")
Plate14<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE14_20190503_threshold.csv")
Plate15<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE15_20190507_threshold.csv")
Plate16<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE16_20190508_threshold.csv")
Plate17<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE17_20190509_threshold.csv")
Plate18<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE18_20190509_threshold.csv")
Plate19<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE19_20190509_threshold.csv")
Plate20<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE20_20190510_threshold.csv")

# read in metadata by plate (some samples are duplicate names, which is why)
meta1 <-read.csv("ddPCR_thresholdData/Plate1_meta.csv")
meta2 <-read.csv("ddPCR_thresholdData/Plate2_meta.csv")
meta3 <-read.csv("ddPCR_thresholdData/Plate3_meta.csv")
meta4 <-read.csv("ddPCR_thresholdData/Plate4_meta.csv")
meta5 <-read.csv("ddPCR_thresholdData/Plate5_meta.csv")
meta6 <-read.csv("ddPCR_thresholdData/Plate6_meta.csv")
meta7 <-read.csv("ddPCR_thresholdData/Plate7_meta.csv")
meta8 <-read.csv("ddPCR_thresholdData/Plate8_meta.csv")
meta9 <-read.csv("ddPCR_thresholdData/Plate9_meta.csv")
meta10 <-read.csv("ddPCR_thresholdData/Plate10_meta.csv")
meta11 <-read.csv("ddPCR_thresholdData/Plate11_meta.csv")
meta12 <-read.csv("ddPCR_thresholdData/Plate12_meta.csv")
meta13 <-read.csv("ddPCR_thresholdData/Plate13_meta.csv")
meta14 <-read.csv("ddPCR_thresholdData/Plate14_meta.csv")
meta15 <-read.csv("ddPCR_thresholdData/Plate15_meta.csv")
meta16 <-read.csv("ddPCR_thresholdData/Plate16_meta.csv")
meta17 <-read.csv("ddPCR_thresholdData/Plate17_meta.csv")
meta18 <-read.csv("ddPCR_thresholdData/Plate18_meta.csv")
meta19 <-read.csv("ddPCR_thresholdData/Plate19_meta.csv")
meta20 <-read.csv("ddPCR_thresholdData/Plate20_meta.csv")

# merge each plates meta with plate
P1<-merge(Plate1, meta1, by="Well")
P2<-merge(Plate2, meta2, by="Well")
P3<-merge(Plate3, meta3, by="Well")
P4<-merge(Plate4, meta4, by="Well")
P5<-merge(Plate5, meta5, by="Well")
P6<-merge(Plate6, meta6, by="Well")
P7<-merge(Plate7, meta7, by="Well")
P8<-merge(Plate8, meta8, by="Well")
P9<-merge(Plate9, meta9, by="Well")
P10<-merge(Plate10, meta10, by="Well")
P11<-merge(Plate11, meta11, by="Well")
P12<-merge(Plate12, meta12, by="Well")
P13<-merge(Plate13, meta13, by="Well")
P14<-merge(Plate14, meta14, by="Well")
P15<-merge(Plate15, meta15, by="Well")
P16<-merge(Plate16, meta16, by="Well")
P17<-merge(Plate17, meta17, by="Well")
P18<-merge(Plate18, meta18, by="Well")
P19<-merge(Plate19, meta19, by="Well")
P20<-merge(Plate20, meta20, by="Well")


#Remove samples that I re-ddPCRd due to low droplet count that now have higher counts (remove olds by plate/well)

# Plate 5
    P5<-P5[!(P5$Well=="B06"),]
    P5<-P5[!(P5$Well=="B09"),]
    P5<-P5[!(P5$Well=="B11"),]
    P5<-P5[!(P5$Well=="C06"),]
    P5<-P5[!(P5$Well=="C09"),]
    P5<-P5[!(P5$Well=="C12"),]
    P5<-P5[!(P5$Well=="D06"),]
    P5<-P5[!(P5$Well=="D10"),]
    P5<-P5[!(P5$Well=="D12"),]
    P5<-P5[!(P5$Well=="H03"),]
    P5<-P5[!(P5$Well=="H04"),]
        P5<-P5[!(P5$Well=="B12"),]#18G

# PLATE 6
    P6<-P6[!(P6$Well=="C12"),]
# PLATE 8
    P8<-P8[!(P8$Well=="A02"),]
    P8<-P8[!(P8$Well=="A04"),]
    P8<-P8[!(P8$Well=="A11"),]
    P8<-P8[!(P8$Well=="A12"),]
    P8<-P8[!(P8$Well=="B02"),]
    P8<-P8[!(P8$Well=="B04"),]
    P8<-P8[!(P8$Well=="B12"),]
    P8<-P8[!(P8$Well=="C02"),]
    P8<-P8[!(P8$Well=="C04"),]
    P8<-P8[!(P8$Well=="C12"),]
    P8<-P8[!(P8$Well=="E04"),]
    P8<-P8[!(P8$Well=="G04"),]
    P8<-P8[!(P8$Well=="G05"),]
    P8<-P8[!(P8$Well=="H04"),]
        P8<-P8[!(P8$Well=="F06"),]#61C
        P8<-P8[!(P8$Well=="C11"),]#66D

# PLATE 9
    P9<-P9[!(P9$Well=="B11"),]
    P9<-P9[!(P9$Well=="C10"),]
    P9<-P9[!(P9$Well=="C11"),]
    P9<-P9[!(P9$Well=="E02"),]
    P9<-P9[!(P9$Well=="E10"),]
    P9<-P9[!(P9$Well=="F04"),]
    P9<-P9[!(P9$Well=="F06"),]
    P9<-P9[!(P9$Well=="G02"),]
    P9<-P9[!(P9$Well=="H03"),]
          P9<-P9[!(P9$Well=="B12"),] ##88D

# PLATE 10
    P10<-P10[!(P10$Well=="C01"),]
    P10<-P10[!(P10$Well=="C07"),]
    P10<-P10[!(P10$Well=="C12"),]
    P10<-P10[!(P10$Well=="D10"),]
    P10<-P10[!(P10$Well=="E05"),]
    P10<-P10[!(P10$Well=="H05"),]
        P10<-P10[!(P10$Well=="E06"),] #106C
        P10<-P10[!(P10$Well=="C10"),] #112F
        P10<-P10[!(P10$Well=="G04"),] #100G


#PLATE 12
    P12<-P12[!(P12$Well=="A09"),]
    P12<-P12[!(P12$Well=="E05"),]
        P12<-P12[!(P12$Well=="E04"),]#95C
        P12<-P12[!(P12$Well=="G05"),]#41G

#PLATE 13
    P13<-P13[!(P13$Well=="A09"),]
    P13<-P13[!(P13$Well=="A12"),]
    P13<-P13[!(P13$Well=="B12"),]
    P13<-P13[!(P13$Well=="C10"),]
    P13<-P13[!(P13$Well=="D10"),]
    P13<-P13[!(P13$Well=="D11"),]
    P13<-P13[!(P13$Well=="E10"),]
    P13<-P13[!(P13$Well=="F05"),]
    P13<-P13[!(P13$Well=="F06"),]
    P13<-P13[!(P13$Well=="A07"),]
    P13<-P13[!(P13$Well=="C12"),]
         P13<-P13[!(P13$Well=="G04"),]#147F

#PLATE 14
    P14<-P14[!(P14$Well=="A09"),]
    P14<-P14[!(P14$Well=="A12"),]
    P14<-P14[!(P14$Well=="B09"),]
        P14<-P14[!(P14$Well=="C03"),] #F1 issue
        P14<-P14[!(P14$Well=="E03"),] #F1 issue
        P14<-P14[!(P14$Well=="B10"),] #165D


#PLATE 15
    P15<-P15[!(P15$Well=="C10"),]
    P15<-P15[!(P15$Well=="D10"),]
    P15<-P15[!(P15$Well=="G03"),]
#PLATE 16
    P16<-P16[!(P16$Well=="D05"),]
    P16<-P16[!(P16$Well=="F04"),]
    P16<-P16[!(P16$Well=="F05"),]
#PLATE 17
    P17<-P17[!(P17$Well=="D09"),]
    P17<-P17[!(P17$Well=="E09"),]
        P17<-P17[!(P17$Well=="H02"),]#178D
        P17<-P17[!(P17$Well=="C09"),]#189F

#PLATE 18
    P18<-P18[!(P18$Well=="E09"),]
    P18<-P18[!(P18$Well=="F04"),]
    P18<-P18[!(P18$Well=="H04"),]
        P18<-P18[!(P18$Well=="G05"),]#205C
        P18<-P18[!(P18$Well=="G04"),]#197G

#PLATE 19
    P19<-P19[!(P19$Well=="C08"),]

#merge all plates
dData1 <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20)

#write.csv(dData1, "dData1TEST.csv")
#only keep columns you need (Sample, Target, Conc(copies/µL), Copies/20ulWell, Accepted Droplets, Positives, Negatives, Threshold1, metadata)

dData<-dData1[,c(1,2:4,11,16:18,31,66 ,68:79)]
dData$Conc.copies.µL.<-as.numeric(dData$Conc.copies.µL.)
dData$Temp<-as.factor(dData$Temp) #make Temp a factor
dData$Temp<-factor(dData$Temp, levels=c("27","30","31"))
dData$Day<-as.factor(dData$Day) #make Day a factor
dData$Day<-factor(dData$Day, levels=c("3","7","14"))
dData$Pot<-as.factor(dData$Pot)
```
False Positive Rate - the false positive rate was calculated using the manufacturors guidelines to 99% confidence. 
```{r}  
#subset only FalsePositives controls (controls included each primer set (C1, D1, F1 and G3) on aposymbiotic larvae and larvae infected with each of the other three symbiont genera (for example, C1 primers used on a D1-infected larva)).

FalsePos<-subset(dData, Info=="CONTROL") # subset only false positive controls 
#write.csv(FalsePos, "FalsePos.csv")
FalsePos1<-FalsePos #make copy

#subset for each primer pair:
FP_C1<-subset(FalsePos1, Primer=="C1") #n=61, n=56 with samples with less than <9000 dropletes rm
FP_D1<-subset(FalsePos1, Primer=="D1") #n=70, n=62 with samples with less than <9000 dropletes rm
FP_F1<-subset(FalsePos1, Primer=="F1") #n=56, n=52 with samples with less than <9000 dropletes rm
FP_G3<-subset(FalsePos1, Primer=="G3") #n=70, n=66 with samples with less than <9000 dropletes rm

# remove any less than 9000
FP_C1<-subset(FP_C1, Accepted.Droplets>9000)
FP_D1<-subset(FP_D1, Accepted.Droplets>9000)
FP_F1<-subset(FP_F1, Accepted.Droplets>9000)
FP_G3<-subset(FP_G3, Accepted.Droplets>9000)

#C1 FPR
sum(FP_C1$Positives) # 15 positives per 56 wells
15/56 # .268 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#D1 FPR
sum(FP_D1$Positives) # 16 positives per 62 wells
16/62# .258 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#F1 FPR
sum(FP_F1$Positives) # 24 positives per 52 wells
24/52 # .462 -> .5 events per well, Threshold = 3 for 95% confidence -> LOD 7 (95%) or 9 (99%), Threshold = 4 (99%) -> LOD 8(95%) 11 (99%)

#G3 FPR
sum(FP_G3$Positives) # 60 positives per 70 wells
60/70 # .857 -> .9 events per well, Threshold = 4 (95%) -> LOD 8(95%), 11 (99%), Threshold =5 (99%) -> LOD 10 (99%) 12 (99%)
```
 
Sample droplet cutoff (remove samples with less than 9000 dropletes), false pos rate (incoroprate), copy number (calculate), and calcualte cells/larvae
```{r}  
# 9000 cutoff - if total droplets are below 9000 remove samples  
dData1<-subset(dData, Accepted.Droplets>9000)# remove samples with less than 9000 droplets (we lose 44 ddpcr samples)

#subset by primer to then account for false positives by primer
C1_9000_fp<-subset(dData1, Primer=="C1")
D1_9000_fp<-subset(dData1, Primer=="D1")
F1_9000_fp<-subset(dData1, Primer=="F1")
G3_9000_fp<-subset(dData1, Primer=="G3")

#False pos, if Pos dropletes not above threshold, change to 0 positives. Use 95% LOD (limit of detection)
C1_9000_fp$Positives[C1_9000$Positives<5] <- 0   # 5 
D1_9000_fp$Positives[D1_9000$Positives<5] <- 0   # 5
F1_9000_fp$Positives[F1_9000$Positives<7] <- 0   #7
G3_9000_fp$Positives[G3_9000$Positives<8] <- 0   # 8

dData2<-rbind(C1_9000_fp,D1_9000_fp,F1_9000_fp,G3_9000_fp )

# use copies/1ul pcr to calculate how many copies are in 1 larvae. 
#(copies/1ul PCR)*(25ul PCR/y ul.DNA added)*(20uLDNA/1 larvae)
dData2$copies.larvae<-(dData2$Conc.copies.µL.)*(25/dData2$ul.DNA)*20

# divide copies by copy number per clade (CALC IN EXCEL, QCd)
dData2$copyNum[dData2$Primer=="C1"]<-2
dData2$copyNum[dData2$Primer=="D1"]<-1
dData2$copyNum[dData2$Primer=="F1"]<-3
dData2$copyNum[dData2$Primer=="G3"]<-19

# calc number of Sym cells in larvae
dData2$cells.larvae<-dData2$copies.larvae/dData2$copyNum
  dData2<-dData2[!(dData2$Info=="NTC"),]

#subset Samples
sData<-subset(dData2, Info=="ALL"|Info=="C1"|Info=="D1"|Info=="F1"|Info=="G3")
#write.csv(sData, "sData20191221.csv")
```

Create dfs for each symbiont genus. Subset for each ddPCR Infection trial (C1, D1, F1, G3, ALL).   
```{r}   
#subset by infection (individual and multi infections)
C1_9000<-subset(sData, Info=="C1")
D1_9000<-subset(sData, Info=="D1")
F1_9000<-subset(sData, Info=="F1")
G3_9000<-subset(sData, Info=="G3")
ALL_9000<-subset(sData, Info=="ALL")

# for the Multi infection, cast for Primer
# remove unneeded columns
ALL_9000a<-ALL_9000[,c("ALL.number","Primer","cells.larvae","Day","Temp","Pot")]
#write.csv(ALL_9000a, "ALL_9000a.csv")

#cast by primers - do this to see which larvae not all primers amplified and cut them for Relative Abund df
 ALLcast_9000_cast<-dcast(ALL_9000a, ALL.number~Primer, value.var = "cells.larvae") # cast()
# write.csv(ALLcast_9000_cast,"ALLcast_9000_cast.csv")

### For Relative Abundance df, remove larvae without amplification in all 4 symbiont genera: 
 # Samples ID'd manually ALL#s with all 0s:  105 (27C, D14), 115 (31C, D14), 134 (31C, D3), 156 (30C, D7), 195(30C, D7), 200 (30C, D7)).
ALL_9000b<-ALLcast_9000_cast

ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="105"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="115"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="134"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="156"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="195"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="200"),]

 # Remove rest of primers/larvae of missing ones (n=21 larvae): aka NAs
  ALL_9000b<-ALL_9000a[!(ALL_9000a$ALL.number=="136"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="135"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="236"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="227"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="111"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="120"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="137"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="204"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="30"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="188"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="130"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="138"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="231"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="125"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="187"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="209"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="122"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="208"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="232"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="233"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="177"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="78"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="64"),]
```

Multi-Infection   
Raw and relative abundance data frames for Multi-infection  
df = ALLcast_9000_cast2a <- df including all samples (even if not all four clades amplified)  
df = ALLcast_9000_cast2b <- df with only samples where all four clades amplified per larvae
```{r}  
# Raw df for comparision of counts within clade between Single vs Multi
ALLcast_9000_cast2a<-dcast(ALL_9000a, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()
ALLcast_9000_cast2a$C1_round<-round(ALLcast_9000_cast2a$C1) 
ALLcast_9000_cast2a$D1_round<-round(ALLcast_9000_cast2a$D1) 
ALLcast_9000_cast2a$F1_round<-round(ALLcast_9000_cast2a$F1) 
ALLcast_9000_cast2a$G3_round<-round(ALLcast_9000_cast2a$G3) 

 # Relative Abundance df to use to compare infection by clade in multi. 
ALLcast_9000_cast2b<-dcast(ALL_9000b, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()
ALLcast_9000_cast2b$C1<-round(ALLcast_9000_cast2b$C1) 
ALLcast_9000_cast2b$D1<-round(ALLcast_9000_cast2b$D1) 
ALLcast_9000_cast2b$F1<-round(ALLcast_9000_cast2b$F1) 
ALLcast_9000_cast2b$G3<-round(ALLcast_9000_cast2b$G3) 
```

Individual-Infection:  
Combine ddPCR df with the hemocytometer/scope count data from each time point for "Full" dataset for INDIVIDUAL INFECTIONS 
Organize data: oragnize, scope + hemo data
```{r} 
# create count.type column for hemo and scope id  
Countdat_D3<-subset(Countdat1, Day=="3") #subset day 3, scope counts, individuals
Countdat_D3$count.type<-"scope"
Countdat_D714<-subset(Countdat1, Day=="7"|Day=="14") #subset days 7 and 14, hemo counts
Countdat_D714$count.type<-"hemo"
 
Countdat_2<-rbind(Countdat_D3,Countdat_D714) #bind together for non-ddPCR dataset 
```

#Do ddPCR counts differe significantly from hemocytometer + scope counts?
For individual infections, we additionally counted symbionts by eye (flurescent scope) on Day 3, and by hemoctyometer (Days 7 and 14). Running a model2 analysis, we show that the slope of ddPCR x scope/hemo counts is not different than 1. 

Organize dfs:
```{r}    
#C1   
#organize the ddPCR data for individual infections  
C1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
C1_9000b<-C1_9000[C1_vars]
colnames(C1_9000b)[colnames(C1_9000b)=="Info"] <- "Symbiont"
C1_9000b$count.type<-"ddPCR"
summary(C1_9000b$cells.larvae)
hist(C1_9000b$cells.larvae) #not normal

#organize hemo data
C1countdat<-subset(Countdat_2, Symbiont=="C1")
hist(C1countdat$cells.larvae)
C1Full<-rbind(C1_9000b,C1countdat) #combine hemo and ddPCR
hist(C1Full$cells.larvae) #right skew
C1Full$cells.larvae_log<-log10(C1Full$cells.larvae+1) #log counts
hist(C1Full$cells.larvae_log)


#D1
#organize the ddPCR data 
D1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
D1_9000b<-D1_9000[D1_vars]
colnames(D1_9000b)[colnames(D1_9000b)=="Info"] <- "Symbiont"
D1_9000b$count.type<-"ddPCR"
hist(D1_9000b$cells.larvae) 

#organize hemo data
D1countdat<-subset(Countdat_2, Symbiont=="D1")
D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR
D1Full$cells.larvae_log<-log10(D1Full$cells.larvae+1) #log counts
hist(D1Full$cells.larvae_log)

#F1
#organize the ddPCR data   
F1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
F1_9000b<-F1_9000[F1_vars]
colnames(F1_9000b)[colnames(F1_9000b)=="Info"] <- "Symbiont"
F1_9000b$count.type<-"ddPCR"
hist(F1_9000b$cells.larvae)
#F1_9000b$cells.larvae_log<-log(F1_9000b$cells.larvae+1)
  #hist(F1_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
F1countdat<-subset(Countdat_2, Symbiont=="F1")
F1Full<-rbind(F1_9000b,F1countdat) #combine hemo and ddPCR
hist(F1Full$cells.larvae_log) 
F1Full$cells.larvae_log<-log10(F1Full$cells.larvae+1)

#G3
#organize the ddPCR data 
G3_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
G3_9000b<-G3_9000[G3_vars]
colnames(G3_9000b)[colnames(G3_9000b)=="Info"] <- "Symbiont"
G3_9000b$count.type<-"ddPCR"
hist(G3_9000b$cells.larvae)
#G3_9000b$cells.larvae_log<-log(G3_9000b$cells.larvae+1)
#  hist(G3_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
G3countdat<-subset(Countdat_2, Symbiont=="G3")
G3Full<-rbind(G3_9000b,G3countdat) #combine hemo and ddPCR
hist(G3Full$cells.larvae) 
G3Full$cells.larvae_log<-log10(G3Full$cells.larvae+1)
hist(G3Full$cells.larvae_log) 


#Means for clade/temp/pot/day for ddpcr x scopehemo

#Raw means scope and hemo only
scopehemoFull_mean<- ddply(Countdat_2, c("Day", "Temp","Symbiont","Pot","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
);scopehemoFull_mean #display table
scopehemoFull_mean$mean<-round(scopehemoFull_mean$mean)
#write.csv(scopehemoFull_mean,"scopehemoFull_mean.csv")

scopehemoFull_meanVars<-c("Temp","Day","Pot", "Symbiont","mean","count.type") #keep only cols you need
scopehemoFull_mean2<-scopehemoFull_mean[scopehemoFull_meanVars]
colnames(scopehemoFull_mean2)[colnames(scopehemoFull_mean2)=="mean"] <- "Countmean"


# raw means for ddPCR  only
ddPCRcompare<-rbind(C1_9000b,D1_9000b,F1_9000b,G3_9000b)
#Raw means
ddPCRcompare_mean<- ddply(ddPCRcompare, c("Day", "Temp","Symbiont","Pot", "count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
);ddPCRcompare_mean #display table
ddPCRcompare_mean$mean<-round(ddPCRcompare_mean$mean)

ddPCRcompareVars<-c("Temp","Day","Pot", "Symbiont","mean","count.type")
ddPCRcompare_mean2<-ddPCRcompare_mean[ddPCRcompareVars]
colnames(ddPCRcompare_mean2)[colnames(ddPCRcompare_mean2)=="mean"] <- "ddPCRmean" 
 
#write.csv(ddPCRcompare_mean,"ddPCRcompare_mean.csv")
# combine Scope and ddPCR
scopehemo_ddPCRCompare<-merge(scopehemoFull_mean2,ddPCRcompare_mean2,by=c("Symbiont","Temp","Day","Pot"))

```

Regression 
Scope/hemo Calc means for clade/temp/time/pot VS ddPCR

Model2 regression
```{r}
#Model_II_linear_regression    https://rpubs.com/jasonvenkiteswaran/22815 

#everything
scopehemo_ddPCRCompare$Countmean_log<-log10(scopehemo_ddPCRCompare$Countmean+1) #log10 the hemo/scope counts
hist(scopehemo_ddPCRCompare$Countmean_log)
scopehemo_ddPCRCompare$ddPCRmean_log<-log10(scopehemo_ddPCRCompare$ddPCRmean+1) #log10 the ddPCR counts
hist(scopehemo_ddPCRCompare$ddPCRmean_log)

#ScopeHemo ddPCR 
lmodel2(ddPCRmean_log~Countmean_log, data = scopehemo_ddPCRCompare)
# y =0.94x + 0 to convert scope/hemo to ddPCR Use MA, force 0 intercept. CN said ok to 0.18 ->0

#reshape this data into one long col. not straighforward to sorry you had to download and reupload
#write.csv(scopehemo_ddPCRCompare,"scopehemo_ddPCRCompare.csv")
scopehemo_ddPCRCompare_all<-read.csv("scopehemo_ddPCRCompare_all.csv")
scopehemo_ddPCRCompare_all$code<-as.factor(scopehemo_ddPCRCompare_all$code)
lmodel2(Countmean_log~coundition+(1|code), data = scopehemo_ddPCRCompare_all)

#Scope vs ddPCR
scope_ddPCRCompare<-subset(scopehemo_ddPCRCompare, count.type.x=="scope")
lmodel2(ddPCRmean_log~Countmean_log, data = scope_ddPCRCompare)

#Hemo vs ddPCR
hemo_ddPCRCompare<-subset(scopehemo_ddPCRCompare, count.type.x=="hemo")
lmodel2(ddPCRmean_log~Countmean_log, data = hemo_ddPCRCompare)

```

Right plot: logged10 plot   
AH- Ideally, I want to plot the 95% confidence intervales on the regression line. But since I tell am manually entering the info, the confidence intervales are showing up wrong. Ideas? 

See what I did with adding two more geom_abline's. Since you want it to be sloped, geom_line wont work. Now you can go an edit the "intercept" to match your confidence intervals. I just set them to +- 1 for visualization. - AH  
```{r} 

#so in order to plot the confidence intervals, you have to use this: 
test<-lmodel2(ddPCRmean_log~Countmean_log+Countmean_log:count.type.x, data = scopehemo_ddPCRCompare)  
plot(test)
plot(test, "MA")

 

#the is the ggplot lm version...not exactly what we want
ggplot(data = scopehemo_ddPCRCompare) + 
  geom_point(aes(x = Countmean_log, y = ddPCRmean_log), size = 2) +
  geom_smooth(aes(x = Countmean_log, y = ddPCRmean_log), method = 'lm', alpha = 0.35) +
  labs(x = "counts", y ="ddPCR", title = "") +
  theme_bw()

#since this is a base R function you would have to look up how to do the colaration, etc. that you want. The blue lines are your confidence intervals 



##### THIS IS THE ONE YOU WANT

#figure out how to map 50% conf interval
ggplot(data=scopehemo_ddPCRCompare,aes(x=Countmean_log, y=ddPCRmean_log)) +
   geom_point(aes(colour=factor(count.type.x))) +
   #geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,aes(group=1),colour="black")+
   scale_colour_manual(name="condition",
       values=c("darkgray","orange"))+
  #scale_x_continuous(trans = "log10")+
  #scale_y_continuous(trans = "log10")+
theme_classic()+
 geom_abline(intercept = 0, slope = .94)+ #add in lmodel2 slope/intercept
  #geom_smooth(aes(ymin=.73, ymax=1.20))+     # when I run these lines it make a new line and plots conf int on those
  #geom_smooth(aes(ymin=.73, ymax=1.20, fill =count.type.x, colour=count.type.x,stat="identity"))
   geom_abline(intercept = 1.2, slope = .94, color = "red", linetype = "dashed")+
   geom_abline(intercept = -1.2, slope = .94, color = "red", linetype = "dashed")

#geom_line(aes(y = .73), color = "red", linetype = "dashed")+ 
    #geom_line(aes(y = 1.2), color = "red", linetype = "dashed")
  
 #stat_ellipse(aes(x=Countmean, y=ddPCRmean, aes(fill=Symbiont)),type = "norm"), linetype = 2)+
#stat_ellipse(geom = "polygon", alpha = 1/4, level=0.5,aes(fill = Symbiont)) # alpha lets you choose confidence interval for ellipse



##lm ddpcrmean_log~countmean_log+countmean_log:count.type.x
CountsMOD<-lm(ddPCRmean_log~Countmean_log+Countmean_log:count.type.x,data = scopehemo_ddPCRCompare)
anova(CountsMOD)

```

Apply hemo.scope conversion and remake df with raw counts
```{r} 
#Convert Scope/hemo data, remake df with ddPCR data. Make new col with "raw" counts post conversion of logs
#C1
C1FullddPCR<-subset(C1Full, count.type=="ddPCR")
C1Fullscopehemo<-subset(C1Full, count.type=="hemo"|count.type=="scope")
#C1Fullscopehemo$cells.larvae_log_Pre<-C1Fullscopehemo$cells.larvae_log #save old to check then comment out
C1Fullscopehemo$cells.larvae_log<-(C1Fullscopehemo$cells.larvae_log*0.94) #convert and check
C1Full<-rbind(C1FullddPCR,C1Fullscopehemo) #rebind with ddPCR
C1Full$cells.larvae_counts<-(10^C1Full$cells.larvae_log)-1  #converted all log back to Raw counts
C1Full$cells.larvae_counts_round<-round(C1Full$cells.larvae_counts)

plot(C1Full$cells.larvae, C1Full$cells.larvae_counts_round) #check

#D1
D1FullddPCR<-subset(D1Full, count.type=="ddPCR")
D1Fullscopehemo<-subset(D1Full, count.type=="hemo"|count.type=="scope")
#D1Fullscopehemo$cells.larvae_log_Pre<-D1Fullscopehemo$cells.larvae_log #save old to check then comment out
D1Fullscopehemo$cells.larvae_log<-(D1Fullscopehemo$cells.larvae_log*0.94) #convert and check
D1Full<-rbind(D1FullddPCR,D1Fullscopehemo) #rebind with ddPCR
D1Full$cells.larvae_counts<-(10^D1Full$cells.larvae_log)-1  #converted all log back to Raw counts
D1Full$cells.larvae_counts_round<-round(D1Full$cells.larvae_counts)

#F1
F1FullddPCR<-subset(F1Full, count.type=="ddPCR")
F1Fullscopehemo<-subset(F1Full, count.type=="hemo"|count.type=="scope")
#F1Fullscopehemo$cells.larvae_log_Pre<-F1Fullscopehemo$cells.larvae_log #save old to check then comment out
F1Fullscopehemo$cells.larvae_log<-(F1Fullscopehemo$cells.larvae_log*0.94) #convert and check
F1Full<-rbind(F1FullddPCR,F1Fullscopehemo) #rebind with ddPCR
F1Full$cells.larvae_counts<-(10^F1Full$cells.larvae_log)-1  #converted all log back to Raw counts
F1Full$cells.larvae_counts_round<-round(F1Full$cells.larvae_counts)

#G3
G3FullddPCR<-subset(G3Full, count.type=="ddPCR")
G3Fullscopehemo<-subset(G3Full, count.type=="hemo"|count.type=="scope")
#G3Fullscopehemo$cells.larvae_log_Pre<-G3Fullscopehemo$cells.larvae_log #save old to check then comment out
G3Fullscopehemo$cells.larvae_log<-(G3Fullscopehemo$cells.larvae_log*0.94) #convert and check
G3Full<-rbind(G3FullddPCR,G3Fullscopehemo) #rebind with ddPCR
G3Full$cells.larvae_counts<-(10^G3Full$cells.larvae_log)-1  #converted all log back to Raw counts
G3Full$cells.larvae_counts_round<-round(G3Full$cells.larvae_counts)
  
```




#Single Infection: Binomial: Did a larvae infect (Y/N)
dfs: C1Full, D1Full, F1Full, G3Full
Questions: 
1. Within each genus, what is the effect of temp and time on what percent of larvae infect with at leaste one symbiont?
- I predict that within each genus, infected larvae will increase over time, and decrease at high temperatures. 
2. At each temperature, which clades infects more successfully, over time?
- At ambient temperature, I hypothesize that C1 will be the most successful, and D1 at high temps. I predict that within each genus, infection rate will grow over time. 

Model:  `glmer(Infect~Symbiont*Day*Temp+(1|potCode)`, family=binomial)
```{r}    
BinaryInfect<-rbind(C1Full,D1Full, F1Full, G3Full)  # make new df for binary infection
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_round>0]<-1  #make new col for infect or not 1 for infect, 0 not.
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_round==0]<-0
 BinaryInfect$Infect<-as.character(BinaryInfect$Infect)
  BinaryInfect$Infect<-as.numeric(BinaryInfect$Infect)
 BinaryInfect$count.type<-as.factor(BinaryInfect$count.type) #make factor

 #write.csv(BinaryInfect,"BinaryInfect.csv")
 
 #rename Pot interaction as a code: Pot_Temp
 BinaryInfect$PotCode<-paste0(BinaryInfect$Temp, BinaryInfect$Pot,BinaryInfect$Symbiont )
 BinaryInfect$PotCode<-as.factor(BinaryInfect$PotCode) #make factor

 
 
#Full model including all clades/temp/time:
 Binary_mod<-glmer(Infect~Symbiont*Temp*Day+(1|PotCode), family="binomial", BinaryInfect) #
  Anova(Binary_mod)
dispersion_glmer(Binary_mod) # no overdispersion 
  emm<-emmeans(Binary_mod,  ~ Symbiont*Temp*Day)
  pairs(emm)
  cld(emm)  
```

By clade: infection ~ Temp*Day
```{r} 
#by clade:  
#C1
  Binary_C1<-subset(BinaryInfect, Symbiont=="C1")
  Binary_C1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_C1)
  Anova(Binary_C1_mod)
  dispersion_glmer(Binary_C1_mod)  #no overdispersion 
    emm<-emmeans(Binary_C1_mod,  ~ Temp|Day)
  pairs(emm)
  cld(emm)  
   emm<-emmeans(Binary_C1_mod,  ~ Day|Temp)
  pairs(emm)
  cld(emm) 
  
#D1 
  Binary_D1<-subset(BinaryInfect, Symbiont=="D1") #we don't have day 14 31C, this throws errors
  Binary_D1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_D1) 
  Anova(Binary_D1_mod)
  dispersion_glmer(Binary_D1_mod)  #no overdispersion 
  
#F1
  Binary_F1<-subset(BinaryInfect, Symbiont=="F1")
  Binary_F1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_F1) 
  Anova(Binary_F1_mod)
  dispersion_glmer(Binary_F1_mod)  #no overdispersion 

#G3
  Binary_G3<-subset(BinaryInfect, Symbiont=="G3")
  Binary_G3mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_G3)  
  Anova(Binary_G3mod) 
  dispersion_glmer(Binary_G3mod)  #no overdispersion  
```

Plot: Clade by temp/time:
C1
```{r}    
Infect_N_mean_C1 <- ddply(Binary_C1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_C1 #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_C1$Day.num<-as.numeric(Infect_N_mean_C1$Day)
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 2] =7
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 3] =14
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 1] =3
#plot
C1_Infect_plot<-ggplot(data=Infect_N_mean_C1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("Cladocopium")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));C1_Infect_plot
```
D1 
```{r} 
#D1  
 

Infect_N_mean_D1 <- ddply(Binary_D1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_D1 #display table 
#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_D1$Day.num<-as.numeric(Infect_N_mean_D1$Day)
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 2] =7
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 3] =14
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 1] =3

#plot
D1_Infect_plot<-ggplot(data=Infect_N_mean_D1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Durusdinium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));D1_Infect_plot

```
F1 
```{r} 
#F1
 

Infect_N_mean_F1 <- ddply(Binary_F1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_F1 #display table 

#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_F1$Day.num<-as.numeric(Infect_N_mean_F1$Day)
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 2] =7
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 3] =14
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 1] =3
#plot
F1_Infect_plot<-ggplot(data=Infect_N_mean_F1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Fugacium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));F1_Infect_plot
```
G3 
```{r}    
#G3 

Infect_N_mean_G3 <- ddply(Binary_G3, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_G3 #display table 

#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_G3$Day.num<-as.numeric(Infect_N_mean_G3$Day)
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 2] =7
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 3] =14
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 1] =3

#plot
G3_Infect_plot<-ggplot(data=Infect_N_mean_G3Test, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  ylim(0,1) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Gerakladium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));G3_Infect_plot
```
Figure x 
```{r}
#log scale axis only 
C1_Infect_plot<-C1_Infect_plot+ theme(legend.position = "none") #remove legend
D1_Infect_plot<-D1_Infect_plot+ theme(legend.position = "none") #remove legend
F1_Infect_plot<-F1_Infect_plot+ theme(legend.position = "none") #remove legend
G3_Infect_plot<-G3_Infect_plot+ theme(legend.position = "none") #remove legend
grid.arrange(C1_Infect_plot, D1_Infect_plot, F1_Infect_plot,G3_Infect_plot, nrow = 1)


```


Stats: By Temperature: at each temp, which clade infects the best?
```{r}   
#by Temp: 

#27C
  Binary_27C<-subset(BinaryInfect, Temp=="27")
  Binary_27C_mod<-glmer(Infect~Symbiont*Day+(1|PotCode), family="binomial", Binary_27C)
  Anova(Binary_27C_mod)
  dispersion_glmer(Binary_27C_mod)  #no overdispersion 
    emm<-emmeans(Binary_27C_mod,  ~ Symbiont|Day)
  pairs(emm)
  cld(emm)  
  
   
#30C
  Binary_30C<-subset(BinaryInfect, Temp=="30")
  Binary_30C_mod<-glmer(Infect~Symbiont*Day+(1|PotCode), family="binomial", Binary_30C)
  Anova(Binary_30C_mod)
  dispersion_glmer(Binary_30C_mod)  #no overdispersion 
    emm<-emmeans(Binary_30C_mod,  ~ Symbiont|Day)
  pairs(emm)
  cld(emm)

#31C
  Binary_31C<-subset(BinaryInfect, Temp=="31")
  Binary_31C<-na.omit(Binary_31C)
  Binary_31C_mod<-glmer(Infect~Symbiont*Day+(1|PotCode), family="binomial", Binary_31C)
  Anova(Binary_31C_mod)
  dispersion_glmer(Binary_31C_mod)  #no overdispersion 
    emm<-emmeans(Binary_31C_mod,  ~ Symbiont|Day)
  pairs(emm)
  cld(emm) 
  
```
Plots: Binary infection clade compare by Temp
```{r}
#27C  
  
Infect_N_mean_27 <- ddply(Binary_27C, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_27 #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_27$Day.num<-as.numeric(Infect_N_mean_27$Day)
Infect_N_mean_27$Day.num[Infect_N_mean_27$Day.num == 2] =7
Infect_N_mean_27$Day.num[Infect_N_mean_27$Day.num == 3] =14
Infect_N_mean_27$Day.num[Infect_N_mean_27$Day.num == 1] =3

Infect_N_mean_27$Symbiont <- ordered(Infect_N_mean_27$Symbiont , levels = c("C1", "D1", "F1","G3"))


#plot
Infect_27_plot<-ggplot(data=Infect_N_mean_27, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("27C")+ 
  theme(plot.title = element_text(size=20,  hjust=0.5));Infect_27_plot




#30
Infect_N_mean_30 <- ddply(Binary_30C, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_30 #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_30$Day.num<-as.numeric(Infect_N_mean_30$Day)
Infect_N_mean_30$Day.num[Infect_N_mean_30$Day.num == 2] =7
Infect_N_mean_30$Day.num[Infect_N_mean_30$Day.num == 3] =14
Infect_N_mean_30$Day.num[Infect_N_mean_30$Day.num == 1] =3

Infect_N_mean_30$Symbiont <- ordered(Infect_N_mean_30$Symbiont , levels = c("C1", "D1", "F1","G3"))


#plot
Infect_30_plot<-ggplot(data=Infect_N_mean_30, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("30C")+ 
  theme(plot.title = element_text(size=20, hjust=0.5));Infect_30_plot


#31
Infect_N_mean_31 <- ddply(Binary_31C, c("Symbiont","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_31 #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_31$Day.num<-as.numeric(Infect_N_mean_31$Day)
Infect_N_mean_31$Day.num[Infect_N_mean_31$Day.num == 2] =7
Infect_N_mean_31$Day.num[Infect_N_mean_31$Day.num == 3] =14
Infect_N_mean_31$Day.num[Infect_N_mean_31$Day.num == 1] =3

Infect_N_mean_31$Symbiont <- ordered(Infect_N_mean_31$Symbiont , levels = c("C1", "D1", "F1","G3"))


#plot
Infect_31_plot<-ggplot(data=Infect_N_mean_31, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) + 
 ggtitle("31C")+ 
  theme(plot.title = element_text(size=20,  hjust=0.5));Infect_31_plot


#combine plots
Infect_27_plot<-Infect_27_plot+ theme(legend.position = "none") #remove legend
Infect_30_plot<-Infect_30_plot+ theme(legend.position = "none") #remove legend
Infect_31_plot<-Infect_31_plot+ theme(legend.position = "none") #remove legend
grid.arrange(Infect_27_plot, Infect_30_plot, Infect_31_plot, nrow = 1)


#combine By clade plots and by temp plots in 2 row figure
grid.arrange(C1_Infect_plot, D1_Infect_plot, F1_Infect_plot,G3_Infect_plot,Infect_27_plot, Infect_30_plot, Infect_31_plot, nrow = 2)

```





  
#PLOT SINGLE INFECTIONS (count data) With 0s included!!!!!! 
  
Model: `lmer(Infect~Symbiont*Temp*Day+(1|PotCode))`
   
C1 single infection plot  
```{r}       
C1Full_mean <- ddply(C1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
C1Full_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1Full_mean$Day.num<-as.numeric(C1Full_mean$Day)
C1Full_mean$Day.num[C1Full_mean$Day.num == 2] =7
C1Full_mean$Day.num[C1Full_mean$Day.num == 3] =14
C1Full_mean$Day.num[C1Full_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
C1Full_plot_9000<-ggplot(data=C1Full_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));C1Full_plot_9000
``` 

D1 single infection plot
```{r}     
D1Full_mean <- ddply(D1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
D1Full_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1Full_mean$Day.num<-as.numeric(D1Full_mean$Day)
D1Full_mean$Day.num[D1Full_mean$Day.num == 2] =7
D1Full_mean$Day.num[D1Full_mean$Day.num == 3] =14
D1Full_mean$Day.num[D1Full_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
D1Full_plot_9000<-ggplot(data=D1Full_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Durusdinium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));D1Full_plot_9000
``` 

F1 single infection  plot
```{r}     
F1Full_mean <- ddply(F1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
  
F1Full_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1Full_mean$Day.num<-as.numeric(F1Full_mean$Day)
F1Full_mean$Day.num[F1Full_mean$Day.num == 2] =7
F1Full_mean$Day.num[F1Full_mean$Day.num == 3] =14
F1Full_mean$Day.num[F1Full_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
F1Full_plot_9000<-ggplot(data=F1Full_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
 geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Fugacium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));F1Full_plot_9000
``` 

G3 single infection plot
```{r}     
G3Full_mean <- ddply(G3Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
G3Full_mean #display table 

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3Full_mean$Day.num<-as.numeric(G3Full_mean$Day)
G3Full_mean$Day.num[G3Full_mean$Day.num == 2] =7
G3Full_mean$Day.num[G3Full_mean$Day.num == 3] =14
G3Full_mean$Day.num[G3Full_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
G3Full_plot_9000<-ggplot(data=G3Full_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
 geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Gerakladium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));G3Full_plot_9000
``` 

Plot all four SINGLE INFECTION together: Figure x
```{r} 
#log scale axis only 
C1Full_plot_9000<-C1Full_plot_9000+ theme(legend.position = "none") #remove legend
D1Full_plot_9000<-D1Full_plot_9000+ theme(legend.position = "none") #remove legend
F1Full_plot_9000<-F1Full_plot_9000+ theme(legend.position = "none") #remove legend
G3Full_plot_9000<-G3Full_plot_9000+ theme(legend.position = "none") #remove legend
grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000, nrow = 1)
```

Plot by temp
```{r}   

#27C BinaryInfect
temp27_counts<-subset(BinaryInfect, Temp==27)
temp27_counts_mean <- ddply(temp27_counts, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
temp27_counts_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
temp27_counts_mean$Day.num<-as.numeric(temp27_counts_mean$Day)
temp27_counts_mean$Day.num[temp27_counts_mean$Day.num == 2] =7
temp27_counts_mean$Day.num[temp27_counts_mean$Day.num == 3] =14
temp27_counts_mean$Day.num[temp27_counts_mean$Day.num == 1] =3
 
#plot with yaxis log10, real data (not transformed)
temp27_counts_mean_plot<-ggplot(data=temp27_counts_mean, aes(x=Day.num, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+  
  geom_line(aes(color=Symbiont),linetype="dotted")+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("") + #Label the X Axis
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));temp27_counts_mean_plot
``` 





#STATS FOR SINGLE INFECTION with 0s
Model 1: `lmer(cell.counts~Day*Temp)` using log transformed! (Cells.larvae_log)  
Single infections: Only data where infection happened
```{r}   
hist(C1Full$cells.larvae_log) # normal
hist(D1Full$cells.larvae_log) # normal
hist(F1Full$cells.larvae_log) # normal
hist(G3Full$cells.larvae_log) #normal

Singles<-rbind(C1Full,D1Full,F1Full,G3Full)
hist(Singles$cells.larvae_log) # normal 

#rename Pot interaction as a code: Pot_Temp
 Singles$PotCode<-paste0(Singles$Temp, Singles$Pot,Singles$Symbiont )
 Singles$PotCode<-as.factor(Singles$PotCode) #make factor

#Full model  
## lmer  symbionts*days*temp
Single_all_mod<-lmer(cells.larvae_log~Symbiont*Day*Temp+(1|PotCode), Singles)
anova(Single_all_mod) 
qqPlot(residuals(Single_all_mod))   # good

  emm<-emmeans(Single_all_mod,  ~ Symbiont*Temp *Day, adjust="Tukey")
cld(emm)
```
 
C1 single  
```{r} 
#C1     
Singles_C1<-subset(Singles, Symbiont=="C1")
C1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_C1)
anova(C1mod)
#summary(C1mod) #for std err df and t
qqPlot(residuals(C1mod))   #  good

#post hoc diff at each day
 emm<-emmeans(C1mod,  ~ Temp |Day, adjust="Tukey")
cld(emm, Letter="abcdefg")
pairs(emm)
#post hoc within temp
 emm<-emmeans(C1mod,  ~ Day |Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")
pairs(emm)

```
D1 singles    
```{r}
#D1   
Singles_D1<-subset(Singles, Symbiont=="D1")
D1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_D1)
anova(D1mod)
#summary(D1mod) #for std err df and t
qqPlot(residuals(D1mod))   #  low end
  emm<-emmeans(D1mod,  ~ Day |Temp, adjust="Tukey")
cld(emm)
pairs(emm)

emm<-emmeans(D1mod,  ~ Temp |Day, adjust="Tukey")
cld(emm)
pairs(emm) 
```
F1 singles  
```{r} 
#F1   
Singles_F1<-subset(Singles, Symbiont=="F1")
F1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_F1)
anova(F1mod)
#summary(F1mod) #for std err df and t
qqPlot(residuals(F1mod))   #  good
  emm<-emmeans(F1mod,  ~ Temp |Day, adjust="Tukey")
cld(emm)
pairs(emm)

emm<-emmeans(F1mod,  ~ Day |Temp, adjust="Tukey")
cld(emm)
pairs(emm)
```
G3 singles  
```{r} 
#G3   
Singles_G3<-subset(Singles, Symbiont=="G3")
G3mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_G3)
anova(G3mod)
#summary(G3mod) #for std err df and t
qqPlot(residuals(G3mod))   #  good
  emm<-emmeans(G3mod,  ~ Temp|Day, adjust="Tukey")
cld(emm)
pairs(emm)

  emm<-emmeans(G3mod,  ~ Day|Temp, adjust="Tukey")
cld(emm)
pairs(emm)
```
By temp:
27C
```{r}
#27C    
Singles_27<-subset(Singles, Temp=="27")
Singles_27_mod<-lmer(cells.larvae_log~Day*Symbiont+(1|PotCode), Singles_27)
anova(Singles_27_mod)
#summary(C1mod) #for std err df and t
qqPlot(residuals(Singles_27_mod))   #  good

#post hoc diff at each day
 emm<-emmeans(Singles_27_mod,  ~ Symbiont |Day, adjust="Tukey")
cld(emm)
pairs(emm)

```

30
```{r}
#30C    
Singles_30<-subset(Singles, Temp=="30")
Singles_30_mod<-lmer(cells.larvae_log~Day*Symbiont+(1|PotCode), Singles_30)
anova(Singles_30_mod)
#summary(C1mod) #for std err df and t
qqPlot(residuals(Singles_30_mod))   #  good

#post hoc diff at each day
 emm<-emmeans(Singles_30_mod,  ~ Symbiont |Day, adjust="Tukey")
cld(emm)
pairs(emm)

```

31C
```{r}
#31C    
Singles_31<-subset(Singles, Temp=="31")
Singles_31_mod<-lmer(cells.larvae_log~Day*Symbiont+(1|PotCode), Singles_31)
anova(Singles_31_mod)
#summary(C1mod) #for std err df and t
qqPlot(residuals(Singles_31_mod))   #  good

#post hoc diff at each day
 emm<-emmeans(Singles_31_mod,  ~ Symbiont |Day, adjust="Tukey")
cld(emm)
pairs(emm)

```



Testing diff wanys to plot: Single comparision days between symbs, boxplots. I kinda like this, but also, think line is more straight forward.
```{r}  
#cool plot
ggplot(Singles, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = NULL, y = "Weight") +
  guides(color = FALSE)

#cool plot day 3 only
AllSing_D3<-subset(Singles, Day==3)
ggplot(AllSing_D3, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = NULL, y = "Cell counts (log10)") +
  guides(color = FALSE)

#cool plot day 7 only
AllSing_D7<-subset(Singles, Day==7)
ggplot(AllSing_D7, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = "Temp", y = "Cell counts (log10)") +
  guides(color = FALSE)

#cool plot day 14 only
AllSing_D14<-subset(Singles, Day==14)
ggplot(AllSing_D14, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = "Temp", y = "Cell counts (log10)") +
  guides(color = FALSE)



```
  

  
  
  
  
  
  
  
  
#Single Infection: Fig 1: Heat maps, by clade (temp x time)  
https://sebastianraschka.com/Articles/heatmaps_in_r.html
Individual clades heatmaps SINGLE, C1Full 0s NOT REMOVED, dfs: C1Full, D1Full, F1Full, G3Full 
```{r} 
Hist1<-hist(C1Full$cells.larvae_log)
Hist2<-hist(D1Full$cells.larvae_log)
Hist3<-hist(F1Full$cells.larvae_log)
Hist4<-hist(G3Full$cells.larvae_log)

library(RColorBrewer)
#C1

C1Full_mean <- ddply(C1Full, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
C1Full_mean #display table
C1Full_mean$mean<-round(C1Full_mean$mean, digits = 2) #round the means

  C1Full_vars<-c("Temp","Day","mean")
C1Full_mean2<-C1Full_mean[C1Full_vars] 
C1Full_mean3<-cast(C1Full_mean2, Temp~Day, mean) #set updata for heatmap

C1rnames <- C1Full_mean3[,1]                            # assign labels in column 1 to "rnames"
C1mat_data <- data.matrix(C1Full_mean3[,2:ncol(C1Full_mean3)])  # transform column 2-5 into a matrix
rownames(C1mat_data) <- C1rnames                  # assign row names

# creates a own color palette from red to green
cols <- brewer.pal(6, "YlGn")
cols
my_palette <- colorRampPalette(cols)


C1heat<-heatmap.2(C1mat_data,
  cellnote = C1mat_data,  # same data set for cell labels
  main = "C1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

#D1
#D1Full
D1Full_mean <- ddply(D1Full, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
D1Full_mean #display table
D1Full_mean$mean<-round(D1Full_mean$mean, digits = 2) #round the means

  D1Full_vars<-c("Temp","Day","mean")
D1Full_mean2<-D1Full_mean[D1Full_vars] 
D1Full_mean3<-cast(D1Full_mean2, Temp~Day, mean) #set updata for heatmap

D1rnames <- D1Full_mean3[,1]                            # assign labels in column 1 to "rnames"
D1mat_data <- data.matrix(D1Full_mean3[,2:ncol(D1Full_mean3)])  # transform column 2-5 into a matrix
rownames(D1mat_data) <- D1rnames                  # assign row names

D1heat<-heatmap.2(D1mat_data,
  cellnote = D1mat_data,  # same data set for cell labels
  main = "D1 ", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA"    )        # turn off column clustering

#F1
#F1Full
F1Full_mean <- ddply(F1Full, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
F1Full_mean #display table
F1Full_mean$mean<-round(F1Full_mean$mean, digits = 2) #round the means

  F1Full_vars<-c("Temp","Day","mean")
F1Full_mean2<-F1Full_mean[F1Full_vars] 
F1Full_mean3<-cast(F1Full_mean2, Temp~Day, mean) #set updata for heatmap

F1rnames2 <- F1Full_mean3[,1]                            # assign labels in column 1 to "rnames"
F1mat_data2 <- data.matrix(F1Full_mean3[,2:ncol(F1Full_mean3)])  # transform column 2-5 into a matrix
rownames(F1mat_data2) <- F1rnames2                  # assign row names


F1heat2<-heatmap.2(F1mat_data2,
  cellnote = F1mat_data2,  # same data set for cell labels
  main = "F1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

#G3
#G3Full
G3Full_mean <- ddply(G3Full, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
G3Full_mean #display table
G3Full_mean$mean<-round(G3Full_mean$mean, digits = 2) #round the means

  G3Full_vars<-c("Temp","Day","mean")
G3Full_mean2<-G3Full_mean[G3Full_vars] 
G3Full_mean3<-cast(G3Full_mean2, Temp~Day, mean) #set updata for heatmap

G3rnames2 <- G3Full_mean3[,1]                            # assign labels in column 1 to "rnames"
G3mat_data2 <- data.matrix(G3Full_mean3[,2:ncol(G3Full_mean3)])  # transform column 2-5 into a matrix
rownames(G3mat_data2) <- G3rnames2                  # assign row names


G3heat<-heatmap.2(G3mat_data2,
  cellnote = G3mat_data2,  # same data set for cell labels
  main = "G3", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  #dendrogram="row",     # only draw a row dendrogram
  Rowv=FALSE,
  dendrogram='none')     #turn off dentrogram

  #Colv="NA")            # turn off column clustering



```

#Multi-infection
**Use only Relabundance for within larvae comparisons, use Raw for comparision with Single infections **    
df: ALL_9000b (has larvae removed where not all clades amped in each individual)   
Binomial - A. did the larvae infect at all? with anything, or B. did each individual clade infect     

#A. GLMER Binomial. Did larvae infect or not, by clade and across clades. 
Plots and comparison models singe v multi

```{r}   

#df ALL_9000b, only 5 larvae have 0 infection (but enough dropletes)
ALL_RelA<-ALL_9000b #copy
ALL_RelA$cell.larvae_round<-round(ALL_RelA$cells.larvae) 
drops <- c("cells.larvae") #get rid of cell.larvae col
ALL_RelA<-ALL_RelA[ , !(names(ALL_RelA) %in% drops)]

ALL_RelA<-dcast(ALL_RelA, ALL.number+Temp+Day+Pot~Primer, value.var = "cell.larvae_round") # cast()

#make "infect or not"" binary
RelA_binary<-ALL_RelA

 # 1 and 0 for each clade 
RelA_binary$C1[RelA_binary$C1>0]<-1  
RelA_binary$C1[RelA_binary$C1==0]<-0
RelA_binary$D1[RelA_binary$D1>0]<-1  
RelA_binary$D1[RelA_binary$D1==0]<-0
RelA_binary$F1[RelA_binary$F1>0]<-1  
RelA_binary$F1[RelA_binary$F1==0]<-0
RelA_binary$G3[RelA_binary$G3>0]<-1  
RelA_binary$G3[RelA_binary$G3==0]<-0
#write.csv(RelA_binary,"RelA_binary.csv")
#new col sum of each clade in a larvae
RelA_binary$numclade<-RelA_binary$C1+RelA_binary$D1+RelA_binary$F1+RelA_binary$G3

RelA_binary$Infect[RelA_binary$numclade>0]<-1  
RelA_binary$Infect[RelA_binary$numclade==0]<-0
   #RelA_binary$Infect<-as.factor(RelA_binary$binary) #make factor

RelA_CladeComp<-RelA_binary #make a copy for the nextsection

#rename Pot interaction as a code: Pot_Temp
 RelA_binary$PotCode<-paste0(RelA_binary$Temp, RelA_binary$Pot)
 RelA_binary$PotCode<-as.factor(RelA_binary$PotCode) #make factor
 
```
  
A did larvae with single clades infect more or less than larvae offered multiple clades: stats
```{r} 
#stats
#df for multi:RelA_binary, df for Individuals:  BinaryInfect
 RelA_binary$Symbiont<-"All"
 
RelA_binary_ALL<-RelA_binary[,c("Temp","Day","PotCode","Infect","Symbiont")] #keep only cols you need
BinaryInfect_ALL<-BinaryInfect[,c("Temp","Day","PotCode","Infect","Symbiont")] #keep only cols you need
Multi_Single_binary<-rbind(RelA_binary_ALL,BinaryInfect_ALL) #combine
 Multi_Single_binary$Symbiont<-as.factor(Multi_Single_binary$Symbiont)
  Multi_Single_binary$Infect<-as.factor(Multi_Single_binary$Infect)

  
#Full model including all clades: This asks if larvae infect in general more if they are Multi, C, D, F or G
  
#(this is testing each symbiont against eachother and against the group "All" which is did multi infection larvae infect period)
  
 Multi_Single_binary_model<-glmer(Infect~Temp*Symbiont*Day+(1|PotCode), family="binomial", Multi_Single_binary) 
 #is this warning oK? 
 # Better way to run this model? For binomial i thought this is it. The error could be due to not all clades living to day 14. 
  
  
 Anova(Multi_Single_binary_model)
dispersion_glmer(Multi_Single_binary_model) # no overdispersion 

  emm<-emmeans(Multi_Single_binary_model,  ~ Symbiont*Temp*Day)
  pairs(emm)
  cld(emm)  
  
  
#try doing within clade/infection type
# ALL - C1
RelA_binary_C1<-RelA_binary[,c("Temp","Day","PotCode","C1", "Symbiont")] #keep only cols you need
RelA_binary_C1$infectType<-"Multi"
names(RelA_binary_C1)[names(RelA_binary_C1) == "C1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_D1<-RelA_binary[,c("Temp","Day","PotCode","D1","Symbiont")] #keep only cols you need
RelA_binary_D1$infectType<-"Multi"
names(RelA_binary_D1)[names(RelA_binary_D1) == "D1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_F1<-RelA_binary[,c("Temp","Day","PotCode","F1","Symbiont")] #keep only cols you need
RelA_binary_F1$infectType<-"Multi"
names(RelA_binary_F1)[names(RelA_binary_F1) == "F1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_G3<-RelA_binary[,c("Temp","Day","PotCode","G3","Symbiont")] #keep only cols you need
RelA_binary_G3$infectType<-"Multi"
names(RelA_binary_G3)[names(RelA_binary_G3) == "G3"] <- "Infect"   #change C1 col name to "infect"


#Individual by clade
Binary_C1_binary<-Binary_C1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_C1_binary$infectType<-"Single"
Binary_D1_binary<-Binary_D1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_D1_binary$infectType<-"Single"
Binary_F1_binary<-Binary_F1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_F1_binary$infectType<-"Single"
Binary_G3_binary<-Binary_G3[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_G3_binary$infectType<-"Single"
```

Individual Infections of MULTI larvae: don't use in SI, instead only use this data to compare to SINGLE infections
C1 -single alone  
```{r}     
C1_binary_SinMul<-rbind(RelA_binary_C1, Binary_C1_binary)
C1_binary_SinMul$Infect<-as.factor(C1_binary_SinMul$Infect)
C1_binary_SinMul$Symbiont<-as.factor(C1_binary_SinMul$Symbiont)
C1_binary_SinMul$infectType<-as.factor(C1_binary_SinMul$infectType)


#model
C1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_C1) 
Anova(C1_binary_Multi_mod)
dispersion_glmer(C1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_C1$Infect<-as.character(RelA_binary_C1$Infect) #change infect back to a number for mean
RelA_binary_C1$Infect<-as.numeric(RelA_binary_C1$Infect)

RelA_binary_C1_mean <- ddply(RelA_binary_C1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_C1_mean #display table 
RelA_binary_C1_mean<-na.omit(RelA_binary_C1_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_C1_mean$Day.num<-as.numeric(RelA_binary_C1_mean$Day)
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 2] =7
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 3] =14
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 1] =3

#plots Multi only

C1_binary_Multi_plot<-ggplot(data=RelA_binary_C1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
 ylab(expression(paste(""))) +
ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_Multi_plot

```

D1 Single alone
```{r}   

#model
D1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_D1) 
Anova(D1_binary_Multi_mod)
dispersion_glmer(D1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_D1$Infect<-as.character(RelA_binary_D1$Infect) #change infect back to a number for mean
RelA_binary_D1$Infect<-as.numeric(RelA_binary_D1$Infect)

RelA_binary_D1_mean <- ddply(RelA_binary_D1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_D1_mean #display table 
RelA_binary_D1_mean<-na.omit(RelA_binary_D1_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_D1_mean$Day.num<-as.numeric(RelA_binary_D1_mean$Day)
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 2] =7
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 3] =14
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 1] =3

#plots Multi only

D1_binary_Multi_plot<-ggplot(data=RelA_binary_D1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  xlab("") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_Multi_plot
```
 
F1 Single alone
```{r}  
#model
F1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_F1) 
Anova(F1_binary_Multi_mod)
dispersion_glmer(F1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_F1$Infect<-as.character(RelA_binary_F1$Infect) #change infect back to a number for mean
RelA_binary_F1$Infect<-as.numeric(RelA_binary_F1$Infect)

RelA_binary_F1_mean <- ddply(RelA_binary_F1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_F1_mean #display table 
RelA_binary_F1_mean<-na.omit(RelA_binary_F1_mean)
 
#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_F1_mean$Day.num<-as.numeric(RelA_binary_F1_mean$Day)
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 2] =7
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 3] =14
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 1] =3
#plots Multi only

F1_binary_Multi_plot<-ggplot(data=RelA_binary_F1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
 ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_Multi_plot
```

G3 Single alone
```{r}  
#model 
G3_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_G3) 
Anova(G3_binary_Multi_mod)
dispersion_glmer(G3_binary_Multi_mod) # 0.53 overdispersion? 

#mean
RelA_binary_G3$Infect<-as.character(RelA_binary_G3$Infect) #change infect back to a number for mean
RelA_binary_G3$Infect<-as.numeric(RelA_binary_G3$Infect)

RelA_binary_G3_mean <- ddply(RelA_binary_G3, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_G3_mean #display table 
RelA_binary_G3_mean<-na.omit(RelA_binary_G3_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_G3_mean$Day.num<-as.numeric(RelA_binary_G3_mean$Day)
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 2] =7
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 3] =14
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 1] =3
#plots Multi only

G3_binary_Multi_plot<-ggplot(data=RelA_binary_G3_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(legend.position = c(0.8, 0.2))+
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_Multi_plot
```

Figure X. Plot all mutli infection by clade alone
```{r}  
C1_binary_Multi_plot<-C1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
D1_binary_Multi_plot<-D1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
F1_binary_Multi_plot<-F1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
#G3_binary_Multi_plot<-G3_binary_Multi_plot+ theme(legend.position = "none") #remove legend

grid.arrange(C1_binary_Multi_plot,D1_binary_Multi_plot,F1_binary_Multi_plot,G3_binary_Multi_plot, nrow = 1)
```

Plot Single and Multi Binomial infection plots 4x4 
```{r} 
library(cowplot)
 
Counts_compare_singmult<-plot_grid(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,C1_Infect_plot, D1_Infect_plot,F1_Infect_plot, G3_Infect_plot, C1_binary_Multi_plot, D1_binary_Multi_plot,F1_binary_Multi_plot,G3_binary_Multi_plot, labels = "AUTO", ncol=4, nrow=2, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);Counts_compare_singmult

#add common x and y axis labels
y.grob <- textGrob("Cells/Larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
Counts_compare_singmult<-grid.arrange(arrangeGrob(Counts_compare_singmult, left = y.grob, bottom = x.grob))
#save
#ggsave(filename="Figures/BinomialSIFig2.png", plot=BinomialSIFig2, dpi=300, width=12, height=10, units="in")
```
  


# Binomial Single v Multi infection by clade (pink and blue)
Models Singe vs Multi by clade
```{r}

#models
#C1
#27
C1_binary_SinMul_27<-subset(C1_binary_SinMul, Temp==27)
 C1_binary_SinMul_27_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", C1_binary_SinMul_27)
  Anova(C1_binary_SinMul_27_mod)
  dispersion_glmer(C1_binary_SinMul_27_mod)  #no overdispersion 
  emm<-emmeans(C1_binary_SinMul_27_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

C1_binary_SinMul_30<-subset(C1_binary_SinMul, Temp==30)
 C1_binary_SinMul_30_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", C1_binary_SinMul_30)
  Anova(C1_binary_SinMul_30_mod)
  dispersion_glmer(C1_binary_SinMul_30_mod)  #no overdispersion 
  emm<-emmeans(C1_binary_SinMul_30_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

C1_binary_SinMul_31<-subset(C1_binary_SinMul, Temp==31)
 C1_binary_SinMul_31_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", C1_binary_SinMul_31)
  Anova(C1_binary_SinMul_31_mod)
  dispersion_glmer(C1_binary_SinMul_31_mod)  #no overdispersion 
  emm<-emmeans(C1_binary_SinMul_31_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)


#D1
#27
D1_binary_SinMul_27<-subset(D1_binary_SinMul, Temp==27)
 D1_binary_SinMul_27_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", D1_binary_SinMul_27)
  Anova(D1_binary_SinMul_27_mod)
  dispersion_glmer(D1_binary_SinMul_27_mod)  #no overdispersion 
  emm<-emmeans(D1_binary_SinMul_27_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

D1_binary_SinMul_30<-subset(D1_binary_SinMul, Temp==30)
 D1_binary_SinMul_30_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", D1_binary_SinMul_30)
  Anova(D1_binary_SinMul_30_mod)
  dispersion_glmer(D1_binary_SinMul_30_mod)  #no overdispersion 
  emm<-emmeans(D1_binary_SinMul_30_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

D1_binary_SinMul_31<-subset(D1_binary_SinMul, Temp==31)
D1_binary_SinMul_31<-subset(D1_binary_SinMul_31, Day==3|Day==7)
 D1_binary_SinMul_31_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", D1_binary_SinMul_31)
  Anova(D1_binary_SinMul_31_mod)
  dispersion_glmer(D1_binary_SinMul_31_mod)  #no overdispersion 
  emm<-emmeans(D1_binary_SinMul_31_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

#F1
#27
F1_binary_SinMul_27<-subset(F1_binary_SinMul, Temp==27)
 F1_binary_SinMul_27_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", F1_binary_SinMul_27)
  Anova(F1_binary_SinMul_27_mod)
  dispersion_glmer(F1_binary_SinMul_27_mod)  #no overdispersion 
  emm<-emmeans(F1_binary_SinMul_27_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

F1_binary_SinMul_30<-subset(F1_binary_SinMul, Temp==30)
 F1_binary_SinMul_30_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", F1_binary_SinMul_30)
  Anova(F1_binary_SinMul_30_mod)
  dispersion_glmer(F1_binary_SinMul_30_mod)  #no overdispersion 
  emm<-emmeans(F1_binary_SinMul_30_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

F1_binary_SinMul_31<-subset(F1_binary_SinMul, Temp==31)
 F1_binary_SinMul_31_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", F1_binary_SinMul_31)
  Anova(F1_binary_SinMul_31_mod)
  dispersion_glmer(F1_binary_SinMul_31_mod)  #no overdispersion 
  emm<-emmeans(F1_binary_SinMul_31_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

#G3
#27
G3_binary_SinMul_27<-subset(G3_binary_SinMul, Temp==27)
 G3_binary_SinMul_27_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", G3_binary_SinMul_27)
  Anova(G3_binary_SinMul_27_mod)
  dispersion_glmer(G3_binary_SinMul_27_mod)  #no overdispersion 
  emm<-emmeans(G3_binary_SinMul_27_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

G3_binary_SinMul_30<-subset(G3_binary_SinMul, Temp==30)
 G3_binary_SinMul_30_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", G3_binary_SinMul_30)
  Anova(G3_binary_SinMul_30_mod)
  dispersion_glmer(G3_binary_SinMul_30_mod)  #no overdispersion 
  emm<-emmeans(G3_binary_SinMul_30_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

G3_binary_SinMul_31<-subset(G3_binary_SinMul, Temp==31)
 G3_binary_SinMul_31_mod<-glmer(Infect~Day*infectType+(1|PotCode), family="binomial", G3_binary_SinMul_31)
  Anova(G3_binary_SinMul_31_mod)
  dispersion_glmer(G3_binary_SinMul_31_mod)  #no overdispersion 
  emm<-emmeans(G3_binary_SinMul_31_mod,  ~ infectType|Day, adjust="Tukey")
cld(emm)

```

C1 Single v Multi
```{r}  
#Singel vs Multi 

#model SINGLE vs MULTI
C1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", C1_binary_SinMul) 
Anova(C1_binary_SinMul_mod)
dispersion_glmer(C1_binary_SinMul_mod) # no overdispersion 

#mean
C1_binary_SinMul$Infect<-as.character(C1_binary_SinMul$Infect) #change infect back to a number for mean
C1_binary_SinMul$Infect<-as.numeric(C1_binary_SinMul$Infect)

C1_binary_SinMul_mean <- ddply(C1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

C1_binary_SinMul_mean #display table 
C1_binary_SinMul_mean<-na.omit(C1_binary_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1_binary_SinMul_mean$Day<-as.numeric(C1_binary_SinMul_mean$Day)
C1_binary_SinMul_mean$Day[C1_binary_SinMul_mean$Day == 2] =7
C1_binary_SinMul_mean$Day[C1_binary_SinMul_mean$Day == 3] =14
C1_binary_SinMul_mean$Day[C1_binary_SinMul_mean$Day == 1] =3

#separate by Temp
C1_binary_SinMul_mean_27<-subset(C1_binary_SinMul_mean, Temp=="27")
C1_binary_SinMul_mean_30<-subset(C1_binary_SinMul_mean, Temp=="30")
C1_binary_SinMul_mean_31<-subset(C1_binary_SinMul_mean, Temp=="31")
C1_binary_SinMul_mean_31<-na.omit(C1_binary_SinMul_mean_31)

#plots
#27

C1_binary_SinMul_plot_27<-ggplot(data=C1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
        scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_27

#30

C1_binary_SinMul_plot_30<-ggplot(data=C1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_30

#31

C1_binary_SinMul_plot_31<-ggplot(data=C1_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_31

#plot together
C1_binary_SinMul_plot_27<-C1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
C1_binary_SinMul_plot_30<-C1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
C1_binary_SinMul_plot_31<-C1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(C1_binary_SinMul_plot_27, C1_binary_SinMul_plot_30, C1_binary_SinMul_plot_31, nrow = 1)





```
D1 Single v Multi 
```{r} 
D1_binary_SinMul<-rbind(RelA_binary_D1, Binary_D1_binary)  
D1_binary_SinMul$Infect<-as.factor(D1_binary_SinMul$Infect)
D1_binary_SinMul$Symbiont<-as.factor(D1_binary_SinMul$Symbiont)
D1_binary_SinMul$infectType<-as.factor(D1_binary_SinMul$infectType)

#model 
D1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", D1_binary_SinMul) 
Anova(D1_binary_SinMul_mod)
dispersion_glmer(D1_binary_SinMul_mod) # no overdispersion

#mean
D1_binary_SinMul$Infect<-as.character(D1_binary_SinMul$Infect) #change infect back to a number for mean
D1_binary_SinMul$Infect<-as.numeric(D1_binary_SinMul$Infect)

D1_binary_SinMul_mean <- ddply(D1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

D1_binary_SinMul_mean #display table  
D1_binary_SinMul_mean<-na.omit(D1_binary_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1_binary_SinMul_mean$Day<-as.numeric(D1_binary_SinMul_mean$Day)
D1_binary_SinMul_mean$Day[D1_binary_SinMul_mean$Day == 2] =7
D1_binary_SinMul_mean$Day[D1_binary_SinMul_mean$Day == 3] =14
D1_binary_SinMul_mean$Day[D1_binary_SinMul_mean$Day == 1] =3

#separate by Temp
D1_binary_SinMul_mean_27<-subset(D1_binary_SinMul_mean, Temp=="27")
D1_binary_SinMul_mean_30<-subset(D1_binary_SinMul_mean, Temp=="30")
D1_binary_SinMul_mean_31<-subset(D1_binary_SinMul_mean, Temp=="31")
D1_binary_SinMul_mean_31<-na.omit(D1_binary_SinMul_mean_31)



#plot
#27
D1_binary_SinMul_plot_27<-ggplot(data=D1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_27

#30
D1_binary_SinMul_plot_30<-ggplot(data=D1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_30

#31
D1_binary_SinMul_plot_31<-ggplot(data=D1_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_31

#plot together
D1_binary_SinMul_plot_27<-D1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
D1_binary_SinMul_plot_30<-D1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
D1_binary_SinMul_plot_31<-D1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(D1_binary_SinMul_plot_27, D1_binary_SinMul_plot_30, D1_binary_SinMul_plot_31, nrow = 1)
```
F1 Single v Multi
```{r} 
#F1 
F1_binary_SinMul<-rbind(RelA_binary_F1, Binary_F1_binary)
F1_binary_SinMul$Infect<-as.factor(F1_binary_SinMul$Infect)
F1_binary_SinMul$Symbiont<-as.factor(F1_binary_SinMul$Symbiont)
F1_binary_SinMul$infectType<-as.factor(F1_binary_SinMul$infectType)

F1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", F1_binary_SinMul) 
Anova(F1_binary_SinMul_mod) 
dispersion_glmer(F1_binary_SinMul_mod) # no overdispersion

#mean
F1_binary_SinMul$Infect<-as.character(F1_binary_SinMul$Infect) #change infect back to a number for mean
F1_binary_SinMul$Infect<-as.numeric(F1_binary_SinMul$Infect)

F1_binary_SinMul_mean <- ddply(F1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

F1_binary_SinMul_mean #display table 
F1_binary_SinMul_mean<-na.omit(F1_binary_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1_binary_SinMul_mean$Day<-as.numeric(F1_binary_SinMul_mean$Day)
F1_binary_SinMul_mean$Day[F1_binary_SinMul_mean$Day == 2] =7
F1_binary_SinMul_mean$Day[F1_binary_SinMul_mean$Day == 3] =14
F1_binary_SinMul_mean$Day[F1_binary_SinMul_mean$Day == 1] =3

#separate by Temp
F1_binary_SinMul_mean_27<-subset(F1_binary_SinMul_mean, Temp=="27")
F1_binary_SinMul_mean_30<-subset(F1_binary_SinMul_mean, Temp=="30")
F1_binary_SinMul_mean_31<-subset(F1_binary_SinMul_mean, Temp=="31")
F1_binary_SinMul_mean_31<-na.omit(F1_binary_SinMul_mean_31)

#plot
#27
F1_binary_SinMul_plot_27<-ggplot(data=F1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_27

#30
F1_binary_SinMul_plot_30<-ggplot(data=F1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("230C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_30

#31
F1_binary_SinMul_plot_31<-ggplot(data=F1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_31

#plot together
F1_binary_SinMul_plot_27<-F1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
F1_binary_SinMul_plot_30<-F1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
F1_binary_SinMul_plot_31<-F1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(F1_binary_SinMul_plot_27, F1_binary_SinMul_plot_30, F1_binary_SinMul_plot_31, nrow = 1)
```
G1 single v multi
```{r}
#G3 
G3_binary_SinMul<-rbind(RelA_binary_G3, Binary_G3_binary)
G3_binary_SinMul$Infect<-as.factor(G3_binary_SinMul$Infect)
G3_binary_SinMul$Symbiont<-as.factor(G3_binary_SinMul$Symbiont)
G3_binary_SinMul$infectType<-as.factor(G3_binary_SinMul$infectType)

G3_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", G3_binary_SinMul) 
Anova(G3_binary_SinMul_mod)
dispersion_glmer(G3_binary_SinMul_mod) # no overdispersion

#mean
G3_binary_SinMul$Infect<-as.character(G3_binary_SinMul$Infect) #change infect back to a number for mean
G3_binary_SinMul$Infect<-as.numeric(G3_binary_SinMul$Infect)

G3_binary_SinMul_mean <- ddply(G3_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

G3_binary_SinMul_mean #display table 
G3_binary_SinMul_mean<-na.omit(G3_binary_SinMul_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3_binary_SinMul_mean$Day<-as.numeric(G3_binary_SinMul_mean$Day)
G3_binary_SinMul_mean$Day[G3_binary_SinMul_mean$Day == 2] =7
G3_binary_SinMul_mean$Day[G3_binary_SinMul_mean$Day == 3] =14
G3_binary_SinMul_mean$Day[G3_binary_SinMul_mean$Day == 1] =3

#separate by Temp
G3_binary_SinMul_mean_27<-subset(G3_binary_SinMul_mean, Temp=="27")
G3_binary_SinMul_mean_30<-subset(G3_binary_SinMul_mean, Temp=="30")
G3_binary_SinMul_mean_31<-subset(G3_binary_SinMul_mean, Temp=="31")
G3_binary_SinMul_mean_31<-na.omit(G3_binary_SinMul_mean_31)

#plot
#27
G3_binary_SinMul_plot_27<-ggplot(data=G3_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_27

#30
G3_binary_SinMul_plot_30<-ggplot(data=G3_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_30

#31
G3_binary_SinMul_plot_31<-ggplot(data=G3_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType), linetype="dotted")+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_31

#plot together
G3_binary_SinMul_plot_27<-G3_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
G3_binary_SinMul_plot_30<-G3_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
G3_binary_SinMul_plot_31<-G3_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(G3_binary_SinMul_plot_27, G3_binary_SinMul_plot_30, G3_binary_SinMul_plot_31, nrow = 1)
```
Plot all 12
```{r}
grid.arrange(C1_binary_SinMul_plot_27, C1_binary_SinMul_plot_30, C1_binary_SinMul_plot_31,D1_binary_SinMul_plot_27, D1_binary_SinMul_plot_30, D1_binary_SinMul_plot_31,F1_binary_SinMul_plot_27, F1_binary_SinMul_plot_30, F1_binary_SinMul_plot_31,G3_binary_SinMul_plot_27, G3_binary_SinMul_plot_30, G3_binary_SinMul_plot_31, nrow = 4)
 #wil remove legend in final plot for scale

BinaryInfect_Fig<-plot_grid(C1_binary_SinMul_plot_27, C1_binary_SinMul_plot_30, C1_binary_SinMul_plot_31,D1_binary_SinMul_plot_27, D1_binary_SinMul_plot_30, D1_binary_SinMul_plot_31,F1_binary_SinMul_plot_27, F1_binary_SinMul_plot_30, F1_binary_SinMul_plot_31,G3_binary_SinMul_plot_27, G3_binary_SinMul_plot_30, G3_binary_SinMul_plot_31, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);BinaryInfect_Fig 

#add common x and y axis labels
y.grob <- textGrob("% Larvae Infected", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
BinaryInfect_Figb<-grid.arrange(arrangeGrob(BinaryInfect_Fig, left = y.grob, bottom = x.grob))
#save
ggsave(filename="Figures/BinaryInfect_Figb.pdf", plot=BinaryInfect_Figb, dpi=300, width=12, height=12, units="in")
#```

#B PLOT Multi infection, % larvae infected with 0,1, 2, 3, or 4 clades (not by clade, by number of clades). "rel1"= 1 clade,..  
```{r}      
ALL_RelAvar<-c("Day", "Temp", "ALL.number","C1","D1","F1" ,"G3","Pot","numclade")
ALL_RelA_Infect<-RelA_CladeComp[ALL_RelAvar]
#write.csv(ALL_RelA_Infect,"ALL_RelA_Infect2.csv")

NumClades<-read.csv("SC18_numberofcladesinfect_20200625.csv") #you couldn't do this in R so you did in excel and are reuploading....ugh.
#if you have ideas on how to do this in R, I just couldn't figure it out :(
NumClades<-select(NumClades, "Day", "Temp", "RA_0","RA_1","RA_2","RA_3" ,"RA_4") #keep only cols you want
NumClades3<-NumClades

NumClades3<-melt(NumClades3,  id=c("Temp","Day"))
NumClades3$Temp<-as.factor(NumClades3$Temp)
NumClades3$Day<-as.factor(NumClades3$Day)




### STACKED BAR PLOTS  -- DELETE!
#27C
NumClades_27<-subset(NumClades3, Temp==27)

# barplot 
Infect27_plot<-ggplot(NumClades_27, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("27C");Infect27_plot   




#30C
NumClades_30<-subset(NumClades, Temp==30)

#plot
Infect30_plot<-ggplot(NumClades_30, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("30C");Infect30_plot  

#31C
NumClades_31<-subset(NumClades, Temp==31)

#plot
Infect31_plot<-ggplot(NumClades_31, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("31C");Infect31_plot  

#plot all together
Infect27_plot<-Infect27_plot+ theme(legend.position = "none") #remove legend
Infect30_plot<-Infect30_plot+ theme(legend.position = "none") #remove legend
Infect31_plot<-Infect31_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Infect27_plot, Infect30_plot,Infect31_plot, nrow = 1)
 


#stats   CHECK THIS! you may need to transform data better!  HEY you don't really want to do this. just talk about as %s
hist(ALL_RelA_Infect$numclade)
ALL_RelA_Infect$numclade_log<-log10(ALL_RelA_Infect$numclade)
hist(ALL_RelA_Infect$numclade_log)

ALL_RelA_Infect_mod<-lm(numclade~Temp*Day, ALL_RelA_Infect) 
  summary(ALL_RelA_Infect_mod)
dispersion_glmer(ALL_RelA_Infect_mod)

emm<-emmeans(ALL_RelA_Infect_mod,  ~ Temp*Day)
  pairs(emm)
  cld(emm)  

  
  
```

PLOT: This is waffle with relative abundance - NOTE you need to go back and edit this bc the rounding is off, but if you use the other waffle, don't waste your time dude. 
Waffle chart showing the average number of infected clades/larvae
```{r}
NumClades_27<-subset(NumClades3, Temp==27)
NumClades_30<-subset(NumClades3, Temp==30)
NumClades_31<-subset(NumClades3, Temp==31)

library(waffle)
library(RColorBrewer) #use YellowGreen: 
brewer.pal(n = 9, name = "PuBu") # use "#FFFFE5",  "#F7FCB9", "#ADDD8E" ,"#41AB5D", "#005A32"

#27 D3
NumClades_27_D3<-subset(NumClades_27, Day==3)
NumClades_27_D3_waffle <- c(Zero=0, One=5, Two=7, Three=39, Four=49)
 NumClades_27_D3_wafflePLOT<-waffle(NumClades_27_D3_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_27_D3_wafflePLOT
 	
 #27 D7
NumClades_27_D7<-subset(NumClades_27, Day==7)
NumClades_27_D7_waffle <- c(Zero=0,One=4, Two=4, Three=26, Four=66)
 NumClades_27_D7_wafflePLOT<-waffle(NumClades_27_D7_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858")); NumClades_27_D7_wafflePLOT 
 
 
  #27 D14
NumClades_27_D14<-subset(NumClades_27, Day==14)
NumClades_27_D14_waffle <- c(Zero=10,One=0, Two=4, Three=48, Four=43)
 NumClades_27_D14_wafflePLOT<-waffle(NumClades_27_D14_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_27_D14_wafflePLOT
 
NumClades_27_D3_wafflePLOT<-NumClades_27_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades_27_D7_wafflePLOT<-NumClades_27_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades_27_D14_wafflePLOT<-NumClades_27_D14_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades_27_D14_wafflePLOT,NumClades_27_D7_wafflePLOT,NumClades_27_D3_wafflePLOT,nrow =3 )


#30 D3
NumClades_30_D3<-subset(NumClades_30, Day==3)
NumClades_30_D3_waffle <- c(Zero=0,One=5, Two=29, Three=50, Four=16)
 NumClades_30_D3_wafflePLOT<-waffle(NumClades_30_D3_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_30_D3_wafflePLOT
 	
 #30 D7
NumClades_30_D7<-subset(NumClades_30, Day==7)
NumClades_30_D7_waffle <- c(zero=20,One=7, Two=7, Three=23, Four=53)
 NumClades_30_D7_wafflePLOT<-waffle(NumClades_30_D7_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_30_D7_wafflePLOT
 
  #30 D14
NumClades_30_D14<-subset(NumClades_30, Day==14)
NumClades_30_D14_waffle <- c(Zero=0,One=0, Two=7, Three=57, Four=36)
 NumClades_30_D14_wafflePLOT<-waffle(NumClades_30_D14_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_30_D14_wafflePLOT
 
NumClades_30_D3_wafflePLOT<-NumClades_30_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades_30_D7_wafflePLOT<-NumClades_30_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades_30_D14_wafflePLOT<-NumClades_30_D14_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades_30_D14_wafflePLOT,NumClades_30_D7_wafflePLOT,NumClades_30_D3_wafflePLOT,nrow =3 )


#31 D3
NumClades_31_D3<-subset(NumClades_31, Day==3)
NumClades_31_D3_waffle <- c(Zero=11,One=11, Two=23, Three=41, Four=24)
 NumClades_31_D3_wafflePLOT<-waffle(NumClades_31_D3_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_31_D3_wafflePLOT
 	
 #31 D7
NumClades_31_D7<-subset(NumClades_31, Day==7)
NumClades_31_D7_waffle <- c(Zero=0,One=0, Two=29, Three=57, Four=14)
 NumClades_31_D7_wafflePLOT<-waffle(NumClades_31_D7_waffle, rows=5, colors=c("#FFF7FB","#ECE7F2", "#A6BDDB" ,"#0570B0", "#023858"));NumClades_31_D7_wafflePLOT
 
 
NumClades_31_D3_wafflePLOT<-NumClades_31_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades_31_D7_wafflePLOT<-NumClades_31_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades_31_D7_wafflePLOT,NumClades_31_D3_wafflePLOT,nrow =3 )
 


#all 8
grid.arrange(NumClades_31_D7_wafflePLOT,NumClades_31_D3_wafflePLOT,NumClades_30_D14_wafflePLOT,NumClades_30_D7_wafflePLOT,NumClades_30_D3_wafflePLOT,NumClades_27_D14_wafflePLOT,NumClades_27_D7_wafflePLOT,NumClades_27_D3_wafflePLOT,nrow =8 )


```
Waffle chart: number of clades/larvae, (same data as above) but with each square representing a single larvae
```{r}
library(waffle)
library(RColorBrewer) #use YellowGreen: 
brewer.pal(n = 9, name = "PuBu") # use "#FFFFE5",  "#F7FCB9", "#ADDD8E" ,"#41AB5D", "#005A32"
# View a single RColorBrewer palette by specifying its name
display.brewer.pal(n = 8, name = 'PuBu')
# Hexadecimal color specification 
brewer.pal(n = 8, name = "PuBu")

NumClades2<-read.csv("SC18_numberofcladesinfect_20200625.csv")
NumClades2a<-select(NumClades2, "Day", "Temp", "total0","total1","total2","total3" ,"total4") #keep only cols you want

NumClades2a<-melt(NumClades2a,  id=c("Temp","Day"))
NumClades2a$Temp<-as.factor(NumClades2a$Temp)
NumClades2a$Day<-as.factor(NumClades2a$Day)

NumClades2a_27<-subset(NumClades2a, Temp==27)
NumClades2a_30<-subset(NumClades2a, Temp==30)
NumClades2a_31<-subset(NumClades2a, Temp==31)

#27 D3
NumClades2a_27_D3<-subset(NumClades2a_27, Day==3)
NumClades2a_27_D3_waffle2 <- c(Four=20,Three=16, Two=3,One=2,Zero=0)
 NumClades2a_27_D3_wafflePLOT<-waffle(NumClades2a_27_D3_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_27_D3_wafflePLOT 
 	
 #27 D7
NumClades2a_27_D7<-subset(NumClades2a_27, Day==7)
NumClades2a_27_D7_waffle2 <- c(Four=15,Three=6, Two=1,One=1,Zero=0)
 NumClades2a_27_D7_wafflePLOT<-waffle(NumClades2a_27_D7_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_27_D7_wafflePLOT 
 
 
#27 D14
NumClades2a_27_D14<-subset(NumClades2a_27, Day==14)
NumClades2a_27_D14_waffle2 <- c(Four=10,Three=11, Two=1,One=0,Zero=1)
 NumClades2a_27_D14_wafflePLOT<-waffle(NumClades2a_27_D14_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_27_D14_wafflePLOT 
 
NumClades2a_27_D3_wafflePLOT<-NumClades2a_27_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades2a_27_D7_wafflePLOT<-NumClades2a_27_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades2a_27_D14_wafflePLOT<-NumClades2a_27_D14_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades2a_27_D3_wafflePLOT,NumClades2a_27_D7_wafflePLOT,NumClades2a_27_D14_wafflePLOT,nrow =3 )

#30 D3
NumClades2a_30_D3<-subset(NumClades2a_30, Day==3)
NumClades2a_30_D3_waffle2 <- c(Four=6,Three=19, Two=11,One=2,Zero=0)
 NumClades2a_30_D3_wafflePLOT<-waffle(NumClades2a_30_D3_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_30_D3_wafflePLOT 
 	
 #30 D7
NumClades2a_30_D7<-subset(NumClades2a_30, Day==7)
NumClades2a_30_D7_waffle2 <- c(Four=16,Three=7, Two=2,One=2,Zero=3)
 NumClades2a_30_D7_wafflePLOT<-waffle(NumClades2a_30_D7_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_30_D7_wafflePLOT 
 
 
#30 D14
NumClades2a_30_D14<-subset(NumClades2a_30, Day==14)
NumClades2a_30_D14_waffle2 <- c(Four=5,Three=8, Two=1,One=0,Zero=0)
 NumClades2a_30_D14_wafflePLOT<-waffle(NumClades2a_30_D14_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_30_D14_wafflePLOT 
 
NumClades2a_30_D3_wafflePLOT<-NumClades2a_30_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades2a_30_D7_wafflePLOT<-NumClades2a_30_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades2a_30_D14_wafflePLOT<-NumClades2a_30_D14_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades2a_30_D3_wafflePLOT,NumClades2a_30_D7_wafflePLOT,NumClades2a_30_D14_wafflePLOT,nrow =3)



#31 D3
NumClades2a_31_D3<-subset(NumClades2a_31, Day==3)
NumClades2a_31_D3_waffle2 <- c(Four=9,Three=15, Two=8,One=4,Zero=1)
 NumClades2a_31_D3_wafflePLOT<-waffle(NumClades2a_31_D3_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_31_D3_wafflePLOT 
 	
 #31 D7
NumClades2a_31_D7<-subset(NumClades2a_31, Day==7)
NumClades2a_31_D7_waffle2 <- c(Four=1,Three=4, Two=2,One=0,Zero=0)
 NumClades2a_31_D7_wafflePLOT<-waffle(NumClades2a_31_D7_waffle2, rows=4, colors=c("#023858","#0570B0","#A6BDDB" ,"#ECE7F2","#FFF7FB")); NumClades2a_31_D7_wafflePLOT 
 
 
NumClades2a_31_D3_wafflePLOT<-NumClades2a_31_D3_wafflePLOT+ theme(legend.position = "none") #remove legend
NumClades2a_31_D7_wafflePLOT<-NumClades2a_31_D7_wafflePLOT+ theme(legend.position = "none") #remove legend
grid.arrange(NumClades2a_31_D3_wafflePLOT,NumClades2a_31_D7_wafflePLOT,nrow =2)

#all 8
grid.arrange(NumClades2a_27_D3_wafflePLOT,NumClades2a_27_D7_wafflePLOT,NumClades2a_27_D14_wafflePLOT,NumClades2a_30_D3_wafflePLOT,NumClades2a_30_D7_wafflePLOT,NumClades2a_30_D14_wafflePLOT,NumClades2a_31_D3_wafflePLOT,NumClades2a_31_D7_wafflePLOT ,nrow =8 )


```



#C Who was the most dominant clade in larvave. 
This is in line plots: see below for waffles. 
```{r}     
#df ALL_RelA

ALL_RelA2<-select(ALL_RelA, "ALL.number", "Temp", "Day","Pot","C1","D1" ,"F1","G3") #keep only cols you want

Dom<-ALL_RelA2%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(1)
#new col with 1 for winner
Dom$Win.lose<-1

#pull losers and give them 0
DomL2<-ALL_RelA2%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(2)
DomL2$Win.lose<-0

DomL3<-ALL_RelA2%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(3)
DomL3$Win.lose<-0

DomL4<-ALL_RelA2%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(4)
DomL4$Win.lose<-0

DomAll<-rbind(Dom,DomL2,DomL3,DomL4)


DomAll_mean <- ddply(DomAll, c("Day", "Temp","clade"), summarise, #summarize cell counts
                 N    = length(Win.lose[!is.na(Win.lose)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Win.lose, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Win.lose, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Win.lose, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

DomAll_mean #display table 
DomAll_mean<-na.omit(DomAll_mean)

#27C
Dom27mean<-subset(DomAll_mean, Temp==27)
#plot
domAll_27_plot<-ggplot(data=Dom27mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("27C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_27_plot

# barplot 27
domAll_27_BARplot<-ggplot(Dom27mean, aes(y=mean, x=Day, fill=clade)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C");domAll_27_BARplot   



#30C
Dom30mean<-subset(DomAll_mean, Temp==30)
#plot
domAll_30_plot<-ggplot(data=Dom30mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("30C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_30_plot


# barplot 30
domAll_30_BARplot<-ggplot(Dom30mean, aes(y=mean, x=Day, fill=clade)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C");domAll_30_BARplot   


#31C
Dom31mean<-subset(DomAll_mean, Temp==31)
#plot
domAll_31_plot<-ggplot(data=Dom31mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("31C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_31_plot

# barplot 31
domAll_31_BARplot<-ggplot(Dom31mean, aes(y=mean, x=Day, fill=clade)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("27C");domAll_31_BARplot   


#plot all together line
domAll_27_plot<-domAll_27_plot+ theme(legend.position = "none") #remove legend
domAll_30_plot<-domAll_30_plot+ theme(legend.position = "none") #remove legend
grid.arrange(domAll_27_plot, domAll_30_plot,domAll_31_plot, nrow = 1)


#plot all together Bar
domAll_27_BARplot<-domAll_27_BARplot+ theme(legend.position = "none") #remove legend
domAll_30_BARplot<-domAll_30_BARplot+ theme(legend.position = "none") #remove legend
grid.arrange(domAll_27_BARplot, domAll_30_BARplot,domAll_31_BARplot, nrow = 1)
```     

Waffle chart (same data as above): each square represents one larvae (color is by most dom clade in each larvae)
```{r}
#df DomAll
#subset by temp
DomAll_27<-subset(DomAll, Temp==27)
DomAll_30<-subset(DomAll, Temp==30)
DomAll_31<-subset(DomAll, Temp==31)
#subset by Day
DomAll_27_D3<-subset(DomAll_27, Day==3)
DomAll_27_D7<-subset(DomAll_27, Day==7)
DomAll_27_D14<-subset(DomAll_27, Day==14)

DomAll_30_D3<-subset(DomAll_30, Day==3)
DomAll_30_D7<-subset(DomAll_30, Day==7)
DomAll_30_D14<-subset(DomAll_30, Day==14)

DomAll_31_D3<-subset(DomAll_31, Day==3)
DomAll_31_D7<-subset(DomAll_31, Day==7)

#27 D3:
aggregate(Win.lose ~ clade, data = DomAll_27_D3, sum) #figure out how many times each clade won by date/temp
DomAll_27_D3_waffle <- c(C1=2, D1=15, F1=3, G3=21)
DomAll_27_D3_waffle_plot<-waffle(DomAll_27_D3_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_27_D3_waffle_plot 
 	
 #27 D7
aggregate(Win.lose ~ clade, data = DomAll_27_D7, sum) #figure out how many times each clade won by date/temp
DomAll_27_D7_waffle <- c(C1=1, D1=12, F1=0, G3=10)
DomAll_27_D7_waffle_plot<-waffle(DomAll_27_D7_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_27_D7_waffle_plot 
 
 
#27 D14
aggregate(Win.lose ~ clade, data = DomAll_27_D14, sum) #figure out how many times each clade won by date/temp
DomAll_27_D14_waffle <- c(C1=11, D1=4, F1=0, G3=8)
DomAll_27_D14_waffle_plot<-waffle(DomAll_27_D14_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_27_D14_waffle_plot 
 
DomAll_27_D3_waffle_plot<-DomAll_27_D3_waffle_plot+ theme(legend.position = "none") #remove legend
DomAll_27_D7_waffle_plot<-DomAll_27_D7_waffle_plot+ theme(legend.position = "none") #remove legend
DomAll_27_D14_waffle_plot<-DomAll_27_D14_waffle_plot+ theme(legend.position = "none") #remove legend
grid.arrange(DomAll_27_D3_waffle_plot,DomAll_27_D7_waffle_plot,DomAll_27_D14_waffle_plot,nrow =3 )


#30 D3:
aggregate(Win.lose ~ clade, data = DomAll_30_D3, sum) #figure out how many times each clade won by date/temp
DomAll_30_D3_waffle <- c(C1=3, D1=8, F1=1, G3=26)
DomAll_30_D3_waffle_plot<-waffle(DomAll_30_D3_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_30_D3_waffle_plot 
 	
 #30 D7
aggregate(Win.lose ~ clade, data = DomAll_30_D7, sum) #figure out how many times each clade won by date/temp
DomAll_30_D7_waffle <- c(C1=3, D1=7, F1=0, G3=20)
DomAll_30_D7_waffle_plot<-waffle(DomAll_30_D7_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_30_D7_waffle_plot 
 
 
#30 D14
aggregate(Win.lose ~ clade, data = DomAll_30_D14, sum) #figure out how many times each clade won by date/temp
DomAll_30_D14_waffle <- c(C1=1, D1=6, F1=1, G3=6)
DomAll_30_D14_waffle_plot<-waffle(DomAll_30_D14_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_30_D14_waffle_plot 
 
DomAll_30_D3_waffle_plot<-DomAll_30_D3_waffle_plot+ theme(legend.position = "none") #remove legend
DomAll_30_D7_waffle_plot<-DomAll_30_D7_waffle_plot+ theme(legend.position = "none") #remove legend
DomAll_30_D14_waffle_plot<-DomAll_30_D14_waffle_plot+ theme(legend.position = "none") #remove legend
grid.arrange(DomAll_30_D3_waffle_plot,DomAll_30_D7_waffle_plot,DomAll_30_D14_waffle_plot,nrow =3 )

#31 D3:
aggregate(Win.lose ~ clade, data = DomAll_31_D3, sum) #figure out how many times each clade won by date/temp
DomAll_31_D3_waffle <- c(C1=2, D1=4, F1=2, G3=29)
DomAll_31_D3_waffle_plot<-waffle(DomAll_31_D3_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_31_D3_waffle_plot 
 	
 #31 D7
aggregate(Win.lose ~ clade, data = DomAll_31_D7, sum) #figure out how many times each clade won by date/temp
DomAll_31_D7_waffle <- c(C1=0, D1=1, F1=1, G3=5)
DomAll_31_D7_waffle_plot<-waffle(DomAll_31_D7_waffle, rows=4, colors=c("#D43F3AFF","#EEA236FF","#5CB85CFF","#46B8DAFF")); DomAll_31_D7_waffle_plot 

DomAll_31_D3_waffle_plot<-DomAll_31_D3_waffle_plot+ theme(legend.position = "none") #remove legend
DomAll_31_D7_waffle_plot<-DomAll_31_D7_waffle_plot+ theme(legend.position = "none") #remove legend
grid.arrange(DomAll_31_D3_waffle_plot,DomAll_31_D7_waffle_plot,nrow =3 )
```
stats:
```{r} 
 #rename Pot interaction as a code: Pot_Temp
 DomAll$PotCode<-paste0(DomAll$Temp, DomAll$Pot,DomAll$clade )
 DomAll$PotCode<-as.factor(DomAll$PotCode) #make factor
 
DomAll_mod<-glmer(Win.lose~clade*Temp*Day+(1|PotCode), family="binomial", DomAll)  #warnings...wtf IS THIS BC we lose treatments bc of death? Reason to do by clade? 

  Anova(DomAll_mod)
dispersion_glmer(DomAll_mod) # no overdispersion 

  emm<-emmeans(DomAll_mod,  ~ clade*Temp)
  pairs(emm)
  cld(emm)  
  
#by Temp
  
#27 
Dom27<-subset(DomAll, Temp==27)
  Dom27_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom27) 
  Anova(Dom27_mod)
  dispersion_glmer(Dom27_mod)  #no overdispersion

#30
Dom30<-subset(DomAll, Temp==30)
  Dom30_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom30) 
  Anova(Dom30_mod)
  dispersion_glmer(Dom30_mod)  #no overdispersion
  
#31
Dom31<-subset(DomAll, Temp==31)
  Dom31_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom31) 
  Anova(Dom31_mod)
  dispersion_glmer(Dom31_mod)  #no overdispersion
```

Plot: Made in Affinity! This plot shows each square = 1 larvae and the blue scale represents how many clades infected it, the small color square indicates the dominant clade in the larvae. 
Make new plot of dominant clade but organize waffle squares to coorespond to the numb clades infect. 
```{r}
#numb clades df:ALL_RelA_Infect
ALL_RelA_Infect_2<-select(ALL_RelA_Infect, "ALL.number","numclade") #keep only cols you want

#winning clade df: Dom
Dom_2<-select(Dom, "Day", "Temp", "ALL.number","Pot","clade") #keep only cols you want

#combine
Win_Num<- merge(ALL_RelA_Infect_2,Dom_2, by="ALL.number")

#Subset into Day/temp groups
Win_Num_27<-subset(Win_Num, Temp==27)
Win_Num_30<-subset(Win_Num, Temp==30)
Win_Num_31<-subset(Win_Num, Temp==31)

#subset into days by temp, calc num clades winner in each infection group
Win_Num_27_D3<-subset(Win_Num_27, Day==3)
  Win_Num_27_D3 %>%                     
   group_by(numclade, clade) %>%
   tally()
  
Win_Num_27_D7<-subset(Win_Num_27, Day==7)
 Win_Num_27_D7 %>%                     
   group_by(numclade, clade) %>%
   tally()
 
Win_Num_27_D14<-subset(Win_Num_27, Day==14)
 Win_Num_27_D14 %>%                     
   group_by(numclade, clade) %>%
   tally()
 
#30C
Win_Num_30_D3<-subset(Win_Num_30, Day==3)
 Win_Num_30_D3 %>%                     
   group_by(numclade, clade) %>%
   tally()
Win_Num_30_D7<-subset(Win_Num_30, Day==7)
Win_Num_30_D7 %>%                     
   group_by(numclade, clade) %>%
   tally()

Win_Num_30_D14<-subset(Win_Num_30, Day==14)
Win_Num_30_D14 %>%                     
   group_by(numclade, clade) %>%
   tally()

#31C
Win_Num_31_D3<-subset(Win_Num_31, Day==3)
Win_Num_31_D3 %>%                     
   group_by(numclade, clade) %>%
   tally()

Win_Num_31_D7<-subset(Win_Num_31, Day==7)
Win_Num_31_D7 %>%                     
   group_by(numclade, clade) %>%
   tally()

```

#Multi infection: relative abundance of each clade  
What is the rel abund of each clade infected in each larvae, over time and at ambient and high temp. 
setup df  
```{r}  
#calc relative abundance for each   
ALL_RelA$Cladocopium<-ALL_RelA$C1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Durusdinium<-ALL_RelA$D1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Fugacium<-ALL_RelA$F1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Gerakladium<-ALL_RelA$G3/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
 
ALL_RelAvar<-c("Day", "Temp", "Pot","ALL.number","Cladocopium","Durusdinium","Fugacium" ,"Gerakladium")
ALL_RelA_a<-ALL_RelA[ALL_RelAvar]
ALL_RelA_b<-melt(ALL_RelA_a, id=c("Day", "Temp", "ALL.number","Pot"), measure.vars = c("Cladocopium","Durusdinium","Fugacium" ,"Gerakladium"))
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="variable"]<-"Symbiont" #rename value col
ALL_RelA_b<-na.omit(ALL_RelA_b) #remove larvae with 0 infection in all larvae (due to possible extraction issue)
``` 
 
Stats: Relative abundance, df = ALL_RelA_b 
```{r}
 
#Full model  
hist(ALL_RelA_b$cells.larvae)
ALL_RelA_b$cells.larvae_log<-log10(ALL_RelA_b$cells.larvae+1)
hist(ALL_RelA_b$cells.larvae_log)
ALL_RelA_b$cells.larvae_arc<-asin(sqrt(ALL_RelA_b$cells.larvae))
hist(ALL_RelA_b$cells.larvae_arc)
qqnorm(ALL_RelA_b$cells.larvae_arc) #
ALL_RelA_b$cells.larvae_sq<-sqrt(ALL_RelA_b$cells.larvae)
hist(ALL_RelA_b$cells.larvae_sq)
qqnorm(ALL_RelA_b$cells.larvae_sq) # 
 

 ALL_RelA_b$PotCode<-paste0(ALL_RelA_b$Temp, ALL_RelA_b$Pot,ALL_RelA_b$clade )
 ALL_RelA_b$PotCode<-as.factor(ALL_RelA_b$PotCode) #make factor#none are good 

 
## lmer  symbionts*days*temp
ALL_RelA_b_mod<-lmer(cells.larvae_arc~Symbiont*Day*Temp+(1|PotCode), ALL_RelA_b)
anova(ALL_RelA_b_mod)
qqPlot(residuals(ALL_RelA_b_mod))   # good

  emm<-emmeans(ALL_RelA_b_mod,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)

#by Temp:
Temp27_RelA<-subset(ALL_RelA_b, Temp=="27")
Temp30_RelA<-subset(ALL_RelA_b, Temp=="30")
Temp31_RelA<-subset(ALL_RelA_b, Temp=="31")

#27C
Temp27_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp27_RelA)
anova(Temp27_modRelA)
qqPlot(residuals(Temp27_modRelA))   # good
  emm<-emmeans(Temp27_modRelA,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)
emm<-emmeans(Temp27_modRelA,  ~ Symbiont |Day, adjust="Tukey")
cld(emm)





#30C
Temp30_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp30_RelA)
anova(Temp30_modRelA)
qqPlot(residuals(Temp30_modRelA))   # good
  emm<-emmeans(Temp30_modRelA,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)
  emm<-emmeans(Temp30_modRelA,  ~ Symbiont|Day, adjust="Tukey")
cld(emm)

#31C
Temp31_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp31_RelA)
anova(Temp31_modRelA)
qqPlot(residuals(Temp31_modRelA))   # good
 emm<-emmeans(Temp31_modRelA,  ~ Symbiont*Day, adjust="Tukey")
cld(emm)
  emm<-emmeans(Temp31_modRelA,  ~ Symbiont|Day, adjust="Tukey")
cld(emm)
```
Plot RA as stacked bar plots by Day and then by temp 

By temps - line chart good (also show bar plot just in case) 
```{r}   
library(RColorBrewer)
display.brewer.pal(n = 9, name = 'YlOrBr')
brewer.pal(9, 'YlOrBr')


#Blue #1D91C0" 
#Green "#41AB5D"
#Yellow "#FEC44F"
#Red "#993404"

ALL_RelA_b$Day2<-ALL_RelA_b$Day #change Day to numeric for plots
ALL_RelA_b$Day2<-as.character(ALL_RelA_b$Day2)
ALL_RelA_b$Day2<-as.numeric(ALL_RelA_b$Day2)

relabund_27<-subset(ALL_RelA_b, Temp=="27")
relabund_30<-subset(ALL_RelA_b, Temp=="30")
relabund_31<-subset(ALL_RelA_b, Temp=="31")
 
#27 
ALL_RelA_27_mean <- ddply(relabund_27, c("Day2","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_27_mean #display table

#round to nearest integer
ALL_RelA_27_mean$mean100<-ALL_RelA_27_mean$mean*100
ALL_RelA_27_mean$mean100r<-round(ALL_RelA_27_mean$mean100, digits = 0)
 
 #30C means  
ALL_RelA_30_mean <- ddply(relabund_30, c("Day2", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_30_mean #display table

#round to nearest integer
ALL_RelA_30_mean$mean100<-ALL_RelA_30_mean$mean*100
ALL_RelA_30_mean$mean100r<-round(ALL_RelA_30_mean$mean100, digits = 1)


#31C
ALL_RelA_31_mean <- ddply(relabund_31, c("Day2", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                  mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_31_mean #display table

#round to nearest integer
ALL_RelA_31_mean$mean100<-ALL_RelA_31_mean$mean*100
ALL_RelA_31_mean$mean100r<-round(ALL_RelA_31_mean$mean100, digits = 0)  
 
 #stacked bar plots
 #27
 relabund_27_D3<-subset(relabund_27, Day2==3)
 relabund_27_D3_plot <-ggplot(data=relabund_27, aes(x=Day, y=cells.larvae, group = interaction(Day,Symbiont), color=Symbiont))+
   geom_boxplot(width=0.5,aes(color = Symbiont))+ 
   theme_classic()+
  # geom_jitter(aes(color = Symbiont, shape = Symbiont), position = position_jitter(0.2)) +
   geom_point(position=position_jitterdodge(),alpha=0.3) +
     scale_color_manual(values = c("#D43F3AFF", "#EEA236FF", "#5CB85CFF","#46B8DAFF"));relabund_27_D3_plot
 
 #30
 relabund_30_D3_plot <-ggplot(data=relabund_30, aes(x=Day2, y=cells.larvae, group = interaction(Day,Symbiont), color=Symbiont))+
   geom_boxplot(width=0.5,aes(color = Symbiont))+ 
   theme_classic()+
  # geom_jitter(aes(color = Symbiont, shape = Symbiont), position = position_jitter(0.2)) +
   geom_point(position=position_jitterdodge(),alpha=0.3) +
     scale_color_manual(values = c("#D43F3AFF", "#EEA236FF", "#5CB85CFF","#46B8DAFF"));relabund_30_D3_plot

  #31
 relabund_31_D3_plot <-ggplot(data=relabund_31, aes(x=Day2, y=cells.larvae, group = interaction(Day,Symbiont), color=Symbiont))+
   geom_boxplot(width=0.5,aes(color = Symbiont))+ 
   theme_classic()+
  # geom_jitter(aes(color = Symbiont, shape = Symbiont), position = position_jitter(0.2)) +
   geom_point(position=position_jitterdodge(),alpha=0.3) +
     scale_color_manual(values = c("#D43F3AFF", "#EEA236FF", "#5CB85CFF","#46B8DAFF"));relabund_31_D3_plot
 
 
 #plot all together
relabund_27_D3_plot<-relabund_27_D3_plot+ theme(legend.position = "none") #remove legend
relabund_30_D3_plot<-relabund_30_D3_plot+ theme(legend.position = "none") #remove legend
relabund_31_D3_plot<-relabund_31_D3_plot+ theme(legend.position = "none") #remove legend

grid.arrange(relabund_27_D3_plot, relabund_30_D3_plot,relabund_31_D3_plot, nrow = 1)




### same but stacked bar

# barplot 
RelAbund27_plot<-ggplot(ALL_RelA_27_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund27_plot   

RelAbund30_plot<-ggplot(ALL_RelA_30_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund30_plot

RelAbund31_plot<-ggplot(ALL_RelA_31_mean, aes(y=mean, x=Day2, fill=Symbiont)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("RelAbund"))) +
  ggtitle("27C");RelAbund31_plot

 #plot all together
RelAbund27_plot<-RelAbund27_plot+ theme(legend.position = "none") #remove legend
RelAbund30_plot<-RelAbund30_plot+ theme(legend.position = "none") #remove legend
RelAbund31_plot<-RelAbund31_plot+ theme(legend.position = "none") #remove legend

grid.arrange(RelAbund27_plot, RelAbund30_plot,RelAbund31_plot, nrow = 1)


``` 

ALL relative abundance Line plots
```{r}   

#27C line plot
 ALL_STP_27_line<-ggplot(data=ALL_RelA_27_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
         scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("27C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_27_line

#30C line plot
 ALL_STP_30_line<-ggplot(data=ALL_RelA_30_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
          scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("30C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_30_line
 
 #31C line plot
 ALL_STP_31_line<-ggplot(data=ALL_RelA_31_mean, aes(x=Day2, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#D43F3AFF','#EEA236FF','#5CB85CFF','#46B8DAFF'))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
       scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("31C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_31_line
     
#plot all together
ALL_STP_27_line<-ALL_STP_27_line+ theme(legend.position = "none") #remove legend
ALL_STP_30_line<-ALL_STP_30_line+ theme(legend.position = "none") #remove legend
ALL_STP_31_line<-ALL_STP_31_line+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_STP_27_line, ALL_STP_30_line,ALL_STP_31_line, nrow = 1)
       
```
 
Figure x. Plot all temps together (Rel Abund)
```{r} 
 #bar
ALL_STP_27<-ALL_STP_27+ theme(legend.position = "none") #remove legend 
ALL_STP_30<-ALL_STP_30+ theme(legend.position = "none") #remove legend
ALL_STP_31<-ALL_STP_31+ theme(legend.position = "none") #remove legend
grid.arrange(ALL_STP_27, ALL_STP_30, ALL_STP_31, nrow = 1)

#line 
ALL_STP_27_line<-ALL_STP_27_line+ theme(legend.position = "none") #remove legend 
ALL_STP_30_line<-ALL_STP_30_line+ theme(legend.position = "none") #remove legend 
ALL_STP_31_line<-ALL_STP_31_line+ theme(legend.position = "none") #remove legend
grid.arrange(ALL_STP_27_line, ALL_STP_30_line, ALL_STP_31_line, nrow = 1)
``` 

DELETE: Relative abundance: bubble plot
```{r}
#27C
ALL_RelA_27_mean$Day.num<-ALL_RelA_27_mean$Day
ALL_RelA_27_mean$Day.num<-as.character(ALL_RelA_27_mean$Day.num)
ALL_RelA_27_mean$Day.num<-as.numeric(ALL_RelA_27_mean$Day.num)

RelA_mult_27 <- ggplot(ALL_RelA_27_mean, aes(x = Day.num, y = Symbiont, size = mean, color = Symbiont)) +
  geom_point() +
              scale_color_locuszoom()+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  scale_size_area(max_size = 20, breaks = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  coord_fixed(ratio = .9) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));RelA_mult_27

#30C
ALL_RelA_30_mean$Day.num<-ALL_RelA_30_mean$Day
ALL_RelA_30_mean$Day.num<-as.character(ALL_RelA_30_mean$Day.num)
ALL_RelA_30_mean$Day.num<-as.numeric(ALL_RelA_30_mean$Day.num)

RelA_mult_30 <- ggplot(ALL_RelA_30_mean, aes(x = Day, y = Symbiont, size = mean, color = Symbiont)) +
  geom_point() +
      #scale_x_continuous(breaks=seq(0, 14, 2))+
              scale_color_locuszoom()+
  scale_size_area(max_size = 20, breaks = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  coord_fixed(ratio = 0.9) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));RelA_mult_30

#31C
ALL_RelA_31_mean$Day.num<-ALL_RelA_31_mean$Day
ALL_RelA_31_mean$Day.num<-as.character(ALL_RelA_31_mean$Day.num)
ALL_RelA_31_mean$Day.num<-as.numeric(ALL_RelA_31_mean$Day.num)
RelA_mult_31 <- ggplot(ALL_RelA_31_mean, aes(x = Day, y = Symbiont, size = mean, color = Symbiont)) +
  geom_point() +
    #  scale_x_continuous(breaks=seq(0, 14, 2))+
              scale_color_locuszoom()+
  scale_size_area(max_size = 20, breaks = c(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  coord_fixed(ratio = 0.9) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"));RelA_mult_31

RelA_mult_27<-RelA_mult_27+ theme(legend.position = "none") #remove legend 
RelA_mult_30<-RelA_mult_30+ theme(legend.position = "none") #remove legend 
RelA_mult_31<-RelA_mult_31+ theme(legend.position = "none") #remove legend
grid.arrange(RelA_mult_27, RelA_mult_30, RelA_mult_31, nrow = 1)

library(cowplot)

BubblePlots<-plot_grid(RelA_mult_27, RelA_mult_30, RelA_mult_31, labels = "AUTO", ncol=3, nrow=1, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);BubblePlots 

#add common x and y axis labels
y.grob <- textGrob("cells/larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
InfectRaw_Fig1<-grid.arrange(arrangeGrob(InfectRaw_Fig1, left = y.grob, bottom = x.grob))
#save
ggsave(filename="Figures/InfectRaw_Fig1.png", plot=InfectRaw_Fig1, dpi=300, width=12, height=12, units="in")

```


#NMDS
```{r}
set.seed(2)
community_matrix=matrix(
   sample(1:100,300,replace=T),nrow=10,
   dimnames=list(paste("community",1:10,sep=""),paste("sp",1:30,sep="")))

example_NMDS=metaMDS(community_matrix, # Our community-by-species matrix
                     k=2) # The number of reduced dimensions
```

#PCA: Let's try to make a PCA  
```{r}


#hist ALL_RelA_b df is right format to check
hist(ALL_RelA_b$cells.larvae) #transform
ALL_RelA_b$cells.larvae_arc<-asin(sqrt(ALL_RelA_b$cells.larvae))
hist(ALL_RelA_b$cells.larvae_arc) #beter (check to see if that is ok)
ALL_RelA_b$cells.larvae_log<-log10(ALL_RelA_b$cells.larvae+1)
hist(ALL_RelA_b$cells.larvae_log) #not as good

RelA_PCA<-ALL_RelA_a #keep only cols you need USE _a for the right shape of data (_b is melted, _a cast)
RelA_PCA<-na.omit(RelA_PCA)# remove NA

#arcsine transform
RelA_PCA$Cladocopium<-asin(sqrt(RelA_PCA$Cladocopium))
RelA_PCA$Durusdinium<-asin(sqrt(RelA_PCA$Durusdinium))
RelA_PCA$Fugacium<-asin(sqrt(RelA_PCA$Fugacium))
RelA_PCA$Gerakladium<-asin(sqrt(RelA_PCA$Gerakladium))
```

Here is the PCA script from AH: 
 
Generate results of (1) eigen values,  (2) coordinates, (3) contributions to the PCA, (4) and quality of representation.    
```{r, results=TRUE} 
# Everything 
multi.pca <- prcomp(RelA_PCA[,5:8], scale=F)
multi.pca
summary(multi.pca)
 
eig.val <- get_eigenvalue(multi.pca)
eig.val

res.var <- get_pca_var(multi.pca)
res.var$coord          # Coordinates
res.var$contrib        # Contributions to the PCs
res.var$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_vegan <- RelA_PCA[c(5:8)]
vegan_model <- scale(data_vegan) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1<-adonis2(vegan_model ~ Day * Temp, data = RelA_PCA, method='eu', perm=999)
summary(adonis1)
adonis1 

#Plotting with elipses by temperature.  
 
pca.plot <- autoplot(multi.pca, data = RelA_PCA, colour = 'Temp', shape="Day",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.25,0.5) +
  ylim(-0.25, 0.5) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot

#spca.plot$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA.pdf", plot=pca.plot, height=8, width=12, units = c("in"), dpi=300) #output figure 


#Plotting with elipses by day. 

pca.plot2 <- autoplot(multi.pca, data = RelA_PCA, colour = 'Day', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm")+
  scale_colour_manual(values=c("black", "maroon", "darkgreen")) +
  scale_fill_manual(values=c("black", "purple", "darkgreen"))+
  xlim(-0.4,0.25) +
  ylim(-0.4, 0.25) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
   theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot2

#pca.plot2$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA2.pdf", plot=pca.plot2, height=8, width=12, units = c("in"), dpi=300) #output figure
```

###PCA by Day   
Day 3
```{r, results=TRUE} 

RelA_PCA_D3<-subset(RelA_PCA, Day==3)  #subset day 3

multi.pcaD3 <- prcomp(RelA_PCA_D3[,5:8], scale=F)
multi.pcaD3
summary(multi.pcaD3)

eig.valD3 <- get_eigenvalue(multi.pcaD3)
eig.valD3
 
res.varD3 <- get_pca_var(multi.pcaD3)
res.varD3$coord          # Coordinates
res.varD3$contrib        # Contributions to the PCs
res.varD3$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_veganD3 <- RelA_PCA_D3[c(5:8)]
vegan_modelD3 <- scale(data_veganD3) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1D3<-adonis2(vegan_modelD3 ~   Temp, data = RelA_PCA_D3, method='eu', perm=999)
summary(adonis1D3)
adonis1D3

#Plotting with elipses by temperature.  
 
pca.plotD3 <- autoplot(multi.pcaD3, data = RelA_PCA_D3, colour = 'Temp', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.4,0.4) +
  ylim(-0.4, 0.5) +
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plotD3

pca.plotD3$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plotD3.pdf", plot=pca.plotD3, height=8, width=12, units = c("in"), dpi=300) #output figure 



```
Day 7
```{r, results=TRUE} 

RelA_PCA_D7<-subset(RelA_PCA, Day==7)  #subset day 3

multi.pcaD7 <- prcomp(RelA_PCA_D7[,5:8], scale=F)
multi.pcaD7
summary(multi.pcaD7)

eig.valD7 <- get_eigenvalue(multi.pcaD7)
eig.valD7
 
res.varD7 <- get_pca_var(multi.pcaD7)
res.varD7$coord          # Coordinates
res.varD7$contrib        # Contributions to the PCs
res.varD7$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_veganD7 <- RelA_PCA_D7[c(5:8)]
vegan_modelD7 <- scale(data_veganD7) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1D7<-adonis2(vegan_modelD7 ~   Temp, data = RelA_PCA_D7, method='eu', perm=999)
summary(adonis1D7)
adonis1D7

#Plotting with elipses by temperature.  
 
pca.plotD7 <- autoplot(multi.pcaD7, data = RelA_PCA_D7, colour = 'Temp', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.5,0.5) +
  ylim(-0.5, 0.5) +
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plotD7

pca.plotD7$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plotD7.pdf", plot=pca.plotD7, height=8, width=12, units = c("in"), dpi=300) #output figure 



```
Day 14
```{r, results=TRUE} 

RelA_PCA_D14<-subset(RelA_PCA, Day==14)  #subset day 14

multi.pcaD14 <- prcomp(RelA_PCA_D14[,5:8], scale=F)
multi.pcaD14
summary(multi.pcaD14)

eig.valD14 <- get_eigenvalue(multi.pcaD14)
eig.valD14
 
res.varD14 <- get_pca_var(multi.pcaD14)
res.varD14$coord          # Coordinates
res.varD14$contrib        # Contributions to the PCs
res.varD14$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_veganD14 <- RelA_PCA_D14[c(5:8)]
vegan_modelD14 <- scale(data_veganD14) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1D14<-adonis2(vegan_modelD14 ~   Temp, data = RelA_PCA_D14, method='eu', perm=999)
summary(adonis1D14)
adonis1D14

#Plotting with elipses by temperature.  
 
pca.plotD14 <- autoplot(multi.pcaD14, data = RelA_PCA_D14, colour = 'Temp', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.6,0.6) +
  ylim(-0.5, 0.5) +
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)=0.04", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plotD14

pca.plotD14$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plotD14.pdf", plot=pca.plotD14, height=8, width=12, units = c("in"), dpi=300) #output figure 

```
Plot all three days (ugly for now)
```{r}
PCA_Days_Figx<-plot_grid(pca.plotD3, pca.plotD7, pca.plotD14, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);PCA_Days_Figx

#save
ggsave(filename="Figures/InfectRaw_Fig1.png", plot=InfectRaw_Fig1, dpi=300, width=12, height=12, units="in")
```
###PCA by TEMP   
27C
```{r, results=TRUE} 

RelA_PCA_27C<-subset(RelA_PCA, Temp=="27")  #subset day 3

multi.pca27C <- prcomp(RelA_PCA_27C[,5:8], scale=F)
multi.pca27C
summary(multi.pca27C)

eig.val27C <- get_eigenvalue(multi.pca27C)
eig.val27C
 
res.var27C <- get_pca_var(multi.pca27C)
res.var27C$coord          # Coordinates
res.var27C$contrib        # Contributions to the PCs
res.var27C$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_vegan27C <- RelA_PCA_27C[c(5:8)]
vegan_model27C <- scale(data_vegan27C) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis127C<-adonis2(vegan_model27C ~   Day, data = RelA_PCA_27C, method='eu', perm=999)
summary(adonis127C)
adonis127C

#Plotting with elipses by temperature.  
 
pca.plot27C <- autoplot(multi.pca27C, data = RelA_PCA_27C, colour = 'Day', shape="Day",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.4,0.4) +
  ylim(-0.4, 0.5) +
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot27C

pca.plot27C$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plot27C.pdf", plot=pca.plot27C, height=8, width=12, units = c("in"), dpi=300) #output figure 



```
30C
```{r, results=TRUE} 

RelA_PCA_30C<-subset(RelA_PCA, Temp==30)  #subset day 3

multi.pca30C <- prcomp(RelA_PCA_30C[,5:8], scale=F)
multi.pca30C
summary(multi.pca30C)

eig.val30C <- get_eigenvalue(multi.pca30C)
eig.val30C
 
res.var30C <- get_pca_var(multi.pca30C)
res.var30C$coord          # Coordinates
res.var30C$contrib        # Contributions to the PCs
res.var30C$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_vegan30C <- RelA_PCA_30C[c(5:8)]
vegan_model30C <- scale(data_vegan30C) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis130C<-adonis2(vegan_model30C ~   Day, data = RelA_PCA_30C, method='eu', perm=999)
summary(adonis130C)
adonis130C

#Plotting with elipses by temperature.  
 
pca.plot30C <- autoplot(multi.pca30C, data = RelA_PCA_30C, colour = 'Day', shape="Day",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.5,0.5) +
  ylim(-0.5, 0.5) +
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)=.11", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot30C

pca.plot30C$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plot30C.pdf", plot=pca.plot30C, height=8, width=12, units = c("in"), dpi=300) #output figure 

```
31C
```{r, results=TRUE} 

RelA_PCA_31C<-subset(RelA_PCA, Temp==31)  #subset day 14

multi.pca31C <- prcomp(RelA_PCA_31C[,5:8], scale=F)
multi.pca31C
summary(multi.pca31C)

eig.val31C <- get_eigenvalue(multi.pca31C)
eig.val31C
 
res.var31C <- get_pca_var(multi.pca31C)
res.var31C$coord          # Coordinates
res.var31C$contrib        # Contributions to the PCs
res.var31C$cos2           # Quality of representation 

#Conduct PERMANOVA with vegan package.  
#All the data by Temp/Day

# PCA
data_vegan31C <- RelA_PCA_31C[c(5:8)]
vegan_model31C <- scale(data_vegan31C) 

# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis131C<-adonis2(vegan_model31C ~   Day, data = RelA_PCA_31C, method='eu', perm=999)
summary(adonis131C)
adonis131C

#Plotting with elipses by temperature.  
 
pca.plot31C <- autoplot(multi.pca31C, data = RelA_PCA_31C, colour = 'Day', shape="Day",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.7,0.6) +
  ylim(-0.6, 0.7) +
  geom_text(x=0, y=-0.43, label="PERMANOVA p(Temp)=0.96", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot31C

pca.plot31C$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/pca.plot31C.pdf", plot=pca.plot31C, height=8, width=12, units = c("in"), dpi=300) #output figure 

```
Plot all three days (ugly for now)
```{r}
PCA_Temp_Figx<-plot_grid(pca.plot27C, pca.plot30C, pca.plot31C, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);PCA_Temp_Figx

#save
ggsave(filename="Figures/InfectRaw_Fig1.png", plot=InfectRaw_Fig1, dpi=300, width=12, height=12, units="in")
```

Plot  3x2 days and temps
```{r}
PCA_TempDay_Figx<-plot_grid(pca.plotD3, pca.plotD7, pca.plotD14, pca.plot27C, pca.plot30C, pca.plot31C, labels = "AUTO", ncol=3, nrow=2, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);PCA_TempDay_Figx

#save
ggsave(filename="Figures/PCA_TempDay_Figx.pdf", plot=PCA_TempDay_Figx, dpi=300, width=12, height=12, units="in")
```

##Multi raw - for how we can compare to individual infection
This is the Count data used for MULTI INFECTION! Not Relabund
```{r}        
#use ALLcast_9000_cast2a THIS IS WITHOUT SAMPS REMOVED WHEN ALL NOT AMPED
#This is OK for the raw to compare to single infections but not for relabund. 

MultiInfect_Raw<-ALLcast_9000_cast2a

# melt
MultiInfect_Raw_2<-melt(MultiInfect_Raw, id=c("ALL.number","Temp","Day","Pot"), measure.vars = c("C1_round","D1_round","F1_round","G3_round"))
colnames(MultiInfect_Raw_2)[colnames(MultiInfect_Raw_2)=="value"]<-"cells.larvae" #rename value col
colnames(MultiInfect_Raw_2)[colnames(MultiInfect_Raw_2)=="variable"]<-"Symbiont" #rename value col
 
#Subset by clade
  
MultiInfect_Raw_C1<-subset(MultiInfect_Raw_2, Symbiont=="C1_round")
MultiInfect_Raw_D1<-subset(MultiInfect_Raw_2, Symbiont=="D1_round")
MultiInfect_Raw_F1<-subset(MultiInfect_Raw_2, Symbiont=="F1_round")
MultiInfect_Raw_G3<-subset(MultiInfect_Raw_2, Symbiont=="G3_round")

```
 
PLOT C1 Multi infection raw
```{r} 
C1_MULTI_mean <- ddply(MultiInfect_Raw_C1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_MULTI_mean #display table
C1_MULTI_mean<-na.omit(C1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1_MULTI_mean$Day.num<-as.numeric(C1_MULTI_mean$Day)
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 2] =7
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 3] =14
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 1] =3


C1_MULTI_plot<-ggplot(data=C1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_MULTI_plot
``` 

PLOT D1 Multi infection Raw
```{r} 
D1_MULTI_mean <- ddply(MultiInfect_Raw_D1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_MULTI_mean #display table
D1_MULTI_mean<-na.omit(D1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1_MULTI_mean$Day.num<-as.numeric(D1_MULTI_mean$Day)
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 2] =7
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 3] =14
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 1] =3


D1_MULTI_plot<-ggplot(data=D1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(1,100,1000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_MULTI_plot
``` 

PLOT F1 Multi infection Raw
```{r} 
F1_MULTI_mean <- ddply(MultiInfect_Raw_F1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_MULTI_mean #display table
F1_MULTI_mean<-na.omit(F1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1_MULTI_mean$Day.num<-as.numeric(F1_MULTI_mean$Day)
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 2] =7
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 3] =14
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 1] =3


F1_MULTI_plot<-ggplot(data=F1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_MULTI_plot
``` 

PLOT G3 Multi infection Raw
```{r} 
G3_MULTI_mean <- ddply(MultiInfect_Raw_G3, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_MULTI_mean #display table
G3_MULTI_mean<-na.omit(G3_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3_MULTI_mean$Day.num<-as.numeric(G3_MULTI_mean$Day)
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 2] =7
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 3] =14
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 1] =3


G3_MULTI_plot<-ggplot(data=G3_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+  xlab("") + #Label the X Axis 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
      theme(legend.position = c(0.8, 0.2))+
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_MULTI_plot
``` 

Figure x. Plot all Symbiont multi ALL  together:
```{r} 
#line plot 
C1_MULTI_plot<-C1_MULTI_plot+ theme(legend.position = "none") #remove legend
D1_MULTI_plot<-D1_MULTI_plot+ theme(legend.position = "none") #remove legend
F1_MULTI_plot<-F1_MULTI_plot+ theme(legend.position = "none") #remove legend
#G3_MULTI_plot<-G3_MULTI_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.
grid.arrange(C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 1)
```

Plot Single and Multi Binomial infection plots 4x4
```{r}
library(cowplot)

countdata_compare<-plot_grid(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, labels = "AUTO", ncol=4, nrow=2, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);countdata_compare

#add common x and y axis labels
y.grob <- textGrob("cells/larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
countdata_compare<-grid.arrange(arrangeGrob(countdata_compare, left = y.grob, bottom = x.grob))
#save
#ggsave(filename="Figures/countdata_compare.png", plot=countdata_compare, dpi=300, width=12,height=10, units="in")

```
  
Plot single Raw plots over Multi clade plots (comparison plot). I like the above better. 
  
```{r}  
grid.arrange(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,
  C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 2)
```
 
# let's look at some plots of raw counts by single vs multi infection. Blue and pink plots
C1    
C1Full2 = Single cells.larvae raw
ALLcast_9000_cast2a = Alls raw that infected
Counts, on log y-axis
```{r}   
MultiCounts<-ALLcast_9000_cast2a
#MultiCounts$cells.larvae<-MultiCounts$C1+MultiCounts$D1+MultiCounts$F1+MultiCounts$G3
MultiCounts2<-MultiCounts[-c(1,5:8)] #remove metadata
MultiCounts2$single.multi<-"multi"
names(MultiCounts2)[names(MultiCounts2) == "C1_round"] <- "C1"
names(MultiCounts2)[names(MultiCounts2) == "D1_round"] <- "D1" 
names(MultiCounts2)[names(MultiCounts2) == "F1_round"] <- "F1"
names(MultiCounts2)[names(MultiCounts2) == "G3_round"] <- "G3"
 

#MultiCounts2$Symbiont<-"All"
MultiCounts2<-melt(MultiCounts2, id=c("Temp","Day","single.multi","Pot"))
colnames(MultiCounts2)[colnames(MultiCounts2)=="value"]<-"cells.larvae_round" #rename value col
colnames(MultiCounts2)[colnames(MultiCounts2)=="variable"]<-"Symbiont" #rename value col

SingleCounts<-rbind(C1Full,D1Full,F1Full,G3Full)
SingleCounts<-SingleCounts[-c(5:10)] #remove metadata
SingleCounts$single.multi<-"single"

CountsCompare<-rbind(SingleCounts, MultiCounts2) # combine


#MEANs
CountsCompare_mean <- ddply(CountsCompare, c("single.multi","Temp","Day","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae_round[!is.na(cells.larvae_round)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_round, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_round, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
CountsCompare_mean #display table
CountsCompare_mean<-na.omit(CountsCompare_mean)
#make a code
CountsCompare_mean$code<-paste0(CountsCompare_mean$single.multi, "_", CountsCompare_mean$Temp) #code

CountsCompare_mean<-CountsCompare_mean[ , order(names(CountsCompare_mean))]
CountsCompare_mean<-na.omit(CountsCompare_mean)
#make Day numeric

#change Day back to Numeric from Factor, reapply the actual numeric dates
CountsCompare_mean$Day<-as.numeric(CountsCompare_mean$Day)
CountsCompare_mean$Day[CountsCompare_mean$Day == 2] =7
CountsCompare_mean$Day[CountsCompare_mean$Day == 3] =14
CountsCompare_mean$Day[CountsCompare_mean$Day == 1] =3
 
#subset by temp
CountsCompare_mean_27<-subset(CountsCompare_mean, Temp=="27")
CountsCompare_mean_30<-subset(CountsCompare_mean, Temp=="30")
CountsCompare_mean_31<-subset(CountsCompare_mean, Temp=="31")
```

subset by Symbiont plots
C1: 27C
```{r}      
#subset C1 
CountsCompare_C1_27<-subset(CountsCompare_mean_27, Symbiont=="C1")
 
CountsCompare_C1_plot27<-ggplot(data=CountsCompare_C1_27, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  
  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Cladocopium")))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot27


```
C1: 30C

```{r}
#Subset 30 
CountsCompare_C1_30<-subset(CountsCompare_mean_30, Symbiont=="C1")

CountsCompare_C1_plot30<-ggplot(data=CountsCompare_C1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot30
```

C1: 31C
```{r} 
#Subset 31
CountsCompare_C1_31<-subset(CountsCompare_mean_31, Symbiont=="C1")
 
 
CountsCompare_C1_plot31<-ggplot(data=CountsCompare_C1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot31
```

D1
D1: 27C
```{r}
CountsCompare_D1<-subset(CountsCompare_mean_27, Symbiont=="D1")
 
CountsCompare_D1_plot27<-ggplot(data=CountsCompare_D1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Durusdinium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot27

```
D1: 30C
```{r}
#Subset 30
CountsCompare_D1_30<-subset(CountsCompare_mean_30, Symbiont=="D1")
 
CountsCompare_D1_plot30<-ggplot(data=CountsCompare_D1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot30

```
D1: 31C
```{r}
#Subset 31
CountsCompare_D1_31<-subset(CountsCompare_mean_31, Symbiont=="D1")


CountsCompare_D1_plot31<-ggplot(data=CountsCompare_D1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  expand_limits(x = 14, y = 0)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot31
```

F1
F1: 27C
```{r}
#subset F1 
CountsCompare_F1<-subset(CountsCompare_mean_27, Symbiont=="F1")
 

CountsCompare_F1_plot27<-ggplot(data=CountsCompare_F1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Fugacium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot27

```
F1: 30C
```{r}
#Subset 30
CountsCompare_F1_30<-subset(CountsCompare_mean_30, Symbiont=="F1")
 

CountsCompare_F1_plot30<-ggplot(data=CountsCompare_F1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot30
```
F1: 31C
```{r}
#Subset 31
CountsCompare_F1_31<-subset(CountsCompare_mean_31, Symbiont=="F1")

CountsCompare_F1_plot31<-ggplot(data=CountsCompare_F1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot31
```

G3
G3: 27C
```{r}
#subset G3
CountsCompare_G3<-subset(CountsCompare_mean_27, Symbiont=="G3")


CountsCompare_G3_plot27<-ggplot(data=CountsCompare_G3, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Gerakladium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot27

```
G3: 30C
```{r}
#Subset 30
CountsCompare_G3_30<-subset(CountsCompare_mean_30, Symbiont=="G3")


CountsCompare_G3_plot30<-ggplot(data=CountsCompare_G3_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot30

```
G3: 31C
```{r}
#Subset 31
CountsCompare_G3_31<-subset(CountsCompare_mean_31, Symbiont=="G3")


CountsCompare_G3_plot31<-ggplot(data=CountsCompare_G3_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  #geom_text(aes(x = 3, y = 800, label = "*"), size = 9)+ #adding **  NOT WORKING YET
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
    theme(legend.position = c(0.8, 0.3),legend.title = element_blank())+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot31
```

Figure x. Plot 3x4:
```{r} 
#line plot 
CountsCompare_G3_plot27<-CountsCompare_G3_plot27+ theme(legend.position = "none")
CountsCompare_G3_plot30<-CountsCompare_G3_plot30+ theme(legend.position = "none")
#CountsCompare_G3_plot31<-CountsCompare_G3_plot31+ theme(legend.position = "none")

CountsCompare_F1_plot27<-CountsCompare_F1_plot27+ theme(legend.position = "none")
CountsCompare_F1_plot30<-CountsCompare_F1_plot30+ theme(legend.position = "none")
CountsCompare_F1_plot31<-CountsCompare_F1_plot31+ theme(legend.position = "none")

CountsCompare_D1_plot27<-CountsCompare_D1_plot27+ theme(legend.position = "none")
CountsCompare_D1_plot30<-CountsCompare_D1_plot30+ theme(legend.position = "none")
CountsCompare_D1_plot31<-CountsCompare_D1_plot31+ theme(legend.position = "none")

CountsCompare_C1_plot27<-CountsCompare_C1_plot27+ theme(legend.position = "none")
CountsCompare_C1_plot30<-CountsCompare_C1_plot30+ theme(legend.position = "none")
CountsCompare_C1_plot31<-CountsCompare_C1_plot31+ theme(legend.position = "none")


grid.arrange(CountsCompare_C1_plot27, CountsCompare_C1_plot30, CountsCompare_C1_plot31, CountsCompare_D1_plot27,CountsCompare_D1_plot30, CountsCompare_D1_plot31,CountsCompare_F1_plot27,CountsCompare_F1_plot30,CountsCompare_F1_plot31,CountsCompare_G3_plot27,CountsCompare_G3_plot30,CountsCompare_G3_plot31, nrow = 4)

```
 
Plot Single and Multi raw counts infection plots 4x2  
```{r} 
   
InfectRaw_Fig1<-plot_grid(CountsCompare_C1_plot27, CountsCompare_C1_plot30, CountsCompare_C1_plot31, CountsCompare_D1_plot27,CountsCompare_D1_plot30, CountsCompare_D1_plot31,CountsCompare_F1_plot27,CountsCompare_F1_plot30,CountsCompare_F1_plot31,CountsCompare_G3_plot27,CountsCompare_G3_plot30,CountsCompare_G3_plot31, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);InfectRaw_Fig1 

#add common x and y axis labels
y.grob <- textGrob("cells/larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
InfectRaw_Fig1<-grid.arrange(arrangeGrob(InfectRaw_Fig1, left = y.grob, bottom = x.grob))
#save
ggsave(filename="Figures/InfectRaw_Fig1.png", plot=InfectRaw_Fig1, dpi=300, width=12, height=12, units="in")
```

Plot comparing cell counts of individual infection vs total for multi (all clades totaled)

Use ALLcast_9000_cast2b = relabund (data for all clades in single larvae)
```{r}
#organize multi infection df
Competition<-ALLcast_9000_cast2b
Competition$code<-paste0(Competition$Day, "_", Competition$Temp,"_", Competition$Pot) #code
Competition$totalcells<-Competition$C1+Competition$D1+Competition$F1+Competition$G3
Competition$cells.larvae_log<-log10(Competition$totalcells+1)
Competition2<-Competition[-c(1,5:8)]  
Competition2$Symbiont<-"All"  #cerate Symbiont column with "All"
Competition2$cells.larvae_round<-Competition2$totalcells
Competition2<-Competition2[-c(5)]  

#organize Single df
SingleCounts2<-rbind(C1Full,D1Full, F1Full, G3Full)
SingleCounts2$code<-paste0(SingleCounts2$Day, "_", SingleCounts2$Temp,"_", SingleCounts2$Pot) #code
SingleCounts2<-SingleCounts2[-c(5:7,9)]  
SingleCounts2$cells.larvae_round<-SingleCounts2$cells.larvae_counts_round
SingleCounts2<-SingleCounts2[-c(6)] 
#combine single and multi 
CompetitionSingle<-rbind(SingleCounts2,Competition2)

#MEANs
CompetitionSingle_mean <- ddply(CompetitionSingle, c("Temp","Day","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae_round[!is.na(cells.larvae_round)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_round, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_round, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 

CompetitionSingle_mean #display table
CompetitionSingle_mean<-na.omit(CompetitionSingle_mean)


#make Day numeric

#change Day back to Numeric from Factor, reapply the actual numeric dates
CompetitionSingle_mean$Day<-as.numeric(CompetitionSingle_mean$Day)
CompetitionSingle_mean$Day[CompetitionSingle_mean$Day == 2] =7
CompetitionSingle_mean$Day[CompetitionSingle_mean$Day == 3] =14
CompetitionSingle_mean$Day[CompetitionSingle_mean$Day == 1] =3




#subset by temp

CompetitionSingle_27<-subset(CompetitionSingle_mean, Temp=="27")
 CompetitionSingle_30<-subset(CompetitionSingle_mean, Temp=="30")
CompetitionSingle_31<-subset(CompetitionSingle_mean, Temp=="31")

#27C
CompetitionSingle_27_plot<-ggplot(data=CompetitionSingle_27, aes(x=Day, y=mean, group=Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis
         scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
         scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
#  ylab(expression(paste(italic("Cells/Larvae")))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CompetitionSingle_27_plot

#30C
CompetitionSingle_30_plot<-ggplot(data=CompetitionSingle_30, aes(x=Day, y=mean, group=Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis
         scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
         scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  #ylab(expression(paste(italic("Cells/Larvae")))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CompetitionSingle_30_plot

#31C
CompetitionSingle_31_plot<-ggplot(data=CompetitionSingle_31, aes(x=Day, y=mean, group=Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point( size=4, show.legend = T)+ 
      scale_color_manual(values=c('#EEA236FF','#46B8DAFF','#D43F3AFF','#5CB85CFF',"black"))+
       geom_point(shape = 1,size = 4,colour = "black")+
  geom_line(linetype="dotted")+
  xlab("Days") + #Label the X Axis
         scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
         scale_x_continuous(breaks=seq(0, 14, 2), limits =c(0,14))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
 # ylab(expression(paste(italic("Cells/Larvae")))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CompetitionSingle_31_plot

CompetitionSingle_27_plot<-CompetitionSingle_27_plot+ theme(legend.position = "none")
CompetitionSingle_30_plot<-CompetitionSingle_30_plot+ theme(legend.position = "none")
CompetitionSingle_31_plot<-CompetitionSingle_31_plot+ theme(legend.position = "none")
#combine all plots
plot_grid(CompetitionSingle_27_plot, CompetitionSingle_30_plot, CompetitionSingle_31_plot,  nrow=1)
                                  

#stats
CompetitionSingle_27mod<-subset(CompetitionSingle, Temp=="27")
CompetitionSingle_27mod$code<-as.factor(CompetitionSingle_27mod$code)

CompetitionSingle_27_mod<-lmer(totalcells_log~Day*Symbiont+(1|code),CompetitionSingle_27mod)
anova(CompetitionSingle_27_mod)
qqPlot(residuals(CompetitionSingle_27_mod))   # good
  emm<-emmeans(CompetitionSingle_27_mod,  ~ Symbiont|Day, adjust="Tukey") 
cld(emm)

CompetitionSingle_30mod<-subset(CompetitionSingle, Temp=="30")
CompetitionSingle_30mod$code<-as.factor(CompetitionSingle_30mod$code)

CompetitionSingle_30_mod<-lmer(totalcells_log~Day*Symbiont+(1|code),CompetitionSingle_30mod)
anova(CompetitionSingle_30_mod)
qqPlot(residuals(CompetitionSingle_30_mod))   # good
  emm<-emmeans(CompetitionSingle_30_mod,  ~ Symbiont|Day, adjust="Tukey") 
cld(emm)


#31  WE LOST TOO MANY VALUES AT D14. Don't run stats on it. 
CompetitionSingle_31mod<-subset(CompetitionSingle, Temp=="31")
CompetitionSingle_31mod<-subset(CompetitionSingle_31mod, Day==3 | Day==7)
#remove <3 larvae groups
#CompetitionSingle_31mod$code2<-paste0(CompetitionSingle_31mod$Day, "_", CompetitionSingle_31mod$Symbiont,"_") #MAKE NEW COde to get rid of single value on D14, ALL 31C#
#ompetitionSingle_31mod<-CompetitionSingle_31mod[!(CompetitionSingle_31mod$code2=="14_All_"),] #remove it

CompetitionSingle_31_mod<-lmer(cells.larvae_log~Day*Symbiont+(1|code),CompetitionSingle_31mod)
anova(CompetitionSingle_31_mod)
qqPlot(residuals(CompetitionSingle_31_mod))   # good
  emm<-emmeans(CompetitionSingle_31_mod,  ~ Symbiont|Day, adjust="Tukey") 
cld(emm)

```



## Multi: Individual clade heatmaps, MUTLI INFECTION counts not relabund (with 0s for individual clades) 
MultiCounts2=df (multi including all samples that amped (not trimmed))
C1 
```{r}
hist(MultiCounts2_C1$cells.larvae_log)
hist(MultiCounts2_D1$cells.larvae_log)
hist(MultiCounts2_F1$cells.larvae_log)
hist(MultiCounts2_G3$cells.larvae_log)


#C1
#Singles_C1
MultiCounts2_C1<-subset(MultiCounts2, Symbiont=="C1")
MultiCounts2_C1<-na.omit(MultiCounts2_C1)
hist(MultiCounts2_C1$cells.larvae_round)
MultiCounts2_C1$cells.larvae_log<-log10(MultiCounts2_C1$cells.larvae_round+1)
hist(MultiCounts2_C1$cells.larvae_log)


MultiCounts2_C1_mean <- ddply(MultiCounts2_C1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
MultiCounts2_C1_mean #display table
MultiCounts2_C1_mean$mean<-round(MultiCounts2_C1_mean$mean, digits = 2) #round the means

  MultiCounts2_C1_vars<-c("Temp","Day","mean")
MultiCounts2_C1_mean2<-MultiCounts2_C1_mean[MultiCounts2_C1_vars] 
MultiCounts2_C1_mean3<-cast(MultiCounts2_C1_mean2, Temp~Day, mean) #set updata for heatmap

C1rnames2 <- MultiCounts2_C1_mean3[,1]                            # assign labels in column 1 to "rnames"
C1mat_data2 <- data.matrix(MultiCounts2_C1_mean3[,2:ncol(MultiCounts2_C1_mean3)])  # transform column 2-5 into a matrix
rownames(C1mat_data2) <- C1rnames2                  # assign row names

C1heatMult<-heatmap.2(C1mat_data2,
  cellnote = C1mat_data2,  # same data set for cell labels
  main = "C1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

```
D1
```{r}
#D1
#Singles_D1
MultiCounts2_D1<-subset(MultiCounts2, Symbiont=="D1")
MultiCounts2_D1<-na.omit(MultiCounts2_D1)
 hist(MultiCounts2_D1$cells.larvae_round)
MultiCounts2_D1$cells.larvae_log<-log10(MultiCounts2_D1$cells.larvae_round+1)
hist(MultiCounts2_D1$cells.larvae_log)


MultiCounts2_D1_mean <- ddply(MultiCounts2_D1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
MultiCounts2_D1_mean #display table
MultiCounts2_D1_mean$mean<-round(MultiCounts2_D1_mean$mean, digits = 2) #round the means
MultiCounts2_D1_mean<-na.omit(MultiCounts2_D1_mean)
MultiCounts2_D1_mean<-na.omit(MultiCounts2_D1_mean)
  MultiCounts2_D1_vars<-c("Temp","Day","mean")
MultiCounts2_D1_mean2<-MultiCounts2_D1_mean[MultiCounts2_D1_vars] 
MultiCounts2_D1_mean3<-cast(MultiCounts2_D1_mean2, Temp~Day, mean) #set updata for heatmap

D1rnames2 <- MultiCounts2_D1_mean3[,1]                            # assign labels in column 1 to "rnames"
D1mat_data2 <- data.matrix(MultiCounts2_D1_mean3[,2:ncol(MultiCounts2_D1_mean3)])  # transform column 2-5 into a matrix
rownames(D1mat_data2) <- D1rnames2                  # assign row names

D1heatMult<-heatmap.2(D1mat_data2,
  cellnote = D1mat_data2,  # same data set for cell labels
  main = "D1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

```
F1
```{r}
#F1 
#Singles_F1
MultiCounts2_F1<-subset(MultiCounts2, Symbiont=="F1")
MultiCounts2_F1<-na.omit(MultiCounts2_F1)
hist(MultiCounts2_F1$cells.larvae_round)
MultiCounts2_F1$cells.larvae_log<-log10(MultiCounts2_F1$cells.larvae_round+1)
hist(MultiCounts2_F1$cells.larvae_log)


MultiCounts2_F1_mean <- ddply(MultiCounts2_F1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                  mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
MultiCounts2_F1_mean #display table
MultiCounts2_F1_mean$mean<-round(MultiCounts2_F1_mean$mean, digits = 2) #round the means
MultiCounts2_F1_mean<-na.omit(MultiCounts2_F1_mean)
  MultiCounts2_F1_vars<-c("Temp","Day","mean")
MultiCounts2_F1_mean2<-MultiCounts2_F1_mean[MultiCounts2_F1_vars] 
MultiCounts2_F1_mean3<-cast(MultiCounts2_F1_mean2, Temp~Day, mean) #set updata for heatmap

F1rnames2 <- MultiCounts2_F1_mean3[,1]                            # assign labels in column 1 to "rnames"
F1mat_data2 <- data.matrix(MultiCounts2_F1_mean3[,2:ncol(MultiCounts2_F1_mean3)])  # transform column 2-5 into a matrix
rownames(F1mat_data2) <- F1rnames2                  # assign row names

F1heatMult<-heatmap.2(F1mat_data2,
  cellnote = F1mat_data2,  # same data set for cell labels
  main = "F1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

```
G3
```{r}
#G3
#Singles_G3
MultiCounts2_G3<-subset(MultiCounts2, Symbiont=="G3")
MultiCounts2_G3<-na.omit(MultiCounts2_G3)
hist(MultiCounts2_G3$cells.larvae_round)
MultiCounts2_G3$cells.larvae_log<-log10(MultiCounts2_G3$cells.larvae_round+1)
hist(MultiCounts2_G3$cells.larvae_log)


MultiCounts2_G3_mean <- ddply(MultiCounts2_G3, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
MultiCounts2_G3_mean #display table
MultiCounts2_G3_mean$mean<-round(MultiCounts2_G3_mean$mean, digits = 2) #round the means
MultiCounts2_G3_mean<-na.omit(MultiCounts2_G3_mean)
  MultiCounts2_G3_vars<-c("Temp","Day","mean")
MultiCounts2_G3_mean2<-MultiCounts2_G3_mean[MultiCounts2_G3_vars] 
MultiCounts2_G3_mean3<-cast(MultiCounts2_G3_mean2, Temp~Day, mean) #set updata for heatmap

G3rnames2 <- MultiCounts2_G3_mean3[,1]                            # assign labels in column 1 to "rnames"
G3mat_data2 <- data.matrix(MultiCounts2_G3_mean3[,2:ncol(MultiCounts2_G3_mean3)])  # transform column 2-5 into a matrix
rownames(G3mat_data2) <- G3rnames2                  # assign row names


G3heatMult<-heatmap.2(G3mat_data2,
  cellnote = G3mat_data2,  # same data set for cell labels
  main = "G3", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

```





#Statistics for single vs multi COUNTS by symbiont
```{r} 
#stats, log10
hist(CountsCompare$cells.larvae_round)
CountsCompare$cells.larvae_log<-log10(CountsCompare$cells.larvae_round+1)
hist(CountsCompare$cells.larvae_log) #normal
CountsCompare$PotCode<-paste0(CountsCompare$Symbiont, "_", CountsCompare$Temp,"_", CountsCompare$Pot) #code
  

CountsCompare_C1<-subset(CountsCompare, Symbiont=="C1")
hist(CountsCompare_C1$cells.larvae_log) #normal
CountsCompare_D1<-subset(CountsCompare, Symbiont=="D1")
hist(CountsCompare_D1$cells.larvae_log) #ok
CountsCompare_F1<-subset(CountsCompare, Symbiont=="F1")
hist(CountsCompare_F1$cells.larvae_log) #normal
CountsCompare_G3<-subset(CountsCompare, Symbiont=="G3")
hist(CountsCompare_G3$cells.larvae_log) #normal


#Full model single v multi

CountsCompare_ALL_mod<-lmer(cells.larvae_log~Temp*Day*single.multi*Symbiont+(1|PotCode),CountsCompare)
anova(CountsCompare_ALL_mod)
qqPlot(residuals(CountsCompare_ALL_mod))   # good
  
emm<-emmeans(CountsCompare_ALL_mod,  ~ Temp*Day, adjust="Tukey")
cld(emm)


```
C1, full mod, then by temp 
```{r} 
#C1 
#full
CountsCompare_C1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_C1)
anova(CountsCompare_C1_mod)
qqPlot(residuals(CountsCompare_C1_mod))   # good
  emm<-emmeans(CountsCompare_C1_mod,  ~ Temp*Day, adjust="Tukey") 
cld(emm)

#subset by temp
CountsCompare_C1_27<-subset(CountsCompare_C1, Temp=="27")
CountsCompare_C1_30<-subset(CountsCompare_C1, Temp=="30")
CountsCompare_C1_31<-subset(CountsCompare_C1, Temp=="31")

#27
CountsCompare_C1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_27)
anova(CountsCompare_C1_27_mod)
qqPlot(residuals(CountsCompare_C1_27_mod))   # good
  emm<-emmeans(CountsCompare_C1_27_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#30
CountsCompare_C1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_30)
anova(CountsCompare_C1_30_mod)
qqPlot(residuals(CountsCompare_C1_30_mod))   # good
   emm<-emmeans(CountsCompare_C1_30_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#31
CountsCompare_C1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_31)
anova(CountsCompare_C1_31_mod)
qqPlot(residuals(CountsCompare_C1_31_mod))   # good
emm<-emmeans(CountsCompare_C1_31_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)


```

D1, full mod, then by temp 
```{r}
#D1
#full
CountsCompare_D1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_D1)
anova(CountsCompare_D1_mod)
qqPlot(residuals(CountsCompare_D1_mod))   # ok
 

#subset by temp
CountsCompare_D1_27<-subset(CountsCompare_D1, Temp=="27")
CountsCompare_D1_30<-subset(CountsCompare_D1, Temp=="30")
CountsCompare_D1_31<-subset(CountsCompare_D1, Temp=="31")

#27
CountsCompare_D1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_27)
anova(CountsCompare_D1_27_mod)
qqPlot(residuals(CountsCompare_D1_27_mod))   # good
  emm<-emmeans(CountsCompare_D1_27_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)
 
#30
CountsCompare_D1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_30)
anova(CountsCompare_D1_30_mod)
qqPlot(residuals(CountsCompare_D1_30_mod))   # good
emm<-emmeans(CountsCompare_D1_30_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#31
CountsCompare_D1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_31)
anova(CountsCompare_D1_31_mod)
qqPlot(residuals(CountsCompare_D1_31_mod))   # good
emm<-emmeans(CountsCompare_D1_31_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

```

F1, full mod, then by temp 
```{r}
#F1 
#full
CountsCompare_F1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_F1)
anova(CountsCompare_F1_mod)
qqPlot(residuals(CountsCompare_F1_mod))   # ok


#subset by temp
CountsCompare_F1_27<-subset(CountsCompare_F1, Temp=="27")
CountsCompare_F1_30<-subset(CountsCompare_F1, Temp=="30")
CountsCompare_F1_31<-subset(CountsCompare_F1, Temp=="31")

#27
CountsCompare_F1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_27)
anova(CountsCompare_F1_27_mod)
qqPlot(residuals(CountsCompare_F1_27_mod))   # good
  emm<-emmeans(CountsCompare_F1_27_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#30
CountsCompare_F1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_30)
anova(CountsCompare_F1_30_mod)
qqPlot(residuals(CountsCompare_F1_30_mod))   # good
 emm<-emmeans(CountsCompare_F1_30_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#31
CountsCompare_F1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_31)
anova(CountsCompare_F1_31_mod)
qqPlot(residuals(CountsCompare_F1_31_mod))   # good
 emm<-emmeans(CountsCompare_F1_31_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

```

G3, full mod, then by temp 
```{r}
#G3 
#full
CountsCompare_G3_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_G3)
anova(CountsCompare_G3_mod)
qqPlot(residuals(CountsCompare_G3_mod))   # ok


#subset by temp
CountsCompare_G3_27<-subset(CountsCompare_G3, Temp=="27")
CountsCompare_G3_30<-subset(CountsCompare_G3, Temp=="30")
CountsCompare_G3_31<-subset(CountsCompare_G3, Temp=="31")

#27
CountsCompare_G3_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_27)
anova(CountsCompare_G3_27_mod)
qqPlot(residuals(CountsCompare_G3_27_mod))   # good
 emm<-emmeans(CountsCompare_G3_27_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#30
CountsCompare_G3_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_30)
anova(CountsCompare_G3_30_mod)
qqPlot(residuals(CountsCompare_G3_30_mod))   # good
 emm<-emmeans(CountsCompare_G3_30_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)

#31
CountsCompare_G3_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_31)
anova(CountsCompare_G3_31_mod)
qqPlot(residuals(CountsCompare_G3_31_mod))   # good
 emm<-emmeans(CountsCompare_G3_31_mod,  ~ single.multi|Day, adjust="Tukey")  # use the "|"" to test specific date
cld(emm)
pairs(emm)
```

#Multi_raw counts full and by-clade for comparison (you said you don't want to use for main analysis)
```{r} 
#Full model MULTI only 
CountsCompare_multi<-subset(CountsCompare, single.multi=="multi")
CountsCompare_multi_mod<-lmer(cells.larvae_log~Temp*Day*Symbiont+(1|PotCode),CountsCompare_multi)
anova(CountsCompare_multi_mod)
qqPlot(residuals(CountsCompare_multi_mod))   # good
  
#C1
CountsCompare_multi_C1<-subset(CountsCompare_multi, Symbiont=="C1")
CountsCompare_multi_C1_mod<-lmer(cells.larvae_log~Temp*Day+(1|PotCode),CountsCompare_multi_C1)
anova(CountsCompare_multi_C1_mod)
qqPlot(residuals(CountsCompare_multi_C1_mod))   # good

#D1
CountsCompare_multi_D1<-subset(CountsCompare_multi, Symbiont=="D1")
CountsCompare_multi_D1_mod<-lmer(cells.larvae_log~Temp*Day+(1|PotCode),CountsCompare_multi_D1)
anova(CountsCompare_multi_D1_mod)
qqPlot(residuals(CountsCompare_multi_D1_mod))   # ok

#F1
CountsCompare_multi_F1<-subset(CountsCompare_multi, Symbiont=="F1")
CountsCompare_multi_F1_mod<-lmer(cells.larvae_log~Temp*Day+(1|PotCode),CountsCompare_multi_F1)
anova(CountsCompare_multi_F1_mod)
qqPlot(residuals(CountsCompare_multi_F1_mod))   # ok

#G3
CountsCompare_multi_G3<-subset(CountsCompare_multi, Symbiont=="G3")
CountsCompare_multi_G3_mod<-lmer(cells.larvae_log~Temp*Day+(1|PotCode),CountsCompare_multi_G3)
anova(CountsCompare_multi_G3_mod)
qqPlot(residuals(CountsCompare_multi_G3_mod))   # good
```






#Multi-infection data, ALL1 data (cutoff 9000)   
THIS IS THE SAME AS THE ABOVE BUT THOSE FIGURES IN MY PPT AFTER THE 'END' WITH THE SINGLE ON LEFT AND MULTI ON RIGHT. 
Expected vs observed infections, all and by clade
```{r}  
#ALL everything (this is way too big) 
Allmod<-lmer(log(cells.larvae+1)~Day*Temp*Primer+(1|Pot), ALL1)  #All.number is the larvae ID
#summary(Allmod)
anova(Allmod)

#is Pot significant
Pottest<-lm(log(cells.larvae+1)~Pot, ALL1)  #All.number is the larvae ID
summary(Pottest) #nothing is significant but the intercept. could argue not needed. 

#conduct post hoc test
#emm_Allmod = emmeans(Allmod, ~ Day * Temp * Primer, adjust="tukey")
#cld(emm_Allmod, Letters=c(LETTERS))#letter display
emmeans(Allmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run ALL by dates
#ALL Day 3 
AllDay3<-subset(ALL1, Day=="3")
AllmodDay3<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay3)  #All.number is the larvae ID
anova(AllmodDay3)
#conduct post hoc test
#emm_AllmodDay3 = emmeans(AllmodDay3, ~ Temp * Primer, adjust="tukey")
  #letter display#$cld(emm_AllmodDay3, Letters=c(LETTERS))
emmeans(AllmodDay3, pairwise ~ Temp |Primer)

#ALL Day 7
AllDay7<-subset(ALL1, Day=="7")
AllmodDay7<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay7)  #All.number is the larvae ID
anova(AllmodDay7)
#conduct post hoc test
#emm_AllmodDay7 = emmeans(AllmodDay7, ~ Temp * Primer, adjust="tukey")
  #cld(emm_AllmodDay7, Letters=c(LETTERS))
emmeans(AllmodDay7, pairwise ~ Temp |Primer)

#ALL Day 14
AllDay14<-subset(ALL1, Day=="14")
all14<-c("Temp","Primer", "ALL.number","cells.larvae")
AllDay14<-AllDay14[all14]
AllDay14<-  AllDay14[!(AllDay14$Temp=="31"),] #remove 31
AllmodDay14<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay14)  #All.number is the larvae ID
anova(AllmodDay14)
#conduct post hoc test
#emm_AllmodDay14 = emmeans(AllmodDay14, ~ Temp * Primer, adjust="tukey")
#cld(emm_AllmodDay14, Letters=c(LETTERS))
emmeans(AllmodDay14, pairwise ~ Temp |Primer)
```

Compare expected vs observed. Do this at each Time point (2-way easier to interpret)
C1
```{r}   
#copy df  
C1Full2<-C1Full 
D1Full2<-D1Full
F1Full2<-F1Full 
G3Full2<-G3Full

#single infection, add new column "single.multi"
C1Full2$single.multi<-"single"
C1Full2$single.multi<-factor(C1Full2$single.multi, levels=c("single","multi"))
C1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
C1Full3<-C1Full2[C1Full2vars]

#multi infection, add new column "single.multi"
C1ALL<-subset(ALL1, Primer=="C1") #subset Primer
C1ALL$single.multi<-"multi" #multi
C1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
C1ALLb<-C1ALL[C1ALLvars]
C1ALLb$cells.larvae_log<-log(C1ALLb$cells.larvae+1) #log
colnames(C1ALLb)[colnames(C1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
C1_EO<-rbind(C1ALLb, C1Full3) 
C1_EO$single.multi<-factor(C1_EO$single.multi, levels=c("single","multi"))
```
C1 Day 3
```{r} 
# Day 3 
C1_EO.D3<-subset(C1_EO, Day=="3")
C1_EOmodD3<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D3)
anova(C1_EOmodD3)
emmeans(C1_EOmodD3, pairwise ~  single.multi|Temp)


#run by temp
#27
C1_EO.D3_27<-subset(C1_EO.D3, Temp==27)
C1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_27)
anova(C1_EO.D3_27_mod)

#30
C1_EO.D3_30<-subset(C1_EO.D3, Temp==30)
C1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_30)
anova(C1_EO.D3_30_mod)

#31
C1_EO.D3_31<-subset(C1_EO.D3, Temp==31)
C1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_31)
anova(C1_EO.D3_31_mod)

#means
C1_EO.D3mean <- ddply(C1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D3mean #display table


C1_EO.D3_plot<-ggplot(data=C1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp,shape=single.multi), size=5, show.legend = T)+
    scale_shape_manual(values=c(19,1))+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+

  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day3")+
  theme(plot.title = element_text(size=20));C1_EO.D3_plot
```

C1 Day 7 
```{r}
# Day 7
C1_EO.D7<-subset(C1_EO, Day=="7")

C1_EOmodD7<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D7)
anova(C1_EOmodD7)
emmeans(C1_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D7_27<-subset(C1_EO.D7, Temp==27)
C1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_27)
anova(C1_EO.D7_27_mod)

#30
C1_EO.D7_30<-subset(C1_EO.D7, Temp==30)
C1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_30)
anova(C1_EO.D7_30_mod)

#31
C1_EO.D7_31<-subset(C1_EO.D7, Temp==31)
C1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_31)
anova(C1_EO.D7_31_mod)

#means
C1_EO.D7mean <- ddply(C1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D7mean #display table


C1_EO.D7_plot<-ggplot(data=C1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.01,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day7")+
  theme(plot.title = element_text(size=20));C1_EO.D7_plot
```

C1 Day 14
```{r}
# Day 14
C1_EO.D14<-subset(C1_EO, Day=="14")

C1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D14)
anova(C1_EOmodD14)
emmeans(C1_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D14_27<-subset(C1_EO.D14, Temp==27)
C1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_27)
anova(C1_EO.D14_27_mod)

#30
C1_EO.D14_30<-subset(C1_EO.D14, Temp==30)
C1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_30)
anova(C1_EO.D14_30_mod)

#31
C1_EO.D14_31<-subset(C1_EO.D14, Temp==31)
C1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_31)
anova(C1_EO.D14_31_mod)






#means
C1_EO.D14mean <- ddply(C1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D14mean #display table
C1_EO.D14mean<-na.omit(C1_EO.D14mean)

C1_EO.D14_plot<-ggplot(data=C1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day14")+
  theme(plot.title = element_text(size=20));C1_EO.D14_plot

```
Plot together

```{r}

C1_EO.D3_plot<-C1_EO.D3_plot+ theme(legend.position = "none") #remove legend
C1_EO.D7_plot<-C1_EO.D7_plot+ theme(legend.position = "none") #remove legend
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D3_plot, C1_EO.D7_plot, C1_EO.D14_plot, nrow = 1)
```

D1
```{r}
#single infection, add new column "single.multi"
D1Full2$single.multi<-"single"
D1Full2$single.multi<-factor(D1Full2$single.multi, levels=c("single","multi"))
D1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
D1Full3<-D1Full2[D1Full2vars]

#multi infection, add new column "single.multi"
D1ALL<-subset(ALL1, Primer=="D1") #subset Primer
D1ALL$single.multi<-"multi" #multi
D1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
D1ALLb<-D1ALL[D1ALLvars]
D1ALLb$cells.larvae_log<-log(D1ALLb$cells.larvae+1) #log
colnames(D1ALLb)[colnames(D1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
D1_EO<-rbind(D1ALLb, D1Full3)
D1_EO$single.multi<-factor(D1_EO$single.multi, levels=c("single","multi"))
```

D1 DAY3
```{R}
# Day 3
D1_EO.D3<-subset(D1_EO, Day=="3")

D1_EOmod<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D3)
anova(D1_EOmod)
emmeans(D1_EOmod, pairwise ~ Temp |Day)

#run by temp
#27
D1_EO.D3_27<-subset(D1_EO.D3, Temp==27)
D1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_27)
anova(D1_EO.D3_27_mod)

#30
D1_EO.D3_30<-subset(D1_EO.D3, Temp==30)
D1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_30)
anova(D1_EO.D3_30_mod)

#31
D1_EO.D3_31<-subset(D1_EO.D3, Temp==31)
D1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_31)
anova(D1_EO.D3_31_mod)

#means
D1_EO.D3mean <- ddply(D1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D3mean #display table


D1_EO.D3_plot<-ggplot(data=D1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day 3")+
  theme(plot.title = element_text(size=20));D1_EO.D3_plot
```

D1 DAY7
```{R}
# Day 7
D1_EO.D7<-subset(D1_EO, Day=="7")

D1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D7)
anova(D1_EOmodD7)
emmeans(D1_EOmodD7, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D7_27<-subset(D1_EO.D7, Temp==27)
D1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_27)
anova(D1_EO.D7_27_mod)

#30
D1_EO.D7_30<-subset(D1_EO.D7, Temp==30)
D1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_30)
anova(D1_EO.D7_30_mod)

#31
D1_EO.D7_31<-subset(D1_EO.D7, Temp==31)
D1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_31)
anova(D1_EO.D7_31_mod)


#means
D1_EO.D7mean <- ddply(D1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D7mean #display table


D1_EO.D7_plot<-ggplot(data=D1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day7")+
  theme(plot.title = element_text(size=20));D1_EO.D7_plot
```

D1 DAY14
```{R}
# Day 14
D1_EO.D14<-subset(D1_EO, Day=="14")

D1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D14)
anova(D1_EOmodD14)
emmeans(D1_EOmodD14, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D14_27<-subset(D1_EO.D14, Temp==27)
D1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_27)
anova(D1_EO.D14_27_mod)

#30
D1_EO.D14_30<-subset(D1_EO.D14, Temp==30)
D1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_30)
anova(D1_EO.D14_30_mod)

#means
D1_EO.D14mean <- ddply(D1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D14mean #display table
D1_EO.D14mean<-na.omit(D1_EO.D14mean)

D1_EO.D14_plot<-ggplot(data=D1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day14")+
  theme(plot.title = element_text(size=20));D1_EO.D14_plot
```

Plot together D1

```{r}

D1_EO.D3_plot<-D1_EO.D3_plot+ theme(legend.position = "none") #remove legend
D1_EO.D7_plot<-D1_EO.D7_plot+ theme(legend.position = "none") #remove legend 
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead. 

grid.arrange(D1_EO.D3_plot, D1_EO.D7_plot, D1_EO.D14_plot, nrow = 1)
```
F1
```{r}
#single infection, add new column "single.multi"
F1Full2$single.multi<-"single"
F1Full2$single.multi<-factor(F1Full2$single.multi, levels=c("single","multi"))
F1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
F1Full3<-F1Full2[F1Full2vars]

#multi infection, add new column "single.multi"
F1ALL<-subset(ALL1, Primer=="F1") #subset Primer
F1ALL$single.multi<-"multi" #multi
F1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
F1ALLb<-F1ALL[F1ALLvars]
F1ALLb$cells.larvae_log<-log(F1ALLb$cells.larvae+1) #log
colnames(F1ALLb)[colnames(F1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
F1_EO<-rbind(F1ALLb, F1Full3)
F1_EO$single.multi<-factor(F1_EO$single.multi, levels=c("single","multi"))

```
F1 Day 3
```{r}

F1_EO.D3<-subset(F1_EO, Day=="3")

F1_EOmod<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D3)
anova(F1_EOmod)
emmeans(F1_EOmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
F1_EO.D3_27<-subset(F1_EO.D3, Temp==27)
F1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_27)
anova(F1_EO.D3_27_mod)

#30
F1_EO.D3_30<-subset(F1_EO.D3, Temp==30)
F1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_30)
anova(F1_EO.D3_30_mod)

#31
F1_EO.D3_31<-subset(F1_EO.D3, Temp==31)
F1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_31)
anova(F1_EO.D3_31_mod)


#means
F1_EO.D3mean <- ddply(F1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D3mean #display table


F1_EO.D3_plot<-ggplot(data=F1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 3")+
  theme(plot.title = element_text(size=20));F1_EO.D3_plot
```
F1 Day 7
```{r}
F1_EO.D7<-subset(F1_EO, Day=="7")

F1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D7)
anova(F1_EOmodD7)
emmeans(F1_EOmodD7, pairwise ~ Temp |single.multi)

#run by temp
#27
F1_EO.D7_27<-subset(F1_EO.D7, Temp==27)
F1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_27)
anova(F1_EO.D7_27_mod)

#30
F1_EO.D7_30<-subset(F1_EO.D7, Temp==30)
F1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_30)
anova(F1_EO.D7_30_mod)

#31
F1_EO.D7_31<-subset(F1_EO.D7, Temp==31)
F1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_31)
anova(F1_EO.D7_31_mod)

#means
F1_EO.D7mean <- ddply(F1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D7mean #display table


F1_EO.D7_plot<-ggplot(data=F1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 7")+
  theme(plot.title = element_text(size=20));F1_EO.D7_plot

```

F1 Day 14
```{r}
F1_EO.D14<-subset(F1_EO, Day=="14")

F1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D14)
anova(F1_EOmodD14)
emmeans(F1_EOmodD14, pairwise ~ single.multi|Temp)

#run by temp
#27
F1_EO.D14_27<-subset(F1_EO.D14, Temp==27)
F1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_27)
anova(F1_EO.D14_27_mod)

#30
F1_EO.D14_30<-subset(F1_EO.D14, Temp==30)
F1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_30)
anova(F1_EO.D14_30_mod)

#31
F1_EO.D14_31<-subset(F1_EO.D14, Temp==31) 
F1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_31)
anova(F1_EO.D14_31_mod) 

#means
F1_EO.D14mean <- ddply(F1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D14mean #display table
F1_EO.D14mean<-na.omit(F1_EO.D14mean)

F1_EO.D14_plot<-ggplot(data=F1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 14")+
  theme(plot.title = element_text(size=20));F1_EO.D14_plot
```
 
Plot together F1 expect-observe

```{r}

F1_EO.D3_plot<-F1_EO.D3_plot+ theme(legend.position = "none") #remove legend
F1_EO.D7_plot<-F1_EO.D7_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(F1_EO.D3_plot, F1_EO.D7_plot, F1_EO.D14_plot, nrow = 1)
```
G3
```{r} 
#single infection, add new column "single.multi"
G3Full2$single.multi<-"single"
G3Full2$single.multi<-factor(G3Full2$single.multi, levels=c("single","multi")) 
G3Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
G3Full3<-G3Full2[G3Full2vars] 

#multi infection, add new column "single.multi"
G3ALL<-subset(ALL1, Primer=="G3") #subset Primer 
G3ALL$single.multi<-"multi" #multi
G3ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
G3ALLb<-D1ALL[G3ALLvars] 
G3ALLb$cells.larvae_log<-log(G3ALLb$cells.larvae+1) #log
colnames(G3ALLb)[colnames(G3ALLb)=="Primer"] <- "Symbiont"
 
#combine the dataframes 
G3_EO<-rbind(G3ALLb, G3Full3)
G3_EO$single.multi<-factor(G3_EO$single.multi, levels=c("single","multi"))
```

G3 Day 3
```{r}
G3_EO.D3<-subset(G3_EO, Day=="3")

G3_EOmod<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D3)
anova(G3_EOmod)
emmeans(G3_EOmod, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D3_27<-subset(G3_EO.D3, Temp==27)
G3_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_27)
anova(G3_EO.D3_27_mod)

#30
G3_EO.D3_30<-subset(G3_EO.D3, Temp==30)
G3_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_30)
anova(G3_EO.D3_30_mod)

#31
G3_EO.D3_31<-subset(G3_EO.D3, Temp==31)
G3_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_31)
anova(G3_EO.D3_31_mod)

#means
G3_EO.D3mean <- ddply(G3_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D3mean #display table


G3_EO.D3_plot<-ggplot(data=G3_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 3")+
  theme(plot.title = element_text(size=20));G3_EO.D3_plot
```

G3 Day 7
```{r}
G3_EO.D7<-subset(G3_EO, Day=="7")

G3_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D7)
anova(G3_EOmodD7)
emmeans(G3_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D7_27<-subset(G3_EO.D7, Temp==27)
G3_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_27)
anova(G3_EO.D7_27_mod)

#30
G3_EO.D7_30<-subset(G3_EO.D7, Temp==30)
G3_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_30)
anova(G3_EO.D7_30_mod)

#31
G3_EO.D7_31<-subset(G3_EO.D7, Temp==31)
G3_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_31)
anova(G3_EO.D7_31_mod)

#means
G3_EO.D7mean <- ddply(G3_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D7mean #display table


G3_EO.D7_plot<-ggplot(data=G3_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 7")+
  theme(plot.title = element_text(size=20));G3_EO.D7_plot
```

G3 Day 14
```{r}
G3_EO.D14<-subset(G3_EO, Day=="14")

G3_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), G3_EO.D14)
anova(G3_EOmodD14)
emmeans(G3_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D14_27<-subset(G3_EO.D14, Temp==27)
G3_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_27)
anova(G3_EO.D14_27_mod)

#30
G3_EO.D14_30<-subset(G3_EO.D14, Temp==30)
G3_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_30)
anova(G3_EO.D14_30_mod)



#means
G3_EO.D14mean <- ddply(G3_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D14mean #display table
G3_EO.D14mean<-na.omit(G3_EO.D14mean)

G3_EO.D14_plot<-ggplot(data=G3_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 14")+
  theme(plot.title = element_text(size=20));G3_EO.D14_plot
```

Plot together G3 expect-observe

```{r}

G3_EO.D3_plot<-G3_EO.D3_plot+ theme(legend.position = "none") #remove legend
G3_EO.D7_plot<-G3_EO.D7_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(G3_EO.D3_plot, G3_EO.D7_plot, G3_EO.D14_plot, nrow = 1)
```

Plot all Day 14
```{r}
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D14_plot, D1_EO.D14_plot, F1_EO.D14_plot,G3_EO.D14_plot , nrow = 1)
```


## NMDS for multi infection
Counts
use this df: "ALLcast_9000_cast2b" Relabund (use ALLcast_9000_cast2a for raw counts)
THis is ugly
```{r} 
#make a df with just abundance
library(vegan)

ALLcast_abund<-ALLcast_9000_cast2b
ALLcast_abund<-na.omit(ALLcast_abund) #get rid of NAs
ALLcast_abund<-ALLcast_abund[-c(8, 18, 34,54,94,101), ] #you need to remove rows with no data (all 0s)
ALLcast_abund_b<-ALLcast_abund[-c(1:8)] #remove metadata

#write.csv(ALLcast_abund, "nmdsData_RawCounts_20200117.csv")

#NMDS
set.seed(2)

ALLdata.nmds <- metaMDS(comm = ALLcast_abund_b, distance = "bray")
plot(ALLdata.nmds$points) 
ALLdata.nmds$stress #0.1326 fuck yeah

ALLdata.nmds_xy <- data.frame(ALLdata.nmds$points)

ALLdata.nmds_xy$Temp <- ALLcast_abund$Temp #add metadata back in
ALLdata.nmds_xy$Day <- ALLcast_abund$Day

#by Day
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#by Temp
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Temp)) + geom_point() + theme_bw()

## testing plots
#combine day and temp
ALLdata.nmds_xy$code<-paste0(ALLdata.nmds_xy$Temp, ALLdata.nmds_xy$Day)

ggplot() + 
  #geom_polygon(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,fill=code,group=code),alpha=0.30) + # add the convex hulls
  geom_point(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,shape=Day,colour=Temp),size=4) + # add the point markers
  coord_equal() +
  theme_bw() + 
  theme(axis.text.x = element_blank(),  # remove x-axis text
        axis.text.y = element_blank(), # remove y-axis text
        axis.ticks = element_blank(),  # remove axis ticks
        axis.title.x = element_text(size=18), # remove x-axis labels
        axis.title.y = element_text(size=18), # remove y-axis labels
        panel.background = element_blank(), 
        panel.grid.major = element_blank(),  #remove major-grid labels
        panel.grid.minor = element_blank(),  #remove minor-grid labels
        plot.background = element_blank())

#This is all the data with ellipses. hard to read but nice to have. 
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color=code))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()


```

nmds by temp 
```{r} 
##### subset by Temp
#27C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp27<-ALLcast_9000_cast2b
ALLcast_abund_Temp27<-subset(ALLcast_abund_Temp27, Temp=="27")
ALLcast_abund_Temp27<-na.omit(ALLcast_abund_Temp27) #get rid of NAs
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="105"),]
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="106"),]

ALLcast_abund_Temp27_b<-ALLcast_abund_Temp27[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp27.nmds <- metaMDS(comm = ALLcast_abund_Temp27_b, distance = "bray")
plot(ALLdata_Temp27.nmds$points) 
ALLdata_Temp27.nmds$stress #.139

ALLdata_Temp27.nmds_xy <- data.frame(ALLdata_Temp27.nmds$points)

ALLdata_Temp27.nmds_xy$Day <- ALLcast_abund_Temp27$Day


ALLdata_Temp27.nmds_xy$code<-paste0(ALLdata_Temp27.nmds_xy$Temp, ALLdata_Temp27.nmds_xy$Day)

temp27nmds<-ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color=Day))+   
  scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Raw counts: Temp 27C");temp27nmds


#by temp 30
ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


#30C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp30<-ALLcast_9000_cast2b
ALLcast_abund_Temp30<-subset(ALLcast_abund_Temp30, Temp=="30")
ALLcast_abund_Temp30<-na.omit(ALLcast_abund_Temp30) #get rid of NAs
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="156"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="195"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="200"),]

ALLcast_abund_Temp30_b<-ALLcast_abund_Temp30[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp30.nmds <- metaMDS(comm = ALLcast_abund_Temp30_b, distance = "bray")
plot(ALLdata_Temp30.nmds$points) 
ALLdata_Temp30.nmds$stress #.123

ALLdata_Temp30.nmds_xy <- data.frame(ALLdata_Temp30.nmds$points)

ALLdata_Temp30.nmds_xy$Day <- ALLcast_abund_Temp30$Day


temp30nmds<-ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color=Day))+
    scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Temp 30C");temp30nmds





#by TEMP
ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#31C
#sample 106, C1 counts is 3100+ way high, likely error, check

ALLcast_abund_Temp31<-ALLcast_9000_cast2b
ALLcast_abund_Temp31<-subset(ALLcast_abund_Temp31, Temp=="31")
ALLcast_abund_Temp31<-na.omit(ALLcast_abund_Temp31) #get rid of NAs
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="115"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="134"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="218"),]

ALLcast_abund_Temp31_b<-ALLcast_abund_Temp31[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp31.nmds <- metaMDS(comm = ALLcast_abund_Temp31_b, distance = "bray")
plot(ALLdata_Temp31.nmds$points) 
ALLdata_Temp31.nmds$stress #.114

ALLdata_Temp31.nmds_xy <- data.frame(ALLdata_Temp31.nmds$points)

ALLdata_Temp31.nmds_xy$Day <- ALLcast_abund_Temp31$Day

temp31nmds<-ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color=Day))+
  scale_colour_manual(values = c("Orange", "Blue"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
    ggtitle("Temp 31C");temp31nmds


#plot all together
grid.arrange(temp27nmds, temp30nmds, temp31nmds, nrow = 1)

```

NMDS BY DAY 
```{R} 

#by Day 3
ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


### by day

ALLcast_abund_Day3<-ALLcast_9000_cast2b
ALLcast_abund_Day3<-subset(ALLcast_abund_Day3, Day=="3")
ALLcast_abund_Day3<-na.omit(ALLcast_abund_Day3) #get rid of NAs
ALLcast_abund_Day3<-  ALLcast_abund_Day3[!(ALLcast_abund_Day3$ALL.number=="134"),]

ALLcast_abund_Day3_b<-ALLcast_abund_Day3[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Day3.nmds <- metaMDS(comm = ALLcast_abund_Day3_b, distance = "bray")
plot(ALLdata_Day3.nmds$points) 
ALLdata_Day3.nmds$stress #.131

ALLdata_Day3.nmds_xy <- data.frame(ALLdata_Day3.nmds$points)

ALLdata_Day3.nmds_xy$Temp <- ALLcast_abund_Day3$Temp

Day3_nmds<-ggplot(ALLdata_Day3.nmds_xy, aes(MDS1, MDS2, color=Temp))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  ggtitle("Day 3");Day3_nmds


#day7  NOT RUNNING....
ALLcast_abund_Day7<-ALLcast_9000_cast2b

ALLcast_abund_Day7<-subset(ALLcast_abund_Day7, Day=="7")
ALLcast_abund_Day7<-na.omit(ALLcast_abund_Day7) #get rid of NAs
ALLcast_abund_Day7<-  ALLcast_abund_Day7[!(ALLcast_abund_Day7$ALL.number=="134"),]

ALLcast_abund_Day7_b<-ALLcast_abund_Day7[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Day7.nmds <- metaMDS(comm = ALLcast_abund_Day7_b, distance = "bray")
plot(ALLdata_Day7.nmds$points) 
ALLdata_Day7.nmds$stress #

ALLdata_Day7.nmds_xy <- data.frame(ALLdata_Day7.nmds$points)

ALLdata_Day7.nmds_xy$Temp <- ALLcast_abund_Day7$Temp

Day7_nmds<-ggplot(ALLdata_Day7.nmds_xy, aes(MDS1, MDS2, color=Temp))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  ggtitle("Day 7");Day7_nmds

```

















