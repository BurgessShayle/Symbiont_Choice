---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "12/7/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

This is the data analysis of the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 

Authors: Matsuda, SB, Chakravarti, LC, Cunning, JR, Huffmyer, AH, Gates, RD, van Oppen, MJH
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. Digital droplet PCR was used to analyze data. 

Single infection: Individual infection of single clades: C1, D1, F1, and G3
Multi-infection: Mix of all four clades 
Pot: the containers larvae kept in (3 reps/clade/temp)

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")

#knitr::opts_knit$set(root.dir = normalizePath("~/Desktop/Symb_choice/Symbiont Choice 2018"))
```



```{r}
#rm(list=ls()) # Clear workspace

# Set up workspace: I def do not use all these
library(lmodel2) 
library(gplots)
library(MASS)
library(scales)
library(reshape) #for cast
library(lattice)
library(plyr)
library(dplyr)
library(ggplot2)
library("gridExtra") #arrange plots for output
library(reshape2)
library("ggsci")#set bar colors
library("qqplotr")
library(blmeco)
library("plotrix") #functions in tapply
library("pscl")
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("coefplot") #coefficient plotting
library("seacarb") #seawater carbonate chemistry
library("vegan") #calculating distance matrices
library(pscl) 
library(boot)
library(betareg)
library(coin)
library(exactRankTests)
library(mvtnorm)
library(DTK)
library(PMCMR)
library(MuMIn)
library(glmmTMB)
library(lme4)
library(lmerTest)
library(ggsignif)
library(HH)
library(PMCMR)
library(tidyverse)
library(arm)
library(jtools)
library(broom)
library(ggstance)
library(officer)
library(huxtable)
library(flextable)
```

#Setup data:   
AH - feel free to look at this section but no need to check it. It's loading in data and QC to make the dfs.  
Hemocytometer and scope counts: For the single infection only, we did hemocytometer (hemo) and scope (larvae placed bewteen coverslip and slide) 3 reps/treatment pot. - Sounds good! - AH
```{r}   
####Load in hemocytometer counts and fluorescent scope counts:  
Day3Counts<-read.csv("SC18_cellcounts_day3.csv")
Day7Counts<-read.csv("SC18_cellcounts_day7.csv")
Day14Counts<-read.csv("SC18_cellcounts_day14.csv")

#Day3
colnames(Day3Counts)[colnames(Day3Counts)=="Count"] <- "cells.larvae"

#remove cols you don't need Day 7
d7vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day7Counts<-Day7Counts[d7vars]
colnames(Day7Counts)[colnames(Day7Counts)=="Cells.per.larva"] <- "cells.larvae"
Day7Counts<-na.omit(Day7Counts)

#remove cols you don't need Day 14
d14vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day14Counts<-Day14Counts[d14vars]
colnames(Day14Counts)[colnames(Day14Counts)=="Cells.per.larva"] <- "cells.larvae"
Day14Counts<-na.omit(Day14Counts)

#combine days:
Countdat<-rbind(Day3Counts, Day7Counts, Day14Counts)
Countdat1<-Countdat[!(Countdat$Symbiont=="ALL"),] #remove ALLs
Countdat1<-Countdat1[!(Countdat1$Symbiont=="CONTROL"),] #remove controls
Countdat1$Temp<-as.factor(Countdat1$Temp)
Countdat1$cells.larvae<-as.numeric(Countdat1$cells.larvae) 
```
Load in ddPCR data with Threshold set in QuantaSoft Analysis
```{r} 
#Read in ddPCR plate data  
Plate1<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE1_20190424_threshold.csv")
Plate2<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE2_20190429_threshold.csv")
Plate3<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3_20190426_threshold.csv")
Plate3B<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3B_20190426_threshold.csv")
Plate3 <- rbind(Plate3,Plate3B) # merge plate 3 and 3b for metadata
Plate4<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE4_20190427_threshold.csv")
Plate5<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE5_20190428_threshold.csv")
Plate6<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE6_20190428_threshold.csv")
Plate7<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE7_20190429_threshold.csv")
Plate8<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE8_20190501_threshold.csv")
Plate9<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE9_20190501_threshold.csv")
Plate10<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE10_20190501_threshold.csv")
Plate11<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE11_20190502_threshold.csv")
Plate12<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE12_20190502_threshold.csv")
Plate13<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE13_20190503_threshold.csv")
Plate14<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE14_20190503_threshold.csv")
Plate15<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE15_20190507_threshold.csv")
Plate16<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE16_20190508_threshold.csv")
Plate17<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE17_20190509_threshold.csv")
Plate18<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE18_20190509_threshold.csv")
Plate19<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE19_20190509_threshold.csv")
Plate20<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE20_20190510_threshold.csv")

# read in metadata by plate (some samples are duplicate names, which is why)
meta1 <-read.csv("ddPCR_thresholdData/Plate1_meta.csv")
meta2 <-read.csv("ddPCR_thresholdData/Plate2_meta.csv")
meta3 <-read.csv("ddPCR_thresholdData/Plate3_meta.csv")
meta4 <-read.csv("ddPCR_thresholdData/Plate4_meta.csv")
meta5 <-read.csv("ddPCR_thresholdData/Plate5_meta.csv")
meta6 <-read.csv("ddPCR_thresholdData/Plate6_meta.csv")
meta7 <-read.csv("ddPCR_thresholdData/Plate7_meta.csv")
meta8 <-read.csv("ddPCR_thresholdData/Plate8_meta.csv")
meta9 <-read.csv("ddPCR_thresholdData/Plate9_meta.csv")
meta10 <-read.csv("ddPCR_thresholdData/Plate10_meta.csv")
meta11 <-read.csv("ddPCR_thresholdData/Plate11_meta.csv")
meta12 <-read.csv("ddPCR_thresholdData/Plate12_meta.csv")
meta13 <-read.csv("ddPCR_thresholdData/Plate13_meta.csv")
meta14 <-read.csv("ddPCR_thresholdData/Plate14_meta.csv")
meta15 <-read.csv("ddPCR_thresholdData/Plate15_meta.csv")
meta16 <-read.csv("ddPCR_thresholdData/Plate16_meta.csv")
meta17 <-read.csv("ddPCR_thresholdData/Plate17_meta.csv")
meta18 <-read.csv("ddPCR_thresholdData/Plate18_meta.csv")
meta19 <-read.csv("ddPCR_thresholdData/Plate19_meta.csv")
meta20 <-read.csv("ddPCR_thresholdData/Plate20_meta.csv")

# merge each plates meta with plate
P1<-merge(Plate1, meta1, by="Well")
P2<-merge(Plate2, meta2, by="Well")
P3<-merge(Plate3, meta3, by="Well")
P4<-merge(Plate4, meta4, by="Well")
P5<-merge(Plate5, meta5, by="Well")
P6<-merge(Plate6, meta6, by="Well")
P7<-merge(Plate7, meta7, by="Well")
P8<-merge(Plate8, meta8, by="Well")
P9<-merge(Plate9, meta9, by="Well")
P10<-merge(Plate10, meta10, by="Well")
P11<-merge(Plate11, meta11, by="Well")
P12<-merge(Plate12, meta12, by="Well")
P13<-merge(Plate13, meta13, by="Well")
P14<-merge(Plate14, meta14, by="Well")
P15<-merge(Plate15, meta15, by="Well")
P16<-merge(Plate16, meta16, by="Well")
P17<-merge(Plate17, meta17, by="Well")
P18<-merge(Plate18, meta18, by="Well")
P19<-merge(Plate19, meta19, by="Well")
P20<-merge(Plate20, meta20, by="Well")


#Remove samples that I re-ddPCRd due to low droplet count that now have higher counts (remove olds by plate/well)

# Plate 5
    P5<-P5[!(P5$Well=="B06"),]
    P5<-P5[!(P5$Well=="B09"),]
    P5<-P5[!(P5$Well=="B11"),]
    P5<-P5[!(P5$Well=="C06"),]
    P5<-P5[!(P5$Well=="C09"),]
    P5<-P5[!(P5$Well=="C12"),]
    P5<-P5[!(P5$Well=="D06"),]
    P5<-P5[!(P5$Well=="D10"),]
    P5<-P5[!(P5$Well=="D12"),]
    P5<-P5[!(P5$Well=="H03"),]
    P5<-P5[!(P5$Well=="H04"),]
        P5<-P5[!(P5$Well=="B12"),]#18G

# PLATE 6
    P6<-P6[!(P6$Well=="C12"),]
# PLATE 8
    P8<-P8[!(P8$Well=="A02"),]
    P8<-P8[!(P8$Well=="A04"),]
    P8<-P8[!(P8$Well=="A11"),]
    P8<-P8[!(P8$Well=="A12"),]
    P8<-P8[!(P8$Well=="B02"),]
    P8<-P8[!(P8$Well=="B04"),]
    P8<-P8[!(P8$Well=="B12"),]
    P8<-P8[!(P8$Well=="C02"),]
    P8<-P8[!(P8$Well=="C04"),]
    P8<-P8[!(P8$Well=="C12"),]
    P8<-P8[!(P8$Well=="E04"),]
    P8<-P8[!(P8$Well=="G04"),]
    P8<-P8[!(P8$Well=="G05"),]
    P8<-P8[!(P8$Well=="H04"),]
        P8<-P8[!(P8$Well=="F06"),]#61C
        P8<-P8[!(P8$Well=="C11"),]#66D

# PLATE 9
    P9<-P9[!(P9$Well=="B11"),]
    P9<-P9[!(P9$Well=="C10"),]
    P9<-P9[!(P9$Well=="C11"),]
    P9<-P9[!(P9$Well=="E02"),]
    P9<-P9[!(P9$Well=="E10"),]
    P9<-P9[!(P9$Well=="F04"),]
    P9<-P9[!(P9$Well=="F06"),]
    P9<-P9[!(P9$Well=="G02"),]
    P9<-P9[!(P9$Well=="H03"),]
          P9<-P9[!(P9$Well=="B12"),] ##88D

# PLATE 10
    P10<-P10[!(P10$Well=="C01"),]
    P10<-P10[!(P10$Well=="C07"),]
    P10<-P10[!(P10$Well=="C12"),]
    P10<-P10[!(P10$Well=="D10"),]
    P10<-P10[!(P10$Well=="E05"),]
    P10<-P10[!(P10$Well=="H05"),]
        P10<-P10[!(P10$Well=="E06"),] #106C
        P10<-P10[!(P10$Well=="C10"),] #112F
        P10<-P10[!(P10$Well=="G04"),] #100G


#PLATE 12
    P12<-P12[!(P12$Well=="A09"),]
    P12<-P12[!(P12$Well=="E05"),]
        P12<-P12[!(P12$Well=="E04"),]#95C
        P12<-P12[!(P12$Well=="G05"),]#41G

#PLATE 13
    P13<-P13[!(P13$Well=="A09"),]
    P13<-P13[!(P13$Well=="A12"),]
    P13<-P13[!(P13$Well=="B12"),]
    P13<-P13[!(P13$Well=="C10"),]
    P13<-P13[!(P13$Well=="D10"),]
    P13<-P13[!(P13$Well=="D11"),]
    P13<-P13[!(P13$Well=="E10"),]
    P13<-P13[!(P13$Well=="F05"),]
    P13<-P13[!(P13$Well=="F06"),]
    P13<-P13[!(P13$Well=="A07"),]
    P13<-P13[!(P13$Well=="C12"),]
         P13<-P13[!(P13$Well=="G04"),]#147F

#PLATE 14
    P14<-P14[!(P14$Well=="A09"),]
    P14<-P14[!(P14$Well=="A12"),]
    P14<-P14[!(P14$Well=="B09"),]
        P14<-P14[!(P14$Well=="C03"),] #F1 issue
        P14<-P14[!(P14$Well=="E03"),] #F1 issue
        P14<-P14[!(P14$Well=="B10"),] #165D


#PLATE 15
    P15<-P15[!(P15$Well=="C10"),]
    P15<-P15[!(P15$Well=="D10"),]
    P15<-P15[!(P15$Well=="G03"),]
#PLATE 16
    P16<-P16[!(P16$Well=="D05"),]
    P16<-P16[!(P16$Well=="F04"),]
    P16<-P16[!(P16$Well=="F05"),]
#PLATE 17
    P17<-P17[!(P17$Well=="D09"),]
    P17<-P17[!(P17$Well=="E09"),]
        P17<-P17[!(P17$Well=="H02"),]#178D
        P17<-P17[!(P17$Well=="C09"),]#189F

#PLATE 18
    P18<-P18[!(P18$Well=="E09"),]
    P18<-P18[!(P18$Well=="F04"),]
    P18<-P18[!(P18$Well=="H04"),]
        P18<-P18[!(P18$Well=="G05"),]#205C
        P18<-P18[!(P18$Well=="G04"),]#197G

#PLATE 19
    P19<-P19[!(P19$Well=="C08"),]

#merge all plates
dData1 <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20)

#write.csv(dData1, "dData1TEST.csv")
#only keep columns you need (Sample, Target, Conc(copies/µL), Copies/20ulWell, Accepted Droplets, Positives, Negatives, Threshold1, metadata)

dData<-dData1[,c(1,2:4,11,16:18,31,66 ,68:79)]
dData$Conc.copies.µL.<-as.numeric(dData$Conc.copies.µL.)
dData$Temp<-as.factor(dData$Temp)
dData$Temp<-factor(dData$Temp, levels=c("27","30","31"))
dData$Day<-as.factor(dData$Day)
dData$Day<-factor(dData$Day, levels=c("3","7","14"))
dData$Pot<-as.factor(dData$Pot)
```

False positives - the false positive rate was calculated using the manufacturors guidelines to 99% confidence. 
```{r}  
#subset only FalsePositives controls (controls included aposymbiotic larvae and larvae infected with each of the other three symbiont genera)
FalsePos<-subset(dData, Info=="CONTROL")
#write.csv(FalsePos, "FalsePos.csv")
FalsePos1<-FalsePos #make copy

#divide by clade
FP_C1<-subset(FalsePos1, Primer=="C1") #n=61, 56 with <9000 rm
FP_D1<-subset(FalsePos1, Primer=="D1") #n=70, 62 with <9000 rm
FP_F1<-subset(FalsePos1, Primer=="F1") #n=56, 52 with <9000 rm
FP_G3<-subset(FalsePos1, Primer=="G3") #n=70, 66 with <9000 rm

# remove any less than 9000

FP_C1<-subset(FP_C1, Accepted.Droplets>9000)
FP_D1<-subset(FP_D1, Accepted.Droplets>9000)
FP_F1<-subset(FP_F1, Accepted.Droplets>9000)
FP_G3<-subset(FP_G3, Accepted.Droplets>9000)

#C1
sum(FP_C1$Positives) # 15 positives per 56 wells
15/56 # .268 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#D1
sum(FP_D1$Positives) # 16 positives per 62 wells
16/62# .258 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#F1
sum(FP_F1$Positives) # 24 positives per 52 wells
24/52 # .462 -> .5 events per well, Threshold = 3 for 95% confidence -> LOD 7 (95%) or 9 (99%), Threshold = 4 (99%) -> LOD 8(95%) 11 (99%)

#G3
sum(FP_G3$Positives) # 60 positives per 70 wells
60/70 # .857 -> .9 events per well, Threshold = 4 (95%) -> LOD 8(95%), 11 (99%), Threshold =5 (99%) -> LOD 10 (99%) 12 (99%)
```
 
Sample droplet cutoff, false pos rate, copy number, cells/larvae calc
```{r}  
 
# 9000 cutoff - if total droplets are below 9000 remove samples  
dData1<-subset(dData, Accepted.Droplets>9000)# remove samples with less than 9000 droplets (we lose 44 ddpcr samples)

#subset by primer to then account for false positives by primer
C1_9000_fp<-subset(dData1, Primer=="C1")
D1_9000_fp<-subset(dData1, Primer=="D1")
F1_9000_fp<-subset(dData1, Primer=="F1")
G3_9000_fp<-subset(dData1, Primer=="G3")

#False pos, if Pos dropletes not above threshold, change to 0 positives. Use 95% LOD (limit of detection)
C1_9000_fp$Positives[C1_9000$Positives<5] <- 0   # 5 
D1_9000_fp$Positives[D1_9000$Positives<5] <- 0   # 5
F1_9000_fp$Positives[F1_9000$Positives<7] <- 0   #7
G3_9000_fp$Positives[G3_9000$Positives<8] <- 0   # 8

dData2<-rbind(C1_9000_fp,D1_9000_fp,F1_9000_fp,G3_9000_fp )

# use copies/1ul pcr to calculate how many copies are in 1 larvae. 
#(copies/1ul PCR)*(25ul PCR/y ul.DNA added)*(20uLDNA/1 larvae)
dData2$copies.larvae<-(dData2$Conc.copies.µL.)*(25/dData2$ul.DNA)*20

# divide copies by copy number per clade (CALC IN EXCEL, QCd)
dData2$copyNum[dData2$Primer=="C1"]<-2
dData2$copyNum[dData2$Primer=="D1"]<-1
dData2$copyNum[dData2$Primer=="F1"]<-3
dData2$copyNum[dData2$Primer=="G3"]<-19

# calc number of Sym cells in larvae
dData2$cells.larvae<-dData2$copies.larvae/dData2$copyNum
  dData2<-dData2[!(dData2$Info=="NTC"),]

#subset Samples
sData<-subset(dData2, Info=="ALL"|Info=="C1"|Info=="D1"|Info=="F1"|Info=="G3")
#write.csv(sData, "sData20191221.csv")
```

Subset for each ddPCR Infection trial (C1, D1, F1, G3, ALL). 
```{r}   
#subset by infection (singles and multi)
C1_9000<-subset(sData, Info=="C1")
D1_9000<-subset(sData, Info=="D1")
F1_9000<-subset(sData, Info=="F1")
G3_9000<-subset(sData, Info=="G3")
ALL_9000<-subset(sData, Info=="ALL")

# for the Alls, cast for Primer
# remove unneeded columns
ALL_9000a<-ALL_9000[,c("ALL.number","Primer","cells.larvae","Day","Temp","Pot")]
#write.csv(ALL_9000a, "ALL_9000a.csv")

#cast by primers - do this to see which larvae not all primers amplified and cut them for Relative Abund df
 ALLcast_9000_cast<-dcast(ALL_9000a, ALL.number~Primer, value.var = "cells.larvae") # cast()
# write.csv(ALLcast_9000_cast,"ALLcast_9000_cast.csv")

### For Relative Abundance df, remove larvae without amplification in all 4 symbiont genera: 
 # Samples ID'd manually ALL#s with all 0s:  105 (27C, D14), 115 (31C, D14), 134 (31C, D3), 156 (30C, D7), 195(30C, D7), 200 (30C, D7)).
ALL_9000b<-ALLcast_9000_cast

ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="105"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="115"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="134"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="156"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="195"),]
ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="200"),]

 # Remove rest of primers/larvae of missing ones (n=21 larvae): aka NAs
  ALL_9000b<-ALL_9000a[!(ALL_9000a$ALL.number=="136"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="135"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="236"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="227"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="111"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="120"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="137"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="204"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="30"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="188"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="130"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="138"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="231"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="125"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="187"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="209"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="122"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="208"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="232"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="233"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="177"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="78"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="64"),]
```

Raw and relative abundance data frames for Multi-infection
```{r} 
# Raw df for comparision of counts within clade between Single vs Multi
ALLcast_9000_cast2a<-dcast(ALL_9000a, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()
ALLcast_9000_cast2a$C1_round<-round(ALLcast_9000_cast2a$C1) 
ALLcast_9000_cast2a$D1_round<-round(ALLcast_9000_cast2a$D1) 
ALLcast_9000_cast2a$F1_round<-round(ALLcast_9000_cast2a$F1) 
ALLcast_9000_cast2a$G3_round<-round(ALLcast_9000_cast2a$G3) 

 # Relative Abundance df to use to compare infection by clade in multi. 
ALLcast_9000_cast2b<-dcast(ALL_9000b, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()
ALLcast_9000_cast2b$C1<-round(ALLcast_9000_cast2b$C1) 
ALLcast_9000_cast2b$D1<-round(ALLcast_9000_cast2b$D1) 
ALLcast_9000_cast2b$F1<-round(ALLcast_9000_cast2b$F1) 
ALLcast_9000_cast2b$G3<-round(ALLcast_9000_cast2b$G3) 
```

Combine ddPCR with the hemocytometer/count data from each time point for "Full" dataset for INDIVIDUAL INFECTIONS 
Organize data: oragnize, scope + hemo data
```{r} 
# create count.type column for hemo and scope id  
Countdat_D3<-subset(Countdat1, Day=="3") #subset day 3, scope counts, individuals
Countdat_D3$count.type<-"scope"
Countdat_D714<-subset(Countdat1, Day=="7"|Day=="14") #subset days 7 and 14, hemo counts
Countdat_D714$count.type<-"hemo"
 
Countdat_2<-rbind(Countdat_D3,Countdat_D714) #bind together for non-ddPCR dataset 
```

#Stats and plots: ddPCR vs hemo + scope, prove not different 
  
YOU DID THIS WITH A REGRESSION TABLE!   
1.	Question: Can we combine hemo/scope counts with ddPCR for analysis?
Setup Df C1
```{r}    
#C1   
#organize the ddPCR data for individual infections  
C1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
C1_9000b<-C1_9000[C1_vars]
colnames(C1_9000b)[colnames(C1_9000b)=="Info"] <- "Symbiont"
C1_9000b$count.type<-"ddPCR"
summary(C1_9000b$cells.larvae)
hist(C1_9000b$cells.larvae) #not normal

#organize hemo data
C1countdat<-subset(Countdat_2, Symbiont=="C1")
hist(C1countdat$cells.larvae)

C1Full<-rbind(C1_9000b,C1countdat) #combine hemo and ddPCR
hist(C1Full$cells.larvae) #right skew

C1Full$cells.larvae_log<-log10(C1Full$cells.larvae+1)
hist(C1Full$cells.larvae_log)

```
D1, df 
```{r}  
#organize the ddPCR data 
D1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
D1_9000b<-D1_9000[D1_vars]
colnames(D1_9000b)[colnames(D1_9000b)=="Info"] <- "Symbiont"
D1_9000b$count.type<-"ddPCR"
hist(D1_9000b$cells.larvae) 

#organize hemo data
D1countdat<-subset(Countdat_2, Symbiont=="D1")

D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR

D1Full$cells.larvae_log<-log10(D1Full$cells.larvae+1) #log counts
hist(D1Full$cells.larvae_log)
```
F1, df 
```{r}
#organize the ddPCR data   
F1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
F1_9000b<-F1_9000[F1_vars]
colnames(F1_9000b)[colnames(F1_9000b)=="Info"] <- "Symbiont"
F1_9000b$count.type<-"ddPCR"
hist(F1_9000b$cells.larvae)
#F1_9000b$cells.larvae_log<-log(F1_9000b$cells.larvae+1)
  #hist(F1_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
F1countdat<-subset(Countdat_2, Symbiont=="F1")

F1Full<-rbind(F1_9000b,F1countdat) #combine hemo and ddPCR
hist(F1Full$cells.larvae_log) 
F1Full$cells.larvae_log<-log10(F1Full$cells.larvae+1)
```
G3, df and means tables
```{r}  
#organize the ddPCR data 
G3_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
G3_9000b<-G3_9000[G3_vars]
colnames(G3_9000b)[colnames(G3_9000b)=="Info"] <- "Symbiont"
G3_9000b$count.type<-"ddPCR"
hist(G3_9000b$cells.larvae)
#G3_9000b$cells.larvae_log<-log(G3_9000b$cells.larvae+1)
#  hist(G3_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
G3countdat<-subset(Countdat_2, Symbiont=="G3")

G3Full<-rbind(G3_9000b,G3countdat) #combine hemo and ddPCR
hist(G3Full$cells.larvae) 
G3Full$cells.larvae_log<-log10(G3Full$cells.larvae+1)
hist(G3Full$cells.larvae_log) 
```
Means for clade/temp/pot/day for ddpcr x scopehemo
```{r}
#scope hemo prep

#Raw means scope and hemo only
scopehemoFull_mean<- ddply(Countdat_2, c("Day", "Temp","Symbiont","Pot","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
);scopehemoFull_mean #display table
scopehemoFull_mean$mean<-round(scopehemoFull_mean$mean)
#write.csv(scopehemoFull_mean,"scopehemoFull_mean.csv")
scopehemoFull_meanVars<-c("Temp","Day","Pot", "Symbiont","mean","count.type")
scopehemoFull_mean2<-scopehemoFull_mean[scopehemoFull_meanVars]
colnames(scopehemoFull_mean2)[colnames(scopehemoFull_mean2)=="mean"] <- "Countmean"


# raw means for ddPCR  only
ddPCRcompare<-rbind(C1_9000b,D1_9000b,F1_9000b,G3_9000b)
#Raw means
ddPCRcompare_mean<- ddply(ddPCRcompare, c("Day", "Temp","Symbiont","Pot", "count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
);ddPCRcompare_mean #display table
ddPCRcompare_mean$mean<-round(ddPCRcompare_mean$mean)

ddPCRcompareVars<-c("Temp","Day","Pot", "Symbiont","mean","count.type")
ddPCRcompare_mean2<-ddPCRcompare_mean[ddPCRcompareVars]
colnames(ddPCRcompare_mean2)[colnames(ddPCRcompare_mean2)=="mean"] <- "ddPCRmean" 
 
#write.csv(ddPCRcompare_mean,"ddPCRcompare_mean.csv")
# combine Scope and ddPCR
scopehemo_ddPCRCompare<-merge(scopehemoFull_mean2,ddPCRcompare_mean2,by=c("Symbiont","Temp","Day","Pot"))

```

THIS IS WHAT YOU WANT - Regression 
Scope/hemo Calc means for clade/temp/time/pot VS ddPCR

Model2 regression
```{r}
#Model_II_linear_regression    https://rpubs.com/jasonvenkiteswaran/22815 

#everything
scopehemo_ddPCRCompare$Countmean_log<-log10(scopehemo_ddPCRCompare$Countmean+1) #log10 the hemo/scope counts
hist(scopehemo_ddPCRCompare$Countmean_log)
scopehemo_ddPCRCompare$ddPCRmean_log<-log10(scopehemo_ddPCRCompare$ddPCRmean+1) #log10 the ddPCR counts
hist(scopehemo_ddPCRCompare$ddPCRmean_log)

#ScopeHemo ddPCR 
lmodel2(ddPCRmean_log~Countmean_log, data = scopehemo_ddPCRCompare)

# y =0.94x + 0 to convert scope/hemo to ddPCR Use MA, force 0 intercept. CN said ok to 0.18 ->0

```

Right plot: logged10 plot   
AH- Ideally, I want to plot the 95% confidence intervales on the regression line. But since I tell am manually entering the info, the confidence intervales are showing up wrong. Ideas? 

See what I did with adding two more geom_abline's. Since you want it to be sloped, geom_line wont work. Now you can go an edit the "intercept" to match your confidence intervals. I just set them to +- 1 for visualization. - AH  
```{r}
##### THIS IS THE ONE YOU WANT

#figure out how to map 50% conf interval
ggplot(data=scopehemo_ddPCRCompare,aes(x=Countmean_log, y=ddPCRmean_log)) +
   geom_point(aes(colour=factor(count.type.x))) +
   #geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,aes(group=1),colour="black")+
   scale_colour_manual(name="condition",
       values=c("darkgray","orange"))+
  #scale_x_continuous(trans = "log10")+
  #scale_y_continuous(trans = "log10")+
theme_classic()+
 geom_abline(intercept = 0, slope = .94)+ #add in lmodel2 slope/intercept
  #geom_smooth(aes(ymin=.73, ymax=1.20))+     # when I run these lines it make a new line and plots conf int on those
  #geom_smooth(aes(ymin=.73, ymax=1.20, fill =count.type.x, colour=count.type.x,stat="identity"))
   geom_abline(intercept = 1.2, slope = .94, color = "red", linetype = "dashed")+
   geom_abline(intercept = -1.2, slope = .94, color = "red", linetype = "dashed")

#geom_line(aes(y = .73), color = "red", linetype = "dashed")+
    #geom_line(aes(y = 1.2), color = "red", linetype = "dashed")
  
 #stat_ellipse(aes(x=Countmean, y=ddPCRmean, aes(fill=Symbiont)),type = "norm"), linetype = 2)+
#stat_ellipse(geom = "polygon", alpha = 1/4, level=0.5,aes(fill = Symbiont)) # alpha lets you choose confidence interval for ellipse

```

Apply hemo.scope conversion and remake df with raw counts
```{r}
#Convert Scope/hemo data, remake df with ddPCR data. Make new col with "raw" counts post conversion of logs
#C1
C1FullddPCR<-subset(C1Full, count.type=="ddPCR")
C1Fullscopehemo<-subset(C1Full, count.type=="hemo"|count.type=="scope")
#C1Fullscopehemo$cells.larvae_log_Pre<-C1Fullscopehemo$cells.larvae_log #save old to check then comment out
C1Fullscopehemo$cells.larvae_log<-(C1Fullscopehemo$cells.larvae_log*0.94) #convert and check
C1Full<-rbind(C1FullddPCR,C1Fullscopehemo) #rebind with ddPCR
C1Full$cells.larvae_counts<-(10^C1Full$cells.larvae_log)-1  #converted all log back to Raw counts
C1Full$cells.larvae_counts_round<-round(C1Full$cells.larvae_counts)

plot(C1Full$cells.larvae, C1Full$cells.larvae_counts_round) #check

#D1
D1FullddPCR<-subset(D1Full, count.type=="ddPCR")
D1Fullscopehemo<-subset(D1Full, count.type=="hemo"|count.type=="scope")
#D1Fullscopehemo$cells.larvae_log_Pre<-D1Fullscopehemo$cells.larvae_log #save old to check then comment out
D1Fullscopehemo$cells.larvae_log<-(D1Fullscopehemo$cells.larvae_log*0.94) #convert and check
D1Full<-rbind(D1FullddPCR,D1Fullscopehemo) #rebind with ddPCR
D1Full$cells.larvae_counts<-(10^D1Full$cells.larvae_log)-1  #converted all log back to Raw counts
D1Full$cells.larvae_counts_round<-round(D1Full$cells.larvae_counts)

#F1
F1FullddPCR<-subset(F1Full, count.type=="ddPCR")
F1Fullscopehemo<-subset(F1Full, count.type=="hemo"|count.type=="scope")
#F1Fullscopehemo$cells.larvae_log_Pre<-F1Fullscopehemo$cells.larvae_log #save old to check then comment out
F1Fullscopehemo$cells.larvae_log<-(F1Fullscopehemo$cells.larvae_log*0.94) #convert and check
F1Full<-rbind(F1FullddPCR,F1Fullscopehemo) #rebind with ddPCR
F1Full$cells.larvae_counts<-(10^F1Full$cells.larvae_log)-1  #converted all log back to Raw counts
F1Full$cells.larvae_counts_round<-round(F1Full$cells.larvae_counts)

#G3
G3FullddPCR<-subset(G3Full, count.type=="ddPCR")
G3Fullscopehemo<-subset(G3Full, count.type=="hemo"|count.type=="scope")
#G3Fullscopehemo$cells.larvae_log_Pre<-G3Fullscopehemo$cells.larvae_log #save old to check then comment out
G3Fullscopehemo$cells.larvae_log<-(G3Fullscopehemo$cells.larvae_log*0.94) #convert and check
G3Full<-rbind(G3FullddPCR,G3Fullscopehemo) #rebind with ddPCR
G3Full$cells.larvae_counts<-(10^G3Full$cells.larvae_log)-1  #converted all log back to Raw counts
G3Full$cells.larvae_counts_round<-round(G3Full$cells.larvae_counts)

```


#Single Infection: binary yes or no did it infect
Df: C1Full, D1Full, F1Full, G3Full
Deciding if I want to compare between and within species or not. Likely too hard between with interactions? 

2.	Question: Does time or temperature affect the rate of how many larvae are infected by clade?

Model:  `glmer(Infect~Symbiont*Day*Temp+(1|potCode)`, family=binomial)
```{r} 
BinaryInfect<-rbind(C1Full,D1Full, F1Full, G3Full)  # make new DF for binary 
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_round>0]<-1  #make new col for infect or not 1 for infect, 0 not.
  BinaryInfect$Infect[BinaryInfect$cells.larvae_counts_round==0]<-0
 BinaryInfect$Infect<-as.character(BinaryInfect$Infect)
  BinaryInfect$Infect<-as.numeric(BinaryInfect$Infect)
 BinaryInfect$count.type<-as.factor(BinaryInfect$count.type) #make factor

 #rename Pot interaction as a code: Pot_Temp
 BinaryInfect$PotCode<-paste0(BinaryInfect$Temp, BinaryInfect$Pot,BinaryInfect$Symbiont )
 BinaryInfect$PotCode<-as.factor(BinaryInfect$PotCode) #make factor

#Full model including all clades:
 Binary_mod<-glmer(Infect~Symbiont*Temp*Day+(1|PotCode), family="binomial", BinaryInfect) #
  Anova(Binary_mod)
dispersion_glmer(Binary_mod) # no overdispersion 

  emm<-emmeans(Binary_mod,  ~ Symbiont*Temp*Day)
  pairs(emm)
  cld(emm)  
  
#by clade
#C1
  Binary_C1<-subset(BinaryInfect, Symbiont=="C1")
  Binary_C1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_C1)
  Anova(Binary_C1_mod)
  dispersion_glmer(Binary_C1_mod)  #no overdispersion 
  
#D1
  Binary_D1<-subset(BinaryInfect, Symbiont=="D1") #we don't have day 14 31C, this throws errors
  Binary_D1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_D1) 
  Anova(Binary_D1_mod)
  dispersion_glmer(Binary_D1_mod)  #no overdispersion 
  
#F1
  Binary_F1<-subset(BinaryInfect, Symbiont=="F1")
  Binary_F1_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_F1) 
  Anova(Binary_F1_mod)
  dispersion_glmer(Binary_F1_mod)  #no overdispersion 

#G3
  Binary_G3<-subset(BinaryInfect, Symbiont=="G3")
  Binary_G3mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", Binary_G3) 
  Anova(Binary_G3mod)
  dispersion_glmer(Binary_G3mod)  #no overdispersion 
```

Plot Clade by temp/time:
C1
```{r}  
Infect_N_mean_C1 <- ddply(Binary_C1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_C1 #display table 
 #change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_C1$Day.num<-as.numeric(Infect_N_mean_C1$Day)
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 2] =7
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 3] =14
Infect_N_mean_C1$Day.num[Infect_N_mean_C1$Day.num == 1] =3
#plot
C1_Infect_plot<-ggplot(data=Infect_N_mean_C1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits 
    scale_x_continuous(breaks=seq(0, 14, 2))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
 ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));C1_Infect_plot
```
D1 
```{r} 
#D1 
 

Infect_N_mean_D1 <- ddply(Binary_D1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_D1 #display table 
#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_D1$Day.num<-as.numeric(Infect_N_mean_D1$Day)
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 2] =7
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 3] =14
Infect_N_mean_D1$Day.num[Infect_N_mean_D1$Day.num == 1] =3

#plot
D1_Infect_plot<-ggplot(data=Infect_N_mean_D1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits
    scale_x_continuous(breaks=seq(0, 14, 2))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Durusdinium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));D1_Infect_plot

```
F1 
```{r} 
#F1


Infect_N_mean_F1 <- ddply(Binary_F1, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_F1 #display table 

#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_F1$Day.num<-as.numeric(Infect_N_mean_F1$Day)
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 2] =7
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 3] =14
Infect_N_mean_F1$Day.num[Infect_N_mean_F1$Day.num == 1] =3
#plot
F1_Infect_plot<-ggplot(data=Infect_N_mean_F1, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1) + #set Y limits
    scale_x_continuous(breaks=seq(0, 14, 2))+
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Fugacium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));F1_Infect_plot
```
G3 
```{r}    
#G3

Infect_N_mean_G3 <- ddply(Binary_G3, c("Symbiont", "Temp","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_N_mean_G3 #display table 

#change Day back to Numeric from Factor, reapply the actual numeric dates
Infect_N_mean_G3$Day.num<-as.numeric(Infect_N_mean_G3$Day)
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 2] =7
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 3] =14
Infect_N_mean_G3$Day.num[Infect_N_mean_G3$Day.num == 1] =3

#plot
G3_Infect_plot<-ggplot(data=Infect_N_mean_G3Test, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+  
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  scale_x_continuous(breaks=seq(0, 14, 2))+
  ylim(0,1) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Gerakladium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));G3_Infect_plot
```
Figure x 
```{r}
#log scale axis only 
C1_Infect_plot<-C1_Infect_plot+ theme(legend.position = "none") #remove legend
D1_Infect_plot<-D1_Infect_plot+ theme(legend.position = "none") #remove legend
F1_Infect_plot<-F1_Infect_plot+ theme(legend.position = "none") #remove legend
G3_Infect_plot<-G3_Infect_plot+ theme(legend.position = "none") #remove legend
grid.arrange(C1_Infect_plot, D1_Infect_plot, F1_Infect_plot,G3_Infect_plot, nrow = 1)


```


#PLOT SINGLE INFECTIONS (count data)  
Organize singles into df with 0s removed, so we can evaluate what happened once infection was successful. Bins removed if <3 samples/treatment

3.	Question: Of the larvae that infected, what is the difference in the amount of infection per larvae by symbionts type? Does this change by temperature and/or time?

Model: `lmer(Infect~Symbiont*Temp*Day+(1|PotCode))`
```{r}   
C1Fulla<-subset(C1Full, cells.larvae_round>0) #remove 0s
D1Fulla<-subset(D1Full, cells.larvae_round>0)
F1Fulla<-subset(F1Full, cells.larvae_round>0)
G3Fulla<-subset(G3Full, cells.larvae_round>0)
```

C1 single infection plot 
```{r}     
C1Fulla_mean <- ddply(C1Fulla, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
C1Fulla_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1Fulla_mean$Day.num<-as.numeric(C1Fulla_mean$Day)
C1Fulla_mean$Day.num[C1Fulla_mean$Day.num == 2] =7
C1Fulla_mean$Day.num[C1Fulla_mean$Day.num == 3] =14
C1Fulla_mean$Day.num[C1Fulla_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
C1Fulla_plot_9000<-ggplot(data=C1Fulla_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));C1Fulla_plot_9000
``` 

D1 single infection plot
```{r}     
D1Fulla_mean <- ddply(D1Fulla, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
D1Fulla_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1Fulla_mean$Day.num<-as.numeric(D1Fulla_mean$Day)
D1Fulla_mean$Day.num[D1Fulla_mean$Day.num == 2] =7
D1Fulla_mean$Day.num[D1Fulla_mean$Day.num == 3] =14
D1Fulla_mean$Day.num[D1Fulla_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
D1Fulla_plot_9000<-ggplot(data=D1Fulla_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Durusdinium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));D1Fulla_plot_9000
``` 

F1 single infection  plot
```{r}     
F1Fulla_mean <- ddply(F1Fulla, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
F1Fulla_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1Fulla_mean$Day.num<-as.numeric(F1Fulla_mean$Day)
F1Fulla_mean$Day.num[F1Fulla_mean$Day.num == 2] =7
F1Fulla_mean$Day.num[F1Fulla_mean$Day.num == 3] =14
F1Fulla_mean$Day.num[F1Fulla_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
F1Fulla_plot_9000<-ggplot(data=F1Fulla_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Fugacium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));F1Fulla_plot_9000
``` 

G3 single infection plot
```{r}     
G3Fulla_mean <- ddply(G3Fulla, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae_counts_round[!is.na(cells.larvae_counts_round)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae_counts_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_counts_round, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_counts_round, na.rm=TRUE)) #calculate max, could also calculate min () if desired  
 
G3Fulla_mean #display table

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3Fulla_mean$Day.num<-as.numeric(G3Fulla_mean$Day)
G3Fulla_mean$Day.num[G3Fulla_mean$Day.num == 2] =7
G3Fulla_mean$Day.num[G3Fulla_mean$Day.num == 3] =14
G3Fulla_mean$Day.num[G3Fulla_mean$Day.num == 1] =3

#plot with yaxis log10, real data (not transformed)
G3Fulla_plot_9000<-ggplot(data=G3Fulla_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));G3Fulla_plot_9000
``` 

Plot all four SINGLE INFECTION together: Figure x
```{r} 
#log scale axis only 
C1Fulla_plot_9000<-C1Fulla_plot_9000+ theme(legend.position = "none") #remove legend
D1Fulla_plot_9000<-D1Fulla_plot_9000+ theme(legend.position = "none") #remove legend
F1Fulla_plot_9000<-F1Fulla_plot_9000+ theme(legend.position = "none") #remove legend
G3Fulla_plot_9000<-G3Fulla_plot_9000+ theme(legend.position = "none") #remove legend
grid.arrange(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000, nrow = 1)
```

STATS FOR SINGLE INFECTION
Model 1: `lmer(cell.counts~Day*Temp)` using log transformed! (Cells.larvae_log)  
Single infections: Only data where infection happened
```{r}   
hist(C1Fulla$cells.larvae_log) # normal
hist(D1Fulla$cells.larvae_log) # normal
hist(F1Fulla$cells.larvae_log) # normal
hist(G3Fulla$cells.larvae_log) #normal

Singles<-rbind(C1Fulla,D1Fulla,F1Fulla,G3Fulla)
hist(Singles$cells.larvae_log) # normal 

#rename Pot interaction as a code: Pot_Temp
 Singles$PotCode<-paste0(Singles$Temp, Singles$Pot,Singles$Symbiont )
 Singles$PotCode<-as.factor(Singles$PotCode) #make factor

#Full model  
## lmer  symbionts*days*temp
Single_all_mod<-lmer(cells.larvae_log~Symbiont*Day*Temp+(1|PotCode), Singles)
anova(Single_all_mod)
qqPlot(residuals(Single_all_mod))   # good

  emm<-emmeans(Single_all_mod,  ~ Symbiont*Temp *Day, adjust="Tukey")
cld(emm)
```
 
C1 single  
```{r}
#C1    
Singles_C1<-subset(Singles, Symbiont=="C1")
C1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_C1)
anova(C1mod)
#summary(C1mod) #for std err df and t
qqPlot(residuals(C1mod))   #  good
  emm<-emmeans(C1mod,  ~ Temp *Day, adjust="Tukey")
cld(emm, Letter="abcdefg")
```
D1 singles    
```{r}
#D1   
Singles_D1<-subset(Singles, Symbiont=="D1")
D1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_D1)
anova(D1mod, type=2)
#summary(D1mod) #for std err df and t
qqPlot(residuals(D1mod))   #  good
  emm<-emmeans(D1mod,  ~ Temp *Day, adjust="Tukey")
cld(emm)

```
F1 singles  
```{r} 
#F1  
Singles_F1<-subset(Singles, Symbiont=="F1")
F1mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_F1)
anova(F1mod, type=2)
#summary(F1mod) #for std err df and t
qqPlot(residuals(F1mod))   #  good
  emm<-emmeans(F1mod,  ~ Temp *Day, adjust="Tukey")
cld(emm)
```
G3 singles  
```{r}
#G3   
Singles_G3<-subset(Singles, Symbiont=="G3")
G3mod<-lmer(cells.larvae_log~Day*Temp+(1|PotCode), Singles_G3)
anova(G3mod, type=2)
#summary(G3mod) #for std err df and t
qqPlot(residuals(G3mod))   #  good
  emm<-emmeans(G3mod,  ~ Temp *Day, adjust="Tukey")
cld(emm)
```

Testing diff wanys to plot: Single comparision days between symbs, boxplots. I kinda like this, but also, think line is more straight forward.
```{r} 
#cool plot
ggplot(Singles, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = NULL, y = "Weight") +
  guides(color = FALSE)

#cool plot day 3 only
AllSing_D3<-subset(Singles, Day==3)
ggplot(AllSing_D3, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = NULL, y = "Cell counts (log10)") +
  guides(color = FALSE)

#cool plot day 7 only
AllSing_D7<-subset(Singles, Day==7)
ggplot(AllSing_D7, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = "Temp", y = "Cell counts (log10)") +
  guides(color = FALSE)

#cool plot day 14 only
AllSing_D14<-subset(Singles, Day==14)
ggplot(AllSing_D14, aes(x = Temp, 
                    y = cells.larvae_log, 
                    color = Symbiont)) +
  geom_boxplot(width = 0.5) +
  geom_point(position = position_jitter(height = 0), 
             size = 1, alpha = 0.5) +
  labs(x = "Temp", y = "Cell counts (log10)") +
  guides(color = FALSE)



```
  
#Heat maps, by clade (temp x time) I think this works and could work for a paper figure? 
https://sebastianraschka.com/Articles/heatmaps_in_r.html
```{r}
#C1
#Singles_C1
Singles_C1_mean <- ddply(Singles_C1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Singles_C1_mean #display table
Singles_C1_mean$mean<-round(Singles_C1_mean$mean, digits = 2) #round the means

  Singles_C1_vars<-c("Temp","Day","mean")
Singles_C1_mean2<-Singles_C1_mean[Singles_C1_vars] 
Singles_C1_mean3<-cast(Singles_C1_mean2, Temp~Day, mean) #set updata for heatmap

C1rnames <- Singles_C1_mean3[,1]                            # assign labels in column 1 to "rnames"
C1mat_data <- data.matrix(Singles_C1_mean3[,2:ncol(Singles_C1_mean3)])  # transform column 2-5 into a matrix
rownames(C1mat_data) <- C1rnames                  # assign row names

# creates a own color palette from red to green
cols <- brewer.pal(3, "YlGn")
cols

my_palette <- colorRampPalette(cols)
#my_palette <- colorRampPalette(c("grey", "pear", "olive"))(n = 299)

# (optional) defines the color breaks manually for a "skewed" color transition
col_breaks = c(seq(0,1,length=100),  # Start
  seq(1.1,2,length=100),          
  seq(2.1,3,length=100),
  seq(3.1,4,length=100))             # END


C1heat<-heatmap.2(C1mat_data,
  cellnote = C1mat_data,  # same data set for cell labels
  main = "C1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering

#D1
#Singles_D1
Singles_D1_mean <- ddply(Singles_D1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Singles_D1_mean #display table
Singles_D1_mean$mean<-round(Singles_D1_mean$mean, digits = 2) #round the means

  Singles_D1_vars<-c("Temp","Day","mean")
Singles_D1_mean2<-Singles_D1_mean[Singles_D1_vars] 
Singles_D1_mean3<-cast(Singles_D1_mean2, Temp~Day, mean) #set updata for heatmap

D1rnames <- Singles_D1_mean3[,1]                            # assign labels in column 1 to "rnames"
D1mat_data <- data.matrix(Singles_D1_mean3[,2:ncol(Singles_D1_mean3)])  # transform column 2-5 into a matrix
rownames(D1mat_data) <- D1rnames                  # assign row names

D1heat<-heatmap.2(D1mat_data,
  cellnote = D1mat_data,  # same data set for cell labels
  main = "D1 ", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA"    )        # turn off column clustering

#F1
#Singles_F1
Singles_F1_mean <- ddply(Singles_F1, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Singles_F1_mean #display table
Singles_F1_mean$mean<-round(Singles_F1_mean$mean, digits = 2) #round the means

  Singles_F1_vars<-c("Temp","Day","mean")
Singles_F1_mean2<-Singles_F1_mean[Singles_F1_vars] 
Singles_F1_mean3<-cast(Singles_F1_mean2, Temp~Day, mean) #set updata for heatmap

F1rnames <- Singles_F1_mean3[,1]                            # assign labels in column 1 to "rnames"
F1mat_data <- data.matrix(Singles_F1_mean3[,2:ncol(Singles_F1_mean3)])  # transform column 2-5 into a matrix
rownames(F1mat_data) <- F1rnames                  # assign row names


F1heat2<-heatmap.2(F1mat_data,
  cellnote = C1mat_data,  # same data set for cell labels
  main = "F1", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="none",     # only draw a row dendrogram
  Rowv=FALSE,
  Colv="NA")            # turn off column clustering








#G3
#Singles_G3
Singles_G3_mean <- ddply(Singles_G3, c("Temp","Day"), summarise, #summarize cell count
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Singles_G3_mean #display table
Singles_G3_mean$mean<-round(Singles_G3_mean$mean, digits = 2) #round the means

  Singles_G3_vars<-c("Temp","Day","mean")
Singles_G3_mean2<-Singles_G3_mean[Singles_G3_vars] 
Singles_G3_mean3<-cast(Singles_G3_mean2, Temp~Day, mean) #set updata for heatmap

G3rnames <- Singles_G3_mean3[,1]                            # assign labels in column 1 to "rnames"
G3mat_data <- data.matrix(Singles_G3_mean3[,2:ncol(Singles_G3_mean3)])  # transform column 2-5 into a matrix
rownames(G3mat_data) <- G3rnames                  # assign row names


G3heat<-heatmap.2(G3mat_data,
  cellnote = G3mat_data,  # same data set for cell labels
  main = "G3", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier
  breaks=col_breaks,    # enable color transition at specified limits
  #dendrogram="row",     # only draw a row dendrogram
  Rowv=FALSE,
  dendrogram='none')     #turn off dentrogram

  #Colv="NA")            # turn off column clustering



```

#Multi-infection
**Use only Relabundance for within larvae comparisons, use Raw for comparision with Single infections **  
df: ALL_9000b (has larvae removed where not all clades amped in each individual)  
Binomial - A. did the larvae infect at all? with anything, or B. did each individual clade infect    
#A. Binomial. Did larvae infect or not, by clade and overall
```{r}   
#df ALL_9000b, only 5 larvae have 0 infection (but enough dropletes)
ALL_RelA<-ALL_9000b #copy
ALL_RelA$cell.larvae_round<-round(ALL_RelA$cells.larvae) 
drops <- c("cells.larvae") #get rid of cell.larvae col
ALL_RelA<-ALL_RelA[ , !(names(ALL_RelA) %in% drops)]

ALL_RelA<-dcast(ALL_RelA, ALL.number+Temp+Day+Pot~Primer, value.var = "cell.larvae_round") # cast()

#make "infect or not"" binary
RelA_binary<-ALL_RelA

 # 1 and 0 for each clade 
RelA_binary$C1[RelA_binary$C1>0]<-1  
RelA_binary$C1[RelA_binary$C1==0]<-0
RelA_binary$D1[RelA_binary$D1>0]<-1  
RelA_binary$D1[RelA_binary$D1==0]<-0
RelA_binary$F1[RelA_binary$F1>0]<-1  
RelA_binary$F1[RelA_binary$F1==0]<-0
RelA_binary$G3[RelA_binary$G3>0]<-1  
RelA_binary$G3[RelA_binary$G3==0]<-0

#new col sum of each clade in a larvae
RelA_binary$numclade<-RelA_binary$C1+RelA_binary$D1+RelA_binary$F1+RelA_binary$G3

RelA_binary$Infect[RelA_binary$numclade>0]<-1  
RelA_binary$Infect[RelA_binary$numclade==0]<-0
   #RelA_binary$Infect<-as.factor(RelA_binary$binary) #make factor

RelA_CladeComp<-RelA_binary #make a copy for the nextsection

#rename Pot interaction as a code: Pot_Temp
 RelA_binary$PotCode<-paste0(RelA_binary$Temp, RelA_binary$Pot)
 RelA_binary$PotCode<-as.factor(RelA_binary$PotCode) #make factor
 
```

A did larvae with single clades infect more or less than larvae offered multiple clades: stats
```{r} 
#stats
#df for multi:RelA_binary, df for Individuals:  BinaryInfect
 RelA_binary$Symbiont<-"All"
 
RelA_binary_ALL<-RelA_binary[,c("Temp","Day","PotCode","Infect","Symbiont")] #keep only cols you need
BinaryInfect_ALL<-BinaryInfect[,c("Temp","Day","PotCode","Infect","Symbiont")] #keep only cols you need
Multi_Single_binary<-rbind(RelA_binary_ALL,BinaryInfect_ALL) #combine
 Multi_Single_binary$Symbiont<-as.factor(Multi_Single_binary$Symbiont)
  Multi_Single_binary$Infect<-as.factor(Multi_Single_binary$Infect)

  
#Full model including all clades: This asks if larvae infect in general more if they are Multi, C, D, F or G
  
#(this is testing each symbiont against eachother and against the group "All" which is did multi infection larvae infect period)
  
 Multi_Single_binary_model<-glmer(Infect~Temp*Symbiont*Day+(1|PotCode), family="binomial", Multi_Single_binary) 
 #is this warning oK? 
 # Better way to run this model? For binomial i thought this is it. The error could be due to not all clades living to day 14. 
  
  
 Anova(Multi_Single_binary_model)
dispersion_glmer(Multi_Single_binary_model) # no overdispersion 

  emm<-emmeans(Multi_Single_binary_model,  ~ Symbiont*Temp*Day)
  pairs(emm)
  cld(emm)  
  
  
#try doing within clade/infection type
# ALL - C1
RelA_binary_C1<-RelA_binary[,c("Temp","Day","PotCode","C1", "Symbiont")] #keep only cols you need
RelA_binary_C1$infectType<-"Multi"
names(RelA_binary_C1)[names(RelA_binary_C1) == "C1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_D1<-RelA_binary[,c("Temp","Day","PotCode","D1","Symbiont")] #keep only cols you need
RelA_binary_D1$infectType<-"Multi"
names(RelA_binary_D1)[names(RelA_binary_D1) == "D1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_F1<-RelA_binary[,c("Temp","Day","PotCode","F1","Symbiont")] #keep only cols you need
RelA_binary_F1$infectType<-"Multi"
names(RelA_binary_F1)[names(RelA_binary_F1) == "F1"] <- "Infect"   #change C1 col name to "infect"

RelA_binary_G3<-RelA_binary[,c("Temp","Day","PotCode","G3","Symbiont")] #keep only cols you need
RelA_binary_G3$infectType<-"Multi"
names(RelA_binary_G3)[names(RelA_binary_G3) == "G3"] <- "Infect"   #change C1 col name to "infect"


#Individual by clade
Binary_C1_binary<-Binary_C1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_C1_binary$infectType<-"Single"
Binary_D1_binary<-Binary_D1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_D1_binary$infectType<-"Single"
Binary_F1_binary<-Binary_F1[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_F1_binary$infectType<-"Single"
Binary_G3_binary<-Binary_G3[,c("Temp","Day","PotCode","Symbiont","Infect")]
Binary_G3_binary$infectType<-"Single"
```

####Individual Infections
C1 -single alone 
```{r}    
C1_binary_SinMul<-rbind(RelA_binary_C1, Binary_C1_binary)
C1_binary_SinMul$Infect<-as.factor(C1_binary_SinMul$Infect)
C1_binary_SinMul$Symbiont<-as.factor(C1_binary_SinMul$Symbiont)
C1_binary_SinMul$infectType<-as.factor(C1_binary_SinMul$infectType)


#model
C1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_C1) 
Anova(C1_binary_Multi_mod)
dispersion_glmer(C1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_C1$Infect<-as.character(RelA_binary_C1$Infect) #change infect back to a number for mean
RelA_binary_C1$Infect<-as.numeric(RelA_binary_C1$Infect)

RelA_binary_C1_mean <- ddply(RelA_binary_C1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_C1_mean #display table 
RelA_binary_C1_mean<-na.omit(RelA_binary_C1_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_C1_mean$Day.num<-as.numeric(RelA_binary_C1_mean$Day)
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 2] =7
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 3] =14
RelA_binary_C1_mean$Day.num[RelA_binary_C1_mean$Day.num == 1] =3

#plots Multi only

C1_binary_Multi_plot<-ggplot(data=RelA_binary_C1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
 ylab(expression(paste(""))) +
ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_Multi_plot

```

D1 Single alone
```{r}   

#model
D1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_D1) 
Anova(D1_binary_Multi_mod)
dispersion_glmer(D1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_D1$Infect<-as.character(RelA_binary_D1$Infect) #change infect back to a number for mean
RelA_binary_D1$Infect<-as.numeric(RelA_binary_D1$Infect)

RelA_binary_D1_mean <- ddply(RelA_binary_D1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_D1_mean #display table 
RelA_binary_D1_mean<-na.omit(RelA_binary_D1_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_D1_mean$Day.num<-as.numeric(RelA_binary_D1_mean$Day)
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 2] =7
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 3] =14
RelA_binary_D1_mean$Day.num[RelA_binary_D1_mean$Day.num == 1] =3

#plots Multi only

D1_binary_Multi_plot<-ggplot(data=RelA_binary_D1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  xlab("") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_Multi_plot
```

F1 Single alone
```{r}  
#model
F1_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_F1) 
Anova(F1_binary_Multi_mod)
dispersion_glmer(F1_binary_Multi_mod) # no overdispersion 

#mean
RelA_binary_F1$Infect<-as.character(RelA_binary_F1$Infect) #change infect back to a number for mean
RelA_binary_F1$Infect<-as.numeric(RelA_binary_F1$Infect)

RelA_binary_F1_mean <- ddply(RelA_binary_F1, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_F1_mean #display table 
RelA_binary_F1_mean<-na.omit(RelA_binary_F1_mean)
 
#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_F1_mean$Day.num<-as.numeric(RelA_binary_F1_mean$Day)
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 2] =7
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 3] =14
RelA_binary_F1_mean$Day.num[RelA_binary_F1_mean$Day.num == 1] =3
#plots Multi only

F1_binary_Multi_plot<-ggplot(data=RelA_binary_F1_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
 ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_Multi_plot
```

G3 Single alone
```{r}  
#model 
G3_binary_Multi_mod<-glmer(Infect~Temp*Day+(1|PotCode), family="binomial", RelA_binary_G3) 
Anova(G3_binary_Multi_mod)
dispersion_glmer(G3_binary_Multi_mod) # 0.53 overdispersion? 

#mean
RelA_binary_G3$Infect<-as.character(RelA_binary_G3$Infect) #change infect back to a number for mean
RelA_binary_G3$Infect<-as.numeric(RelA_binary_G3$Infect)

RelA_binary_G3_mean <- ddply(RelA_binary_G3, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

RelA_binary_G3_mean #display table 
RelA_binary_G3_mean<-na.omit(RelA_binary_G3_mean)

#change Day back to Numeric from Factor, reapply the actual numeric dates
RelA_binary_G3_mean$Day.num<-as.numeric(RelA_binary_G3_mean$Day)
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 2] =7
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 3] =14
RelA_binary_G3_mean$Day.num[RelA_binary_G3_mean$Day.num == 1] =3
#plots Multi only

G3_binary_Multi_plot<-ggplot(data=RelA_binary_G3_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0,1)+
    scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(legend.position = c(0.8, 0.2))+
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_Multi_plot
```

Figure X. Plot all mutli infection by clade alone
```{r} 
C1_binary_Multi_plot<-C1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
D1_binary_Multi_plot<-D1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
F1_binary_Multi_plot<-F1_binary_Multi_plot+ theme(legend.position = "none") #remove legend
#G3_binary_Multi_plot<-G3_binary_Multi_plot+ theme(legend.position = "none") #remove legend

grid.arrange(C1_binary_Multi_plot,D1_binary_Multi_plot,F1_binary_Multi_plot,G3_binary_Multi_plot, nrow = 1)
```

Plot Single and Multi Binomial infection plots 4x4 
```{r}
library(cowplot)

Counts_compare_singmult<-plot_grid(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,C1_Infect_plot, D1_Infect_plot,F1_Infect_plot, G3_Infect_plot, C1_binary_Multi_plot, D1_binary_Multi_plot,F1_binary_Multi_plot,G3_binary_Multi_plot, labels = "AUTO", ncol=4, nrow=2, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);Counts_compare_singmult

#add common x and y axis labels
y.grob <- textGrob("Cells/Larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
Counts_compare_singmult<-grid.arrange(arrangeGrob(Counts_compare_singmult, left = y.grob, bottom = x.grob))
#save
#ggsave(filename="Figures/BinomialSIFig2.png", plot=BinomialSIFig2, dpi=300, width=12, height=10, units="in")
```



###Single v Multi infection by clade
C1 Single v Multi
```{r} 
#Singel vs Multi 

#model SINGLE vs MULTI
C1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", C1_binary_SinMul) 
Anova(C1_binary_SinMul_mod)
dispersion_glmer(C1_binary_SinMul_mod) # no overdispersion 

#mean
C1_binary_SinMul$Infect<-as.character(C1_binary_SinMul$Infect) #change infect back to a number for mean
C1_binary_SinMul$Infect<-as.numeric(C1_binary_SinMul$Infect)

C1_binary_SinMul_mean <- ddply(C1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

C1_binary_SinMul_mean #display table 
C1_binary_SinMul_mean<-na.omit(C1_binary_SinMul_mean)

#separate by Temp
C1_binary_SinMul_mean_27<-subset(C1_binary_SinMul_mean, Temp=="27")
C1_binary_SinMul_mean_30<-subset(C1_binary_SinMul_mean, Temp=="30")
C1_binary_SinMul_mean_31<-subset(C1_binary_SinMul_mean, Temp=="31")
C1_binary_SinMul_mean_31<-na.omit(C1_binary_SinMul_mean_31)

#plots
#27

C1_binary_SinMul_plot_27<-ggplot(data=C1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_27

#30

C1_binary_SinMul_plot_30<-ggplot(data=C1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_30

#31

C1_binary_SinMul_plot_31<-ggplot(data=C1_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
  ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C C1")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_binary_SinMul_plot_31

#plot together
C1_binary_SinMul_plot_27<-C1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
C1_binary_SinMul_plot_30<-C1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
C1_binary_SinMul_plot_31<-C1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(C1_binary_SinMul_plot_27, C1_binary_SinMul_plot_30, C1_binary_SinMul_plot_31, nrow = 1)
```
D1 Single v Multi 
```{r}
D1_binary_SinMul<-rbind(RelA_binary_D1, Binary_D1_binary)  
D1_binary_SinMul$Infect<-as.factor(D1_binary_SinMul$Infect)
D1_binary_SinMul$Symbiont<-as.factor(D1_binary_SinMul$Symbiont)
D1_binary_SinMul$infectType<-as.factor(D1_binary_SinMul$infectType)

#model 
D1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", D1_binary_SinMul) 
Anova(D1_binary_SinMul_mod)
dispersion_glmer(D1_binary_SinMul_mod) # no overdispersion

#mean
D1_binary_SinMul$Infect<-as.character(D1_binary_SinMul$Infect) #change infect back to a number for mean
D1_binary_SinMul$Infect<-as.numeric(D1_binary_SinMul$Infect)

D1_binary_SinMul_mean <- ddply(D1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

D1_binary_SinMul_mean #display table  
D1_binary_SinMul_mean<-na.omit(D1_binary_SinMul_mean)

#separate by Temp
D1_binary_SinMul_mean_27<-subset(D1_binary_SinMul_mean, Temp=="27")
D1_binary_SinMul_mean_30<-subset(D1_binary_SinMul_mean, Temp=="30")
D1_binary_SinMul_mean_31<-subset(D1_binary_SinMul_mean, Temp=="31")
D1_binary_SinMul_mean_31<-na.omit(D1_binary_SinMul_mean_31)



#plot
#27
D1_binary_SinMul_plot_27<-ggplot(data=D1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_27

#30
D1_binary_SinMul_plot_30<-ggplot(data=D1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_30

#31
D1_binary_SinMul_plot_31<-ggplot(data=D1_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C D1")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_binary_SinMul_plot_31

#plot together
D1_binary_SinMul_plot_27<-D1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
D1_binary_SinMul_plot_30<-D1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
D1_binary_SinMul_plot_31<-D1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(D1_binary_SinMul_plot_27, D1_binary_SinMul_plot_30, D1_binary_SinMul_plot_31, nrow = 1)
```
F1 Single v Multi
```{r} 
#F1 
F1_binary_SinMul<-rbind(RelA_binary_F1, Binary_F1_binary)
F1_binary_SinMul$Infect<-as.factor(F1_binary_SinMul$Infect)
F1_binary_SinMul$Symbiont<-as.factor(F1_binary_SinMul$Symbiont)
F1_binary_SinMul$infectType<-as.factor(F1_binary_SinMul$infectType)

F1_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", F1_binary_SinMul) 
Anova(F1_binary_SinMul_mod) 
dispersion_glmer(F1_binary_SinMul_mod) # no overdispersion

#mean
F1_binary_SinMul$Infect<-as.character(F1_binary_SinMul$Infect) #change infect back to a number for mean
F1_binary_SinMul$Infect<-as.numeric(F1_binary_SinMul$Infect)

F1_binary_SinMul_mean <- ddply(F1_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

F1_binary_SinMul_mean #display table 
F1_binary_SinMul_mean<-na.omit(F1_binary_SinMul_mean)

#separate by Temp
F1_binary_SinMul_mean_27<-subset(F1_binary_SinMul_mean, Temp=="27")
F1_binary_SinMul_mean_30<-subset(F1_binary_SinMul_mean, Temp=="30")
F1_binary_SinMul_mean_31<-subset(F1_binary_SinMul_mean, Temp=="31")
F1_binary_SinMul_mean_31<-na.omit(F1_binary_SinMul_mean_31)

#plot
#27
F1_binary_SinMul_plot_27<-ggplot(data=F1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_27

#30
F1_binary_SinMul_plot_30<-ggplot(data=F1_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("230C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_30

#31
F1_binary_SinMul_plot_31<-ggplot(data=F1_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C F1")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_binary_SinMul_plot_31

#plot together
F1_binary_SinMul_plot_27<-F1_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
F1_binary_SinMul_plot_30<-F1_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend
F1_binary_SinMul_plot_31<-F1_binary_SinMul_plot_31+ theme(legend.position = "none") #remove legend

grid.arrange(F1_binary_SinMul_plot_27, F1_binary_SinMul_plot_30, F1_binary_SinMul_plot_31, nrow = 1)
```
G1 single v multi
```{r}
#G3 
G3_binary_SinMul<-rbind(RelA_binary_G3, Binary_G3_binary)
G3_binary_SinMul$Infect<-as.factor(G3_binary_SinMul$Infect)
G3_binary_SinMul$Symbiont<-as.factor(G3_binary_SinMul$Symbiont)
G3_binary_SinMul$infectType<-as.factor(G3_binary_SinMul$infectType)

G3_binary_SinMul_mod<-glmer(Infect~Temp*infectType*Day+(1|PotCode), family="binomial", G3_binary_SinMul) 
Anova(G3_binary_SinMul_mod)
dispersion_glmer(G3_binary_SinMul_mod) # no overdispersion

#mean
G3_binary_SinMul$Infect<-as.character(G3_binary_SinMul$Infect) #change infect back to a number for mean
G3_binary_SinMul$Infect<-as.numeric(G3_binary_SinMul$Infect)

G3_binary_SinMul_mean <- ddply(G3_binary_SinMul, c("Temp", "infectType","Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

G3_binary_SinMul_mean #display table 
G3_binary_SinMul_mean<-na.omit(G3_binary_SinMul_mean)

#separate by Temp
G3_binary_SinMul_mean_27<-subset(G3_binary_SinMul_mean, Temp=="27")
G3_binary_SinMul_mean_30<-subset(G3_binary_SinMul_mean, Temp=="30")
G3_binary_SinMul_mean_31<-subset(G3_binary_SinMul_mean, Temp=="31")
G3_binary_SinMul_mean_31<-na.omit(G3_binary_SinMul_mean_31)

#plot
#27
G3_binary_SinMul_plot_27<-ggplot(data=G3_binary_SinMul_mean_27, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("27C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_27

#30
G3_binary_SinMul_plot_30<-ggplot(data=G3_binary_SinMul_mean_30, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("30C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_30

#31
G3_binary_SinMul_plot_31<-ggplot(data=G3_binary_SinMul_mean_31, aes(x=Day, y=mean, group=infectType, color=infectType)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=infectType), size=4, show.legend = T)+
  geom_line(aes(color=infectType, linetype=infectType))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("Days") + #Label the X Axis
    ylim(0,1)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae infected"))) +
  ggtitle("31C G3")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_binary_SinMul_plot_31

#plot together
G3_binary_SinMul_plot_27<-G3_binary_SinMul_plot_27+ theme(legend.position = "none") #remove legend
G3_binary_SinMul_plot_30<-G3_binary_SinMul_plot_30+ theme(legend.position = "none") #remove legend

grid.arrange(G3_binary_SinMul_plot_27, G3_binary_SinMul_plot_30, G3_binary_SinMul_plot_31, nrow = 1)
```
Plot all 12
```{r}
grid.arrange(C1_binary_SinMul_plot_27, C1_binary_SinMul_plot_30, C1_binary_SinMul_plot_31,D1_binary_SinMul_plot_27, D1_binary_SinMul_plot_30, D1_binary_SinMul_plot_31,F1_binary_SinMul_plot_27, F1_binary_SinMul_plot_30, F1_binary_SinMul_plot_31,G3_binary_SinMul_plot_27, G3_binary_SinMul_plot_30, G3_binary_SinMul_plot_31, nrow = 4)
 #wil remove legend in final plot for scale
```

##B PLOT Multi infection, % larvae infected with 0,1, 2, 3, or 4 clades (not by clade, by number of clades). "rel1"= 1 clade,..
```{r}     
ALL_RelAvar<-c("Day", "Temp", "ALL.number","C1","D1","F1" ,"G3","Pot","numclade")
ALL_RelA_Infect<-RelA_CladeComp[ALL_RelAvar]
#write.csv(ALL_RelA_Infect,"ALL_RelA_Infect.csv")

NumClades<-read.csv("NumbCladesInfect_20200405.csv") #you couldn't do this in R so you did in excel and are reuploading....ugh.
#if you have ideas on how to do this in R, I just couldn't figure it out :(

NumClades<-melt(NumClades,  id=c("Temp","Day"))
NumClades$Temp<-as.factor(NumClades$Temp)
NumClades$Day<-as.factor(NumClades$Day)

#27C
NumClades_27<-subset(NumClades, Temp==27)

#plot
Infect27_plot<-ggplot(NumClades_27, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
            #scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("27C");Infect27_plot     

#30C
NumClades_30<-subset(NumClades, Temp==30)

#plot
Infect30_plot<-ggplot(NumClades_30, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("30C");Infect30_plot  

#31C
NumClades_31<-subset(NumClades, Temp==31)

#plot
Infect31_plot<-ggplot(NumClades_31, aes(y=value, x=Day, fill=variable)) + 
           geom_bar(stat="identity")+
  scale_fill_manual(values=c("#46B8DAFF","#5CB85CFF","#EEA236FF","#D43F3AFF"))+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("31C");Infect31_plot  

#plot all together
Infect27_plot<-Infect27_plot+ theme(legend.position = "none") #remove legend
Infect30_plot<-Infect30_plot+ theme(legend.position = "none") #remove legend
Infect31_plot<-Infect31_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Infect27_plot, Infect30_plot,Infect31_plot, nrow = 1)
 


#stats   CHECK THIS! you may need to transform data better!  HEY you don't really want to do this. just talk about as %s
hist(ALL_RelA_Infect$numclade)
ALL_RelA_Infect$numclade_log<-log10(ALL_RelA_Infect$numclade)
hist(ALL_RelA_Infect$numclade_log)

ALL_RelA_Infect_mod<-lm(numclade~Temp*Day, ALL_RelA_Infect) 
  summary(ALL_RelA_Infect_mod)
dispersion_glmer(ALL_RelA_Infect_mod)

emm<-emmeans(ALL_RelA_Infect_mod,  ~ Temp*Day)
  pairs(emm)
  cld(emm)  

```

##C Who was the most dominant clade in larvave - You need to figure out how to set up a df to run this correctly. I think you might need to change the 'winner' into a 1 and then find the 3 losers and change those to 0s. but not sure how to code that. 
I don't think i want to do this? This needs a lot of work, but not necessarily needed for story, just say with WORDS. What I'm trying to do here is show which clade is the dominant clade on average. Look at the plots...kinda ugly. 
```{r}     
#df ALL_RelA
Dom<-ALL_RelA%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(1)
#new col with 1 for winner
Dom$Win.lose<-1

#pull losers and give them 0
DomL2<-ALL_RelA%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(2)
DomL2$Win.lose<-0

DomL3<-ALL_RelA%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(3)
DomL3$Win.lose<-0

DomL4<-ALL_RelA%>%gather(clade,count,-Pot,-Day,-Temp,-ALL.number)%>%group_by(ALL.number)%>%arrange(desc(count))%>%slice(4)
DomL4$Win.lose<-0

DomAll<-rbind(Dom,DomL2,DomL3,DomL4)


DomAll_mean <- ddply(DomAll, c("Day", "Temp","clade"), summarise, #summarize cell counts
                 N    = length(Win.lose[!is.na(Win.lose)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Win.lose, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Win.lose, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Win.lose, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

DomAll_mean #display table 
DomAll_mean<-na.omit(DomAll_mean)

#27C
Dom27mean<-subset(DomAll_mean, Temp==27)
#plot
domAll_27_plot<-ggplot(data=Dom27mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("27C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_27_plot

#30C
Dom30mean<-subset(DomAll_mean, Temp==30)
#plot
domAll_30_plot<-ggplot(data=Dom30mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("30C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_30_plot


#31C
Dom31mean<-subset(DomAll_mean, Temp==31)
#plot
domAll_31_plot<-ggplot(data=Dom31mean, aes(x=Day, y=mean, group = clade, color=clade)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=clade), size=4, show.legend = T)+ 
  geom_line(aes(color=clade))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  #ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% larvae"))) +
  ggtitle("31C Dom Symbiont")+
  theme(plot.title = element_text(size=20));domAll_31_plot



#plot all together
domAll_27_plot<-domAll_27_plot+ theme(legend.position = "none") #remove legend
domAll_30_plot<-domAll_30_plot+ theme(legend.position = "none") #remove legend
grid.arrange(domAll_27_plot, domAll_30_plot,domAll_31_plot, nrow = 1)
```     

stats:
```{r} 
 #rename Pot interaction as a code: Pot_Temp
 DomAll$PotCode<-paste0(DomAll$Temp, DomAll$Pot,DomAll$clade )
 DomAll$PotCode<-as.factor(DomAll$PotCode) #make factor
 
DomAll_mod<-glmer(Win.lose~clade*Temp*Day+(1|PotCode), family="binomial", DomAll)  #warnings...wtf IS THIS BC we lose treatments bc of death? Reason to do by clade? 

  Anova(DomAll_mod)
dispersion_glmer(DomAll_mod) # no overdispersion 

  emm<-emmeans(DomAll_mod,  ~ clade*Temp)
  pairs(emm)
  cld(emm)  
  
#by Temp
  
#27 
Dom27<-subset(DomAll, Temp==27)
  Dom27_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom27) 
  Anova(Dom27_mod)
  dispersion_glmer(Dom27_mod)  #no overdispersion

#30
Dom30<-subset(DomAll, Temp==30)
  Dom30_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom30) 
  Anova(Dom30_mod)
  dispersion_glmer(Dom30_mod)  #no overdispersion
  
#31
Dom31<-subset(DomAll, Temp==31)
  Dom31_mod<-glmer(Win.lose~clade*Day+(1|PotCode), family="binomial", Dom31) 
  Anova(Dom31_mod)
  dispersion_glmer(Dom31_mod)  #no overdispersion
```

##Multi infection, relative abundance. What is the rel abund of each clade infected
setup df
```{r} 
#calc relative abundance for each 
ALL_RelA$Cladocopium<-ALL_RelA$C1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Durusdinium<-ALL_RelA$D1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Fugacium<-ALL_RelA$F1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Gerakladium<-ALL_RelA$G3/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)

ALL_RelAvar<-c("Day", "Temp", "Pot","ALL.number","Cladocopium","Durusdinium","Fugacium" ,"Gerakladium")
ALL_RelA_a<-ALL_RelA[ALL_RelAvar]
ALL_RelA_b<-melt(ALL_RelA_a, id=c("Day", "Temp", "ALL.number","Pot"), measure.vars = c("Cladocopium","Durusdinium","Fugacium" ,"Gerakladium"))
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="variable"]<-"Symbiont" #rename value col
ALL_RelA_b<-na.omit(ALL_RelA_b) #remove larvae with 0 infection in all larvae (due to possible extraction issue)
``` 

Relative abundance Stats, df ALL_RelA_b 
```{r}

#Full model 
hist(ALL_RelA_b$cells.larvae)
ALL_RelA_b$cells.larvae_log<-log10(ALL_RelA_b$cells.larvae+1)
hist(ALL_RelA_b$cells.larvae_log)
ALL_RelA_b$cells.larvae_arc<-asin(sqrt(ALL_RelA_b$cells.larvae))
hist(ALL_RelA_b$cells.larvae_arc)
qqnorm(ALL_RelA_b$cells.larvae_arc) #
ALL_RelA_b$cells.larvae_sq<-sqrt(ALL_RelA_b$cells.larvae)
hist(ALL_RelA_b$cells.larvae_sq)
qqnorm(ALL_RelA_b$cells.larvae_sq) #


 ALL_RelA_b$PotCode<-paste0(ALL_RelA_b$Temp, ALL_RelA_b$Pot,ALL_RelA_b$clade )
 ALL_RelA_b$PotCode<-as.factor(ALL_RelA_b$PotCode) #make factor#none are good 

 
## lmer  symbionts*days*temp
ALL_RelA_b_mod<-lmer(cells.larvae_arc~Symbiont*Day*Temp+(1|PotCode), ALL_RelA_b)
anova(ALL_RelA_b_mod)
qqPlot(residuals(ALL_RelA_b_mod))   # good

  emm<-emmeans(ALL_RelA_b_mod,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)

#by Temp:
Temp27_RelA<-subset(ALL_RelA_b, Temp=="27")
Temp30_RelA<-subset(ALL_RelA_b, Temp=="30")
Temp31_RelA<-subset(ALL_RelA_b, Temp=="31")

#27C
Temp27_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp27_RelA)
anova(Temp27_modRelA)
qqPlot(residuals(Temp27_modRelA))   # good
  emm<-emmeans(Temp27_modRelA,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)

#30C
Temp30_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp30_RelA)
anova(Temp30_modRelA)
qqPlot(residuals(Temp30_modRelA))   # good
  emm<-emmeans(Temp30_modRelA,  ~ Symbiont *Day, adjust="Tukey")
cld(emm)


#31C
Temp31_modRelA<-lmer(cells.larvae_arc~Symbiont*Day+(1|PotCode), Temp31_RelA)
anova(Temp31_modRelA)
qqPlot(residuals(Temp31_modRelA))   # good
  emm<-emmeans(Temp31_modRelA,  ~ Symbiont, adjust="Tukey")
cld(emm)
```
Plot RA as stacked bar plots by Day and then by temp 

By temps - line chart good (also show bar plot just in case)
```{r}  
relabund_27<-subset(ALL_RelA_b, Temp=="27")
relabund_30<-subset(ALL_RelA_b, Temp=="30")
relabund_31<-subset(ALL_RelA_b, Temp=="31")
 
#27
ALL_RelA_27_mean <- ddply(relabund_27, c("Day","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_27_mean #display table

#round to nearest integer
ALL_RelA_27_mean$mean100<-ALL_RelA_27_mean$mean*100
ALL_RelA_27_mean$mean100r<-round(ALL_RelA_27_mean$mean100, digits = 0)

  #bar plot  (prob won't include the numbers on the bars, just helpful to see here)        
 ALL_STP_27<-ggplot(ALL_RelA_27_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) +  
           geom_bar(stat="identity")+ 
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+ 
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance (%)"))) +  
  ggtitle("27C");ALL_STP_27     
 
 #line plot
 ALL_STP_27_line<-ggplot(data=ALL_RelA_27_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance"))) +
  ggtitle("27C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_27_line
            
``` 

30C - ALL relative abundance stacked bar
```{r}  
#30C means  
ALL_RelA_30_mean <- ddply(relabund_30, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_30_mean #display table

#round to nearest integer
ALL_RelA_30_mean$mean100<-ALL_RelA_30_mean$mean*100
ALL_RelA_30_mean$mean100r<-round(ALL_RelA_30_mean$mean100, digits = 1)

#bar plot
ALL_STP_30<-ggplot(ALL_RelA_30_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) + 
           geom_bar(stat="identity")+
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance (%)"))) +
  ggtitle("30C");ALL_STP_30     


#line plot
 ALL_STP_30_line<-ggplot(data=ALL_RelA_30_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance (%)"))) +
  ggtitle("30C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_30_line
            
```
31C - ALL relative abundance stacked bar
```{r} 
#31C means
ALL_RelA_31_mean <- ddply(relabund_31, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_31_mean #display table

#round to nearest integer
ALL_RelA_31_mean$mean100<-ALL_RelA_31_mean$mean*100
ALL_RelA_31_mean$mean100r<-round(ALL_RelA_31_mean$mean100, digits = 0)

#bar plot
ALL_STP_31<-ggplot(ALL_RelA_31_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) + 
           geom_bar(stat="identity")+
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance (%)"))) +
  ggtitle("31C");ALL_STP_31    

#line plot
 ALL_STP_31_line<-ggplot(data=ALL_RelA_31_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Relative Abundance (%)"))) +
  ggtitle("31C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_31_line
            
```

Figure x. Plot all temps together (Rel Abund)
```{r} 
 #bar
ALL_STP_27<-ALL_STP_27+ theme(legend.position = "none") #remove legend 
ALL_STP_30<-ALL_STP_30+ theme(legend.position = "none") #remove legend
ALL_STP_31<-ALL_STP_31+ theme(legend.position = "none") #remove legend
grid.arrange(ALL_STP_27, ALL_STP_30, ALL_STP_31, nrow = 1)

#line
ALL_STP_27_line<-ALL_STP_27_line+ theme(legend.position = "none") #remove legend 
ALL_STP_30_line<-ALL_STP_30_line+ theme(legend.position = "none") #remove legend 
ALL_STP_31_line<-ALL_STP_31_line+ theme(legend.position = "none") #remove legend
grid.arrange(ALL_STP_27_line, ALL_STP_30_line, ALL_STP_31_line, nrow = 1)
``` 

Let's try to make a PCA  
THis looks like crap    
ALL_RelA
```{r}
library(devtools)
library(ggbiplot)
library(ggfortify)

RelA_PCA<-ALL_RelA[,c(1:4,9:12)] #keep only cols you need

#arcsine transform
RelA_PCA$Cladocopium<-asin(sqrt(RelA_PCA$Cladocopium))
RelA_PCA$Durusdinium<-asin(sqrt(RelA_PCA$Durusdinium))
RelA_PCA$Fugacium<-asin(sqrt(RelA_PCA$Fugacium))
RelA_PCA$Gerakladium<-asin(sqrt(RelA_PCA$Gerakladium))
RelA_PCA<-na.omit(RelA_PCA)


multi.pca <- prcomp(ALL_RelA[,5:8], scale=F)
multi.pca
summary(multi.pca)
#ggbiplot(multi.pca)

pca.plot <- autoplot(multi.pca, data = ALL_RelA, colour = 'Temp', shape="Day",loadings = TRUE, loadings.colour = 'blue',loadings.label = TRUE, loadings.label.size = 5)
pca.plot



#try zscoring: for all df, do score - mean/sd for everything, save as new column
RelA_PCA<-RelA_PCA %>% 
  mutate(C1zscore = (Cladocopium - mean(Cladocopium))/sd(Cladocopium))

RelA_PCA<-RelA_PCA %>% 
  mutate(D1zscore = (Durusdinium - mean(Durusdinium))/sd(Durusdinium))

RelA_PCA<-RelA_PCA %>% 
  mutate(F1zscore = (Fugacium - mean(Fugacium))/sd(Fugacium))

RelA_PCA<-RelA_PCA %>% 
  mutate(G3zscore = (Gerakladium - mean(Gerakladium))/sd(Gerakladium))


multi.pca2 <- prcomp(RelA_PCA[,1:13])
multi.pca2
summary(multi.pca)
#ggbiplot(multi.pca)

pca.plot <- autoplot(multi.pca, data = ALL_RelA, colour = 'Temp', shape="Day",loadings = TRUE, loadings.colour = 'blue',loadings.label = TRUE, loadings.label.size = 5)
pca.plot 
```

Here is the PCA script from AH: 
 
Generate results of (1) eigen values,  (2) coordinates, (3) contributions to the PCA, (4) and quality of representation.    
```{r, results=TRUE}
library(vegan)
library("factoextra")

eig.val <- get_eigenvalue(multi.pca)
eig.val

res.var <- get_pca_var(multi.pca)
res.var$coord          # Coordinates
res.var$contrib        # Contributions to the PCs
res.var$cos2           # Quality of representation 
```


Conduct PERMANOVA with vegan package.  
###All the data by Temp/Day
```{r, results=FALSE}
# PCA
data_vegan <- RelA_PCA[c(5:8)]
vegan_model <- scale(data_vegan) 
```

```{r, results=TRUE}
# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1<-adonis2(vegan_model ~ Day * Temp, data = RelA_PCA, method='eu', perm=999)
summary(adonis1)
adonis1 
```

Plotting with elipses by temperature. 
```{r, results=FALSE}
pca.plot <- autoplot(multi.pca, data = ALL_RelA, colour = 'Temp', shape="Day",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.25,0.5) +
  ylim(-0.25, 0.5) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot

#spca.plot$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA.pdf", plot=pca.plot, height=8, width=12, units = c("in"), dpi=300) #output figure 
```

Plotting with elipses by day. 
```{r, results=FALSE}
pca.plot2 <- autoplot(multi.pca, data = ALL_RelA, colour = 'Day', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm")+
  scale_colour_manual(values=c("black", "maroon", "darkgreen")) +
  scale_fill_manual(values=c("black", "purple", "darkgreen"))+
  xlim(-0.4,0.5) +
  ylim(-0.4, 0.5) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
   theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot2

#pca.plot2$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA2.pdf", plot=pca.plot2, height=8, width=12, units = c("in"), dpi=300) #output figure
```
###PCA by Day  
Day 3




WHY not runnning for day 3
```{r, results=FALSE}
eig.val <- get_eigenvalue(multi.pca)
eig.val

res.var <- get_pca_var(multi.pca)
res.var$coord          # Coordinates
res.var$contrib        # Contributions to the PCs
res.var$cos2           # Quality of representation 
#Day3
RelA_PCA_D3<-subset(RelA_PCA, Day=="3")
# PCA
data_veganDay3 <- RelA_PCA_D3[c(5:8)]
vegan_model_D3 <- scale(data_veganDay3) 
```

```{r, results=TRUE}
# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1<-adonis2(vegan_model_D3 ~ Temp, data = RelA_PCA_D3, method='eu', perm=999)
summary(adonis1)
adonis1 
```

D3 Plotting with elipses by temperature. 
```{r, results=FALSE}
pca.plot <- autoplot(multi.pca, data = RelA_PCA_D3, colour = 'Temp', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.25,0.5) +
  ylim(-0.25, 0.5) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot

#spca.plot$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA_D3.pdf", plot=pca.plot, height=8, width=12, units = c("in"), dpi=300) #output figure 
```
Day 7
```{r, results=FALSE}
#Day7
RelA_PCA_D7<-subset(RelA_PCA, Day=="7")
# PCA
data_veganDay7 <- RelA_PCA_D7[c(5:8)]
vegan_model_D7 <- scale(data_veganDay7) 
```

```{r, results=TRUE}
# PerMANOVA - partitioning the euclidean distance matrix by nutrition & temp
adonis1<-adonis2(vegan_model_D7 ~ Temp, data = RelA_PCA_D7, method='eu', perm=999)
summary(adonis1)
adonis1 
```

Plotting with elipses by temperature. 
```{r, results=FALSE}
pca.plot <- autoplot(multi.pca, data = ALL_RelA_D7, colour = 'Temp', shape="Temp",loadings = TRUE, loadings.colour = 'black',loadings.label = TRUE, loadings.label.colour="black", loadings.label.size = 5, loadings.label.vjust=-1, frame.type="norm", frame=TRUE)+
  scale_colour_manual(values=c("blue", "orange", "red")) +
  scale_fill_manual(values=c("blue", "orange", "red"))+
  xlim(-0.25,0.5) +
  ylim(-0.25, 0.5) +
  geom_text(x=0, y=-0.34, label="PERMANOVA p(Day)<0.01", size=5)+
  geom_text(x=0, y=-0.38, label="PERMANOVA p(Temp)<0.01", size=5)+
  theme(legend.text = element_text(size=18), 
        plot.background = element_blank(),
        legend.title = element_text(size=18, face="bold"), 
        axis.text = element_text(size=18), 
        axis.title = element_text(size=18,  face="bold"));pca.plot

#spca.plot$layers[[2]]$aes_params$size <- 1
#ggsave("Figures/PCA_D3.pdf", plot=pca.plot, height=8, width=12, units = c("in"), dpi=300) #output figure 
```




##Multi raw - for how we can compare to individual infection
This is the Count data used for MULTI INFECTION! Not Relabund
```{r}        
#use ALLcast_9000_cast2a THIS IS WITHOUT SAMPS REMOVED WHEN ALL NOT AMPED
#This is OK for the raw to compare to single infections but not for relabund. 

MultiInfect_Raw<-ALLcast_9000_cast2a

# melt
MultiInfect_Raw_2<-melt(MultiInfect_Raw, id=c("ALL.number","Temp","Day","Pot"), measure.vars = c("C1_round","D1_round","F1_round","G3_round"))
colnames(MultiInfect_Raw_2)[colnames(MultiInfect_Raw_2)=="value"]<-"cells.larvae" #rename value col
colnames(MultiInfect_Raw_2)[colnames(MultiInfect_Raw_2)=="variable"]<-"Symbiont" #rename value col
 
#Subset by clade
  
MultiInfect_Raw_C1<-subset(MultiInfect_Raw_2, Symbiont=="C1_round")
MultiInfect_Raw_D1<-subset(MultiInfect_Raw_2, Symbiont=="D1_round")
MultiInfect_Raw_F1<-subset(MultiInfect_Raw_2, Symbiont=="F1_round")
MultiInfect_Raw_G3<-subset(MultiInfect_Raw_2, Symbiont=="G3_round")

```
 
PLOT C1 Multi infection raw
```{r} 
C1_MULTI_mean <- ddply(MultiInfect_Raw_C1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_MULTI_mean #display table
C1_MULTI_mean<-na.omit(C1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
C1_MULTI_mean$Day.num<-as.numeric(C1_MULTI_mean$Day)
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 2] =7
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 3] =14
C1_MULTI_mean$Day.num[C1_MULTI_mean$Day.num == 1] =3


C1_MULTI_plot<-ggplot(data=C1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_MULTI_plot
``` 

PLOT D1 Multi infection Raw
```{r} 
D1_MULTI_mean <- ddply(MultiInfect_Raw_D1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_MULTI_mean #display table
D1_MULTI_mean<-na.omit(D1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
D1_MULTI_mean$Day.num<-as.numeric(D1_MULTI_mean$Day)
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 2] =7
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 3] =14
D1_MULTI_mean$Day.num[D1_MULTI_mean$Day.num == 1] =3


D1_MULTI_plot<-ggplot(data=D1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(1,100,1000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_MULTI_plot
``` 

PLOT F1 Multi infection Raw
```{r} 
F1_MULTI_mean <- ddply(MultiInfect_Raw_F1, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_MULTI_mean #display table
F1_MULTI_mean<-na.omit(F1_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
F1_MULTI_mean$Day.num<-as.numeric(F1_MULTI_mean$Day)
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 2] =7
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 3] =14
F1_MULTI_mean$Day.num[F1_MULTI_mean$Day.num == 1] =3


F1_MULTI_plot<-ggplot(data=F1_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_MULTI_plot
``` 

PLOT G3 Multi infection Raw
```{r} 
G3_MULTI_mean <- ddply(MultiInfect_Raw_G3, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_MULTI_mean #display table
G3_MULTI_mean<-na.omit(G3_MULTI_mean) # remove NAs or any bin with n<3

#change Day back to Numeric from Factor, reapply the actual numeric dates
G3_MULTI_mean$Day.num<-as.numeric(G3_MULTI_mean$Day)
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 2] =7
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 3] =14
G3_MULTI_mean$Day.num[G3_MULTI_mean$Day.num == 1] =3


G3_MULTI_plot<-ggplot(data=G3_MULTI_mean, aes(x=Day.num, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(.1,5000))+  xlab("") + #Label the X Axis 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
      theme(legend.position = c(0.8, 0.2))+
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_MULTI_plot
``` 

Figure x. Plot all Symbiont multi ALL  together:
```{r} 
#line plot 
C1_MULTI_plot<-C1_MULTI_plot+ theme(legend.position = "none") #remove legend
D1_MULTI_plot<-D1_MULTI_plot+ theme(legend.position = "none") #remove legend
F1_MULTI_plot<-F1_MULTI_plot+ theme(legend.position = "none") #remove legend
#G3_MULTI_plot<-G3_MULTI_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.
grid.arrange(C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 1)
```

Plot Single and Multi Binomial infection plots 4x4
```{r}
library(cowplot)

countdata_compare<-plot_grid(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, labels = "AUTO", ncol=4, nrow=2, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);countdata_compare

#add common x and y axis labels
y.grob <- textGrob("cells/larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
countdata_compare<-grid.arrange(arrangeGrob(countdata_compare, left = y.grob, bottom = x.grob))
#save
#ggsave(filename="Figures/countdata_compare.png", plot=countdata_compare, dpi=300, width=12,height=10, units="in")

```
  
Plot single Raw plots over Multi clade plots (comparison plot). I like the above better. 
  
```{r}  
grid.arrange(C1Fulla_plot_9000, D1Fulla_plot_9000, F1Fulla_plot_9000,G3Fulla_plot_9000,
  C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 2)
```
 
# let's look at some plots of raw counts by single vs multi infection. Blue and pink plots
C1  
C1Full2 = Single cells.larvae raw
ALLcast_9000_cast2a = Alls raw that infected
Counts, on log y-axis
```{r}  
MultiCounts<-ALLcast_9000_cast2a
#MultiCounts$cells.larvae<-MultiCounts$C1+MultiCounts$D1+MultiCounts$F1+MultiCounts$G3
MultiCounts2<-MultiCounts[-c(1,5:8)] #remove metadata
MultiCounts2$single.multi<-"multi"
names(MultiCounts2)[names(MultiCounts2) == "C1_round"] <- "C1"
names(MultiCounts2)[names(MultiCounts2) == "D1_round"] <- "D1" 
names(MultiCounts2)[names(MultiCounts2) == "F1_round"] <- "F1"
names(MultiCounts2)[names(MultiCounts2) == "G3_round"] <- "G3"
 

#MultiCounts2$Symbiont<-"All"
MultiCounts2<-melt(MultiCounts2, id=c("Temp","Day","single.multi","Pot"))
colnames(MultiCounts2)[colnames(MultiCounts2)=="value"]<-"cells.larvae_round" #rename value col
colnames(MultiCounts2)[colnames(MultiCounts2)=="variable"]<-"Symbiont" #rename value col

SingleCounts<-rbind(C1Fulla,D1Fulla,F1Fulla,G3Fulla)
SingleCounts<-SingleCounts[-c(5:10)] #remove metadata
SingleCounts$single.multi<-"single"

CountsCompare<-rbind(SingleCounts, MultiCounts2) # combine


#MEANs
CountsCompare_mean <- ddply(CountsCompare, c("single.multi","Temp","Day","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae_round[!is.na(cells.larvae_round)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae_round, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae_round, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae_round, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
CountsCompare_mean #display table
CountsCompare_mean<-na.omit(CountsCompare_mean)
#make a code
CountsCompare_mean$code<-paste0(CountsCompare_mean$single.multi, "_", CountsCompare_mean$Temp) #code

CountsCompare_mean<-CountsCompare_mean[ , order(names(CountsCompare_mean))]
CountsCompare_mean<-na.omit(CountsCompare_mean)
#make Day numeric

#change Day back to Numeric from Factor, reapply the actual numeric dates
CountsCompare_mean$Day<-as.numeric(CountsCompare_mean$Day)
CountsCompare_mean$Day[CountsCompare_mean$Day == 2] =7
CountsCompare_mean$Day[CountsCompare_mean$Day == 3] =14
CountsCompare_mean$Day[CountsCompare_mean$Day == 1] =3

#subset by temp
CountsCompare_mean_27<-subset(CountsCompare_mean, Temp=="27")
CountsCompare_mean_30<-subset(CountsCompare_mean, Temp=="30")
CountsCompare_mean_31<-subset(CountsCompare_mean, Temp=="31")
```

#subset by Symbiont plots
C1: 27C
```{r}     
#subset C1 
CountsCompare_C1_27<-subset(CountsCompare_mean_27, Symbiont=="C1")

CountsCompare_C1_plot27<-ggplot(data=CountsCompare_C1_27, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  
  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Cladocopium")))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot27
```
C1: 30C

```{r}
#Subset 30 
CountsCompare_C1_30<-subset(CountsCompare_mean_30, Symbiont=="C1")

CountsCompare_C1_plot30<-ggplot(data=CountsCompare_C1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot30
```

C1: 31C
```{r} 
#Subset 31
CountsCompare_C1_31<-subset(CountsCompare_mean_31, Symbiont=="C1")
 
 
CountsCompare_C1_plot31<-ggplot(data=CountsCompare_C1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20, hjust=0.5));CountsCompare_C1_plot31
```

D1
D1: 27C
```{r}
CountsCompare_D1<-subset(CountsCompare_mean_27, Symbiont=="D1")
 
CountsCompare_D1_plot27<-ggplot(data=CountsCompare_D1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Durusdinium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot27

```
D1: 30C
```{r}
#Subset 30
CountsCompare_D1_30<-subset(CountsCompare_mean_30, Symbiont=="D1")
 
CountsCompare_D1_plot30<-ggplot(data=CountsCompare_D1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot30

```
D1: 31C
```{r}
#Subset 31
CountsCompare_D1_31<-subset(CountsCompare_mean_31, Symbiont=="D1")


CountsCompare_D1_plot31<-ggplot(data=CountsCompare_D1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  expand_limits(x = 14, y = 0)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_D1_plot31
```

F1
F1: 27C
```{r}
#subset F1 
CountsCompare_F1<-subset(CountsCompare_mean_27, Symbiont=="F1")
 

CountsCompare_F1_plot27<-ggplot(data=CountsCompare_F1, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Fugacium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot27

```
F1: 30C
```{r}
#Subset 30
CountsCompare_F1_30<-subset(CountsCompare_mean_30, Symbiont=="F1")
 

CountsCompare_F1_plot30<-ggplot(data=CountsCompare_F1_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") +
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot30
```
F1: 31C
```{r}
#Subset 31
CountsCompare_F1_31<-subset(CountsCompare_mean_31, Symbiont=="F1")

CountsCompare_F1_plot31<-ggplot(data=CountsCompare_F1_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
      scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_F1_plot31
```

G3
G3: 27C
```{r}
#subset G3
CountsCompare_G3<-subset(CountsCompare_mean_27, Symbiont=="G3")


CountsCompare_G3_plot27<-ggplot(data=CountsCompare_G3, aes(x=Day, y=mean, group=single.multi, color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(italic("Gerakladium")))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot27

```
G3: 30C
```{r}
#Subset 30
CountsCompare_G3_30<-subset(CountsCompare_mean_30, Symbiont=="G3")


CountsCompare_G3_plot30<-ggplot(data=CountsCompare_G3_30, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot30

```
G3: 31C
```{r}
#Subset 31
CountsCompare_G3_31<-subset(CountsCompare_mean_31, Symbiont=="G3")


CountsCompare_G3_plot31<-ggplot(data=CountsCompare_G3_31, aes(x=Day, y=mean, group=single.multi,color=single.multi)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
   geom_point(aes(color=single.multi), size=4, show.legend = T)+
  geom_line(aes(color=single.multi, linetype=single.multi))+
  scale_color_manual(values=c("deeppink3", "turquoise3"))+
  xlab("") + #Label the X Axis
       scale_y_log10(breaks = c(-100,1,100,1000, 10000), limits=c(1,5000))+  xlab("") + 
      scale_x_continuous(breaks=seq(0, 14, 2))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(""))) +
  ggtitle("")+
    theme(legend.position = c(0.8, 0.8))+
  theme(plot.title = element_text(size=20, face = "italic"));CountsCompare_G3_plot31
```

Figure x. Plot 3x4:
```{r} 
#line plot 
CountsCompare_G3_plot27<-CountsCompare_G3_plot27+ theme(legend.position = "none")
CountsCompare_G3_plot30<-CountsCompare_G3_plot30+ theme(legend.position = "none")
#CountsCompare_G3_plot31<-CountsCompare_G3_plot31+ theme(legend.position = "none")

CountsCompare_F1_plot27<-CountsCompare_F1_plot27+ theme(legend.position = "none")
CountsCompare_F1_plot30<-CountsCompare_F1_plot30+ theme(legend.position = "none")
CountsCompare_F1_plot31<-CountsCompare_F1_plot31+ theme(legend.position = "none")

CountsCompare_D1_plot27<-CountsCompare_D1_plot27+ theme(legend.position = "none")
CountsCompare_D1_plot30<-CountsCompare_D1_plot30+ theme(legend.position = "none")
CountsCompare_D1_plot31<-CountsCompare_D1_plot31+ theme(legend.position = "none")

CountsCompare_C1_plot27<-CountsCompare_C1_plot27+ theme(legend.position = "none")
CountsCompare_C1_plot30<-CountsCompare_C1_plot30+ theme(legend.position = "none")
CountsCompare_C1_plot31<-CountsCompare_C1_plot31+ theme(legend.position = "none")


grid.arrange(CountsCompare_C1_plot27, CountsCompare_C1_plot30, CountsCompare_C1_plot31, CountsCompare_D1_plot27,CountsCompare_D1_plot30, CountsCompare_D1_plot31,CountsCompare_F1_plot27,CountsCompare_F1_plot30,CountsCompare_F1_plot31,CountsCompare_G3_plot27,CountsCompare_G3_plot30,CountsCompare_G3_plot31, nrow = 4)

```

Plot Single and Multi raw counts infection plots 4x2
```{r}

InfectRaw_Fig1<-plot_grid(CountsCompare_C1_plot27, CountsCompare_C1_plot30, CountsCompare_C1_plot31, CountsCompare_D1_plot27,CountsCompare_D1_plot30, CountsCompare_D1_plot31,CountsCompare_F1_plot27,CountsCompare_F1_plot30,CountsCompare_F1_plot31,CountsCompare_G3_plot27,CountsCompare_G3_plot30,CountsCompare_G3_plot31, labels = "AUTO", ncol=3, nrow=4, rel_heights= c(1,1), rel_widths = c(1,1), label_size = 15);InfectRaw_Fig1

#add common x and y axis labels
y.grob <- textGrob("cells/larvae", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15), rot=90)

x.grob <- textGrob("Days Post Infection", 
                   gp=gpar(fontface="bold", col="Black", fontsize=15))
#add to plot
InfectRaw_Fig1<-grid.arrange(arrangeGrob(InfectRaw_Fig1, left = y.grob, bottom = x.grob))
#save
#ggsave(filename="Figures/InfectRaw_Fig1.png", plot=InfectRaw_Fig1, dpi=300, width=12, height=12, units="in")
```
#Statistics for single vs multi COUNTS by symbiont
```{r}
#stats
hist(CountsCompare$cells.larvae_round)
CountsCompare$cells.larvae_log<-log10(CountsCompare$cells.larvae_round+1)
hist(CountsCompare$cells.larvae_log) #normal
CountsCompare$PotCode<-paste0(CountsCompare$Symbiont, "_", CountsCompare$Temp,"_", CountsCompare$Pot) #code
  

CountsCompare_C1<-subset(CountsCompare, Symbiont=="C1")
hist(CountsCompare_C1$cells.larvae_log) #normal
CountsCompare_D1<-subset(CountsCompare, Symbiont=="D1")
hist(CountsCompare_D1$cells.larvae_log) #ok
CountsCompare_F1<-subset(CountsCompare, Symbiont=="F1")
hist(CountsCompare_F1$cells.larvae_log) #normal
CountsCompare_G3<-subset(CountsCompare, Symbiont=="G3")
hist(CountsCompare_G3$cells.larvae_log) #normal

```
C1, full mod, then by temp 
```{r}
#C1
#full
CountsCompare_C1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_C1)
anova(CountsCompare_C1_mod)
qqPlot(residuals(CountsCompare_C1_mod))   # good
  emm<-emmeans(CountsCompare_C1_mod,  ~ Temp*Day, adjust="Tukey")
cld(emm)

#subset by temp
CountsCompare_C1_27<-subset(CountsCompare_C1, Temp=="27")
CountsCompare_C1_30<-subset(CountsCompare_C1, Temp=="30")
CountsCompare_C1_31<-subset(CountsCompare_C1, Temp=="31")

#27
CountsCompare_C1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_27)
anova(CountsCompare_C1_27_mod)
qqPlot(residuals(CountsCompare_C1_27_mod))   # good
  

#30
CountsCompare_C1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_30)
anova(CountsCompare_C1_30_mod)
qqPlot(residuals(CountsCompare_C1_30_mod))   # good
  emm<-emmeans(CountsCompare_C1_30_mod,  ~ single.multi*Day, adjust="Tukey")
cld(emm)

#31
CountsCompare_C1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_C1_31)
anova(CountsCompare_C1_31_mod)
qqPlot(residuals(CountsCompare_C1_31_mod))   # good
```

D1, full mod, then by temp 
```{r}
#D1
#full
CountsCompare_D1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_D1)
anova(CountsCompare_D1_mod)
qqPlot(residuals(CountsCompare_D1_mod))   # ok


#subset by temp
CountsCompare_D1_27<-subset(CountsCompare_D1, Temp=="27")
CountsCompare_D1_30<-subset(CountsCompare_D1, Temp=="30")
CountsCompare_D1_31<-subset(CountsCompare_D1, Temp=="31")

#27
CountsCompare_D1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_27)
anova(CountsCompare_D1_27_mod)
qqPlot(residuals(CountsCompare_D1_27_mod))   # good
  

#30
CountsCompare_D1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_30)
anova(CountsCompare_D1_30_mod)
qqPlot(residuals(CountsCompare_D1_30_mod))   # good

#31
CountsCompare_D1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_D1_31)
anova(CountsCompare_D1_31_mod)
qqPlot(residuals(CountsCompare_D1_31_mod))   # good
```

F1, full mod, then by temp 
```{r}
#F1
#full
CountsCompare_F1_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_F1)
anova(CountsCompare_F1_mod)
qqPlot(residuals(CountsCompare_F1_mod))   # ok


#subset by temp
CountsCompare_F1_27<-subset(CountsCompare_F1, Temp=="27")
CountsCompare_F1_30<-subset(CountsCompare_F1, Temp=="30")
CountsCompare_F1_31<-subset(CountsCompare_F1, Temp=="31")

#27
CountsCompare_F1_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_27)
anova(CountsCompare_F1_27_mod)
qqPlot(residuals(CountsCompare_F1_27_mod))   # good
  

#30
CountsCompare_F1_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_30)
anova(CountsCompare_F1_30_mod)
qqPlot(residuals(CountsCompare_F1_30_mod))   # good

#31
CountsCompare_F1_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_F1_31)
anova(CountsCompare_F1_31_mod)
qqPlot(residuals(CountsCompare_F1_31_mod))   # good
```

G3, full mod, then by temp 
```{r}
#G3
#full
CountsCompare_G3_mod<-lmer(cells.larvae_log~Temp*Day*single.multi+(1|PotCode),CountsCompare_G3)
anova(CountsCompare_G3_mod)
qqPlot(residuals(CountsCompare_G3_mod))   # ok


#subset by temp
CountsCompare_G3_27<-subset(CountsCompare_G3, Temp=="27")
CountsCompare_G3_30<-subset(CountsCompare_G3, Temp=="30")
CountsCompare_G3_31<-subset(CountsCompare_G3, Temp=="31")

#27
CountsCompare_G3_27_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_27)
anova(CountsCompare_G3_27_mod)
qqPlot(residuals(CountsCompare_G3_27_mod))   # good
  emm<-emmeans(CountsCompare_G3_27_mod,  ~ Temp*single.multi, adjust="Tukey")
cld(emm)

#30
CountsCompare_G3_30_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_30)
anova(CountsCompare_G3_30_mod)
qqPlot(residuals(CountsCompare_G3_30_mod))   # good

#31
CountsCompare_G3_31_mod<-lmer(cells.larvae_log~Day*single.multi+(1|PotCode),CountsCompare_G3_31)
anova(CountsCompare_G3_31_mod)
qqPlot(residuals(CountsCompare_G3_31_mod))   # good
  emm<-emmeans(CountsCompare_G3_31_mod,  ~ Temp*single.multi, adjust="Tukey")
cld(emm)
```



#Multi-infection data, ALL1 data (cutoff 9000)   
THIS IS THE SAME AS THE ABOVE BUT THOSE FIGURES IN MY PPT AFTER THE 'END' WITH THE SINGLE ON LEFT AND MULTI ON RIGHT. 
Expected vs observed infections, all and by clade
```{r}  
#ALL everything (this is way too big) 
Allmod<-lmer(log(cells.larvae+1)~Day*Temp*Primer+(1|Pot), ALL1)  #All.number is the larvae ID
#summary(Allmod)
anova(Allmod)

#is Pot significant
Pottest<-lm(log(cells.larvae+1)~Pot, ALL1)  #All.number is the larvae ID
summary(Pottest) #nothing is significant but the intercept. could argue not needed. 

#conduct post hoc test
#emm_Allmod = emmeans(Allmod, ~ Day * Temp * Primer, adjust="tukey")
#cld(emm_Allmod, Letters=c(LETTERS))#letter display
emmeans(Allmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run ALL by dates
#ALL Day 3 
AllDay3<-subset(ALL1, Day=="3")
AllmodDay3<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay3)  #All.number is the larvae ID
anova(AllmodDay3)
#conduct post hoc test
#emm_AllmodDay3 = emmeans(AllmodDay3, ~ Temp * Primer, adjust="tukey")
  #letter display#$cld(emm_AllmodDay3, Letters=c(LETTERS))
emmeans(AllmodDay3, pairwise ~ Temp |Primer)

#ALL Day 7
AllDay7<-subset(ALL1, Day=="7")
AllmodDay7<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay7)  #All.number is the larvae ID
anova(AllmodDay7)
#conduct post hoc test
#emm_AllmodDay7 = emmeans(AllmodDay7, ~ Temp * Primer, adjust="tukey")
  #cld(emm_AllmodDay7, Letters=c(LETTERS))
emmeans(AllmodDay7, pairwise ~ Temp |Primer)

#ALL Day 14
AllDay14<-subset(ALL1, Day=="14")
all14<-c("Temp","Primer", "ALL.number","cells.larvae")
AllDay14<-AllDay14[all14]
AllDay14<-  AllDay14[!(AllDay14$Temp=="31"),] #remove 31
AllmodDay14<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay14)  #All.number is the larvae ID
anova(AllmodDay14)
#conduct post hoc test
#emm_AllmodDay14 = emmeans(AllmodDay14, ~ Temp * Primer, adjust="tukey")
#cld(emm_AllmodDay14, Letters=c(LETTERS))
emmeans(AllmodDay14, pairwise ~ Temp |Primer)
```


Compare expected vs observed. Do this at each Time point (2-way easier to interpret)
C1
```{r}   
#copy df 
C1Full2<-C1Full 
D1Full2<-D1Full
F1Full2<-F1Full 
G3Full2<-G3Full

#single infection, add new column "single.multi"
C1Full2$single.multi<-"single"
C1Full2$single.multi<-factor(C1Full2$single.multi, levels=c("single","multi"))
C1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
C1Full3<-C1Full2[C1Full2vars]

#multi infection, add new column "single.multi"
C1ALL<-subset(ALL1, Primer=="C1") #subset Primer
C1ALL$single.multi<-"multi" #multi
C1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
C1ALLb<-C1ALL[C1ALLvars]
C1ALLb$cells.larvae_log<-log(C1ALLb$cells.larvae+1) #log
colnames(C1ALLb)[colnames(C1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
C1_EO<-rbind(C1ALLb, C1Full3) 
C1_EO$single.multi<-factor(C1_EO$single.multi, levels=c("single","multi"))
```
C1 Day 3
```{r} 
# Day 3
C1_EO.D3<-subset(C1_EO, Day=="3")
C1_EOmodD3<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D3)
anova(C1_EOmodD3)
emmeans(C1_EOmodD3, pairwise ~  single.multi|Temp)


#run by temp
#27
C1_EO.D3_27<-subset(C1_EO.D3, Temp==27)
C1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_27)
anova(C1_EO.D3_27_mod)

#30
C1_EO.D3_30<-subset(C1_EO.D3, Temp==30)
C1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_30)
anova(C1_EO.D3_30_mod)

#31
C1_EO.D3_31<-subset(C1_EO.D3, Temp==31)
C1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_31)
anova(C1_EO.D3_31_mod)

#means
C1_EO.D3mean <- ddply(C1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D3mean #display table


C1_EO.D3_plot<-ggplot(data=C1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp,shape=single.multi), size=5, show.legend = T)+
    scale_shape_manual(values=c(19,1))+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+

  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day3")+
  theme(plot.title = element_text(size=20));C1_EO.D3_plot
```

C1 Day 7 
```{r}
# Day 7
C1_EO.D7<-subset(C1_EO, Day=="7")

C1_EOmodD7<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D7)
anova(C1_EOmodD7)
emmeans(C1_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D7_27<-subset(C1_EO.D7, Temp==27)
C1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_27)
anova(C1_EO.D7_27_mod)

#30
C1_EO.D7_30<-subset(C1_EO.D7, Temp==30)
C1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_30)
anova(C1_EO.D7_30_mod)

#31
C1_EO.D7_31<-subset(C1_EO.D7, Temp==31)
C1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_31)
anova(C1_EO.D7_31_mod)

#means
C1_EO.D7mean <- ddply(C1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D7mean #display table


C1_EO.D7_plot<-ggplot(data=C1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.01,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day7")+
  theme(plot.title = element_text(size=20));C1_EO.D7_plot
```

C1 Day 14
```{r}
# Day 14
C1_EO.D14<-subset(C1_EO, Day=="14")

C1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D14)
anova(C1_EOmodD14)
emmeans(C1_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D14_27<-subset(C1_EO.D14, Temp==27)
C1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_27)
anova(C1_EO.D14_27_mod)

#30
C1_EO.D14_30<-subset(C1_EO.D14, Temp==30)
C1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_30)
anova(C1_EO.D14_30_mod)

#31
C1_EO.D14_31<-subset(C1_EO.D14, Temp==31)
C1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_31)
anova(C1_EO.D14_31_mod)






#means
C1_EO.D14mean <- ddply(C1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D14mean #display table
C1_EO.D14mean<-na.omit(C1_EO.D14mean)

C1_EO.D14_plot<-ggplot(data=C1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day14")+
  theme(plot.title = element_text(size=20));C1_EO.D14_plot

```
Plot together

```{r}

C1_EO.D3_plot<-C1_EO.D3_plot+ theme(legend.position = "none") #remove legend
C1_EO.D7_plot<-C1_EO.D7_plot+ theme(legend.position = "none") #remove legend
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D3_plot, C1_EO.D7_plot, C1_EO.D14_plot, nrow = 1)
```

D1
```{r}
#single infection, add new column "single.multi"
D1Full2$single.multi<-"single"
D1Full2$single.multi<-factor(D1Full2$single.multi, levels=c("single","multi"))
D1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
D1Full3<-D1Full2[D1Full2vars]

#multi infection, add new column "single.multi"
D1ALL<-subset(ALL1, Primer=="D1") #subset Primer
D1ALL$single.multi<-"multi" #multi
D1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
D1ALLb<-D1ALL[D1ALLvars]
D1ALLb$cells.larvae_log<-log(D1ALLb$cells.larvae+1) #log
colnames(D1ALLb)[colnames(D1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
D1_EO<-rbind(D1ALLb, D1Full3)
D1_EO$single.multi<-factor(D1_EO$single.multi, levels=c("single","multi"))
```

D1 DAY3
```{R}
# Day 3
D1_EO.D3<-subset(D1_EO, Day=="3")

D1_EOmod<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D3)
anova(D1_EOmod)
emmeans(D1_EOmod, pairwise ~ Temp |Day)

#run by temp
#27
D1_EO.D3_27<-subset(D1_EO.D3, Temp==27)
D1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_27)
anova(D1_EO.D3_27_mod)

#30
D1_EO.D3_30<-subset(D1_EO.D3, Temp==30)
D1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_30)
anova(D1_EO.D3_30_mod)

#31
D1_EO.D3_31<-subset(D1_EO.D3, Temp==31)
D1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_31)
anova(D1_EO.D3_31_mod)

#means
D1_EO.D3mean <- ddply(D1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D3mean #display table


D1_EO.D3_plot<-ggplot(data=D1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day 3")+
  theme(plot.title = element_text(size=20));D1_EO.D3_plot
```

D1 DAY7
```{R}
# Day 7
D1_EO.D7<-subset(D1_EO, Day=="7")

D1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D7)
anova(D1_EOmodD7)
emmeans(D1_EOmodD7, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D7_27<-subset(D1_EO.D7, Temp==27)
D1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_27)
anova(D1_EO.D7_27_mod)

#30
D1_EO.D7_30<-subset(D1_EO.D7, Temp==30)
D1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_30)
anova(D1_EO.D7_30_mod)

#31
D1_EO.D7_31<-subset(D1_EO.D7, Temp==31)
D1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_31)
anova(D1_EO.D7_31_mod)


#means
D1_EO.D7mean <- ddply(D1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D7mean #display table


D1_EO.D7_plot<-ggplot(data=D1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day7")+
  theme(plot.title = element_text(size=20));D1_EO.D7_plot
```

D1 DAY14
```{R}
# Day 14
D1_EO.D14<-subset(D1_EO, Day=="14")

D1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D14)
anova(D1_EOmodD14)
emmeans(D1_EOmodD14, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D14_27<-subset(D1_EO.D14, Temp==27)
D1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_27)
anova(D1_EO.D14_27_mod)

#30
D1_EO.D14_30<-subset(D1_EO.D14, Temp==30)
D1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_30)
anova(D1_EO.D14_30_mod)

#means
D1_EO.D14mean <- ddply(D1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D14mean #display table
D1_EO.D14mean<-na.omit(D1_EO.D14mean)

D1_EO.D14_plot<-ggplot(data=D1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day14")+
  theme(plot.title = element_text(size=20));D1_EO.D14_plot
```

Plot together D1

```{r}

D1_EO.D3_plot<-D1_EO.D3_plot+ theme(legend.position = "none") #remove legend
D1_EO.D7_plot<-D1_EO.D7_plot+ theme(legend.position = "none") #remove legend 
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead. 

grid.arrange(D1_EO.D3_plot, D1_EO.D7_plot, D1_EO.D14_plot, nrow = 1)
```
F1
```{r}
#single infection, add new column "single.multi"
F1Full2$single.multi<-"single"
F1Full2$single.multi<-factor(F1Full2$single.multi, levels=c("single","multi"))
F1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
F1Full3<-F1Full2[F1Full2vars]

#multi infection, add new column "single.multi"
F1ALL<-subset(ALL1, Primer=="F1") #subset Primer
F1ALL$single.multi<-"multi" #multi
F1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
F1ALLb<-F1ALL[F1ALLvars]
F1ALLb$cells.larvae_log<-log(F1ALLb$cells.larvae+1) #log
colnames(F1ALLb)[colnames(F1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
F1_EO<-rbind(F1ALLb, F1Full3)
F1_EO$single.multi<-factor(F1_EO$single.multi, levels=c("single","multi"))

```
F1 Day 3
```{r}

F1_EO.D3<-subset(F1_EO, Day=="3")

F1_EOmod<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D3)
anova(F1_EOmod)
emmeans(F1_EOmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
F1_EO.D3_27<-subset(F1_EO.D3, Temp==27)
F1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_27)
anova(F1_EO.D3_27_mod)

#30
F1_EO.D3_30<-subset(F1_EO.D3, Temp==30)
F1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_30)
anova(F1_EO.D3_30_mod)

#31
F1_EO.D3_31<-subset(F1_EO.D3, Temp==31)
F1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_31)
anova(F1_EO.D3_31_mod)


#means
F1_EO.D3mean <- ddply(F1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D3mean #display table


F1_EO.D3_plot<-ggplot(data=F1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 3")+
  theme(plot.title = element_text(size=20));F1_EO.D3_plot
```
F1 Day 7
```{r}
F1_EO.D7<-subset(F1_EO, Day=="7")

F1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D7)
anova(F1_EOmodD7)
emmeans(F1_EOmodD7, pairwise ~ Temp |single.multi)

#run by temp
#27
F1_EO.D7_27<-subset(F1_EO.D7, Temp==27)
F1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_27)
anova(F1_EO.D7_27_mod)

#30
F1_EO.D7_30<-subset(F1_EO.D7, Temp==30)
F1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_30)
anova(F1_EO.D7_30_mod)

#31
F1_EO.D7_31<-subset(F1_EO.D7, Temp==31)
F1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_31)
anova(F1_EO.D7_31_mod)

#means
F1_EO.D7mean <- ddply(F1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D7mean #display table


F1_EO.D7_plot<-ggplot(data=F1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 7")+
  theme(plot.title = element_text(size=20));F1_EO.D7_plot

```

F1 Day 14
```{r}
F1_EO.D14<-subset(F1_EO, Day=="14")

F1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D14)
anova(F1_EOmodD14)
emmeans(F1_EOmodD14, pairwise ~ single.multi|Temp)

#run by temp
#27
F1_EO.D14_27<-subset(F1_EO.D14, Temp==27)
F1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_27)
anova(F1_EO.D14_27_mod)

#30
F1_EO.D14_30<-subset(F1_EO.D14, Temp==30)
F1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_30)
anova(F1_EO.D14_30_mod)

#31
F1_EO.D14_31<-subset(F1_EO.D14, Temp==31) 
F1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_31)
anova(F1_EO.D14_31_mod) 

#means
F1_EO.D14mean <- ddply(F1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D14mean #display table
F1_EO.D14mean<-na.omit(F1_EO.D14mean)

F1_EO.D14_plot<-ggplot(data=F1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 14")+
  theme(plot.title = element_text(size=20));F1_EO.D14_plot
```
 
Plot together F1 expect-observe

```{r}

F1_EO.D3_plot<-F1_EO.D3_plot+ theme(legend.position = "none") #remove legend
F1_EO.D7_plot<-F1_EO.D7_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(F1_EO.D3_plot, F1_EO.D7_plot, F1_EO.D14_plot, nrow = 1)
```
G3
```{r} 
#single infection, add new column "single.multi"
G3Full2$single.multi<-"single"
G3Full2$single.multi<-factor(G3Full2$single.multi, levels=c("single","multi")) 
G3Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
G3Full3<-G3Full2[G3Full2vars] 

#multi infection, add new column "single.multi"
G3ALL<-subset(ALL1, Primer=="G3") #subset Primer 
G3ALL$single.multi<-"multi" #multi
G3ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
G3ALLb<-D1ALL[G3ALLvars] 
G3ALLb$cells.larvae_log<-log(G3ALLb$cells.larvae+1) #log
colnames(G3ALLb)[colnames(G3ALLb)=="Primer"] <- "Symbiont"
 
#combine the dataframes 
G3_EO<-rbind(G3ALLb, G3Full3)
G3_EO$single.multi<-factor(G3_EO$single.multi, levels=c("single","multi"))
```

G3 Day 3
```{r}
G3_EO.D3<-subset(G3_EO, Day=="3")

G3_EOmod<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D3)
anova(G3_EOmod)
emmeans(G3_EOmod, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D3_27<-subset(G3_EO.D3, Temp==27)
G3_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_27)
anova(G3_EO.D3_27_mod)

#30
G3_EO.D3_30<-subset(G3_EO.D3, Temp==30)
G3_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_30)
anova(G3_EO.D3_30_mod)

#31
G3_EO.D3_31<-subset(G3_EO.D3, Temp==31)
G3_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_31)
anova(G3_EO.D3_31_mod)

#means
G3_EO.D3mean <- ddply(G3_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D3mean #display table


G3_EO.D3_plot<-ggplot(data=G3_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 3")+
  theme(plot.title = element_text(size=20));G3_EO.D3_plot
```

G3 Day 7
```{r}
G3_EO.D7<-subset(G3_EO, Day=="7")

G3_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D7)
anova(G3_EOmodD7)
emmeans(G3_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D7_27<-subset(G3_EO.D7, Temp==27)
G3_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_27)
anova(G3_EO.D7_27_mod)

#30
G3_EO.D7_30<-subset(G3_EO.D7, Temp==30)
G3_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_30)
anova(G3_EO.D7_30_mod)

#31
G3_EO.D7_31<-subset(G3_EO.D7, Temp==31)
G3_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_31)
anova(G3_EO.D7_31_mod)

#means
G3_EO.D7mean <- ddply(G3_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D7mean #display table


G3_EO.D7_plot<-ggplot(data=G3_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 7")+
  theme(plot.title = element_text(size=20));G3_EO.D7_plot
```

G3 Day 14
```{r}
G3_EO.D14<-subset(G3_EO, Day=="14")

G3_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), G3_EO.D14)
anova(G3_EOmodD14)
emmeans(G3_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D14_27<-subset(G3_EO.D14, Temp==27)
G3_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_27)
anova(G3_EO.D14_27_mod)

#30
G3_EO.D14_30<-subset(G3_EO.D14, Temp==30)
G3_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_30)
anova(G3_EO.D14_30_mod)



#means
G3_EO.D14mean <- ddply(G3_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D14mean #display table
G3_EO.D14mean<-na.omit(G3_EO.D14mean)

G3_EO.D14_plot<-ggplot(data=G3_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 14")+
  theme(plot.title = element_text(size=20));G3_EO.D14_plot
```

Plot together G3 expect-observe

```{r}

G3_EO.D3_plot<-G3_EO.D3_plot+ theme(legend.position = "none") #remove legend
G3_EO.D7_plot<-G3_EO.D7_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(G3_EO.D3_plot, G3_EO.D7_plot, G3_EO.D14_plot, nrow = 1)
```

Plot all Day 14
```{r}
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D14_plot, D1_EO.D14_plot, F1_EO.D14_plot,G3_EO.D14_plot , nrow = 1)
```


## NMDS for multi infection
Counts
use this df: "ALLcast_9000_cast2b" Relabund (use ALLcast_9000_cast2a for raw counts)
THis is ugly
```{r}
#make a df with just abundance
library(vegan)

ALLcast_abund<-ALLcast_9000_cast2b
ALLcast_abund<-na.omit(ALLcast_abund) #get rid of NAs
ALLcast_abund<-ALLcast_abund[-c(8, 18, 34,54,94,101), ] #you need to remove rows with no data (all 0s)
ALLcast_abund_b<-ALLcast_abund[-c(1:8)] #remove metadata

#write.csv(ALLcast_abund, "nmdsData_RawCounts_20200117.csv")

#NMDS
set.seed(2)

ALLdata.nmds <- metaMDS(comm = ALLcast_abund_b, distance = "bray")
plot(ALLdata.nmds$points) 
ALLdata.nmds$stress #0.1326 fuck yeah

ALLdata.nmds_xy <- data.frame(ALLdata.nmds$points)

ALLdata.nmds_xy$Temp <- ALLcast_abund$Temp #add metadata back in
ALLdata.nmds_xy$Day <- ALLcast_abund$Day

#by Day
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#by Temp
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Temp)) + geom_point() + theme_bw()

## testing plots
#combine day and temp
ALLdata.nmds_xy$code<-paste0(ALLdata.nmds_xy$Temp, ALLdata.nmds_xy$Day)

ggplot() + 
  #geom_polygon(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,fill=code,group=code),alpha=0.30) + # add the convex hulls
  geom_point(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,shape=Day,colour=Temp),size=4) + # add the point markers
  coord_equal() +
  theme_bw() + 
  theme(axis.text.x = element_blank(),  # remove x-axis text
        axis.text.y = element_blank(), # remove y-axis text
        axis.ticks = element_blank(),  # remove axis ticks
        axis.title.x = element_text(size=18), # remove x-axis labels
        axis.title.y = element_text(size=18), # remove y-axis labels
        panel.background = element_blank(), 
        panel.grid.major = element_blank(),  #remove major-grid labels
        panel.grid.minor = element_blank(),  #remove minor-grid labels
        plot.background = element_blank())

#This is all the data with ellipses. hard to read but nice to have. 
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color=code))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()


```

nmds by temp 
```{r}
##### subset by Temp
#27C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp27<-ALLcast_9000_cast2b
ALLcast_abund_Temp27<-subset(ALLcast_abund_Temp27, Temp=="27")
ALLcast_abund_Temp27<-na.omit(ALLcast_abund_Temp27) #get rid of NAs
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="105"),]
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="106"),]

ALLcast_abund_Temp27_b<-ALLcast_abund_Temp27[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp27.nmds <- metaMDS(comm = ALLcast_abund_Temp27_b, distance = "bray")
plot(ALLdata_Temp27.nmds$points) 
ALLdata_Temp27.nmds$stress #.139

ALLdata_Temp27.nmds_xy <- data.frame(ALLdata_Temp27.nmds$points)

ALLdata_Temp27.nmds_xy$Day <- ALLcast_abund_Temp27$Day


ALLdata_Temp27.nmds_xy$code<-paste0(ALLdata_Temp27.nmds_xy$Temp, ALLdata_Temp27.nmds_xy$Day)

temp27nmds<-ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color=Day))+   
  scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Raw counts: Temp 27C");temp27nmds


#by temp 30
ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


#30C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp30<-ALLcast_9000_cast2b
ALLcast_abund_Temp30<-subset(ALLcast_abund_Temp30, Temp=="30")
ALLcast_abund_Temp30<-na.omit(ALLcast_abund_Temp30) #get rid of NAs
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="156"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="195"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="200"),]

ALLcast_abund_Temp30_b<-ALLcast_abund_Temp30[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp30.nmds <- metaMDS(comm = ALLcast_abund_Temp30_b, distance = "bray")
plot(ALLdata_Temp30.nmds$points) 
ALLdata_Temp30.nmds$stress #.123

ALLdata_Temp30.nmds_xy <- data.frame(ALLdata_Temp30.nmds$points)

ALLdata_Temp30.nmds_xy$Day <- ALLcast_abund_Temp30$Day


temp30nmds<-ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color=Day))+
    scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Temp 30C");temp30nmds





#by TEMP
ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#31C
#sample 106, C1 counts is 3100+ way high, likely error, check

ALLcast_abund_Temp31<-ALLcast_9000_cast2b
ALLcast_abund_Temp31<-subset(ALLcast_abund_Temp31, Temp=="31")
ALLcast_abund_Temp31<-na.omit(ALLcast_abund_Temp31) #get rid of NAs
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="115"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="134"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="218"),]

ALLcast_abund_Temp31_b<-ALLcast_abund_Temp31[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp31.nmds <- metaMDS(comm = ALLcast_abund_Temp31_b, distance = "bray")
plot(ALLdata_Temp31.nmds$points) 
ALLdata_Temp31.nmds$stress #.114

ALLdata_Temp31.nmds_xy <- data.frame(ALLdata_Temp31.nmds$points)

ALLdata_Temp31.nmds_xy$Day <- ALLcast_abund_Temp31$Day

temp31nmds<-ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color=Day))+
  scale_colour_manual(values = c("Orange", "Blue"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
    ggtitle("Temp 31C");temp31nmds


#plot all together
grid.arrange(temp27nmds, temp30nmds, temp31nmds, nrow = 1)

```

NMDS BY DAY 
```{R}

#by Day 3
ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


### by day

ALLcast_abund_Day3<-ALLcast_9000_cast2b
ALLcast_abund_Day3<-subset(ALLcast_abund_Day3, Day=="3")
ALLcast_abund_Day3<-na.omit(ALLcast_abund_Day3) #get rid of NAs
ALLcast_abund_Day3<-  ALLcast_abund_Day3[!(ALLcast_abund_Day3$ALL.number=="134"),]

ALLcast_abund_Day3_b<-ALLcast_abund_Day3[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Day3.nmds <- metaMDS(comm = ALLcast_abund_Day3_b, distance = "bray")
plot(ALLdata_Day3.nmds$points) 
ALLdata_Day3.nmds$stress #.131

ALLdata_Day3.nmds_xy <- data.frame(ALLdata_Day3.nmds$points)

ALLdata_Day3.nmds_xy$Temp <- ALLcast_abund_Day3$Temp

Day3_nmds<-ggplot(ALLdata_Day3.nmds_xy, aes(MDS1, MDS2, color=Temp))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  ggtitle("Day 3");Day3_nmds


#day7  NOT RUNNING....
ALLcast_abund_Day7<-ALLcast_9000_cast2b

ALLcast_abund_Day7<-subset(ALLcast_abund_Day7, Day=="7")
ALLcast_abund_Day7<-na.omit(ALLcast_abund_Day7) #get rid of NAs
ALLcast_abund_Day7<-  ALLcast_abund_Day7[!(ALLcast_abund_Day7$ALL.number=="134"),]

ALLcast_abund_Day7_b<-ALLcast_abund_Day7[-c(1:4)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Day7.nmds <- metaMDS(comm = ALLcast_abund_Day7_b, distance = "bray")
plot(ALLdata_Day7.nmds$points) 
ALLdata_Day7.nmds$stress #

ALLdata_Day7.nmds_xy <- data.frame(ALLdata_Day7.nmds$points)

ALLdata_Day7.nmds_xy$Temp <- ALLcast_abund_Day7$Temp

Day7_nmds<-ggplot(ALLdata_Day7.nmds_xy, aes(MDS1, MDS2, color=Temp))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  ggtitle("Day 7");Day7_nmds

```




#Let's try a heatmap
by temp on day 3
relabundance data
```{r}
#day 3

heat_relabund_D3<-ALL_RelA_a
heat_relabund_D3<-subset(heat_relabund_D3, Day==3)
heat_relabund_D3$code<-paste0(heat_relabund_D3$Temp, "_",heat_relabund_D3$ALL.number) #code
row.names(heat_relabund_D3)<-heat_relabund_D3$code

#order by temp
heat_relabund_D3_b <- heat_relabund_D3[order(heat_relabund_D3$Temp),]
heat_relabund_D3_b<-heat_relabund_D3_b[-c(1:3, 9)] #remove metadata

#make matrix
heat_relabund_D3_b_matrix <- data.matrix(heat_relabund_D3_b)

library(RColorBrewer)
#make heatmap
heat_relabund_D3_b_heatmap <- heatmap(heat_relabund_D3_b_matrix, col = cm.colors(200),main="heatmap Day 3")


#day 7

heat_relabund_D7<-ALL_RelA_a
heat_relabund_D7<-subset(heat_relabund_D7, Day==7)
heat_relabund_D7$code<-paste0(heat_relabund_D7$Temp, "_",heat_relabund_D7$ALL.number) #code
row.names(heat_relabund_D7)<-heat_relabund_D7$code

#order by temp
heat_relabund_D7_b <- heat_relabund_D7[order(heat_relabund_D7$Temp),]
heat_relabund_D7_b<-heat_relabund_D7_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_D7_b_matrix <- data.matrix(heat_relabund_D7_b)

#make heatmap
heat_relabund_D7_b_heatmap <- heatmap(heat_relabund_D7_b_matrix, col = cm.colors(200),main="heatmap Day 7")

#day 14

heat_relabund_D14<-ALL_RelA_a
heat_relabund_D14<-subset(heat_relabund_D14, Day==14)
heat_relabund_D14$code<-paste0(heat_relabund_D14$Temp, "_",heat_relabund_D14$ALL.number) #code
row.names(heat_relabund_D14)<-heat_relabund_D14$code

#order by temp
heat_relabund_D14_b <- heat_relabund_D14[order(heat_relabund_D14$Temp),]
heat_relabund_D14_b<-heat_relabund_D14_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_D14_b_matrix <- data.matrix(heat_relabund_D14_b)

#make heatmap
heat_relabund_D14_b_heatmap <- heatmap(heat_relabund_D14_b_matrix, col = cm.colors(200),main="heatmap Day 14")
```

heatmaps by temp
```{r}
#27c

heat_relabund_27<-ALL_RelA_a
heat_relabund_27<-subset(heat_relabund_27, Temp==27)
heat_relabund_27$code<-paste0(heat_relabund_27$Day, "_",heat_relabund_27$ALL.number) #code
row.names(heat_relabund_27)<-heat_relabund_27$code

#order by temp
heat_relabund_27_b <- heat_relabund_27[order(heat_relabund_27$Day),]
heat_relabund_27_b<-heat_relabund_27_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_27_b_matrix <- data.matrix(heat_relabund_27_b)

#make heatmap
heat_relabund_27_b_heatmap <- heatmap(heat_relabund_27_b_matrix, col = cm.colors(200),main="heatmap 27C")


#30C

heat_relabund_30<-ALL_RelA_a
heat_relabund_30<-subset(heat_relabund_30, Temp==30)
heat_relabund_30$code<-paste0(heat_relabund_30$Day, "_",heat_relabund_30$ALL.number) #code
row.names(heat_relabund_30)<-heat_relabund_30$code

#order by temp
heat_relabund_30_b <- heat_relabund_30[order(heat_relabund_30$Day),]
heat_relabund_30_b<-heat_relabund_30_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_30_b_matrix <- data.matrix(heat_relabund_30_b)

#make heatmap
heat_relabund_30_b_heatmap <- heatmap(heat_relabund_30_b_matrix, col = cm.colors(200),main="heatmap 30C")

#31C

heat_relabund_31<-ALL_RelA_a
heat_relabund_31<-subset(heat_relabund_31, Temp==31)
heat_relabund_31$code<-paste0(heat_relabund_31$Day, "_",heat_relabund_31$ALL.number) #code
row.names(heat_relabund_31)<-heat_relabund_31$code

#order by temp
heat_relabund_31_b <- heat_relabund_31[order(heat_relabund_31$Day),]
heat_relabund_31_b<-heat_relabund_31_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_31_b_matrix <- data.matrix(heat_relabund_31_b)

#make heatmap
heat_relabund_31_b_heatmap <- heatmap(heat_relabund_31_b_matrix, col = cm.colors(200),main="heatmap 31C")
```





