---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "12/7/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---
This is data from the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 
Data: ddPCR 

Recent updates to the script: 12.19.2019 - Using Full dataset (counts and ddPCR at 9000 cutoff for now. Code for checking against 8000 and ddPCR vs dPCR+counts below.)

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")

#knitr::opts_knit$set(root.dir = normalizePath("~/Desktop/Symb_choice/Symbiont Choice 2018"))
```

```{r}
rm(list=ls()) # Clear workspace
```
## Background

Authors: SB Matsuda, L Chakravarti, JR Cunning, M van Oppen, RD Gates
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. 

```{r}
# Set up workspace 

library(plyr)
library(dplyr)
library(ggplot2)
library("gridExtra") #arrange plots for output
library(reshape2)
library("ggsci")#set bar colors
library("qqplotr")
library(blmeco)
library("plotrix") #functions in tapply
library("pscl")
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("coefplot") #coefficient plotting
library("seacarb") #seawater carbonate chemistry
library("vegan") #calculating distance matrices
library(pscl) 
library(boot)
library(betareg)
library(coin)
library(exactRankTests)
library(mvtnorm)
library(DTK)
library(PMCMR)
library(MuMIn)
library(glmmTMB)
library(lme4)
library(lmerTest)
library(ggsignif)
library(HH)
library(PMCMR)
library(tidyverse)
library(arm)
library(jtools)
library(broom)
library(ggstance)
library(officer)
library(huxtable)
library(flextable)
```

Setup data: Hemocytometer and scope counts
```{r} 
####Load in hemocytometer counts and fluorescent scope counts: 
Day3Counts<-read.csv("SC18_cellcounts_day3.csv")
Day7Counts<-read.csv("SC18_cellcounts_day7.csv")
Day14Counts<-read.csv("SC18_cellcounts_day14.csv")

#day3
colnames(Day3Counts)[colnames(Day3Counts)=="Count"] <- "cells.larvae"

#remove cols you don't need Day 7
d7vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day7Counts<-Day7Counts[d7vars]
colnames(Day7Counts)[colnames(Day7Counts)=="Cells.per.larva"] <- "cells.larvae"
Day7Counts<-na.omit(Day7Counts)

#remove cols you don't need Day 14
d14vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day14Counts<-Day14Counts[d14vars]
colnames(Day14Counts)[colnames(Day14Counts)=="Cells.per.larva"] <- "cells.larvae"
Day14Counts<-na.omit(Day14Counts)

#combine days:
Countdat<-rbind(Day3Counts, Day7Counts, Day14Counts)
Countdat1<-Countdat[!(Countdat$Symbiont=="ALL"),] #remove ALLs
Countdat1<-Countdat1[!(Countdat1$Symbiont=="CONTROL"),] #remove controls
Countdat1$Temp<-as.factor(Countdat1$Temp)
Countdat1$cells.larvae<-as.numeric(Countdat1$cells.larvae)

```
#Load in ddPCR data with Threshold set in QuantaSoft Analysis
```{r}
#Read in ddPCR plate data  
Plate1<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE1_20190424_threshold.csv")
Plate2<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE2_20190429_threshold.csv")
Plate3<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3_20190426_threshold.csv")
Plate3B<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3B_20190426_threshold.csv")
Plate3 <- rbind(Plate3,Plate3B) # merge plate 3 and 3b for metadata
Plate4<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE4_20190427_threshold.csv")
Plate5<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE5_20190428_threshold.csv")
Plate6<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE6_20190428_threshold.csv")
Plate7<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE7_20190429_threshold.csv")
Plate8<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE8_20190501_threshold.csv")
Plate9<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE9_20190501_threshold.csv")
Plate10<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE10_20190501_threshold.csv")
Plate11<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE11_20190502_threshold.csv")
Plate12<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE12_20190502_threshold.csv")
Plate13<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE13_20190503_threshold.csv")
Plate14<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE14_20190503_threshold.csv")
Plate15<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE15_20190507_threshold.csv")
Plate16<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE16_20190508_threshold.csv")
Plate17<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE17_20190509_threshold.csv")
Plate18<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE18_20190509_threshold.csv")
Plate19<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE19_20190509_threshold.csv")
Plate20<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE20_20190510_threshold.csv")

# read in metadata by plate (some samples are duplicate names, which is why)
meta1 <-read.csv("ddPCR_thresholdData/Plate1_meta.csv")
meta2 <-read.csv("ddPCR_thresholdData/Plate2_meta.csv")
meta3 <-read.csv("ddPCR_thresholdData/Plate3_meta.csv")
meta4 <-read.csv("ddPCR_thresholdData/Plate4_meta.csv")
meta5 <-read.csv("ddPCR_thresholdData/Plate5_meta.csv")
meta6 <-read.csv("ddPCR_thresholdData/Plate6_meta.csv")
meta7 <-read.csv("ddPCR_thresholdData/Plate7_meta.csv")
meta8 <-read.csv("ddPCR_thresholdData/Plate8_meta.csv")
meta9 <-read.csv("ddPCR_thresholdData/Plate9_meta.csv")
meta10 <-read.csv("ddPCR_thresholdData/Plate10_meta.csv")
meta11 <-read.csv("ddPCR_thresholdData/Plate11_meta.csv")
meta12 <-read.csv("ddPCR_thresholdData/Plate12_meta.csv")
meta13 <-read.csv("ddPCR_thresholdData/Plate13_meta.csv")
meta14 <-read.csv("ddPCR_thresholdData/Plate14_meta.csv")
meta15 <-read.csv("ddPCR_thresholdData/Plate15_meta.csv")
meta16 <-read.csv("ddPCR_thresholdData/Plate16_meta.csv")
meta17 <-read.csv("ddPCR_thresholdData/Plate17_meta.csv")
meta18 <-read.csv("ddPCR_thresholdData/Plate18_meta.csv")
meta19 <-read.csv("ddPCR_thresholdData/Plate19_meta.csv")
meta20 <-read.csv("ddPCR_thresholdData/Plate20_meta.csv")

# merge each plates meta with plate
P1<-merge(Plate1, meta1, by="Well")
P2<-merge(Plate2, meta2, by="Well")
P3<-merge(Plate3, meta3, by="Well")
P4<-merge(Plate4, meta4, by="Well")
P5<-merge(Plate5, meta5, by="Well")
P6<-merge(Plate6, meta6, by="Well")
P7<-merge(Plate7, meta7, by="Well")
P8<-merge(Plate8, meta8, by="Well")
P9<-merge(Plate9, meta9, by="Well")
P10<-merge(Plate10, meta10, by="Well")
P11<-merge(Plate11, meta11, by="Well")
P12<-merge(Plate12, meta12, by="Well")
P13<-merge(Plate13, meta13, by="Well")
P14<-merge(Plate14, meta14, by="Well")
P15<-merge(Plate15, meta15, by="Well")
P16<-merge(Plate16, meta16, by="Well")
P17<-merge(Plate17, meta17, by="Well")
P18<-merge(Plate18, meta18, by="Well")
P19<-merge(Plate19, meta19, by="Well")
P20<-merge(Plate20, meta20, by="Well")


#Remove samples that I re-ddPCRd due to low droplet count that now have higher counts (remove olds by plate/well)

# Plate 5
    P5<-P5[!(P5$Well=="B06"),]
    P5<-P5[!(P5$Well=="B09"),]
    P5<-P5[!(P5$Well=="B11"),]
    P5<-P5[!(P5$Well=="C06"),]
    P5<-P5[!(P5$Well=="C09"),]
    P5<-P5[!(P5$Well=="C12"),]
    P5<-P5[!(P5$Well=="D06"),]
    P5<-P5[!(P5$Well=="D10"),]
    P5<-P5[!(P5$Well=="D12"),]
    P5<-P5[!(P5$Well=="H03"),]
    P5<-P5[!(P5$Well=="H04"),]
        P5<-P5[!(P5$Well=="B12"),]#18G

# PLATE 6
    P6<-P6[!(P6$Well=="C12"),]
# PLATE 8
    P8<-P8[!(P8$Well=="A02"),]
    P8<-P8[!(P8$Well=="A04"),]
    P8<-P8[!(P8$Well=="A11"),]
    P8<-P8[!(P8$Well=="A12"),]
    P8<-P8[!(P8$Well=="B02"),]
    P8<-P8[!(P8$Well=="B04"),]
    P8<-P8[!(P8$Well=="B12"),]
    P8<-P8[!(P8$Well=="C02"),]
    P8<-P8[!(P8$Well=="C04"),]
    P8<-P8[!(P8$Well=="C12"),]
    P8<-P8[!(P8$Well=="E04"),]
    P8<-P8[!(P8$Well=="G04"),]
    P8<-P8[!(P8$Well=="G05"),]
    P8<-P8[!(P8$Well=="H04"),]
        P8<-P8[!(P8$Well=="F06"),]#61C
        P8<-P8[!(P8$Well=="C11"),]#66D

# PLATE 9
    P9<-P9[!(P9$Well=="B11"),]
    P9<-P9[!(P9$Well=="C10"),]
    P9<-P9[!(P9$Well=="C11"),]
    P9<-P9[!(P9$Well=="E02"),]
    P9<-P9[!(P9$Well=="E10"),]
    P9<-P9[!(P9$Well=="F04"),]
    P9<-P9[!(P9$Well=="F06"),]
    P9<-P9[!(P9$Well=="G02"),]
    P9<-P9[!(P9$Well=="H03"),]
          P9<-P9[!(P9$Well=="B12"),] ##88D

# PLATE 10
    P10<-P10[!(P10$Well=="C01"),]
    P10<-P10[!(P10$Well=="C07"),]
    P10<-P10[!(P10$Well=="C12"),]
    P10<-P10[!(P10$Well=="D10"),]
    P10<-P10[!(P10$Well=="E05"),]
    P10<-P10[!(P10$Well=="H05"),]
        P10<-P10[!(P10$Well=="E06"),] #106C
        P10<-P10[!(P10$Well=="C10"),] #112F
        P10<-P10[!(P10$Well=="G04"),] #100G


#PLATE 12
    P12<-P12[!(P12$Well=="A09"),]
    P12<-P12[!(P12$Well=="E05"),]
        P12<-P12[!(P12$Well=="E04"),]#95C
        P12<-P12[!(P12$Well=="G05"),]#41G

#PLATE 13
    P13<-P13[!(P13$Well=="A09"),]
    P13<-P13[!(P13$Well=="A12"),]
    P13<-P13[!(P13$Well=="B12"),]
    P13<-P13[!(P13$Well=="C10"),]
    P13<-P13[!(P13$Well=="D10"),]
    P13<-P13[!(P13$Well=="D11"),]
    P13<-P13[!(P13$Well=="E10"),]
    P13<-P13[!(P13$Well=="F05"),]
    P13<-P13[!(P13$Well=="F06"),]
    P13<-P13[!(P13$Well=="A07"),]
    P13<-P13[!(P13$Well=="C12"),]
         P13<-P13[!(P13$Well=="G04"),]#147F

#PLATE 14
    P14<-P14[!(P14$Well=="A09"),]
    P14<-P14[!(P14$Well=="A12"),]
    P14<-P14[!(P14$Well=="B09"),]
        P14<-P14[!(P14$Well=="C03"),] #F1 issue
        P14<-P14[!(P14$Well=="E03"),] #F1 issue
        P14<-P14[!(P14$Well=="B10"),] #165D


#PLATE 15
    P15<-P15[!(P15$Well=="C10"),]
    P15<-P15[!(P15$Well=="D10"),]
    P15<-P15[!(P15$Well=="G03"),]
#PLATE 16
    P16<-P16[!(P16$Well=="D05"),]
    P16<-P16[!(P16$Well=="F04"),]
    P16<-P16[!(P16$Well=="F05"),]
#PLATE 17
    P17<-P17[!(P17$Well=="D09"),]
    P17<-P17[!(P17$Well=="E09"),]
        P17<-P17[!(P17$Well=="H02"),]#178D
        P17<-P17[!(P17$Well=="C09"),]#189F

#PLATE 18
    P18<-P18[!(P18$Well=="E09"),]
    P18<-P18[!(P18$Well=="F04"),]
    P18<-P18[!(P18$Well=="H04"),]
        P18<-P18[!(P18$Well=="G05"),]#205C
        P18<-P18[!(P18$Well=="G04"),]#197G

#PLATE 19
    P19<-P19[!(P19$Well=="C08"),]



#merge all plates
dData1 <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20)

 write.csv(dData1, "dData1TEST.csv")
#only keep columns you need (Sample, Target, Conc(copies/µL), Copies/20ulWell, Accepted Droplets, Positives, Negatives, Threshold1, metadata)

dData<-dData1[,c(1,2:4,11,16:18,31,66 ,68:79)]
dData$Conc.copies.µL.<-as.numeric(dData$Conc.copies.µL.)
dData$Temp<-as.factor(dData$Temp)
dData$Temp<-factor(dData$Temp, levels=c("27","30","31"))
dData$Day<-as.factor(dData$Day)
dData$Day<-factor(dData$Day, levels=c("3","7","14"))
dData$Pot<-as.factor(dData$Pot)
```


#false positives 
```{r} 

#subset only FalsePositives
FalsePos<-subset(dData, Info=="CONTROL")
#write.csv(FalsePos, "FalsePos.csv")

FalsePos1<-FalsePos #make copy

#divide into each clade

FP_C1<-subset(FalsePos1, Primer=="C1") #n=61, 56 with <9000 rm
FP_D1<-subset(FalsePos1, Primer=="D1") #n=70, 62 with <9000 rm
FP_F1<-subset(FalsePos1, Primer=="F1") #n=56, 52 with <9000 rm
FP_G3<-subset(FalsePos1, Primer=="G3") #n=70, 66 with <9000 rm

# remove any less than 9000

FP_C1<-subset(FP_C1, Accepted.Droplets>9000)
FP_D1<-subset(FP_D1, Accepted.Droplets>9000)
FP_F1<-subset(FP_F1, Accepted.Droplets>9000)
FP_G3<-subset(FP_G3, Accepted.Droplets>9000)

#C1
sum(FP_C1$Positives) # 15 positives per 56 wells
15/56 # .268 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#D1
sum(FP_D1$Positives) # 16 positives per 62 wells
16/62# .258 -> .3 events per well, Threshold = 3 for 99% confidence level-> LOD 7 (95%) or 9 (99%), Threshold=2 for 95% conf -> LOD 5 (95%), 7 (99%) 

#F1
sum(FP_F1$Positives) # 24 positives per 52 wells
24/52 # .462 -> .5 events per well, Threshold = 3 for 95% confidence -> LOD 7 (95%) or 9 (99%), Threshold = 4 (99%) -> LOD 8(95%) 11 (99%)

#G3
sum(FP_G3$Positives) # 60 positives per 70 wells
60/70 # .857 -> .9 events per well, Threshold = 4 (95%) -> LOD 8(95%), 11 (99%), Threshold =5 (99%) -> LOD 10 (99%) 12 (99%)
```

Droplet cutoff, false pos rate, copy number, cells/larvae calc
```{r}  

# 9000 cutoff - if total droplets are below 9000 remove samples 

dData1<-subset(dData, Accepted.Droplets>9000)# remove samples with less than 9000 droplets (we lose 44 ddpcr samples)


#subset by primer to then account for false positives by primer
C1_9000_fp<-subset(dData1, Primer=="C1")
D1_9000_fp<-subset(dData1, Primer=="D1")
F1_9000_fp<-subset(dData1, Primer=="F1")
G3_9000_fp<-subset(dData1, Primer=="G3")

#False pos, if Pos dropletes not above threshold, change to 0 positives. Use 95% LOD (limit of detection)
C1_9000_fp$Positives[C1_9000$Positives<5] <- 0   # 5 
D1_9000_fp$Positives[D1_9000$Positives<5] <- 0   # 5
F1_9000_fp$Positives[F1_9000$Positives<7] <- 0   #7
G3_9000_fp$Positives[G3_9000$Positives<8] <- 0   # 8

dData2<-rbind(C1_9000_fp,D1_9000_fp,F1_9000_fp,G3_9000_fp )

# use copies/1ul pcr to calculate how many copies are in 1 larvae. 
#(copies/1ul PCR)*(25ul PCR/y ul.DNA added)*(20uLDNA/1 larvae)
dData2$copies.larvae<-(dData2$Conc.copies.µL.)*(25/dData2$ul.DNA)*20

# divide copies by copy number per clade (CALC IN EXCEL, QCd)
dData2$copyNum[dData2$Primer=="C1"]<-2
dData2$copyNum[dData2$Primer=="D1"]<-1
dData2$copyNum[dData2$Primer=="F1"]<-3
dData2$copyNum[dData2$Primer=="G3"]<-19

# calc number of Sym cells in larvae
dData2$cells.larvae<-dData2$copies.larvae/dData2$copyNum
  dData2<-dData2[!(dData2$Info=="NTC"),]

#subset Samples
sData<-subset(dData2, Info=="ALL"|Info=="C1"|Info=="D1"|Info=="F1"|Info=="G3")
#write.csv(sData, "sData20191221.csv")
```


# Subset for each ddPCR Infection trial (C1, D1, F1, G3, ALL)
```{r}  
#subset by infection (singles and multi)
C1_9000<-subset(sData, Info=="C1")
D1_9000<-subset(sData, Info=="D1")
F1_9000<-subset(sData, Info=="F1")
G3_9000<-subset(sData, Info=="G3")
ALL_9000<-subset(sData, Info=="ALL")
# for the Alls, cast for Primer
# remove unneeded columns
ALL_9000a<-ALL_9000[,c("ALL.number","Primer","cells.larvae","Day","Temp","Pot")]
#write.csv(ALL_9000a, "ALL_9000a.csv")

#cast by primers - do this to see which larvae not all primers amplified and cut them for Relative Abund df
 ALLcast_9000_cast<-dcast(ALL_9000a, ALL.number~Primer, value.var = "cells.larvae") # cast()
 
### For Relative Abundance, remove larvae without amplification in all 4 symbiont genera: 
 
 # Remove rest of primers/larvae of missing ones (n=21 larvae)
  ALL_9000b<-ALL_9000a[!(ALL_9000a$ALL.number=="136"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="135"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="236"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="227"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="111"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="120"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="137"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="204"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="30"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="188"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="130"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="138"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="231"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="125"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="187"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="209"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="122"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="208"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="232"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="233"),]
  ALL_9000b<-ALL_9000b[!(ALL_9000b$ALL.number=="177"),]
```

Raw and relative abundance data frames for Multi-infection
```{r}
# Raw df
 ALLcast_9000_cast2a<-dcast(ALL_9000a, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()

 # Relative Abundance df
  ALLcast_9000_cast2b<-dcast(ALL_9000b, ALL.number+Temp+Day+Pot~Primer, value.var = "cells.larvae") # cast()
```


# Combine ddPCR with the hemocytometer/count data from each time point for "Full" dataset for INDIVIDUAL INFECTIONS 
Organize data  

oragnize, scope + hemo data
```{r}
# create count.type for hemo and scope  
Countdat_D3<-subset(Countdat1, Day=="3") #subset day 3, scope counts, individuals
Countdat_D3$count.type<-"scope"
Countdat_D714<-subset(Countdat1, Day=="7"|Day=="14") #subset days 7 and 14, hemo counts
Countdat_D714$count.type<-"hemo"
 
Countdat_2<-rbind(Countdat_D3,Countdat_D714) #bind together for non-ddPCR dataset 
```

#####Stats and plots: ddPCR vs hemo + scope, prove not different 

```{r} 
#C1 
#organize the ddPCR data for individual infections  
C1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
C1_9000b<-C1_9000[C1_vars]
colnames(C1_9000b)[colnames(C1_9000b)=="Info"] <- "Symbiont"
C1_9000b$count.type<-"ddPCR"
summary(C1_9000b$cells.larvae)

hist(C1_9000b$cells.larvae) #not normal
C1_9000b$cells.larvae_log<-log(C1_9000b$cells.larvae+1)
  hist(C1_9000b$cells.larvae_log) #more normal but not great
  
#  C1_9000b$cells.larvae_sqrt<-sqrt(C1_9000b$cells.larvae) #sqrt not great
#hist(C1_9000b$cells.larvae_sqrt)

#C1_9000b$cells.larvae_1oX<-1/(C1_9000b$cells.larvae) #1/x not great
#hist(C1_9000b$cells.larvae_1oX)

#C1_9000b$cells.larvae_x2<-(C1_9000b$cells.larvae+1)^8 #x^2 not great
#hist(C1_9000b$cells.larvae_x2)


#organize hemo data
C1countdat<-subset(Countdat_2, Symbiont=="C1")
hist(C1countdat$cells.larvae)

C1countdat$cells.larvae_log<-log(C1countdat$cells.larvae+1)
hist(C1countdat$cells.larvae_log)

C1Full<-rbind(C1_9000b,C1countdat) #combine hemo and ddPCR
hist(C1Full$cells.larvae_log)

#ggplot(C1Full, aes(cells.larvae)) + geom_histogram() + scale_x_log10()
#this cuts the 0s. 


#Raw means
C1Full_mean<- ddply(C1Full, c("Day", "Temp","count.type","Symbiont","Pot"), summarise, #summarize cell counts
                 N    = length(cells.larvae_log[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
);C1Full_mean #display table

# Remove rows with <3 replicates (one r=1)
C1Full_mean<-C1Full_mean[!(C1Full_mean$N==1),]

C1vars2<-c("Day", "Temp","count.type", "mean","Symbiont","Pot")
C1Full_means2<-C1Full_mean[C1vars2]

#Day 3 scope vs ddpcr
C1Full_means3<-subset(C1Full_means2, Day=="3")
C1Full_means3<-dcast(C1Full_means3, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()

#Day 7 and 14 scope vs ddpcr
C1Full_means4<-subset(C1Full_means2, Day=="7"|Day=="14")
C1Full_means4<-dcast(C1Full_means4, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()



#D1 
#organize the ddPCR data 
D1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
D1_9000b<-D1_9000[D1_vars]
colnames(D1_9000b)[colnames(D1_9000b)=="Info"] <- "Symbiont"
D1_9000b$count.type<-"ddPCR"
hist(D1_9000b$cells.larvae)
D1_9000b$cells.larvae_log<-log(D1_9000b$cells.larvae+1)
  hist(D1_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
D1countdat<-subset(Countdat_2, Symbiont=="D1")
D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR

D1countdat$cells.larvae_log<-log(D1countdat$cells.larvae+1)
hist(D1countdat$cells.larvae_log)

D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR
hist(D1Full$cells.larvae_log)

#Raw means
D1Full_mean<- ddply(D1Full, c("Day", "Temp","count.type","Symbiont","Pot"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
);D1Full_mean #display table

D1vars2<-c("Day", "Temp","count.type", "mean","Symbiont","Pot")
D1Full_means2<-D1Full_mean[D1vars2]

#Day 3 scope vs ddpcr
D1Full_means3<-subset(D1Full_means2, Day=="3")
D1Full_means3<-dcast(D1Full_means3, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()

#Day 7 and 14 scope vs ddpcr
D1Full_means4<-subset(D1Full_means2, Day=="7"|Day=="14")
D1Full_means4<-dcast(D1Full_means4, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()


#F1
#organize the ddPCR data 
F1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
F1_9000b<-F1_9000[F1_vars]
colnames(F1_9000b)[colnames(F1_9000b)=="Info"] <- "Symbiont"
F1_9000b$count.type<-"ddPCR"
hist(F1_9000b$cells.larvae)
F1_9000b$cells.larvae_log<-log(F1_9000b$cells.larvae+1)
  hist(F1_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
F1countdat<-subset(Countdat_2, Symbiont=="F1")
F1countdat$cells.larvae_log<-log(F1countdat$cells.larvae+1)
hist(F1countdat$cells.larvae_log)

F1Full<-rbind(F1_9000b,F1countdat) #combine hemo and ddPCR
hist(F1Full$cells.larvae_log) #not amazing left squew

#Raw means
F1Full_mean<- ddply(F1Full, c("Day", "Temp","count.type","Symbiont","Pot"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
);F1Full_mean #display table

F1vars2<-c("Day", "Temp","count.type", "mean","Symbiont","Pot")
F1Full_means2<-F1Full_mean[F1vars2]

#Day 3 scope vs ddpcr
F1Full_means3<-subset(F1Full_means2, Day=="3")
F1Full_means3<-dcast(F1Full_means3, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()

#Day 7 and 14 scope vs ddpcr
F1Full_means4<-subset(F1Full_means2, Day=="7"|Day=="14")
F1Full_means4<-dcast(F1Full_means4, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()




#G3
#organize the ddPCR data 
G3_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
G3_9000b<-G3_9000[G3_vars]
colnames(G3_9000b)[colnames(G3_9000b)=="Info"] <- "Symbiont"
G3_9000b$count.type<-"ddPCR"
hist(G3_9000b$cells.larvae)
G3_9000b$cells.larvae_log<-log(G3_9000b$cells.larvae+1)
  hist(G3_9000b$cells.larvae_log, w=.01, breaks = 10) 

#organize hemo data
G3countdat<-subset(Countdat_2, Symbiont=="G3")
G3countdat$cells.larvae_log<-log(G3countdat$cells.larvae+1)
hist(G3countdat$cells.larvae_log)

G3Full<-rbind(G3_9000b,G3countdat) #combine hemo and ddPCR
hist(G3Full$cells.larvae_log) #not amazing left squew

#Raw means
G3Full_mean<- ddply(G3Full, c("Day", "Temp","count.type","Symbiont","Pot"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae_log)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae_log, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae_log, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae_log, na.rm=TRUE) #calculate max, could also calculate min () if desired
);G3Full_mean #display table

G3vars2<-c("Day", "Temp","count.type", "mean","Symbiont","Pot")
G3Full_means2<-G3Full_mean[G3vars2]

#Day 3 scope vs ddpcr
G3Full_means3<-subset(G3Full_means2, Day=="3")
G3Full_means3<-dcast(G3Full_means3, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()

#Day 7 and 14 scope vs ddpcr
G3Full_means4<-subset(G3Full_means2, Day=="7"|Day=="14")
G3Full_means4<-dcast(G3Full_means4, Temp+Day+Symbiont+Pot~count.type, value.var = "mean") # cast()

```

Make plots: do these work, that's the question. 
```{r} 
######## Make Day 3 scope vs ddPCR plot 
ScopeddPCR<-rbind(C1Full_means3,D1Full_means3,F1Full_means3,G3Full_means3)
#ScopeddPCR<-melt(ScopeddPCR, id=c("Temp","Day","Symbiont")) #melt
#colnames(ScopeddPCR)[colnames(ScopeddPCR) == 'value'] <- 'cell.count.means.log'  #rename col
#colnames(ScopeddPCR)[colnames(ScopeddPCR) == 'variable'] <- 'count.type'      #rename col

#write.csv(ScopeddPCR,"ScopeddPCR_meanTable.csv")

ggplot(ScopeddPCR, aes(x=scope, y=ddPCR, group=Symbiont))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm")
  
 ggplot(ScopeddPCR, aes(x=scope, y=ddPCR))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm") 



######## Make Day 3=7 and 14 hemo vs ddPCR plot
HemoddPCR<-rbind(C1Full_means4,D1Full_means4,F1Full_means4,G3Full_means4)
#write.csv(HemoddPCR,"HemoddPCR_meanTable.csv")
HemoddPCR_D7<-subset(HemoddPCR, Day=="7")
HemoddPCR_D14<-subset(HemoddPCR, Day=="14")

#D7 and D14
ggplot(HemoddPCR, aes(x=hemo, y=ddPCR, group=Symbiont))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm")
  
ggplot(HemoddPCR, aes(x=hemo, y=ddPCR))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm") 
  
# D7
  ggplot(HemoddPCR_D7, aes(x=hemo, y=ddPCR, group=Symbiont))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm")
  
ggplot(HemoddPCR_D7, aes(x=hemo, y=ddPCR))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm") 
    

# D14
  ggplot(HemoddPCR_D14, aes(x=hemo, y=ddPCR, group=Symbiont))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm")
  
ggplot(HemoddPCR_D14, aes(x=hemo, y=ddPCR))+
        geom_point(aes(color=factor(Symbiont)))+
geom_smooth(method="lm") 

### question, is this good enough to show any correlation? 


```
Run stats on the counts themselves:
```{r} 
# ALL CLADES TOGETHER   <- this doesn't really make sense to do

  # Day 3 scope vs ddCPR, the data is logged   <-are these stats even right?
  D3_ddPCRscope<-lm(ddPCR~scope*Temp*Pot, ScopeddPCR)
  summary(D3_ddPCRscope)
  qqPlot(residuals(D3_ddPCRscope)) #good
  plot(allEffects(D3_ddPCRscope))

  # Day 7 scope vs ddCPR, the data is logged
  D7_ddPCRhemo<-lm(ddPCR~hemo*Temp*Pot, HemoddPCR_D7)
  summary(D7_ddPCRhemo)

  # Day 14 scope vs ddCPR, the data is logged   <----- this one is significant
  D14_ddPCRhemo<-lm(ddPCR~hemo*Temp*Pot, HemoddPCR_D14)
  summary(D14_ddPCRhemo)
  plot(allEffects(D14_ddPCRhemo))


### By Symbiont, subset  by clade
ScopeddPCR_C1<-subset(ScopeddPCR, Symbiont=="C1")
ScopeddPCR_D1<-subset(ScopeddPCR, Symbiont=="D1")
ScopeddPCR_F1<-subset(ScopeddPCR, Symbiont=="F1")
ScopeddPCR_G3<-subset(ScopeddPCR, Symbiont=="G3")

HemoddPCR_D7_C1<-subset(HemoddPCR_D7, Symbiont=="C1")
HemoddPCR_D7_D1<-subset(HemoddPCR_D7, Symbiont=="D1")
HemoddPCR_D7_F1<-subset(HemoddPCR_D7, Symbiont=="F1")
HemoddPCR_D7_G3<-subset(HemoddPCR_D7, Symbiont=="G3")

HemoddPCR_D14_C1<-subset(HemoddPCR_D14, Symbiont=="C1")
HemoddPCR_D14_D1<-subset(HemoddPCR_D14, Symbiont=="D1")
HemoddPCR_D14_F1<-subset(HemoddPCR_D14, Symbiont=="F1")
HemoddPCR_D14_G3<-subset(HemoddPCR_D14, Symbiont=="G3")


# Day 3 scope vs ddCPR, the data is logged  

#ScopeddPCR_C1  by clade (not by temp or pot)
ScopeddPCR_C1_D3<-lm(ddPCR~scope, ScopeddPCR_C1)   #C1
anova(ScopeddPCR_C1_D3)  # no diff 
plot(allEffects(ScopeddPCR_C1_D3))

ScopeddPCR_D1_D3<-lm(ddPCR~scope, ScopeddPCR_D1)   #D1
anova(ScopeddPCR_D1_D3) # no diff
plot(allEffects(ScopeddPCR_D1_D3))

ScopeddPCR_F1_D3<-lm(ddPCR~scope, ScopeddPCR_F1)   #F1
anova(ScopeddPCR_F1_D3) # no diff
plot(allEffects(ScopeddPCR_F1_D3))

ScopeddPCR_G3_D3<-lm(ddPCR~scope, ScopeddPCR_G3)   #G3
anova(ScopeddPCR_G3_D3) #no diff
plot(allEffects(ScopeddPCR_G3_D3))

# Day 7 hemo vs ddCPR, the data is logged
D7_ddPCRhemo_C1<-lm(ddPCR~hemo, HemoddPCR_D7_C1)    #C1
anova(D7_ddPCRhemo_C1) #sig diff
  
  HemoddPCR_D7_C1_27<-subset(HemoddPCR_D7_C1, Temp==27)
  D7_ddPCRhemo_C1_27<-lm(ddPCR~hemo, HemoddPCR_D7_C1_27)    #27 sig 0.015
  anova(D7_ddPCRhemo_C1_27)
  
  HemoddPCR_D7_C1_30<-subset(HemoddPCR_D7_C1, Temp==30)
  D7_ddPCRhemo_C1_30<-lm(ddPCR~hemo, HemoddPCR_D7_C1_30)    #30 
  anova(D7_ddPCRhemo_C1_30)
  
  HemoddPCR_D7_C1_31<-subset(HemoddPCR_D7_C1, Temp==31)
  D7_ddPCRhemo_C1_31<-lm(ddPCR~hemo, HemoddPCR_D7_C1_31)    #31 NA not enough data points to calc. 
  anova(D7_ddPCRhemo_C1_31)

D7_ddPCRhemo_D1<-lm(ddPCR~hemo*Temp, HemoddPCR_D7_D1)    #D1
anova(D7_ddPCRhemo_D1)

D7_ddPCRhemo_F1<-lm(ddPCR~hemo*Temp, HemoddPCR_D7_F1)    #D1
anova(D7_ddPCRhemo_F1)

D7_ddPCRhemo_G3<-lm(ddPCR~hemo*Temp, HemoddPCR_D7_G3)    #G3
anova(D7_ddPCRhemo_G3)

# Day 14 hemo vs ddCPR, the data is logged   

D14_ddPCRhemo_C1<-lm(ddPCR~hemo*Temp, HemoddPCR_D14_C1)   #C1
anova(D14_ddPCRhemo_C1)

D14_ddPCRhemo_D1<-lm(ddPCR~hemo*Temp, HemoddPCR_D14_D1)   #D1 significant difference
anova(D14_ddPCRhemo_D1)

D14_ddPCRhemo_F1<-lm(ddPCR~hemo*Temp, HemoddPCR_D14_F1)   #F1
anova(D14_ddPCRhemo_F1)

D14_ddPCRhemo_G3<-lm(ddPCR~hemo*Temp, HemoddPCR_D14_G3)   #G3 
anova(D14_ddPCRhemo_G3) 
```



old dot plots, delete later once you feel good about your other comparision
```{r}
#Compare ddPCR and hemo counts  
#all days
C1Full_Alldayplot<-ggplot(data=C1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day");C1Full_Alldayplot

#Day3 C1
C1Full_Day3<-subset(C1Full, Day=="3")
C1Full_Day3plot<-ggplot(data=C1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 3");C1Full_Day3plot


#Day7 27
C1Full_Day7<-subset(C1Full, Day=="7")
C1Full_Day7plot<-ggplot(data=C1Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 7");C1Full_Day7plot


#Day14 27
C1Full_Day14<-subset(C1Full, Day=="14")
C1Full_Day14plot<-ggplot(data=C1Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 14");C1Full_Day14plot

#plot together
grid.arrange(C1Full_Day3plot,C1Full_Day7plot,C1Full_Day14plot, nrow = 1)
#check on C1 ddPCR higher

```
D1 organize, ddpcr + hemo
```{r}  
#D1
#organize the ddPCR data 
D1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
D1_9000b<-D1_9000[D1_vars]
colnames(D1_9000b)[colnames(D1_9000b)=="Info"] <- "Symbiont"
D1_9000b$count.type<-"ddPCR"

#organize hemo data
D1countdat<-subset(Countdat1, Symbiont=="D1")
D1countdat$count.type<-"hemo"

D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR

D1Full_mean<- ddply(D1Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1Full_mean #display table

D1Full_mean$code<-paste0(D1Full_mean$Temp, D1Full_mean$Day, D1Full_mean$count.type)

#Compare ddPCR and hemo counts 
#All days
D1Full_allDayplot<-ggplot(data=D1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 3");D1Full_allDayplot

#Day3 D1
D1Full_Day3<-subset(D1Full, Day=="3")
D1Full_Day3plot<-ggplot(data=D1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 3");D1Full_Day3plot
# 2 hemo counts high

#Day7 
D1Full_Day7<-subset(D1Full, Day=="7") 
D1Full_Day7plot<-ggplot(data=D1Full_Day7,aes(Temp, cells.larvae)) + 
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 7");D1Full_Day7plot
#1 hemo count high
 
#Day14 
D1Full_Day14<-subset(D1Full, Day=="14")
D1Full_Day14plot<-ggplot(data=D1Full_Day14,aes(Temp, cells.larvae)) + 
  geom_point(aes(colour=factor(count.type)))+ 
  ggtitle("D1 Day 14");D1Full_Day14plot 
#hemo counts higher 
 
#plot together
grid.arrange(D1Full_Day3plot,D1Full_Day7plot,D1Full_Day14plot, nrow = 1)
```

F1 organize, ddpcr + hemo
```{r} 
#F1

#organize the ddPCR data
F1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
F1_9000b<-F1_9000[F1_vars]
colnames(F1_9000b)[colnames(F1_9000b)=="Info"] <- "Symbiont"
F1_9000b$count.type<-"ddPCR"

#organize hemo data
F1countdat<-subset(Countdat1, Symbiont=="F1")
F1countdat$count.type<-"hemo"

F1Full<-rbind(F1_9000b,F1countdat) #combine hemo and ddPCR

F1Full_mean<- ddply(F1Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1Full_mean #display table

F1Full_mean$code<-paste0(F1Full_mean$Temp, F1Full_mean$Day, F1Full_mean$count.type)

#Compare ddPCR and hemo counts 
#all Day F1
F1Full_AllDayplot<-ggplot(data=F1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 3");F1Full_AllDayplot

#Day3 F1
F1Full_Day3<-subset(F1Full, Day=="3")
F1Full_Day3plot<-ggplot(data=F1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 3");F1Full_Day3plot
#1 ddpcr higher 27

#Day7 
F1Full_Day7<-subset(F1Full, Day=="7")
F1Full_Day7plot<-ggplot(data=F1Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 7");F1Full_Day7plot


#Day14 
F1Full_Day14<-subset(F1Full, Day=="14")
F1Full_Day14plot<-ggplot(data=F1Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 14");F1Full_Day14plot

#plot together
grid.arrange(F1Full_Day3plot,F1Full_Day7plot,F1Full_Day14plot, nrow = 1)

```

G3 organize, ddpcr + hemo
```{r}  
#G3

#organize the ddPCR data
G3_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
G3_9000b<-G3_9000[G3_vars]
colnames(G3_9000b)[colnames(G3_9000b)=="Info"] <- "Symbiont"
G3_9000b$count.type<-"ddPCR"

#organize hemo data
G3countdat<-subset(Countdat1, Symbiont=="G3")
G3countdat$count.type<-"hemo"

G3Full<-rbind(G3_9000b,G3countdat) #combine hemo and ddPCR

G3Full_mean<- ddply(G3Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3Full_mean #display table

G3Full_mean$code<-paste0(G3Full_mean$Temp, G3Full_mean$Day, G3Full_mean$count.type)

#Compare ddPCR and hemo counts 
#all day
G3Full_AllDayplot<-ggplot(data=G3Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 3");G3Full_AllDayplot
#ddpcr high


#Day3 G3
G3Full_Day3<-subset(G3Full, Day=="3") 
G3Full_Day3plot<-ggplot(data=G3Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 3");G3Full_Day3plot 
#ddpcr high

#Day7 
G3Full_Day7<-subset(G3Full, Day=="7")
G3Full_Day7plot<-ggplot(data=G3Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 7");G3Full_Day7plot
# ddpcr higher
 
#Day14 
G3Full_Day14<-subset(G3Full, Day=="14")
G3Full_Day14plot<-ggplot(data=G3Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 14");G3Full_Day14plot
 

#plot together
grid.arrange(G3Full_Day3plot,G3Full_Day7plot,G3Full_Day14plot, nrow = 1)

```

##Infection or not after 3 days - binary yes or no  
Df: C1Full, D1Full, F1Full, G3Full
```{r}
#round all cell counts
C1Full$cells.larvae_round<-round(C1Full$cells.larvae) 
D1Full$cells.larvae_round<-round(D1Full$cells.larvae) 
F1Full$cells.larvae_round<-round(F1Full$cells.larvae) 
G3Full$cells.larvae_round<-round(G3Full$cells.larvae) 


# C1
Initial_C1<-subset(C1Full, Day=="3")
Initial_C1 <- subset(Initial_C1, select = -c(cells.larvae_log)) #remove this col
Initial_C1$Infect[Initial_C1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Initial_C1$Infect[Initial_C1$cells.larvae==0]<-0
hist(Initial_C1$Infect)

Mid_C1<-subset(C1Full, Day=="7")
Mid_C1 <- subset(Mid_C1, select = -c(cells.larvae_log)) #remove this col
Mid_C1$Infect[Mid_C1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Mid_C1$Infect[Mid_C1$cells.larvae==0]<-0
hist(Mid_C1$Infect)

Fin_C1<-subset(C1Full, Day=="14")
Fin_C1 <- subset(Fin_C1, select = -c(cells.larvae_log)) #remove this col
Fin_C1$Infect[Fin_C1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Fin_C1$Infect[Fin_C1$cells.larvae==0]<-0
hist(Fin_C1$Infect)

# D1
Initial_D1<-subset(D1Full, Day=="3")
Initial_D1$Infect[Initial_D1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Initial_D1$Infect[Initial_D1$cells.larvae==0]<-0
hist(Initial_D1$Infect)

Mid_D1<-subset(D1Full, Day=="7")
Mid_D1$Infect[Mid_D1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Mid_D1$Infect[Mid_D1$cells.larvae==0]<-0
hist(Mid_D1$Infect)

Fin_D1<-subset(D1Full, Day=="14")
Fin_D1$Infect[Fin_D1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Fin_D1$Infect[Fin_D1$cells.larvae==0]<-0
hist(Fin_D1$Infect)

# F1
Initial_F1<-subset(F1Full, Day=="3")
Initial_F1$Infect[Initial_F1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Initial_F1$Infect[Initial_F1$cells.larvae==0]<-0
hist(Initial_F1$Infect)

Mid_F1<-subset(F1Full, Day=="7")
Mid_F1$Infect[Mid_F1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Mid_F1$Infect[Mid_F1$cells.larvae==0]<-0
hist(Mid_F1$Infect)

Fin_F1<-subset(F1Full, Day=="14")
Fin_F1$Infect[Fin_F1$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Fin_F1$Infect[Fin_F1$cells.larvae==0]<-0
hist(Fin_F1$Infect)

# G3
Initial_G3<-subset(G3Full, Day=="3")
Initial_G3$Infect[Initial_G3$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Initial_G3$Infect[Initial_G3$cells.larvae==0]<-0
hist(Initial_G3$Infect)

Mid_G3<-subset(G3Full, Day=="7")
Mid_G3$Infect[Mid_G3$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Mid_G3$Infect[Mid_G3$cells.larvae==0]<-0
hist(Mid_G3$Infect)

Fin_G3<-subset(G3Full, Day=="14")
Fin_G3$Infect[Fin_G3$cells.larvae>0]<-1  #make new col for infect or not 1 for infect, 0 not.
Fin_G3$Infect[Fin_G3$cells.larvae==0]<-0
hist(Fin_G3$Infect)

#combine
InitialInfect<-rbind(Initial_C1,Initial_D1,Initial_F1,Initial_G3)  
MidInfect<-rbind(Mid_C1,Mid_D1,Mid_F1,Mid_G3)
FinInfect<-rbind(Fin_C1,Fin_D1,Fin_F1,Fin_G3)



# by temp
InitialInfect_27<-subset(InitialInfect, Temp=="27")
InitialInfect_30<-subset(InitialInfect, Temp=="30")
InitialInfect_31<-subset(InitialInfect, Temp=="31")

MidInfect_27<-subset(MidInfect, Temp=="27")
MidInfect_30<-subset(MidInfect, Temp=="30")
MidInfect_31<-subset(MidInfect, Temp=="31")

FinInfect_27<-subset(FinInfect, Temp=="27")
FinInfect_30<-subset(FinInfect, Temp=="30")
FinInfect_31<-subset(FinInfect, Temp=="31")

Temp27<-rbind(InitialInfect_27,MidInfect_27,FinInfect_27)
Temp30<-rbind(InitialInfect_30,MidInfect_30,FinInfect_30)
Temp31<-rbind(InitialInfect_31,MidInfect_31,FinInfect_31)


# by day
InitialInfect_D3<-subset(InitialInfect, Day=="3")
InitialInfect_D7<-subset(InitialInfect, Day=="7")
InitialInfect_D14<-subset(InitialInfect, Day=="14")

MidInfect_D3<-subset(MidInfect, Day=="3")
MidInfect_D7<-subset(MidInfect, Day=="7")
MidInfect_D14<-subset(MidInfect, Day=="14")

FinInfect_D3<-subset(FinInfect, Day=="3")
FinInfect_D7<-subset(FinInfect, Day=="7")
FinInfect_D14<-subset(FinInfect, Day=="14")
```

means All temps by day
```{r}
#Day 3
InitialInfect_mean <- ddply(InitialInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

InitialInfect_mean #display table 

#Day 7
MidInfect_mean <- ddply(MidInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

MidInfect_mean #display table 

#Day 14
FinInfect_mean <- ddply(FinInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

FinInfect_mean #display table 

#All Days
#27C
InitialInfect_day_mean <- ddply(InitialInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

InitialInfect_mean #display table 

#Day 7
MidInfect_mean <- ddply(MidInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

MidInfect_mean #display table 

#Day 14
FinInfect_mean <- ddply(FinInfect, c("Symbiont", "Temp"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

FinInfect_mean #display table 
```
plot all temps by day
```{r}
#Day3
InitialInfect_all_plot<-ggplot(data=InitialInfect_mean, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab(" cell counts") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Day 3 Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));InitialInfect_all_plot

#Day7
MidInfect_all_plot<-ggplot(data=MidInfect_mean, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab(" cell counts") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Day 7 Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));MidInfect_all_plot

#Day14
FinInfect_all_plot<-ggplot(data=FinInfect_mean, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab(" cell counts") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Day 14 Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));FinInfect_all_plot

#plot together
InitailInfect_all_plot<-InitialInfect_all_plot+ theme(legend.position = "none") #remove legend
MidInfect_all_plot<-MidInfect_all_plot+ theme(legend.position = "none") #remove legend
grid.arrange(InitailInfect_all_plot, MidInfect_all_plot, FinInfect_all_plot, nrow = 1)
```
means All Days by Temp
```{r}
#27C
Infect_27mean <- ddply(Temp27, c("Symbiont", "Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_27mean #display table 
Infect_27mean$Temp<-27


#30C
Infect_30mean <- ddply(Temp30, c("Symbiont", "Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_30mean #display table 
Infect_30mean$Temp<-30
#31C
Infect_31mean <- ddply(Temp31, c("Symbiont", "Day"), summarise, #summarize cell counts
                 N    = length(Infect[!is.na(Infect)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(Infect, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Infect, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Infect, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

Infect_31mean #display table 
Infect_31mean$Temp<-31
#All 
IMFmean<-rbind(Infect_27mean,Infect_30mean,Infect_31mean)

```
plot all temps by day:  HEY You need to figure out how to order the df by Symbiont type for color in plots
```{r}
#27C
Infect_27_plot<-ggplot(data=Infect_27mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
              scale_color_locuszoom()+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  xlab(" cell counts") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Proportion larvae infected"))) +
  ggtitle("27C Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));Infect_27_plot

#30C
Infect_30_plot<-ggplot(data=Infect_30mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
              scale_color_locuszoom()+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  xlab(" cell counts") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Proportion larvae infected"))) +
  ggtitle("30C Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));Infect_30_plot

#31C
Infect_31_plot<-ggplot(data=Infect_31mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
              scale_color_locuszoom()+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
  xlab(" cell counts") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Proportion larvae infected"))) +
  ggtitle("31C Infection")+
  theme(plot.title = element_text(size=20, face = "italic"));Infect_31_plot

#plot together
Infect_27_plot<-Infect_27_plot+ theme(legend.position = "none") #remove legend
Infect_30_plot<-Infect_30_plot+ theme(legend.position = "none") #remove legend
grid.arrange(Infect_27_plot, Infect_30_plot, Infect_31_plot, nrow = 1)
```

Analyze binomial with a logistic binomial regression model.   
```{r}
#Day 3
#C1 
C1_infect<- glmer(Infect~Temp+(1|Pot),data=Initial_C1, family="binomial")
Anova(C1_infect)   #btw this is Type II Wald chisquare test
summary(effect(c("Temp"), xlevels=3, C1_infect))   # what do these pvals coorespond to
dispersion_glmer(C1_infect) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(C1_infect)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#D1 
D1_infect<- glmer(Infect~Temp+(1|Pot),data=Initial_D1, family="binomial")
Anova(D1_infect)
summary(effect(c("Temp"), xlevels=3, D1_infect))   # what do these pvals coorespond to
dispersion_glmer(D1_infect) #0.829                 *****************
plot(residuals(D1_infect)) + abline(h=0, lty=2) #this looks top heavy                     ****************

#F1 
F1_infect<- glmer(Infect~Temp+(1|Pot),data=Initial_F1, family="binomial")
Anova(F1_infect)
summary(effect(c("Temp"), xlevels=3, F1_infect))   # what do these pvals coorespond to
dispersion_glmer(F1_infect) #1.16 does that mean it's overdispersed??                  *****************
plot(residuals(F1_infect)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#G3 
G3_infect<- glmer(Infect~Temp+(1|Pot),data=Initial_G3, family="binomial")
Anova(G3_infect)
summary(effect(c("Temp"), xlevels=3, G3_infect))   # what do these pvals coorespond to
dispersion_glmer(G3_infect) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(G3_infect)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#All
Day3_infectAll<-rbind(Initial_C1,Initial_D1, Initial_F1, Initial_G3)

Day3_infectAll_infect<- glmer(Infect~Temp*Symbiont+(1|Pot),data=Day3_infectAll, family="binomial")
Anova(Day3_infectAll_infect)
summary(effect(c("Temp"), xlevels=3, Day3_infectAll_infect))   # what do these pvals coorespond to
dispersion_glmer(Day3_infectAll_infect) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(Day3_infectAll_infect)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#Day 7

#C1 
Mid_C1_mod<- glmer(Infect~Temp+(1|Pot),data=Mid_C1, family="binomial")
Anova(Mid_C1_mod)   #btw this is Type II Wald chisquare test
summary(effect(c("Temp"), xlevels=3, Mid_C1_mod))   # what do these pvals coorespond to
dispersion_glmer(Mid_C1_mod) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(Mid_C1_mod)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#D1 
Mid_D1_mod<- glmer(Infect~Temp+(1|Pot),data=Mid_D1, family="binomial")
Anova(Mid_D1_mod)
summary(effect(c("Temp"), xlevels=3, Mid_D1_mod))   # what do these pvals coorespond to
dispersion_glmer(Mid_D1_mod) #0.829                 *****************
plot(residuals(Mid_D1_mod)) + abline(h=0, lty=2) #this looks top heavy                     ****************

#F1 
Mid_F1_mod<- glmer(Infect~Temp+(1|Pot),data=Mid_F1, family="binomial")
Anova(Mid_F1_mod)
summary(effect(c("Temp"), xlevels=3, Mid_F1_mod))   # what do these pvals coorespond to
dispersion_glmer(Mid_F1_mod) #1.16 does that mean it's overdispersed??                  *****************
plot(residuals(Mid_F1_mod)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#G3 

Mid_G3_mod<- glmer(Infect~Temp+(1|Pot),data=Mid_G3, family="binomial")
Anova(Mid_G3_mod)
summary(effect(c("Temp"), xlevels=3, Mid_G3_mod))   # what do these pvals coorespond to
dispersion_glmer(Mid_G3_mod) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(Mid_G3_mod)) + abline(h=0, lty=2) #Dispersed randomly                      ****************

#All
Mid_C1 <- subset(Mid_C1, select = -c(zscore)) #remove this col
Mid_D1 <- subset(Mid_D1, select = -c(cells.larvae_log)) #remove this col
Mid_G3 <- subset(Mid_G3, select = -c(cells.larvae_log)) #remove this col
Mid_F1 <- subset(Mid_F1, select = -c(cells.larvae_log)) #remove this col

Day7_infectAll<-rbind(Mid_C1,Mid_D1, Mid_F1, Mid_G3)

Day7_infectAll_infect<- glmer(Infect~Temp*Symbiont+(1|Pot),data=Day7_infectAll, family="binomial")
Anova(Day7_infectAll_infect)
summary( Day7_infectAll) # what do these pvals coorespond to
dispersion_glmer(Day7_infectAll) #1.14 does that mean it's overdispersed??                  *****************
plot(residuals(Day7_infectAll)) + abline(h=0, lty=2) #Dispersed randomly                      ****************


```





##PLOT SINGLE INFECTIONS, full dataset 
C1 single infection plot 
```{r} 
C1Full_mean <- ddply(C1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE)) #calculate max, could also calculate min () if desired  

C1Full_mean #display table 

#plot with yaxis log10, real data (not transformed)
C1Full_plot_9000<-ggplot(data=C1Full_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic"));C1Full_plot_9000




``` 


# Individual z-score
C1 single infection z-score plot
```{r}  
#use the log data to calc zscore by clade (all time and temp included by clade)
scale(C1Full$cells.larvae_log, center=T, scale=T)
C1Full$zscore<-(C1Full$cells.larvae_log - mean(C1Full$cells.larvae_log))/sd(C1Full$cells.larvae_log)

C1Full_mean_z <- ddply(C1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(zscore)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean((zscore), na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd((zscore), na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max((zscore), na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1Full_mean_z #display table 

#plot with yaxis log10, real data (not transformed)
C1Full_plot_9000_z<-ggplot(data=C1Full_mean_z, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(0,2000) + #set Y limits
   #scale_y_log10()+
       #scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("Cladocopium")+
  theme(plot.title = element_text(size=20, face = "italic"));C1Full_plot_9000_z

```

D1 single infection plot
```{r} 
D1Full_mean_9000 <- ddply(D1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's 
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired 
)
D1Full_mean_9000 #display table  

D1Full_plot_9000<-ggplot(data=D1Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limit
       scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines 
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text  
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) + 
  ggtitle("Durusdinium")+
  theme(plot.title = element_text(size=20, face = "italic"));D1Full_plot_9000
```
D1 single infection z-score plot
```{r} 
#use the log data to calc zscore
scale(C1Full$cells.larvae_log, center=T, scale=T)

scale(D1Full$cells.larvae_log, center=T, scale=T)
D1Full$zscore<-(D1Full$cells.larvae_log - mean(D1Full$cells.larvae_log))/sd(D1Full$cells.larvae_log)

D1Full_mean_z <- ddply(D1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(zscore)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean((zscore), na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd((zscore), na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max((zscore), na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1Full_mean_z #display table 

#plot with yaxis log10, real data (not transformed)
D1Full_plot_9000_z<-ggplot(data=D1Full_mean_z, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("Durusdinium z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));D1Full_plot_9000_z

```
F1 single infection  plot
```{r}
F1Full_mean_9000 <- ddply(F1Full, c("Day", "Temp"), summarise, #summarize cell counts 
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1Full_mean_9000 #display table


F1Full_plot_9000<-ggplot(data=F1Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("Fugacium")+ 
  theme(plot.title = element_text(size=20, face = "italic"));F1Full_plot_9000

```
F1 single infection z-score plot
```{r}
#use the log data to calc zscore
scale(F1Full$cells.larvae_log, center=T, scale=T)
F1Full$zscore<-(F1Full$cells.larvae_log - mean(F1Full$cells.larvae_log))/sd(F1Full$cells.larvae_log)

F1Full_mean_z <- ddply(F1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(zscore)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean((zscore), na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd((zscore), na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max((zscore), na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1Full_mean_z #display table 

#plot with yaxis log10, real data (not transformed)
F1Full_plot_9000_z<-ggplot(data=F1Full_mean_z, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("Fugacium z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));F1Full_plot_9000_z

```

G3 single infection plot
```{r}
G3Full_mean_9000 <- ddply(G3Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired 
)
G3Full_mean_9000 #display table 
 
G3Full_plot_9000<-ggplot(data=G3Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color 
  theme(axis.line = element_line(color = 'black'), #Set the axes color 
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Gerakladium")+
  theme(plot.title = element_text(size=20, face = "italic"));G3Full_plot_9000

 
 
``` 

G3 single infection z-score plot
```{r}
#use the log data to calc zscore
scale(G3Full$cells.larvae_log, center=T, scale=T)
G3Full$zscore<-(G3Full$cells.larvae_log - mean(G3Full$cells.larvae_log))/sd(G3Full$cells.larvae_log)

G3Full_mean_z <- ddply(G3Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(zscore)]), #calculate the length of the data frame,  excluding NA’s *this part is important*
                 mean = mean((zscore), na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd((zscore), na.rm=TRUE), #calculate standard deviation 
                 se   = sd / sqrt(N), #calculate standard error
                 max = max((zscore), na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3Full_mean_z #display table 

#plot
G3Full_plot_9000_z<-ggplot(data=G3Full_mean_z, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+ 
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("Gerakladium z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));G3Full_plot_9000_z

```

Plot all four SINGLE INFECTION together:
```{r}
#log scale axis only
C1Full_plot_9000<-C1Full_plot_9000+ theme(legend.position = "none") #remove legend
D1Full_plot_9000<-D1Full_plot_9000+ theme(legend.position = "none") #remove legend
F1Full_plot_9000<-F1Full_plot_9000+ theme(legend.position = "none") #remove legend
G3Full_plot_9000<-G3Full_plot_9000+ theme(legend.position = "none") #remove legend
grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000, nrow = 1)

C1Full_plot_9000_z<-C1Full_plot_9000_z+ theme(legend.position = "none") #remove legend
D1Full_plot_9000_z<-D1Full_plot_9000_z+ theme(legend.position = "none") #remove legend
F1Full_plot_9000_z<-F1Full_plot_9000_z+ theme(legend.position = "none") #remove legend
G3Full_plot_9000_z<-G3Full_plot_9000_z+ theme(legend.position = "none") #remove legend
grid.arrange(C1Full_plot_9000_z, D1Full_plot_9000_z, F1Full_plot_9000_z,G3Full_plot_9000_z, nrow = 1)


#all 8 together
grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000,C1Full_plot_9000_z, D1Full_plot_9000_z, F1Full_plot_9000_z,G3Full_plot_9000_z, nrow = 2)

```

## single infection z-scores by TEMP
Trying plotting comparative clades by temp
```{r}  
# combine by temps
#27C
zscore_27C_C1<-subset(C1Full_mean_z,Temp==27)
zscore_27C_C1$Symbiont<-"C1"
zscore_27C_D1<-subset(D1Full_mean_z,Temp==27)
zscore_27C_D1$Symbiont<-"D1"
zscore_27C_F1<-subset(F1Full_mean_z,Temp==27)
zscore_27C_F1$Symbiont<-"F1"
zscore_27C_G3<-subset(G3Full_mean_z,Temp==27)
zscore_27C_G3$Symbiont<-"G3"
zscore_27C<-rbind(zscore_27C_C1,zscore_27C_D1,zscore_27C_F1,zscore_27C_G3)


#30C
zscore_30C_C1<-subset(C1Full_mean_z,Temp==30)
zscore_30C_C1$Symbiont<-"C1"
zscore_30C_D1<-subset(D1Full_mean_z,Temp==30)
zscore_30C_D1$Symbiont<-"D1"
zscore_30C_F1<-subset(F1Full_mean_z,Temp==30)
zscore_30C_F1$Symbiont<-"F1"
zscore_30C_G3<-subset(G3Full_mean_z,Temp==30)
zscore_30C_G3$Symbiont<-"G3"
zscore_30C<-rbind(zscore_30C_C1,zscore_30C_D1,zscore_30C_F1,zscore_30C_G3)


#31C
zscore_31C_C1<-subset(C1Full_mean_z,Temp==31)
zscore_31C_C1$Symbiont<-"C1"
zscore_31C_D1<-subset(D1Full_mean_z,Temp==31)
zscore_31C_D1$Symbiont<-"D1"
zscore_31C_F1<-subset(F1Full_mean_z,Temp==31)
zscore_31C_F1$Symbiont<-"F1"
zscore_31C_G3<-subset(G3Full_mean_z,Temp==31)
zscore_31C_G3$Symbiont<-"G3"
zscore_31C<-rbind(zscore_31C_C1,zscore_31C_D1,zscore_31C_F1,zscore_31C_G3)

#plot 27
zscore_27C_plot<-ggplot(data=zscore_27C, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
              scale_color_locuszoom()+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("27C z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));zscore_27C_plot

#plot 30
zscore_30C_plot<-ggplot(data=zscore_30C, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
              scale_color_locuszoom()+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("30C z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));zscore_30C_plot

#plot 31
zscore_31C_plot<-ggplot(data=zscore_31C, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+ 
  geom_line(aes(color=Symbiont))+
              scale_color_locuszoom()+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("z-score cells/larvae"))) +
  ggtitle("31C z-score")+
  theme(plot.title = element_text(size=20, face = "italic"));zscore_31C_plot

```
Plot together by temp
```{r}
zscore_27C_plot<-zscore_27C_plot+ theme(legend.position = "none") #remove legend
zscore_30C_plot<-zscore_30C_plot+ theme(legend.position = "none") #remove legend

grid.arrange(zscore_27C_plot, zscore_30C_plot, zscore_31C_plot, nrow = 1)


```


#Multi-infection raw counts
Subset by Temp treatments
raw counts: line and bar plots 
```{r}    
#use ALLcast_9000_cast2a THIS IS WITHOUT SAMPS REMOVED WHEN ALL NOT AMPED, DECIDE IF YOU WANT TO RERUN
ALL_27_9000c<-subset(ALLcast_9000_cast2a, Temp==27)
ALL_30_9000c<-subset(ALLcast_9000_cast2a, Temp==30) 
ALL_31_9000c<-subset(ALLcast_9000_cast2a, Temp==31)

# melt
ALL_27_9000d<-melt(ALL_27_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_27_9000d)[colnames(ALL_27_9000d)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_27_9000d)[colnames(ALL_27_9000d)=="variable"]<-"Symbiont" #rename value col


ALL_30_9000d<-melt(ALL_30_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_30_9000d)[colnames(ALL_30_9000d)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_30_9000d)[colnames(ALL_30_9000d)=="variable"]<-"Symbiont" #rename value col


ALL_31_9000d<-melt(ALL_31_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_31_9000d)[colnames(ALL_31_9000d)=="value"]<-"cells.larvae" #rename value col 
colnames(ALL_31_9000d)[colnames(ALL_31_9000d)=="variable"]<-"Symbiont" #rename value col 
``` 
 
ALL Ambient 27C
```{r}  
ALL_27_9000_mean <- ddply(ALL_27_9000d, c("Day", "Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_27_9000_mean #display table

ALL_27_plot_9000<-ggplot(data=ALL_27_9000_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
         scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") + 
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("27C")+
  theme(plot.title = element_text(size=20));ALL_27_plot_9000


#plot by bar
ALL_27_9000_mean$mean1<-round(ALL_27_9000_mean$mean, digits = 0)

ALL_RAW_27<-ggplot(ALL_27_9000_mean, aes(y=mean1, x=Day, fill=Symbiont, label=mean1)) + 
           geom_bar(stat="identity")+
          #  geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae (count)"))) +
  ggtitle("27C");ALL_RAW_27   
``` 

ALL High 30C
```{r}
ALL_30_mean_9000 <- ddply(ALL_30_9000d, c("Day", "Temp","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
ALL_30_mean_9000 #display table

ALL_30_plot_9000<-ggplot(data=ALL_30_mean_9000, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis
           scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") + 
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("30C")+
  theme(plot.title = element_text(size=20));ALL_30_plot_9000



#plot by bar
ALL_30_mean_9000$mean1<-round(ALL_30_mean_9000$mean, digits = 0)

ALL_RAW_30<-ggplot(ALL_30_mean_9000, aes(y=mean1, x=Day, fill=Symbiont, label=mean1)) + 
           geom_bar(stat="identity")+
            #geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae (count)"))) +
  ggtitle("Raw 30C");ALL_RAW_30   
```

ALL High 31C
```{r}
ALL_31_mean_9000 <- ddply(ALL_31_9000d, c("Day", "Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_31_mean_9000 #display table
ALL_31_mean_9000<-na.omit(ALL_31_mean_9000)

ALL_31_plot_9000<-ggplot(data=ALL_31_mean_9000, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis
 # ylim(-10, 2500) + #set Y limits
  scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(-.1,5000))+  xlab("Days") + 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("31C")+
  theme(plot.title = element_text(size=20));ALL_31_plot_9000

#plot by bar
ALL_31_mean_9000$mean1<-round(ALL_31_mean_9000$mean, digits = 0)

ALL_RAW_31<-ggplot(ALL_31_mean_9000, aes(y=mean1, x=Day, fill=Symbiont)) + 
           geom_bar(stat="identity")+
            #geom_text(size=10, position=position_stack(vjust = 0.5))+ ##put "label=mean1" in ggplot aes to run this line
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae (count)"))) +
  ggtitle("Raw 31C");ALL_RAW_31 
``` 

Plot all three ALL temps together:
```{r}
#line plot
ALL_27_plot_9000<-ALL_27_plot_9000+ theme(legend.position = "none") #remove legend 
ALL_30_plot_9000<-ALL_30_plot_9000+ theme(legend.position = "none") #remove legend
ALL_31_plot_9000<-ALL_31_plot_9000+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_27_plot_9000, ALL_30_plot_9000, ALL_31_plot_9000, nrow = 1)

#bar plot
ALL_RAW_27<-ALL_RAW_27+ theme(legend.position = "none") #remove legend
ALL_RAW_30<-ALL_RAW_30+ theme(legend.position = "none") #remove legend
ALL_RAW_31<-ALL_RAW_31+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_RAW_27, ALL_RAW_30, ALL_RAW_31, nrow = 1)

#plot raw counts in row 1 and rel abund in row 2
grid.arrange(ALL_27_plot_9000, ALL_30_plot_9000, ALL_31_plot_9000,ALL_STP_27, ALL_STP_30, ALL_STP_31, nrow = 2)
```

##Plot multi raw counts under plots of single counts, pull multi out by clade
```{r}
C1_27C_multi<-subset(ALL_27_9000d, Symbiont=="C1")
D1_27C_multi<-subset(ALL_27_9000d, Symbiont=="D1")
F1_27C_multi<-subset(ALL_27_9000d, Symbiont=="F1")
G3_27C_multi<-subset(ALL_27_9000d, Symbiont=="G3")

C1_30C_multi<-subset(ALL_30_9000d, Symbiont=="C1")
D1_30C_multi<-subset(ALL_30_9000d, Symbiont=="D1")
F1_30C_multi<-subset(ALL_30_9000d, Symbiont=="F1")
G3_30C_multi<-subset(ALL_30_9000d, Symbiont=="G3")

C1_31C_multi<-subset(ALL_31_9000d, Symbiont=="C1")
D1_31C_multi<-subset(ALL_31_9000d, Symbiont=="D1")
F1_31C_multi<-subset(ALL_31_9000d, Symbiont=="F1")
G3_31C_multi<-subset(ALL_31_9000d, Symbiont=="G3")

#bind by clade
#C1
C1_MULTI<-rbind(C1_27C_multi,C1_30C_multi,C1_31C_multi)
#D1
D1_MULTI<-rbind(D1_27C_multi,D1_30C_multi,D1_31C_multi)
#C1
F1_MULTI<-rbind(F1_27C_multi,F1_30C_multi,F1_31C_multi)
#C1
G3_MULTI<-rbind(G3_27C_multi,G3_30C_multi,G3_31C_multi)
```
PLOT C1 Multi infection (note here your log axis it -0.1 for error bar, othres are 1, figure out what to do)
```{r}
C1_MULTI_mean <- ddply(C1_MULTI, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_MULTI_mean #display table
C1_MULTI_mean<-na.omit(C1_MULTI_mean)

C1_MULTI_plot<-ggplot(data=C1_MULTI_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(-.1,5000))+  xlab("Days") + #Label the X Axis 
  #ylim(-10, 2500) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("27C C1 Multi Raw Counts")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_MULTI_plot
``` 

PLOT D1 Multi infection
```{r}
D1_MULTI_mean <- ddply(D1_MULTI, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_MULTI_mean #display table
D1_MULTI_mean<-na.omit(D1_MULTI_mean)

D1_MULTI_plot<-ggplot(data=D1_MULTI_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") + #Label the X Axis 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1 27C Multi Raw Counts")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_MULTI_plot
``` 

PLOT F1 Multi infection
```{r}
F1_MULTI_mean <- ddply(F1_MULTI, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_MULTI_mean #display table
F1_MULTI_mean<-na.omit(F1_MULTI_mean)

F1_MULTI_plot<-ggplot(data=F1_MULTI_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") + #Label the X Axis 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1 27C Multi Raw Counts")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_MULTI_plot
``` 

PLOT G3 Multi infection
```{r}
G3_MULTI_mean <- ddply(G3_MULTI, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_MULTI_mean #display table
G3_MULTI_mean<-na.omit(G3_MULTI_mean)

G3_MULTI_plot<-ggplot(data=G3_MULTI_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") + #Label the X Axis 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3 27C Multi Raw Counts")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_MULTI_plot
``` 

Plot all Symbiont multi ALL  together:
```{r}
#line plot 
C1_MULTI_plot<-C1_MULTI_plot+ theme(legend.position = "none") #remove legend
D1_MULTI_plot<-D1_MULTI_plot+ theme(legend.position = "none") #remove legend
F1_MULTI_plot<-F1_MULTI_plot+ theme(legend.position = "none") #remove legend
G3_MULTI_plot<-G3_MULTI_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

C1Full_plot_9000<-C1Full_plot_9000+ theme(legend.position = "none") #remove legend
D1Full_plot_9000<-D1Full_plot_9000+ theme(legend.position = "none") #remove legend
F1Full_plot_9000<-F1Full_plot_9000+ theme(legend.position = "none") #remove legend
G3_MULTI_plot<-G3_MULTI_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 1)

# plot single Raw plots over Multi clade plots
grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000,
  C1_MULTI_plot, D1_MULTI_plot, F1_MULTI_plot, G3_MULTI_plot, nrow = 2)

# plot single Raw plots over Multi clade plots - plot clades next to eachother, not on top
grid.arrange(C1Full_plot_9000,C1_MULTI_plot, D1Full_plot_9000,D1_MULTI_plot, F1Full_plot_9000,F1_MULTI_plot, G3Full_plot_9000,G3_MULTI_plot, nrow = 2)
```


###Plot by Day
```{r} 
ALL_D3_9000e<-subset(ALLcast_9000_cast2a, Day=="3")
ALL_D7_9000e<-subset(ALLcast_9000_cast2a, Day=="7") 
ALL_D14_9000e<-subset(ALLcast_9000_cast2a, Day=="14")
 
# melt
ALL_D3_9000<-melt(ALL_D3_9000e, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D3_9000)[colnames(ALL_D3_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D3_9000)[colnames(ALL_D3_9000)=="variable"]<-"Symbiont" #rename value col


ALL_D7_9000<-melt(ALL_D7_9000e, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D7_9000)[colnames(ALL_D7_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D7_9000)[colnames(ALL_D7_9000)=="variable"]<-"Symbiont" #rename value col 
 
ALL_D14_9000<-melt(ALL_D14_9000e, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D14_9000)[colnames(ALL_D14_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D14_9000)[colnames(ALL_D14_9000)=="variable"]<-"Symbiont" #rename value col
```
Day 3
```{r}
ALL_D3_mean_9000 <- ddply(ALL_D3_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D3_mean_9000 #display table

ALL_D3_plot_9000<-ggplot(data=ALL_D3_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred","green"))+
              scale_color_locuszoom()+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D3_plot_9000
```
Day 7
```{r}
ALL_D7_mean_9000 <- ddply(ALL_D7_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D7_mean_9000 #display table
 
ALL_D7_plot_9000<-ggplot(data=ALL_D7_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                 width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
              scale_color_locuszoom()+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred","green"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D7_plot_9000
```
Day 14
```{r}
ALL_D14_mean_9000 <- ddply(ALL_D14_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D14_mean_9000 #display table 
#remove Day 14
ALL_D14_mean_9000<-na.omit(ALL_D14_mean_9000)

ALL_D14_plot_9000<-ggplot(data=ALL_D14_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  #scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred","green"))+
  scale_color_locuszoom()+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+ 
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D14_plot_9000
``` 

Plot all three ALL days together:
```{r}
#line plot
ALL_D3_plot_9000<-ALL_D3_plot_9000+ theme(legend.position = "none") #remove legend
ALL_D7_plot_9000<-ALL_D7_plot_9000+ theme(legend.position = "none") #remove legend
#ALL_D14_plot_9000<-ALL_D14_plot_9000+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_D3_plot_9000, ALL_D7_plot_9000, ALL_D14_plot_9000, nrow = 1)
```


##Multi infection, % larvae infected with 0,1, 2, 3, or 4 types
THIS IS A MESS...
```{r} 
#use ALL_9000a or ALLcast_9000_cast2

ALLcast_9000_cast3<-ALLcast_9000_cast2a #copy df
#if any symb present, call 1, if none call 0
ALLcast_9000_cast3$C1PA[ALLcast_9000_cast3$C1>0]<-1 
ALLcast_9000_cast3$D1PA[ALLcast_9000_cast3$D1>0]<-1
ALLcast_9000_cast3$F1PA[ALLcast_9000_cast3$F1>0]<-1
ALLcast_9000_cast3$G3PA[ALLcast_9000_cast3$G3>0]<-1
ALLcast_9000_cast3$C1PA[ALLcast_9000_cast3$C1==0]<-0
ALLcast_9000_cast3$D1PA[ALLcast_9000_cast3$D1==0]<-0
ALLcast_9000_cast3$F1PA[ALLcast_9000_cast3$F1==0]<-0
ALLcast_9000_cast3$G3PA[ALLcast_9000_cast3$G3==0]<-0

# add column with # of types of symbs
ALLcast_9000_cast3$infectNum<-ALLcast_9000_cast3$C1PA+ALLcast_9000_cast3$D1PA+ALLcast_9000_cast3$F1PA+ALLcast_9000_cast3$G3PA

# pull out by tmep
Infect27<-subset(ALLcast_9000_cast3, Temp==27)
Infect27<-subset(Infect27, select=c( "Day", "infectNum"))
#write.csv(Infect27, "Infect27.csv")


Infect30<-subset(ALLcast_9000_cast3, Temp==30)
Infect30<-subset(Infect30, select=c( "Day", "infectNum"))
#write.csv(Infect30, "Infect30.csv")

Infect31<-subset(ALLcast_9000_cast3, Temp==31)
Infect31<-subset(Infect31, select=c( "Day", "infectNum"))
#write.csv(Infect31, "Infect31.csv")

#upload formated df
NumbSymb<-read.csv("NumbSymbInfection_20191230.csv")
NumbSymb_B<-melt(NumbSymb, id=c("Day","Temp"))
#plot

#plot
Infect27_plot<-ggplot(NumbSymb_B, aes(y=value, x=Day, full=Temp)) + 
           geom_bar(stat="identity")+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("# of types of symbionts"))) +
  ggtitle("27C");Infect27_plot           
            
```

```{r}
# Stacked bar plots 
#27 
All_PA_27<-subset(ALLcast_9000_cast3, Temp==27)
All_PA_27_D3<-subset(All_PA_27, Day==3)
All_PA_27_D7<-subset(All_PA_27, Day==7)
All_PA_27_D14<-subset(All_PA_27, Day==14)

``` 


##Make Relative Abundance dataframe, rerun ALL MULTI plots above with relative abundance data
```{r}
#ALLS, ddPCR

#use ALLcast_9000_cast2b
#calc relative abundance for each

ALL_RelA<-ALLcast_9000_cast2b #copy

ALL_RelA$Cladocopium<-ALL_RelA$C1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Durusdinium<-ALL_RelA$D1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Fugacium<-ALL_RelA$F1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$Gerakladium<-ALL_RelA$G3/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)

ALL_RelA<-na.omit(ALL_RelA)# remove any rows without values for primers
ALL_RelAvar<-c("Day", "Temp", "ALL.number","Cladocopium","Durusdinium","Fugacium" ,"Gerakladium")
ALL_RelA_a<-ALL_RelA[ALL_RelAvar]
ALL_RelA_b<-melt(ALL_RelA_a, id=c("Day", "Temp", "ALL.number"), measure.vars = c("Cladocopium","Durusdinium","Fugacium" ,"Gerakladium"))
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="variable"]<-"Symbiont" #rename value col

``` 

Plot RA as stacked bar plots by Day and then by temp 

```{r}

#pull out by temp
ALL_RelA_27<-subset(ALL_RelA_b, Temp=="27")
ALL_RelA_30<-subset(ALL_RelA_b, Temp=="30")
ALL_RelA_31<-subset(ALL_RelA_b, Temp=="31")

```

27C - ALL relative abundance stacked bar
```{r}
#27C means
ALL_RelA_27_mean <- ddply(ALL_RelA_27, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_27_mean #display table

#round to nearest integer
ALL_RelA_27_mean$mean100<-ALL_RelA_27_mean$mean*100
ALL_RelA_27_mean$mean100r<-round(ALL_RelA_27_mean$mean100, digits = 1)

  #bar plot          
 ALL_STP_27<-ggplot(ALL_RelA_27_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) +  
           geom_bar(stat="identity")+ 
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+ 
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae (%)"))) +  
  ggtitle("27C");ALL_STP_27     
 
 #line plot
 ALL_STP_27_line<-ggplot(data=ALL_RelA_27_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("27C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_27_line
            
```

30C - ALL relative abundance stacked bar
```{r}
#30C means
ALL_RelA_30_mean <- ddply(ALL_RelA_30, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_30_mean #display table

#round to nearest integer
ALL_RelA_30_mean$mean100<-ALL_RelA_30_mean$mean*100
ALL_RelA_30_mean$mean100r<-round(ALL_RelA_30_mean$mean100, digits = 1)

#bar plot
ALL_STP_30<-ggplot(ALL_RelA_30_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) + 
           geom_bar(stat="identity")+
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae (%)"))) +
  ggtitle("30C");ALL_STP_30     


#line plot
 ALL_STP_30_line<-ggplot(data=ALL_RelA_30_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("30C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_30_line
            
```
31C - ALL relative abundance stacked bar
```{r}
#31C means
ALL_RelA_31_mean <- ddply(ALL_RelA_31, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_31_mean #display table

#round to nearest integer
ALL_RelA_31_mean$mean100<-ALL_RelA_31_mean$mean*100
ALL_RelA_31_mean$mean100r<-round(ALL_RelA_31_mean$mean100, digits = 1)

#bar plot
ALL_STP_31<-ggplot(ALL_RelA_31_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) + 
           geom_bar(stat="identity")+
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae (%)"))) +
  ggtitle("31C");ALL_STP_31    

#line plot
 ALL_STP_31_line<-ggplot(data=ALL_RelA_31_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
            scale_color_locuszoom()+
  xlab("Days") + #Label the X Axis 
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("31C_RelAbund")+
  theme(plot.title = element_text(size=20));ALL_STP_31_line
            
```

Plot all temps together (Rel Abund)
```{r}
 #bar
ALL_STP_27<-ALL_STP_27+ theme(legend.position = "none") #remove legend 
ALL_STP_30<-ALL_STP_30+ theme(legend.position = "none") #remove legend
ALL_STP_31<-ALL_STP_31+ theme(legend.position = "none") #remove legend
grid.arrange(ALL_STP_27, ALL_STP_30, ALL_STP_31, nrow = 1)

#line
ALL_STP_27_line<-ALL_STP_27_line+ theme(legend.position = "none") #remove legend 
ALL_STP_30_line<-ALL_STP_30_line+ theme(legend.position = "none") #remove legend
#ALL_STP_31_line<-ALL_STP_31_line+ theme(legend.position = "none") #remove legend
 
grid.arrange(ALL_STP_27_line, ALL_STP_30_line, ALL_STP_31_line, nrow = 1)
``` 


##Plot multi RelAbund under plots of single counts, pull multi out by clade
```{r} 
C1_27C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Cladocopium")
D1_27C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Durusdinium")
F1_27C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Fugacium")
G3_27C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Gerakladium")

C1_30C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Cladocopium")
D1_30C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Durusdinium")
F1_30C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Fugacium")
G3_30C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Gerakladium")

C1_31C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Cladocopium")
D1_31C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Durusdinium")
F1_31C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Fugacium")
G3_31C_multi_RelAb<-subset(ALL_RelA_b, Symbiont=="Gerakladium")

#bind by clade
#C1
C1_MULTI_RelAb<-rbind(C1_27C_multi_RelAb,C1_30C_multi_RelAb,C1_31C_multi_RelAb)
#D1
D1_MULTI_RelAb<-rbind(D1_27C_multi_RelAb,D1_30C_multi_RelAb,D1_31C_multi_RelAb)
#C1
F1_MULTI_RelAb<-rbind(F1_27C_multi_RelAb,F1_30C_multi_RelAb,F1_31C_multi_RelAb)
#C1
G3_MULTI_RelAb<-rbind(G3_27C_multi_RelAb,G3_30C_multi_RelAb,G3_31C_multi_RelAb)
```

PLOT C1 Multi infection
```{r}
C1_MULTI_RelAb_mean <- ddply(C1_MULTI_RelAb, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_MULTI_RelAb_mean #display table
C1_MULTI_RelAb_mean<-na.omit(C1_MULTI_RelAb_mean)

C1_MULTI_RelAb_plot<-ggplot(data=C1_MULTI_RelAb_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("27C C1 Multi Relabund")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_MULTI_RelAb_plot
``` 

PLOT D1 Multi infection
```{r}
D1_MULTI_RelAb_mean <- ddply(D1_MULTI_RelAb, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_MULTI_RelAb_mean #display table
D1_MULTI_RelAb_mean<-na.omit(D1_MULTI_RelAb_mean)

D1_MULTI_RelAb_plot<-ggplot(data=D1_MULTI_RelAb_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
    ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1 27C Multi RelAbund")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_MULTI_RelAb_plot
``` 

PLOT F1 Multi infection
```{r}
F1_MULTI_RelAb_mean <- ddply(F1_MULTI_RelAb, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_MULTI_RelAb_mean #display table
F1_MULTI_RelAb_mean<-na.omit(F1_MULTI_RelAb_mean)

F1_MULTI_RelAb_plot<-ggplot(data=F1_MULTI_RelAb_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
      ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1 27C Multi Raw Counts")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_MULTI_RelAb_plot
``` 

PLOT G3 Multi infection
```{r}
G3_MULTI_RelAb_mean <- ddply(G3_MULTI_RelAb, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_MULTI_RelAb_mean #display table
G3_MULTI_RelAb_mean<-na.omit(G3_MULTI_RelAb_mean)

G3_MULTI_RelAb_plot<-ggplot(data=G3_MULTI_RelAb_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
        ylim(0, 1) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3 27C Multi RelAbund")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_MULTI_RelAb_plot
``` 

Plot all Symbiont multi ALL  together:
```{r}
#line plot 
C1_MULTI_RelAb_plot<-C1_MULTI_RelAb_plot+ theme(legend.position = "none") #remove legend
D1_MULTI_RelAb_plot<-D1_MULTI_RelAb_plot+ theme(legend.position = "none") #remove legend
F1_MULTI_RelAb_plot<-F1_MULTI_RelAb_plot+ theme(legend.position = "none") #remove legend
G3_MULTI_RelAb_plot<-G3_MULTI_RelAb_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

C1Full_plot_9000<-C1Full_plot_9000+ theme(legend.position = "none") #remove legend
D1Full_plot_9000<-D1Full_plot_9000+ theme(legend.position = "none") #remove legend
F1Full_plot_9000<-F1Full_plot_9000+ theme(legend.position = "none") #remove legend
G3_MULTI_plot<-G3_MULTI_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_MULTI_RelAb_plot, D1_MULTI_RelAb_plot, F1_MULTI_RelAb_plot, G3_MULTI_RelAb_plot, nrow = 1)

# plot single relabund plots over Multi clade plots
grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000,
  C1_MULTI_RelAb_plot, D1_MULTI_RelAb_plot, F1_MULTI_RelAb_plot, G3_MULTI_RelAb_plot, nrow = 2)

# plot single relabund plots over Multi clade plots - plot clades next to eachother, not on top
grid.arrange(C1Full_plot_9000,C1_MULTI_RelAb_plot, D1Full_plot_9000,D1_MULTI_RelAb_plot, F1Full_plot_9000,F1_MULTI_RelAb_plot, G3Full_plot_9000,G3_MULTI_RelAb_plot, nrow = 2)
```

















#Statistics
https://rlbarter.github.io/Practical-Statistics/2017/05/10/generalized-estimating-equations-gee/
*****Do you want to use GEE instead of Lmer , it's non parametric*****

Single infections
```{r}  
hist(C1Full$cells.larvae) #not normal
hist(D1Full$cells.larvae) #not normal
hist(F1Full$cells.larvae) #not normal
hist(G3Full$cells.larvae) #not normal

#can't use poisson if non integer WHAT IF YOU ROUND ALL YOUR COUNT DATA! ****** IF you go this route, add in earlier in code for plots

C1Full$cells.larvae_round<-round(C1Full$cells.larvae) 
D1Full$cells.larvae_round<-round(D1Full$cells.larvae) 
F1Full$cells.larvae_round<-round(F1Full$cells.larvae) 
G3Full$cells.larvae_round<-round(G3Full$cells.larvae) 

#log transform the rounded values
C1Full$cells.larvae_log<-log(C1Full$cells.larvae_round+1)
  hist(C1Full$cells.larvae_log) #more normal
D1Full$cells.larvae_log<-log(D1Full$cells.larvae_round+1)
  hist(D1Full$cells.larvae_log) #more normal
F1Full$cells.larvae_log<-log(F1Full$cells.larvae_round+1)
  hist(F1Full$cells.larvae_log) #more normal
G3Full$cells.larvae_log<-log(G3Full$cells.larvae_round+1)
  hist(G3Full$cells.larvae_log) #more normal, scewed right?
  
Singles<-rbind(C1Full,D1Full,F1Full,G3Full)
hist(Singles$cells.larvae_log) # still large left tail
```
 
###SINGLE
```{r}
#test for sucessful infection(binomal, infect or not)


#C1
C1InfectorNot<-subset(C1Full, cells.larvae_round==0)
D1InfectorNot<-subset(D1Full, cells.larvae_round==0)
F1InfectorNot<-subset(F1Full, cells.larvae_round==0)
G3InfectorNot<-subset(G3Full, cells.larvae_round==0)

```

Model 1: lmer(cell.counts~Day*Temp) using log transformed! Raw counts  

(DECIDE WHAT TO DO WITH THIS:
let's deal with the fact your data is not normal no matter what you do###
  # Krustal-Wallis rank sum test
By day 
kruskal.test(cells.larvae ~ Temp, data = C1Full_D3) # Day 3 p-value = 0.08037
kruskal.test(cells.larvae ~ Temp, data = C1Full_D7) #Day 7 p-value = 3.585e-07
kruskal.test(cells.larvae ~ Temp, data = C1Full_D14) # Day 14 p-value = 1.073e-05)

C1 single  
```{r}
#C1  
library(moments)

## tests for assumptions (from CW git)
  C1Full_test<-lmer(cells.larvae_log~Day*Temp+(1|Pot), data=C1Full, na.action=na.exclude)
  R <- resid(C1Full_test) #save glm residuals
  Y.shapiro <- shapiro.test(R) #runs a normality test on residuals
  print(Y.shapiro) # null = normally distrubuted (P<0.05 = non-normal) p<0.05, data not normal...what are you going to do about it

  hist(C1Full$cells.larvae)
hist(C1Full$cells.larvae_log)
hist(C1Full$zscore)
skewness(C1Full$cells.larvae_log, na.rm=T) #.416 moderately skewed 
skewness(C1Full$zscore, na.rm=T) #.416 moderately skewed 


## lmer  All Days
C1mod<-lmer(cells.larvae_log~Day*Temp+(1|Pot), C1Full)
summary(C1mod) #for std err df and t
qqPlot(residuals(C1mod))   #  not awful
anova(C1mod)
  emm<-emmeans(C1mod,  ~ Temp *Day, adjust="Tukey")
cld(emm, Letter="abcdefg")


#Try single dates only
#D3
C1Full_D3<-subset(C1Full, Day==3)
  C1_D3_mod<-lmer(cells.larvae_log~Temp+(1|Pot), C1Full_D3)
  hist(C1Full_D3$cells.larvae_log)
  qqPlot(residuals(C1_D3_mod))  #weird line but close enough?
   # hist(C1Full_D3$zscore)
  anova(C1_D3_mod)
 emm<-emmeans(C1_D3_mod,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")

#D7
C1Full_D7<-subset(C1Full, Day==7)
  C1_D7_mod<-lmer(cells.larvae_log~Temp+(1|Pot), C1Full_D7)
  hist(C1Full_D7$cells.larvae_log)
    qqPlot(residuals(C1_D7_mod))  #good
  anova(C1_D7_mod)
emm<-emmeans(C1_D7_mod,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")

#D14
C1Full_D14<-subset(C1Full, Day==14)
  C1_D14_mod<-lmer(cells.larvae_log~Temp+(1|Pot), C1Full_D14)
  anova(C1_D14_mod)
emm<-emmeans(C1_D14_mod,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")  
  

############## glmer() https://www.dataquest.io/blog/tutorial-poisson-regression-in-r/
#also I'm assuming i should not transform data here and instead use raw. 

## glmer  All Days
C1mod_glmer<-glmer(cells.larvae_round~Day*Temp+(1|Pot), data=C1Full,family=poisson(link="log"))
summary(C1mod_glmer) #for std err df and t
qqPlot(residuals(C1mod_glmer))            #  bad 
  emm<-emmeans(C1mod_glmer,  ~ Temp *Day, adjust="Tukey")
cld(emm, Letter="abcdefg")

#D3
  C1_D3_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=C1Full_D3, family=poisson(link="log"))
  hist(C1Full_D3$cells.larvae_round)
  qqPlot(residuals(C1_D3_mod_glmer))  #ok
  summary(C1_D3_mod_glmer)
emm<-emmeans(C1_D3_mod_glmer,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefgh")

#D7
C1_D7_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=C1Full_D7, family=poisson(link="log"))
  hist(C1Full_D7$cells.larvae_round)
  qqPlot(residuals(C1_D7_mod_glmer))  #ok
  summary(C1_D7_mod_glmer)
 emm<-emmeans(C1_D7_mod_glmer,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")

#D14
C1_D14_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=C1Full_D14, family=poisson(link="log"))
  hist(C1Full_D14$cells.larvae_round)
  qqPlot(residuals(C1_D14_mod_glmer))  #ok
  summary(C1_D14_mod_glmer)
 emm<-emmeans(C1_D14_mod_glmer,  ~ Temp, adjust="Tukey")
cld(emm, Letter="abcdefg")
```
D1 singles    
```{r}
#D1 
## tests for assumptions (from CW git)
  D1Full_test<-lmer(cells.larvae_log~Day*Temp+(1|Pot), data=D1Full, na.action=na.exclude)
  R <- resid(D1Full_test) #save glm residuals
  Y.shapiro <- shapiro.test(R) #runs a normality test on residuals
  print(Y.shapiro) # null = normally distrubuted (P<0.05 = non-normal) p<0.05, data not normal...what are you going to do about it

  hist(D1Full$cells.larvae)
hist(D1Full$cells.larvae_log)
hist(D1Full$zscore)
skewness(D1Full$cells.larvae_log, na.rm=T) #.416 moderately skewed 
skewness(D1Full$zscore, na.rm=T) #.416 moderately skewed 


## lmer()
D1mod<-lmer(cells.larvae_log~Day*Temp+(1|Pot), D1Full)
#summary(D1mod)
qqPlot(residuals(D1mod))  # not amazing
anova(D1mod)
  emmeans(D1mod, pairwise ~ Temp |Day)
  
#Try single dates only
#D3
D1Full_D3<-subset(D1Full, Day==3)
  D1_D3_mod<-lmer(cells.larvae_log~Temp+(1|Pot), D1Full_D3)
  hist(D1Full_D3$cells.larvae_log)
  qqPlot(residuals(D1_D3_mod))  #weird line but close enough?
   # hist(D1Full_D3$zscore)
  anova(D1_D3_mod)
  emmeans(D1_D3_mod, pairwise ~ Temp)

#D7
D1Full_D7<-subset(D1Full, Day==7)
  D1_D7_mod<-lmer(cells.larvae_log~Temp+(1|Pot), D1Full_D7)
  hist(D1Full_D7$cells.larvae_log)
    qqPlot(residuals(D1_D7_mod))  #ok
  anova(D1_D7_mod)
  emmeans(D1_D7_mod, pairwise ~ Temp)

#D14
D1Full_D14<-subset(D1Full, Day==14)
  D1_D14_mod<-lmer(cells.larvae_log~Temp+(1|Pot), D1Full_D14)
      qqPlot(residuals(D1_D14_mod))  #good
  anova(D1_D14_mod)
  emmeans(D1_D14_mod, pairwise ~ Temp)
  
  
##glmer
# use ROUNDED data and use log in the link
D1_glmer<-glmer(cells.larvae_round~Temp*Day+(1|Pot), data=D1Full, family=poisson(link="log"))
summary(D1_glmer)
      qqPlot(residuals(D1_glm))  #ok
      
      
#D3
  D1_D3_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=D1Full_D3, family=poisson(link="log"))
  hist(D1Full_D3$cells.larvae_round)
  qqPlot(residuals(D1_D3_mod_glmer))  #ok
  summary(D1_D3_mod_glmer)
  emmeans(D1_D3_mod, pairwise ~ Temp)

#D7
D1_D7_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=D1Full_D7, family=poisson(link="log"))
  hist(D1Full_D7$cells.larvae_round)
  qqPlot(residuals(D1_D7_mod_glmer))  #good
  summary(D1_D7_mod_glmer)
  emmeans(D1_D7_mod, pairwise ~ Temp)

#D14
D1_D14_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=D1Full_D14, family=poisson(link="log"))
  hist(D1Full_D14$cells.larvae_round)
  qqPlot(residuals(D1_D14_mod_glmer))  #ok
  summary(D1_D14_mod_glmer)
  emmeans(D1_D14_mod, pairwise ~ Temp)

```
F1 singles  
```{r}
#F1  
 #let's try to deal with this. add an "ID" for each larvae individual
  F1Full$ID<-seq.int(nrow(F1Full))




## tests for assumptions (from CW git)
  F1Full_test<-lmer(cells.larvae_log~Day*Temp+(1|Pot), data=F1Full, na.action=na.exclude)
  R <- resid(F1Full_test) #save glm residuals
  Y.shapiro <- shapiro.test(R) #runs a normality test on residuals
  print(Y.shapiro) # null = normally distrubuted (P<0.05 = non-normal) p<0.05, data not normal...what are you going to do about it

  hist(F1Full$cells.larvae)
hist(F1Full$cells.larvae_log)
hist(F1Full$zscore)
skewness(F1Full$cells.larvae_log, na.rm=T) #.416 moderately skewed 
skewness(F1Full$zscore, na.rm=T) #.416 moderately skewed 


## lmer()
F1mod<-lmer(cells.larvae_log~Day*Temp+(1|Pot), F1Full)
summary(F1mod)
qqPlot(residuals(F1mod))  # kinda ok
anova(F1mod)

  F1mod_em<- emmeans(F1mod, ~Temp, adjust="tukey")  #from AH code, use emmmeans this way?
cld(F1mod_em, Letters=c(LETTERS)) #letter display  

#anova(F1mod, ddf = "Kenward-Roger")  #does the interaction matter or can we just do additive, from Kyle's lecture. 



  #Try single dates only
#D3
F1Full_D3<-subset(F1Full, Day==3)
  F1_D3_mod<-lmer(cells.larvae_log~Temp+(1|Pot), F1Full_D3)
  hist(F1Full_D3$cells.larvae_log)
  qqPlot(residuals(F1_D3_mod))  #close
   # hist(F1Full_D3$zscore)
  anova(F1_D3_mod)
  emmeans(F1_D3_mod, pairwise ~ Temp)

#D7
F1Full_D7<-subset(F1Full, Day==7)
  F1_D7_mod<-lmer(cells.larvae_log~Temp+(1|Pot), F1Full_D7)
  hist(F1Full_D7$cells.larvae_log)
    qqPlot(residuals(F1_D7_mod))  #ok
  anova(F1_D7_mod)
  emmeans(F1_D7_mod, pairwise ~ Temp)

#F14
F1Full_F14<-subset(F1Full, Day==14)
  F1_F14_mod<-lmer(cells.larvae_log~Temp+(1|Pot), F1Full_F14)
      qqPlot(residuals(F1_F14_mod))  #good
  anova(F1_F14_mod)
  emmeans(F1_F14_mod, pairwise ~ Temp)
  
  
##glmer
# use ROUNDED data and use log in the link
F1_glmer<-glmer(cells.larvae_round~Temp*Day+(1|Pot), data=F1Full, family=poisson(link="log"))
summary(F1_glmer)
      qqPlot(residuals(F1_glmer))  #not great, top not good at all. 
      
   plot(allEffects(F1_glmer))
   library(RVAideMemoire)
overdisp.glmer(F1_glmer) #Residual deviance: 20927.305 on 137 degrees of freedom (ratio: 152.754) dude that is awful. 



#D3
  F1_D3_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=F1Full_D3, family=poisson(link="log"))
  hist(F1Full_D3$cells.larvae_round)
  qqPlot(residuals(F1_D3_mod_glmer))  #ok
  summary(F1_D3_mod_glmer)
  emmeans(F1_D3_mod, pairwise ~ Temp)
  
  #let's see if we can deal with overdispersion
  overdisp.glmer(F1_D3_mod_glmer) #ration 22.104, still high
    F1_D3_mod_glmer2<-glmer(cells.larvae_round~Temp+(1|Pot)+(1|ID), data=F1Full_D3, family=poisson(link="log"))
  overdisp.glmer(F1_D3_mod_glmer2) #ratio: 0.253 <-- damn ok what!? adding in the ID as random effect took care of overdispersion, but shit it should be ~1. kyle says better to keep it in.
  
  ###Kyle stuff not running right below
    mod.id.notreat<-glmer(cells.larvae_round~1+(1|Pot)+(1|ID), data=F1Full_D3, family=poisson(link="log"))
    mod.id<-glmer(cells.larvae_round~Temp+(1|Pot)+(1|ID), data=F1Full_D3, family=poisson(link="log"))
  sim.pollen=simulate(mod.id.notreat, nsim=1000)
  LR=vector()
  for(i in 1:1000) { +
  mod.full=glmer(sim.pollen[[i]]~Temp +(1|Pot)+(1|ID), data=F1Full_D3, family=poisson(link = "log"))+
  mod.res=glmer(sim.pollen[[i]]~1+(1|Pot)+(1|ID), data=F1Full_D3, family = poisson(link = "log"))
  LR[i]=2*(logLik(mod.full)-logLik(mod.res))}

  
#D7
F1_D7_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=F1Full_D7, family=poisson(link="log"))
  hist(F1Full_D7$cells.larvae_round)
  qqPlot(residuals(F1_D7_mod_glmer))  #not great
  summary(F1_D7_mod_glmer)
  emmeans(F1_D7_mod, pairwise ~ Temp)
dispersion_glmer(F1_D7_mod_glmer)

#F14
F1_F14_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=F1Full_F14, family=poisson(link="log"))
  hist(F1Full_F14$cells.larvae_round)
  qqPlot(residuals(F1_F14_mod_glmer))  #good
  summary(F1_F14_mod_glmer)
  emmeans(F1_F14_mod, pairwise ~ Temp)

```
G3 singles  
```{r}
#G3 
## tests for assumptions (from CW git)
  G3Full_test<-lmer(cells.larvae_log~Day*Temp+(1|Pot), data=G3Full, na.action=na.exclude)
  R <- resid(G3Full_test) #save glm residuals
  Y.shapiro <- shapiro.test(R) #runs a normality test on residuals
  print(Y.shapiro) # null = normally distrubuted (P<0.05 = non-normal) p<0.05, data not normal...what are you going to do about it

  hist(G3Full$cells.larvae)
hist(G3Full$cells.larvae_log)
hist(G3Full$zscore)
skewness(G3Full$cells.larvae_log, na.rm=T)
skewness(G3Full$zscore, na.rm=T) #-0.6625293


## lmer()
G3mod<-lmer(cells.larvae_log~Day*Temp+(1|Pot), G3Full)
#summary(G3mod)
qqPlot(residuals(G3mod))  # good except points at base
anova(G3mod)
emmeans(G3mod, pairwise ~ Temp |Day,adjust="tukey")    #the anova says that day is significant, but 
  #cld(emm, Letters=c(LETTERS)) This is throwing an error
  
#Try single dates only
#D3
G3Full_D3<-subset(G3Full, Day==3)
  G3_D3_mod<-lmer(cells.larvae_log~Temp+(1|Pot), G3Full_D3)
  hist(G3Full_D3$cells.larvae_log) #normal!
  qqPlot(residuals(G3_D3_mod))  #good
   # hist(G3Full_D3$zscore)
  anova(G3_D3_mod)
  emm=emmeans(G3_D3_mod, pairwise ~ Temp)

#D7
G3Full_D7<-subset(G3Full, Day==7)
  G3_D7_mod<-lmer(cells.larvae_log~Temp+(1|Pot), G3Full_D7)
  hist(G3Full_D7$cells.larvae_log) # skew negative
    qqPlot(residuals(G3_D7_mod))  #good
  anova(G3_D7_mod)
  emmeans(G3_D7_mod, pairwise ~ Temp)

#G34
G3Full_G34<-subset(G3Full, Day==14)
  hist(G3Full_D14$cells.larvae_log) # skew negative
  G3_G34_mod<-lmer(cells.larvae_log~Temp+(1|Pot), G3Full_G34)
      qqPlot(residuals(G3_G34_mod))  #good
  anova(G3_G34_mod)
  emmeans(G3_G34_mod, pairwise ~ Temp)
  
  
##glmer
# use ROUNDED data and use log in the link
G3_glmer<-glmer(cells.larvae_round~Temp*Day+(1|Pot), data=G3Full, family=poisson(link="log"))
summary(G3_glmer)
hist(G3Full$cells.larvae_round) #poisson
      qqPlot(residuals(G3_glmer))  #top off
        emmeans(G3_glmer, pairwise ~ Temp|Day) #not sure if this is the right way to do posthoc

      
#D3
  G3_D3_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=G3Full_D3, family=poisson(link="log"))
  hist(G3Full_D3$cells.larvae_round) #poisson
  qqPlot(residuals(G3_D3_mod_glmer))  #good up until top
  summary(G3_D3_mod_glmer)
  emmeans(G3_D3_mod, pairwise ~ Temp)

#D7
G3_D7_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=G3Full_D7, family=poisson(link="log"))
  hist(G3Full_D7$cells.larvae_round)
  qqPlot(residuals(G3_D7_mod_glmer))  #good
  summary(G3_D7_mod_glmer)
  emmeans(G3_D7_mod, pairwise ~ Temp)

#G34
G3_G34_mod_glmer<-glmer(cells.larvae_round~Temp+(1|Pot), data=G3Full_G34, family=poisson(link="log"))
  hist(G3Full_G34$cells.larvae_round)
  qqPlot(residuals(G3_G34_mod_glmer))  #ok except top
  summary(G3_G34_mod_glmer)
  emmeans(G3_G34_mod, pairwise ~ Temp)

```
All singles  
```{r} 
#subset by temp
AllSing_27<-subset(Singles, Temp==27)
AllSing_30<-subset(Singles, Temp==30)
AllSing_31<-subset(Singles, Temp==31) 

# subset by day 
AllSing_27_D3<-subset(AllSing_27, Day==3)
AllSing_27_D7<-subset(AllSing_27, Day==7)
AllSing_27_D14<-subset(AllSing_27, Day==14)

AllSing_30_D3<-subset(AllSing_30, Day==3)
AllSing_30_D7<-subset(AllSing_30, Day==7)
AllSing_30_D14<-subset(AllSing_30, Day==14)

AllSing_31_D3<-subset(AllSing_31, Day==3)
AllSing_31_D7<-subset(AllSing_31, Day==7)
AllSing_31_D14<-subset(AllSing_31, Day==14)


#### 27C
## Day 3
AllSing_27_D3_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_27_D3)
anova(AllSing_27_D3_mod) 
emm_AllSing_27_D3_mod = emmeans(AllSing_27_D3_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_27_D3_mod, Letters=c(LETTERS)) #letter display 

## Day 7
AllSing_27_D7_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_27_D7)
anova(AllSing_27_D7_mod) 
emm_AllSing_27_D7_mod = emmeans(AllSing_27_D7_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_27_D7_mod, Letters=c(LETTERS)) #letter display 

## Day 14
AllSing_27_D14_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_27_D14)
anova(AllSing_27_D14_mod) 
emm_AllSing_27_D14_mod = emmeans(AllSing_27_D14_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_27_D14_mod, Letters=c(LETTERS)) #letter display 

#### 30C
## Day 3
AllSing_30_D3_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_30_D3)
anova(AllSing_30_D3_mod) 
emm_AllSing_30_D3_mod = emmeans(AllSing_30_D3_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_30_D3_mod, Letters=c(LETTERS)) #letter display 

## Day 7
AllSing_30_D7_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_30_D7)
anova(AllSing_30_D7_mod) 
emm_AllSing_30_D7_mod = emmeans(AllSing_30_D7_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_30_D7_mod, Letters=c(LETTERS)) #letter display 

## Day 14
AllSing_30_D14_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_30_D14)
anova(AllSing_30_D14_mod) 
emm_AllSing_30_D14_mod = emmeans(AllSing_30_D14_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_30_D14_mod, Letters=c(LETTERS)) #letter display 


#### 30C
## Day 3
AllSing_31_D3_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_31_D3)
anova(AllSing_31_D3_mod) 
emm_AllSing_31_D3_mod = emmeans(AllSing_31_D3_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_31_D3_mod, Letters=c(LETTERS)) #letter display 

## Day 7S
AllSing_31_D7_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_31_D7)
anova(AllSing_31_D7_mod) 
emm_AllSing_31_D7_mod = emmeans(AllSing_31_D7_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_31_D7_mod, Letters=c(LETTERS)) #letter display 

## Day 14 
AllSing_31_D14_mod<-lmer(cells.larvae_log~Symbiont+(1|Pot), AllSing_31_D14)
anova(AllSing_31_D14_mod) 
emm_AllSing_31_D14_mod = emmeans(AllSing_31_D14_mod, ~  Symbiont, adjust="tukey")
cld(emm_AllSing_31_D14_mod, Letters=c(LETTERS)) #letter display 
```

Single comparision at days between symbs, PLOTS
```{r}
 
#subset by day
AllSing_D3<-subset(Singles, Day==3)
AllSing_D3$Symbiont<-as.character(AllSing_D3$Symbiont) 
AllSing_D7<-subset(Singles, Day==7)
AllSing_D7$Symbiont<-as.character(AllSing_D7$Symbiont)
AllSing_D14<-subset(Singles, Day==14)
AllSing_D14$Symbiont<-as.character(AllSing_D14$Symbiont)
 
#Day 3
AllSing_D3_mean <- ddply(AllSing_D3, c("Temp","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
AllSing_D3_mean #display table

AllSing_D3_mean_plot<-ggplot(AllSing_D3_mean, aes(y=mean, x=Temp, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") +  #Label the X Axis 
            scale_fill_locuszoom()+
   xlab("Temp")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Single, Day 3");AllSing_D3_mean_plot   

#Day 7
AllSing_D7_mean <- ddply(AllSing_D7, c("Temp","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
AllSing_D7_mean #display table

AllSing_D7_mean_plot<-ggplot(AllSing_D7_mean, aes(y=mean, x=Temp, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") +  #Label the X Axis 
            scale_fill_locuszoom()+
   xlab("Temp")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Single, Day 7");AllSing_D7_mean_plot   


#Day 14
AllSing_D14_mean <- ddply(AllSing_D14, c("Temp","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
AllSing_D14_mean #display table

AllSing_D14_mean_plot<-ggplot(AllSing_D14_mean, aes(y=mean, x=Temp, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000), limits=c(1,5000))+  xlab("Days") +  #Label the X Axis 
            scale_fill_locuszoom()+
   xlab("Temp")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Single, Day 14");AllSing_D14_mean_plot   

# plot all three together
AllSing_D3_mean_plot<-AllSing_D3_mean_plot+ theme(legend.position = "none") #remove legend
AllSing_D7_mean_plot<-AllSing_D7_mean_plot+ theme(legend.position = "none") #remove legend
AllSing_D14_mean_plot<-AllSing_D14_mean_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(AllSing_D3_mean_plot, AllSing_D7_mean_plot, AllSing_D14_mean_plot, nrow = 1)


```
 

 wtf
```{r} 
## 
MULTImod<-lmer(cells.larvae_log~Day*Temp*Symbiont+(1|Pot), Singles)
#summary(MULTImod)
anova(MULTImod)
#emm_Multimod = emmeans(MULTImod, ~ Day*Temp*Symbiont, adjust="tukey")
#cld(emm_Multimod, Letters=c(LETTERS)) #letter display
emmeans(MULTImod, pairwise ~ Temp *Day*Symbiont)
cld(test, Letters=c(LETTERS)) #letter display
```


#Multi-infection data, ALL1 data (cutoff 9000)
```{r} 
#ALL everything (this is way too big)
Allmod<-lmer(log(cells.larvae+1)~Day*Temp*Primer+(1|Pot), ALL1)  #All.number is the larvae ID
#summary(Allmod)
anova(Allmod)

#is Pot significant
Pottest<-lm(log(cells.larvae+1)~Pot, ALL1)  #All.number is the larvae ID
summary(Pottest) #nothing is significant but the intercept. could argue not needed. 

#conduct post hoc test
#emm_Allmod = emmeans(Allmod, ~ Day * Temp * Primer, adjust="tukey")
#cld(emm_Allmod, Letters=c(LETTERS))#letter display
emmeans(Allmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run ALL by dates
#ALL Day 3 
AllDay3<-subset(ALL1, Day=="3")
AllmodDay3<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay3)  #All.number is the larvae ID
anova(AllmodDay3)
#conduct post hoc test
#emm_AllmodDay3 = emmeans(AllmodDay3, ~ Temp * Primer, adjust="tukey")
  #letter display#$cld(emm_AllmodDay3, Letters=c(LETTERS))
emmeans(AllmodDay3, pairwise ~ Temp |Primer)

#ALL Day 7
AllDay7<-subset(ALL1, Day=="7")
AllmodDay7<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay7)  #All.number is the larvae ID
anova(AllmodDay7)
#conduct post hoc test
#emm_AllmodDay7 = emmeans(AllmodDay7, ~ Temp * Primer, adjust="tukey")
  #cld(emm_AllmodDay7, Letters=c(LETTERS))
emmeans(AllmodDay7, pairwise ~ Temp |Primer)

#ALL Day 14
AllDay14<-subset(ALL1, Day=="14")
all14<-c("Temp","Primer", "ALL.number","cells.larvae")
AllDay14<-AllDay14[all14]
AllDay14<-  AllDay14[!(AllDay14$Temp=="31"),] #remove 31
AllmodDay14<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay14)  #All.number is the larvae ID
anova(AllmodDay14)
#conduct post hoc test
#emm_AllmodDay14 = emmeans(AllmodDay14, ~ Temp * Primer, adjust="tukey")
#cld(emm_AllmodDay14, Letters=c(LETTERS))
emmeans(AllmodDay14, pairwise ~ Temp |Primer)
```


###Compare expected vs observed. Do this at each Time point (2-way easier to interpret)
C1
```{r}   
#copy df 
C1Full2<-C1Full
D1Full2<-D1Full
F1Full2<-F1Full 
G3Full2<-G3Full

#single infection, add new column "single.multi"
C1Full2$single.multi<-"single"
C1Full2$single.multi<-factor(C1Full2$single.multi, levels=c("single","multi"))
C1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
C1Full3<-C1Full2[C1Full2vars]

#multi infection, add new column "single.multi"
C1ALL<-subset(ALL1, Primer=="C1") #subset Primer
C1ALL$single.multi<-"multi" #multi
C1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
C1ALLb<-C1ALL[C1ALLvars]
C1ALLb$cells.larvae_log<-log(C1ALLb$cells.larvae+1) #log
colnames(C1ALLb)[colnames(C1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
C1_EO<-rbind(C1ALLb, C1Full3) 
C1_EO$single.multi<-factor(C1_EO$single.multi, levels=c("single","multi"))
```
C1 Day 3
```{r}
# Day 3
C1_EO.D3<-subset(C1_EO, Day=="3")
C1_EOmodD3<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D3)
anova(C1_EOmodD3)
emmeans(C1_EOmodD3, pairwise ~  single.multi|Temp)


#run by temp
#27
C1_EO.D3_27<-subset(C1_EO.D3, Temp==27)
C1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_27)
anova(C1_EO.D3_27_mod)

#30
C1_EO.D3_30<-subset(C1_EO.D3, Temp==30)
C1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_30)
anova(C1_EO.D3_30_mod)

#31
C1_EO.D3_31<-subset(C1_EO.D3, Temp==31)
C1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D3_31)
anova(C1_EO.D3_31_mod)

#means
C1_EO.D3mean <- ddply(C1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D3mean #display table


C1_EO.D3_plot<-ggplot(data=C1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp,shape=single.multi), size=5, show.legend = T)+
    scale_shape_manual(values=c(19,1))+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+

  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day3")+
  theme(plot.title = element_text(size=20));C1_EO.D3_plot
```

C1 Day 7 
```{r}
# Day 7
C1_EO.D7<-subset(C1_EO, Day=="7")

C1_EOmodD7<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D7)
anova(C1_EOmodD7)
emmeans(C1_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D7_27<-subset(C1_EO.D7, Temp==27)
C1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_27)
anova(C1_EO.D7_27_mod)

#30
C1_EO.D7_30<-subset(C1_EO.D7, Temp==30)
C1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_30)
anova(C1_EO.D7_30_mod)

#31
C1_EO.D7_31<-subset(C1_EO.D7, Temp==31)
C1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D7_31)
anova(C1_EO.D7_31_mod)

#means
C1_EO.D7mean <- ddply(C1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D7mean #display table


C1_EO.D7_plot<-ggplot(data=C1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.01,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day7")+
  theme(plot.title = element_text(size=20));C1_EO.D7_plot
```

C1 Day 14
```{r}
# Day 14
C1_EO.D14<-subset(C1_EO, Day=="14")

C1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), C1_EO.D14)
anova(C1_EOmodD14)
emmeans(C1_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
C1_EO.D14_27<-subset(C1_EO.D14, Temp==27)
C1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_27)
anova(C1_EO.D14_27_mod)

#30
C1_EO.D14_30<-subset(C1_EO.D14, Temp==30)
C1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_30)
anova(C1_EO.D14_30_mod)

#31
C1_EO.D14_31<-subset(C1_EO.D14, Temp==31)
C1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), C1_EO.D14_31)
anova(C1_EO.D14_31_mod)






#means
C1_EO.D14mean <- ddply(C1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D14mean #display table
C1_EO.D14mean<-na.omit(C1_EO.D14mean)

C1_EO.D14_plot<-ggplot(data=C1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(0,3000) + #set Y limits
         scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("C1_Day14")+
  theme(plot.title = element_text(size=20));C1_EO.D14_plot

```
Plot together

```{r}

C1_EO.D3_plot<-C1_EO.D3_plot+ theme(legend.position = "none") #remove legend
C1_EO.D7_plot<-C1_EO.D7_plot+ theme(legend.position = "none") #remove legend
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D3_plot, C1_EO.D7_plot, C1_EO.D14_plot, nrow = 1)
```

D1
```{r}
#single infection, add new column "single.multi"
D1Full2$single.multi<-"single"
D1Full2$single.multi<-factor(D1Full2$single.multi, levels=c("single","multi"))
D1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
D1Full3<-D1Full2[D1Full2vars]

#multi infection, add new column "single.multi"
D1ALL<-subset(ALL1, Primer=="D1") #subset Primer
D1ALL$single.multi<-"multi" #multi
D1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
D1ALLb<-D1ALL[D1ALLvars]
D1ALLb$cells.larvae_log<-log(D1ALLb$cells.larvae+1) #log
colnames(D1ALLb)[colnames(D1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
D1_EO<-rbind(D1ALLb, D1Full3)
D1_EO$single.multi<-factor(D1_EO$single.multi, levels=c("single","multi"))
```

D1 DAY3
```{R}
# Day 3
D1_EO.D3<-subset(D1_EO, Day=="3")

D1_EOmod<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D3)
anova(D1_EOmod)
emmeans(D1_EOmod, pairwise ~ Temp |Day)

#run by temp
#27
D1_EO.D3_27<-subset(D1_EO.D3, Temp==27)
D1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_27)
anova(D1_EO.D3_27_mod)

#30
D1_EO.D3_30<-subset(D1_EO.D3, Temp==30)
D1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_30)
anova(D1_EO.D3_30_mod)

#31
D1_EO.D3_31<-subset(D1_EO.D3, Temp==31)
D1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D3_31)
anova(D1_EO.D3_31_mod)

#means
D1_EO.D3mean <- ddply(D1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D3mean #display table


D1_EO.D3_plot<-ggplot(data=D1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day 3")+
  theme(plot.title = element_text(size=20));D1_EO.D3_plot
```

D1 DAY7
```{R}
# Day 7
D1_EO.D7<-subset(D1_EO, Day=="7")

D1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D7)
anova(D1_EOmodD7)
emmeans(D1_EOmodD7, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D7_27<-subset(D1_EO.D7, Temp==27)
D1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_27)
anova(D1_EO.D7_27_mod)

#30
D1_EO.D7_30<-subset(D1_EO.D7, Temp==30)
D1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_30)
anova(D1_EO.D7_30_mod)

#31
D1_EO.D7_31<-subset(D1_EO.D7, Temp==31)
D1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D7_31)
anova(D1_EO.D7_31_mod)


#means
D1_EO.D7mean <- ddply(D1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D7mean #display table


D1_EO.D7_plot<-ggplot(data=D1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day7")+
  theme(plot.title = element_text(size=20));D1_EO.D7_plot
```

D1 DAY14
```{R}
# Day 14
D1_EO.D14<-subset(D1_EO, Day=="14")

D1_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), D1_EO.D14)
anova(D1_EOmodD14)
emmeans(D1_EOmodD14, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
D1_EO.D14_27<-subset(D1_EO.D14, Temp==27)
D1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_27)
anova(D1_EO.D14_27_mod)

#30
D1_EO.D14_30<-subset(D1_EO.D14, Temp==30)
D1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), D1_EO.D14_30)
anova(D1_EO.D14_30_mod)

#means
D1_EO.D14mean <- ddply(D1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D14mean #display table
D1_EO.D14mean<-na.omit(D1_EO.D14mean)

D1_EO.D14_plot<-ggplot(data=D1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("D1_Day14")+
  theme(plot.title = element_text(size=20));D1_EO.D14_plot
```

Plot together D1

```{r}

D1_EO.D3_plot<-D1_EO.D3_plot+ theme(legend.position = "none") #remove legend
D1_EO.D7_plot<-D1_EO.D7_plot+ theme(legend.position = "none") #remove legend 
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead. 

grid.arrange(D1_EO.D3_plot, D1_EO.D7_plot, D1_EO.D14_plot, nrow = 1)
```
F1
```{r}
#single infection, add new column "single.multi"
F1Full2$single.multi<-"single"
F1Full2$single.multi<-factor(F1Full2$single.multi, levels=c("single","multi"))
F1Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
F1Full3<-F1Full2[F1Full2vars]

#multi infection, add new column "single.multi"
F1ALL<-subset(ALL1, Primer=="F1") #subset Primer
F1ALL$single.multi<-"multi" #multi
F1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
F1ALLb<-F1ALL[F1ALLvars]
F1ALLb$cells.larvae_log<-log(F1ALLb$cells.larvae+1) #log
colnames(F1ALLb)[colnames(F1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
F1_EO<-rbind(F1ALLb, F1Full3)
F1_EO$single.multi<-factor(F1_EO$single.multi, levels=c("single","multi"))

```
F1 Day 3
```{r}

F1_EO.D3<-subset(F1_EO, Day=="3")

F1_EOmod<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D3)
anova(F1_EOmod)
emmeans(F1_EOmod, pairwise ~ Temp |Day)
cld(test, Letters=c(LETTERS)) #letter display

#run by temp
#27
F1_EO.D3_27<-subset(F1_EO.D3, Temp==27)
F1_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_27)
anova(F1_EO.D3_27_mod)

#30
F1_EO.D3_30<-subset(F1_EO.D3, Temp==30)
F1_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_30)
anova(F1_EO.D3_30_mod)

#31
F1_EO.D3_31<-subset(F1_EO.D3, Temp==31)
F1_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D3_31)
anova(F1_EO.D3_31_mod)


#means
F1_EO.D3mean <- ddply(F1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D3mean #display table


F1_EO.D3_plot<-ggplot(data=F1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(-.1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 3")+
  theme(plot.title = element_text(size=20));F1_EO.D3_plot
```
F1 Day 7
```{r}
F1_EO.D7<-subset(F1_EO, Day=="7")

F1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D7)
anova(F1_EOmodD7)
emmeans(F1_EOmodD7, pairwise ~ Temp |single.multi)

#run by temp
#27
F1_EO.D7_27<-subset(F1_EO.D7, Temp==27)
F1_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_27)
anova(F1_EO.D7_27_mod)

#30
F1_EO.D7_30<-subset(F1_EO.D7, Temp==30)
F1_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_30)
anova(F1_EO.D7_30_mod)

#31
F1_EO.D7_31<-subset(F1_EO.D7, Temp==31)
F1_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D7_31)
anova(F1_EO.D7_31_mod)

#means
F1_EO.D7mean <- ddply(F1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D7mean #display table


F1_EO.D7_plot<-ggplot(data=F1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 7")+
  theme(plot.title = element_text(size=20));F1_EO.D7_plot

```

F1 Day 14
```{r}
F1_EO.D14<-subset(F1_EO, Day=="14")

F1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D14)
anova(F1_EOmodD14)
emmeans(F1_EOmodD14, pairwise ~ single.multi|Temp)

#run by temp
#27
F1_EO.D14_27<-subset(F1_EO.D14, Temp==27)
F1_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_27)
anova(F1_EO.D14_27_mod)

#30
F1_EO.D14_30<-subset(F1_EO.D14, Temp==30)
F1_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_30)
anova(F1_EO.D14_30_mod)

#31
F1_EO.D14_31<-subset(F1_EO.D14, Temp==31) 
F1_EO.D14_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), F1_EO.D14_31)
anova(F1_EO.D14_31_mod) 

#means
F1_EO.D14mean <- ddply(F1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_EO.D14mean #display table
F1_EO.D14mean<-na.omit(F1_EO.D14mean)

F1_EO.D14_plot<-ggplot(data=F1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("F1_Day 14")+
  theme(plot.title = element_text(size=20));F1_EO.D14_plot
```
 
Plot together F1 expect-observe

```{r}

F1_EO.D3_plot<-F1_EO.D3_plot+ theme(legend.position = "none") #remove legend
F1_EO.D7_plot<-F1_EO.D7_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(F1_EO.D3_plot, F1_EO.D7_plot, F1_EO.D14_plot, nrow = 1)
```
G3
```{r}
#single infection, add new column "single.multi"
G3Full2$single.multi<-"single"
G3Full2$single.multi<-factor(G3Full2$single.multi, levels=c("single","multi")) 
G3Full2vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi","cells.larvae_log")
G3Full3<-G3Full2[G3Full2vars] 

#multi infection, add new column "single.multi"
G3ALL<-subset(ALL1, Primer=="G3") #subset Primer 
G3ALL$single.multi<-"multi" #multi
G3ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
G3ALLb<-D1ALL[G3ALLvars] 
G3ALLb$cells.larvae_log<-log(G3ALLb$cells.larvae+1) #log
colnames(G3ALLb)[colnames(G3ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
G3_EO<-rbind(G3ALLb, G3Full3)
G3_EO$single.multi<-factor(G3_EO$single.multi, levels=c("single","multi"))
```

G3 Day 3
```{r}
G3_EO.D3<-subset(G3_EO, Day=="3")

G3_EOmod<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D3)
anova(G3_EOmod)
emmeans(G3_EOmod, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D3_27<-subset(G3_EO.D3, Temp==27)
G3_EO.D3_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_27)
anova(G3_EO.D3_27_mod)

#30
G3_EO.D3_30<-subset(G3_EO.D3, Temp==30)
G3_EO.D3_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_30)
anova(G3_EO.D3_30_mod)

#31
G3_EO.D3_31<-subset(G3_EO.D3, Temp==31)
G3_EO.D3_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D3_31)
anova(G3_EO.D3_31_mod)

#means
G3_EO.D3mean <- ddply(G3_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D3mean #display table


G3_EO.D3_plot<-ggplot(data=G3_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 3")+
  theme(plot.title = element_text(size=20));G3_EO.D3_plot
```

G3 Day 7
```{r}
G3_EO.D7<-subset(G3_EO, Day=="7")

G3_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D7)
anova(G3_EOmodD7)
emmeans(G3_EOmodD7, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D7_27<-subset(G3_EO.D7, Temp==27)
G3_EO.D7_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_27)
anova(G3_EO.D7_27_mod)

#30
G3_EO.D7_30<-subset(G3_EO.D7, Temp==30)
G3_EO.D7_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_30)
anova(G3_EO.D7_30_mod)

#31
G3_EO.D7_31<-subset(G3_EO.D7, Temp==31)
G3_EO.D7_31_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D7_31)
anova(G3_EO.D7_31_mod)

#means
G3_EO.D7mean <- ddply(G3_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D7mean #display table


G3_EO.D7_plot<-ggplot(data=G3_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 7")+
  theme(plot.title = element_text(size=20));G3_EO.D7_plot
```

G3 Day 14
```{r}
G3_EO.D14<-subset(G3_EO, Day=="14")

G3_EOmodD14<-lmer(cells.larvae_log~Temp*single.multi+(1|Pot), G3_EO.D14)
anova(G3_EOmodD14)
emmeans(G3_EOmodD14, pairwise ~ single.multi |Temp)

#run by temp
#27
G3_EO.D14_27<-subset(G3_EO.D14, Temp==27)
G3_EO.D14_27_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_27)
anova(G3_EO.D14_27_mod)

#30
G3_EO.D14_30<-subset(G3_EO.D14, Temp==30)
G3_EO.D14_30_mod<-lmer(cells.larvae_log~single.multi+(1|Pot), G3_EO.D14_30)
anova(G3_EO.D14_30_mod)



#means
G3_EO.D14mean <- ddply(G3_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_EO.D14mean #display table
G3_EO.D14mean<-na.omit(G3_EO.D14mean)

G3_EO.D14_plot<-ggplot(data=G3_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=5, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Infection type") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  scale_y_log10(breaks = c(1,100,1000, 10000), limits=c(1,5000))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("G3_Day 14")+
  theme(plot.title = element_text(size=20));G3_EO.D14_plot
```

Plot together G3 expect-observe

```{r}

G3_EO.D3_plot<-G3_EO.D3_plot+ theme(legend.position = "none") #remove legend
G3_EO.D7_plot<-G3_EO.D7_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(G3_EO.D3_plot, G3_EO.D7_plot, G3_EO.D14_plot, nrow = 1)
```

Plot all Day 14
```{r}
C1_EO.D14_plot<-C1_EO.D14_plot+ theme(legend.position = "none") #remove legend
D1_EO.D14_plot<-D1_EO.D14_plot+ theme(legend.position = "none") #remove legend
F1_EO.D14_plot<-F1_EO.D14_plot+ theme(legend.position = "none") #remove legend
G3_EO.D14_plot<-G3_EO.D14_plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(C1_EO.D14_plot, D1_EO.D14_plot, F1_EO.D14_plot,G3_EO.D14_plot , nrow = 1)
```


## NMDS for ALLs
Raw counts
use this df: "ALLcast_9000_cast2"
```{r}
#make a df with just abundance
library(vegan)

ALLcast_abund<-ALLcast_9000_cast2
ALLcast_abund<-na.omit(ALLcast_abund) #get rid of NAs
ALLcast_abund<-ALLcast_abund[-c(8, 18, 34,54,94,101), ] #you need to remove rows with no data (all 0s)
ALLcast_abund_b<-ALLcast_abund[-c(1:3)] #remove metadata

#write.csv(ALLcast_abund, "nmdsData_RawCounts_20200117.csv")

#NMDS
set.seed(2)

ALLdata.nmds <- metaMDS(comm = ALLcast_abund_b, distance = "bray")
plot(ALLdata.nmds$points) 
ALLdata.nmds$stress #0.1326 fuck yeah

ALLdata.nmds_xy <- data.frame(ALLdata.nmds$points)

ALLdata.nmds_xy$Temp <- ALLcast_abund$Temp #add metadata back in
ALLdata.nmds_xy$Day <- ALLcast_abund$Day

#by Day
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#by Temp
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color = Temp)) + geom_point() + theme_bw()

## testing plots
#combine day and temp
ALLdata.nmds_xy$code<-paste0(ALLdata.nmds_xy$Temp, ALLdata.nmds_xy$Day)

ggplot() + 
  #geom_polygon(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,fill=code,group=code),alpha=0.30) + # add the convex hulls
  geom_point(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,shape=Day,colour=Temp),size=4) + # add the point markers
  coord_equal() +
  theme_bw() + 
  theme(axis.text.x = element_blank(),  # remove x-axis text
        axis.text.y = element_blank(), # remove y-axis text
        axis.ticks = element_blank(),  # remove axis ticks
        axis.title.x = element_text(size=18), # remove x-axis labels
        axis.title.y = element_text(size=18), # remove y-axis labels
        panel.background = element_blank(), 
        panel.grid.major = element_blank(),  #remove major-grid labels
        panel.grid.minor = element_blank(),  #remove minor-grid labels
        plot.background = element_blank())

#This is all the data with ellipses. hard to read but nice to have. 
ggplot(ALLdata.nmds_xy, aes(MDS1, MDS2, color=code))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()


```

nmds by temp - raw data
```{r}
##### subset by Temp
#27C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp27<-ALLcast_9000_cast2
ALLcast_abund_Temp27<-subset(ALLcast_abund_Temp27, Temp=="27")
ALLcast_abund_Temp27<-na.omit(ALLcast_abund_Temp27) #get rid of NAs
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="105"),]
ALLcast_abund_Temp27<-  ALLcast_abund_Temp27[!(ALLcast_abund_Temp27$ALL.number=="106"),]

ALLcast_abund_Temp27_b<-ALLcast_abund_Temp27[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp27.nmds <- metaMDS(comm = ALLcast_abund_Temp27_b, distance = "bray")
plot(ALLdata_Temp27.nmds$points) 
ALLdata_Temp27.nmds$stress #.139

ALLdata_Temp27.nmds_xy <- data.frame(ALLdata_Temp27.nmds$points)

ALLdata_Temp27.nmds_xy$Day <- ALLcast_abund_Temp27$Day


ALLdata_Temp27.nmds_xy$code<-paste0(ALLdata_Temp27.nmds_xy$Temp, ALLdata_Temp27.nmds_xy$Day)

temp27nmds<-ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color=Day))+   
  scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Raw counts: Temp 27C");temp27nmds


#by temp 30
ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


#30C
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Temp30<-ALLcast_9000_cast2
ALLcast_abund_Temp30<-subset(ALLcast_abund_Temp30, Temp=="30")
ALLcast_abund_Temp30<-na.omit(ALLcast_abund_Temp30) #get rid of NAs
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="156"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="195"),]
ALLcast_abund_Temp30<-  ALLcast_abund_Temp30[!(ALLcast_abund_Temp30$ALL.number=="200"),]

ALLcast_abund_Temp30_b<-ALLcast_abund_Temp30[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp30.nmds <- metaMDS(comm = ALLcast_abund_Temp30_b, distance = "bray")
plot(ALLdata_Temp30.nmds$points) 
ALLdata_Temp30.nmds$stress #.123

ALLdata_Temp30.nmds_xy <- data.frame(ALLdata_Temp30.nmds$points)

ALLdata_Temp30.nmds_xy$Day <- ALLcast_abund_Temp30$Day


temp30nmds<-ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color=Day))+
    scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Temp 30C");temp30nmds





#by TEMP
ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#31C
#sample 106, C1 counts is 3100+ way high, likely error, check

ALLcast_abund_Temp31<-ALLcast_9000_cast2
ALLcast_abund_Temp31<-subset(ALLcast_abund_Temp31, Temp=="31")
ALLcast_abund_Temp31<-na.omit(ALLcast_abund_Temp31) #get rid of NAs
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="115"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="134"),]
ALLcast_abund_Temp31<-  ALLcast_abund_Temp31[!(ALLcast_abund_Temp31$ALL.number=="218"),]

ALLcast_abund_Temp31_b<-ALLcast_abund_Temp31[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp31.nmds <- metaMDS(comm = ALLcast_abund_Temp31_b, distance = "bray")
plot(ALLdata_Temp31.nmds$points) 
ALLdata_Temp31.nmds$stress #.114

ALLdata_Temp31.nmds_xy <- data.frame(ALLdata_Temp31.nmds$points)

ALLdata_Temp31.nmds_xy$Day <- ALLcast_abund_Temp31$Day

temp31nmds<-ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color=Day))+
  scale_colour_manual(values = c("Orange", "Blue"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
    ggtitle("Temp 31C");temp31nmds


#plot all together
grid.arrange(temp27nmds, temp30nmds, temp31nmds, nrow = 1)

```

NMDS BY DAY 
```{R}

#by Day
ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()


### by day
#sample 106, C1 counts is 3000+ way high, likely error, check

ALLcast_abund_Day3<-ALLcast_9000_cast2
ALLcast_abund_Day3<-subset(ALLcast_abund_Day3, Day=="3")
ALLcast_abund_Day3<-na.omit(ALLcast_abund_Day3) #get rid of NAs
ALLcast_abund_Day3<-  ALLcast_abund_Day3[!(ALLcast_abund_Day3$ALL.number=="134"),]

ALLcast_abund_Day3_b<-ALLcast_abund_Day3[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Day3.nmds <- metaMDS(comm = ALLcast_abund_Day3_b, distance = "bray")
plot(ALLdata_Day3.nmds$points) 
ALLdata_Day3.nmds$stress #.131

ALLdata_Day3.nmds_xy <- data.frame(ALLdata_Day3.nmds$points)

ALLdata_Day3.nmds_xy$Temp <- ALLcast_abund_Day3$Temp

Day3_nmds<-ggplot(ALLdata_Day3.nmds_xy, aes(MDS1, MDS2, color=Temp))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
  ggtitle("Day 3");Day3_nmds

```


##nmds- relative abundances!
Use df: ALL_RelA_a or ALL_RelA_b

```{r}
#make a df with just RelRelabundance
ALLcast_Relabund<-ALL_RelA_a
ALLcast_Relabund<-na.omit(ALLcast_Relabund) #get rid of NAs
ALLcast_Relabund_b<-ALLcast_Relabund[-c(1:3)] #remove metadata

#write.csv(ALLcast_Relabund, "nmds_RelAbund_20200117.csv")

#NMDS
set.seed(2)

ALLdataRelabund.nmds <- metaMDS(comm = ALLcast_Relabund_b, distance = "bray")
plot(ALLdataRelabund.nmds$points) 
ALLdataRelabund.nmds$stress #0.097

ALLdataRelabund.nmds_xy <- data.frame(ALLdataRelabund.nmds$points)

ALLdataRelabund.nmds_xy$Temp <- ALLcast_Relabund$Temp #add metadata back in
ALLdataRelabund.nmds_xy$Day <- ALLcast_Relabund$Day

#by Day
ggplot(ALLdataRelabund.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#by Temp
ggplot(ALLdataRelabund.nmds_xy, aes(MDS1, MDS2, color = Temp)) + geom_point() + theme_bw()

## testing plots
#combine day and temp
ALLdataRelabund.nmds_xy$code<-paste0(ALLdataRelabund.nmds_xy$Temp, ALLdataRelabund.nmds_xy$Day)

ggplot() + 
  #geom_polygon(data=ALLdata.nmds_xy,aes(x=MDS1,y=MDS2,fill=code,group=code),alpha=0.30) + # add the convex hulls
  geom_point(data=ALLdataRelabund.nmds_xy,aes(x=MDS1,y=MDS2,shape=Day,colour=Temp),size=4) + # add the point markers
  coord_equal() +
  theme_bw() + 
  theme(axis.text.x = element_blank(),  # remove x-axis text
        axis.text.y = element_blank(), # remove y-axis text
        axis.ticks = element_blank(),  # remove axis ticks
        axis.title.x = element_text(size=18), # remove x-axis labels
        axis.title.y = element_text(size=18), # remove y-axis labels
        panel.background = element_blank(), 
        panel.grid.major = element_blank(),  #remove major-grid labels
        panel.grid.minor = element_blank(),  #remove minor-grid labels
        plot.background = element_blank())

#This is all the data with ellipses. hard to read but nice to have. 
ggplot(ALLdataRelabund.nmds_xy, aes(MDS1, MDS2, color=code))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()

```

By temp all RELABUND
```{r}
##### subset by Temp
#27C
ALLcast_Relabund_Temp27<-ALL_RelA_a
ALLcast_Relabund_Temp27<-subset(ALLcast_Relabund_Temp27, Temp=="27")
ALLcast_Relabund_Temp27_b<-ALLcast_Relabund_Temp27[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp27.nmds <- metaMDS(comm = ALLcast_Relabund_Temp27_b, distance = "bray")
plot(ALLdata_Temp27.nmds$points) 
ALLdata_Temp27.nmds$stress #.139

ALLdata_Temp27.nmds_xy <- data.frame(ALLdata_Temp27.nmds$points)

ALLdata_Temp27.nmds_xy$Day <- ALLcast_Relabund_Temp27$Day


ALLdata_Temp27.nmds_xy$code<-paste0(ALLdata_Temp27.nmds_xy$Temp, ALLdata_Temp27.nmds_xy$Day)

temp27nmdsRelabund<-ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color=Day))+   
  scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Relative Abundance Temp 27C");temp27nmdsRelabund

#by temp 30
ggplot(ALLdata_Temp27.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#30C

ALLcast_Relabund_Temp30<-ALL_RelA_a
ALLcast_Relabund_Temp30<-subset(ALLcast_Relabund_Temp30, Temp=="30")

ALLcast_Relabund_Temp30_b<-ALLcast_Relabund_Temp30[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp30.nmds <- metaMDS(comm = ALLcast_Relabund_Temp30_b, distance = "bray")
plot(ALLdata_Temp30.nmds$points) 
ALLdata_Temp30.nmds$stress #.05

ALLdata_Temp30.nmds_xy <- data.frame(ALLdata_Temp30.nmds$points)

ALLdata_Temp30.nmds_xy$Day <- ALLcast_Relabund_Temp30$Day


temp30nmdsRelabund<-ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color=Day))+
    scale_colour_manual(values = c("Orange", "Blue", "Green"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
      ggtitle("Temp 30C");temp30nmdsRelabund





#by TEMP
ggplot(ALLdata_Temp30.nmds_xy, aes(MDS1, MDS2, color = Day)) + geom_point() + theme_bw()

#31C
#sample 106, C1 counts is 3100+ way high, likely error, check

ALLcast_Relabund_Temp31<-ALL_RelA_a
ALLcast_Relabund_Temp31<-subset(ALLcast_Relabund_Temp31, Temp=="31")

ALLcast_Relabund_Temp31_b<-ALLcast_Relabund_Temp31[-c(1:3)] #remove metadata

#NMDS
set.seed(2)

ALLdata_Temp31.nmds <- metaMDS(comm = ALLcast_Relabund_Temp31_b, distance = "bray")
plot(ALLdata_Temp31.nmds$points) 
ALLdata_Temp31.nmds$stress #.06

ALLdata_Temp31.nmds_xy <- data.frame(ALLdata_Temp31.nmds$points)

ALLdata_Temp31.nmds_xy$Day <- ALLcast_Relabund_Temp31$Day

temp31nmdsRelabund<-ggplot(ALLdata_Temp31.nmds_xy, aes(MDS1, MDS2, color=Day))+
  scale_colour_manual(values = c("Orange", "Blue"))+
  geom_point(position=position_jitter(.1), shape=3)+##separates overlapping points
  stat_ellipse(type='t',size =1)+ ##draws 95% confidence interval ellipses
  theme_minimal()+
    ggtitle("Temp 31C");temp31nmdsRelabund


#plot all together
grid.arrange(temp27nmdsRelabund, temp30nmdsRelabund, temp31nmdsRelabund, nrow = 1)

#plot raw counts over relabund
grid.arrange(temp27nmds, temp30nmds, temp31nmds,temp27nmdsRelabund, temp30nmdsRelabund, temp31nmdsRelabund, nrow = 2)


```


#Let's try a heatmap
by temp on day 3
relabundance data
```{r}
#day 3

heat_relabund_D3<-ALL_RelA_a
heat_relabund_D3<-subset(heat_relabund_D3, Day==3)
heat_relabund_D3$code<-paste0(heat_relabund_D3$Temp, "_",heat_relabund_D3$ALL.number) #code
row.names(heat_relabund_D3)<-heat_relabund_D3$code

#order by temp
heat_relabund_D3_b <- heat_relabund_D3[order(heat_relabund_D3$Temp),]
heat_relabund_D3_b<-heat_relabund_D3_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_D3_b_matrix <- data.matrix(heat_relabund_D3_b)

library(RColorBrewer)
#make heatmap
heat_relabund_D3_b_heatmap <- heatmap(heat_relabund_D3_b_matrix, col = cm.colors(200),main="heatmap Day 3")


#day 7

heat_relabund_D7<-ALL_RelA_a
heat_relabund_D7<-subset(heat_relabund_D7, Day==7)
heat_relabund_D7$code<-paste0(heat_relabund_D7$Temp, "_",heat_relabund_D7$ALL.number) #code
row.names(heat_relabund_D7)<-heat_relabund_D7$code

#order by temp
heat_relabund_D7_b <- heat_relabund_D7[order(heat_relabund_D7$Temp),]
heat_relabund_D7_b<-heat_relabund_D7_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_D7_b_matrix <- data.matrix(heat_relabund_D7_b)

#make heatmap
heat_relabund_D7_b_heatmap <- heatmap(heat_relabund_D7_b_matrix, col = cm.colors(200),main="heatmap Day 7")

#day 14

heat_relabund_D14<-ALL_RelA_a
heat_relabund_D14<-subset(heat_relabund_D14, Day==14)
heat_relabund_D14$code<-paste0(heat_relabund_D14$Temp, "_",heat_relabund_D14$ALL.number) #code
row.names(heat_relabund_D14)<-heat_relabund_D14$code

#order by temp
heat_relabund_D14_b <- heat_relabund_D14[order(heat_relabund_D14$Temp),]
heat_relabund_D14_b<-heat_relabund_D14_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_D14_b_matrix <- data.matrix(heat_relabund_D14_b)

#make heatmap
heat_relabund_D14_b_heatmap <- heatmap(heat_relabund_D14_b_matrix, col = cm.colors(200),main="heatmap Day 14")
```

heatmaps by temp
```{r}
#27c

heat_relabund_27<-ALL_RelA_a
heat_relabund_27<-subset(heat_relabund_27, Temp==27)
heat_relabund_27$code<-paste0(heat_relabund_27$Day, "_",heat_relabund_27$ALL.number) #code
row.names(heat_relabund_27)<-heat_relabund_27$code

#order by temp
heat_relabund_27_b <- heat_relabund_27[order(heat_relabund_27$Day),]
heat_relabund_27_b<-heat_relabund_27_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_27_b_matrix <- data.matrix(heat_relabund_27_b)

#make heatmap
heat_relabund_27_b_heatmap <- heatmap(heat_relabund_27_b_matrix, col = cm.colors(200),main="heatmap 27C")


#30C

heat_relabund_30<-ALL_RelA_a
heat_relabund_30<-subset(heat_relabund_30, Temp==30)
heat_relabund_30$code<-paste0(heat_relabund_30$Day, "_",heat_relabund_30$ALL.number) #code
row.names(heat_relabund_30)<-heat_relabund_30$code

#order by temp
heat_relabund_30_b <- heat_relabund_30[order(heat_relabund_30$Day),]
heat_relabund_30_b<-heat_relabund_30_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_30_b_matrix <- data.matrix(heat_relabund_30_b)

#make heatmap
heat_relabund_30_b_heatmap <- heatmap(heat_relabund_30_b_matrix, col = cm.colors(200),main="heatmap 30C")

#31C

heat_relabund_31<-ALL_RelA_a
heat_relabund_31<-subset(heat_relabund_31, Temp==31)
heat_relabund_31$code<-paste0(heat_relabund_31$Day, "_",heat_relabund_31$ALL.number) #code
row.names(heat_relabund_31)<-heat_relabund_31$code

#order by temp
heat_relabund_31_b <- heat_relabund_31[order(heat_relabund_31$Day),]
heat_relabund_31_b<-heat_relabund_31_b[-c(1:3, 8)] #remove metadata

#make matrix
heat_relabund_31_b_matrix <- data.matrix(heat_relabund_31_b)

#make heatmap
heat_relabund_31_b_heatmap <- heatmap(heat_relabund_31_b_matrix, col = cm.colors(200),main="heatmap 31C")
```


# let's look at some plots of raw counts by single vs multi infection.

C1 
C1Full2 = Single cells.larvae raw
ALLcast_9000_cast2 = Alls
Raw counts, on long y-axis
```{r}
MultiCounts<-ALLcast_9000_cast2
MultiCounts$cells.larvae<-MultiCounts$C1+MultiCounts$D1+MultiCounts$F1+MultiCounts$G3
MultiCounts2<-MultiCounts[-c(1,4:7)] #remove metadata
MultiCounts2$single.multi<-"multi"
MultiCounts2$Symbiont<-"All"


SingleCounts<-rbind(C1Full2,D1Full2,F1Full2,G3Full2)
SingleCounts<-SingleCounts[-c(4:5,7:8)] #remove metadata

CountsCompare<-rbind(SingleCounts, MultiCounts2) # combine


#MEANs
CountsCompare_mean <- ddply(CountsCompare, c("single.multi","Temp","Day","Symbiont"), summarise, #summarize cell count
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important* 
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                  max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
CountsCompare_mean #display table

#make a code
#CountsCompare_mean$code<-paste0(CountsCompare_mean$single.multi, "_",CountsCompare_mean$Day,"_", CountsCompare_mean$Temp) #code

CountsCompare_mean<-CountsCompare_mean[ , order(names(CountsCompare_mean))]

#subset by temp
CountsCompare27<-subset(CountsCompare_mean, Temp=="27")

CountsCompare27_plot<-ggplot(CountsCompare27, aes(y=mean, x=Day, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000,10000), limits=c(-100,100000))+  xlab("Days") +  #Label the X Axis 
            #scale_fill_locuszoom()+
    geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
                 position=position_dodge(.9)) +
   xlab("Day")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Counts compare 27C");CountsCompare27_plot   

#30
CountsCompare30<-subset(CountsCompare_mean, Temp=="30")

CountsCompare30_plot<-ggplot(CountsCompare30, aes(y=mean, x=Day, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000,10000), limits=c(-100,100000))+  xlab("Days") +  
            #scale_fill_locuszoom()+
   geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
                 position=position_dodge(.9)) +
   xlab("Day")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Counts compare 30C");CountsCompare30_plot   


#31
CountsCompare31<-subset(CountsCompare_mean, Temp=="31")

CountsCompare31_plot<-ggplot(CountsCompare31, aes(y=mean, x=Day, fill=Symbiont)) + 
           geom_bar(stat="identity",position=position_dodge())+ 
       scale_y_log10(breaks = c(0,1,100,1000, 10000,10000), limits=c(-100,100000))+  xlab("Days") +  #Label the X Axis 
            #scale_fill_locuszoom()+
   geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
                 position=position_dodge(.9)) +
   xlab("Day")+ 
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format 
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells/larvae"))) +
  ggtitle("Counts compare 31C");CountsCompare31_plot  


#plot together

grid.arrange(CountsCompare27_plot, CountsCompare30_plot,CountsCompare31_plot, nrow=1)

#stats run on logged data for normality

#logged
CountsCompare$cells.larvae_log<-log(CountsCompare$cells.larvae+1)



```




##Code for ddPCR only single dataset

##PLOT SINGLE INFECTIONS_9000 SUBSET, ddPCR only
C1 single infection 9000
```{r}
C1_mean_9000 <- ddply(C1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_mean_9000 #display table

C1_plot_9000<-ggplot(data=C1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  scale_y_continuous(trans='log10')+
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1_9000")+ 
  theme(plot.title = element_text(size=20, face = "italic"));C1_plot_9000 
```

D1 single infection
```{r}
D1_mean_9000 <- ddply(D1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_mean_9000 #display table

D1_plot_9000<-ggplot(data=D1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
    scale_y_continuous(trans='log10')+
#ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text  
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) + 
  ggtitle("D1_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_plot_9000
```

F1 single infection  
```{r}
F1_mean_9000 <- ddply(F1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_mean_9000 #display table

F1_plot_9000<-ggplot(data=F1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), 
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+ 
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits 
    scale_y_continuous(trans='log10')+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("Cells/Larvae"))) + 
  ggtitle("F1_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_plot_9000
``` 

G3 single infection
```{r}
G3_mean_9000 <- ddply(G3_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_mean_9000 #display table

G3_plot_9000<-ggplot(data=G3_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "darkorange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits
    scale_y_continuous(trans='log10')+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines 
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key 
  ylab(expression(paste("cells/larvae"))) + 
  ggtitle("G3_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_plot_9000 
```  

Plot all four SINGLE INFECTION together:
```{r}
C1_plot_9000<-C1_plot_9000+ theme(legend.position = "none") #remove legend 
D1_plot_9000<-D1_plot_9000+ theme(legend.position = "none") #remove legend 
F1_plot_9000<-F1_plot_9000+ theme(legend.position = "none") #remove legend 
#G3_plot_9000<-G3_plot_9000+ theme(legend.position = "none") #remove legend
 
grid.arrange(C1_plot_9000, D1_plot_9000, F1_plot_9000,G3_plot_9000, nrow = 2)
```  


