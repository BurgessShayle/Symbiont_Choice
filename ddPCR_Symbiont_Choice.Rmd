---
title: "Symb_Choice_ddPCR"
author: "Shayle Matsuda"
date: "12/7/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---
This is data from the Symbiont Choice 2018 experiment conducted at AIMS in 2018 and 2019. 
Data: ddPCR 

Recent updates to the script: 12.19.2019 - Using Full dataset (counts and ddPCR at 9000 cutoff for now. Code for checking against 8000 and ddPCR vs dPCR+counts below.)

```{r setup chunk, setup, warning=FALSE, message=FALSE, fig.align='center'}
require("knitr")

#knitr::opts_knit$set(root.dir = normalizePath("~/Desktop/Symb_choice/Symbiont Choice 2018"))
```

```{r}
rm(list=ls()) # Clear workspace
```
## Background

Authors: SB Matsuda, L Chakravarti, JR Cunning, M van Oppen, RD Gates
Symbiont choice experiment tests the uptake of cultured Symbiodiniaceae alone and as a mixture in A. tenuis larvae at ambient (27C) and two elevated (30C and 31C) temperatures over the course of 2 weeks. Sampling was on days 3, 7 and 14. 

```{r}
# Set up workspace
setwd("~/Desktop/Symb_choice/Symbiont Choice 2018")

library(plyr)
library(dplyr)
library(ggplot2)
library("gridExtra") #arrange plots for output
library(reshape2)
library("viridis")           # Load color palettes
library("plotrix") #functions in tapply
library("pscl")
library("car") #levenes test
library("lsmeans")
library(effects)
library("multcomp") 
library("multcompView")
library("coefplot") #coefficient plotting
library("seacarb") #seawater carbonate chemistry
library("vegan") #calculating distance matrices
library(betareg)
library(coin)
library(exactRankTests)
library(mvtnorm)
library(DTK)
library(PMCMR)
library(MuMIn)
library(glmmTMB)
library(lme4)
library(lmerTest)
library(ggsignif)
library(HH)
library(PMCMR)
library(tidyverse)
library(arm)
library(jtools)
library(broom)
library(ggstance)
library(officer)
library(huxtable)
library(flextable)
```

Setup data
```{r}
####Load in hemocytometer counts and fluorescent scope counts:
Day3Counts<-read.csv("SC18_cellcounts_day3.csv")
Day7Counts<-read.csv("SC18_cellcounts_day7.csv")
Day14Counts<-read.csv("SC18_cellcounts_day14.csv")

#day3
colnames(Day3Counts)[colnames(Day3Counts)=="Count"] <- "cells.larvae"

#remove cols you don't need Day 7
d7vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day7Counts<-Day7Counts[d7vars]
colnames(Day7Counts)[colnames(Day7Counts)=="Cells.per.larva"] <- "cells.larvae"
Day7Counts<-na.omit(Day7Counts)

#remove cols you don't need Day 14
d14vars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","Cells.per.larva")
Day14Counts<-Day14Counts[d14vars]
colnames(Day14Counts)[colnames(Day14Counts)=="Cells.per.larva"] <- "cells.larvae"
Day14Counts<-na.omit(Day14Counts)

#combine days:
Countdat<-rbind(Day3Counts, Day7Counts, Day14Counts)
Countdat1<-Countdat[!(Countdat$Symbiont=="ALL"),] #remove ALLs
Countdat1<-Countdat1[!(Countdat1$Symbiont=="CONTROL"),] #remove controls
Countdat1$Temp<-as.factor(Countdat1$Temp)
Countdat1$cells.larvae<-as.numeric(Countdat1$cells.larvae)


####Load in ddPCR data with Threshold set in QuantaSoft Analysis

#Read in ddPCR plate data
Plate1<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE1_20190424_threshold.csv")
Plate2<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE2_20190429_threshold.csv")
Plate3<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3_20190426_threshold.csv")
Plate3B<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE3B_20190426_threshold.csv")
Plate3 <- rbind(Plate3,Plate3B) # merge plate 3 and 3b for metadata
Plate4<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE4_20190427_threshold.csv")
Plate5<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE5_20190428_threshold.csv")
Plate6<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE6_20190428_threshold.csv")
Plate7<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE7_20190429_threshold.csv")
Plate8<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE8_20190501_threshold.csv")
Plate9<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE9_20190501_threshold.csv")
Plate10<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE10_20190501_threshold.csv")
Plate11<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE11_20190502_threshold.csv")
Plate12<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE12_20190502_threshold.csv")
Plate13<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE13_20190503_threshold.csv")
Plate14<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE14_20190503_threshold.csv")
Plate15<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE15_20190507_threshold.csv")
Plate16<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE16_20190508_threshold.csv")
Plate17<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE17_20190509_threshold.csv")
Plate18<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE18_20190509_threshold.csv")
Plate19<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE19_20190509_threshold.csv")
Plate20<- read.csv("ddPCR_thresholdData/SHAYLE_PLATE20_20190510_threshold.csv")

# read in metadata by plate (some samples are duplicate names, which is why)
meta1 <-read.csv("ddPCR_thresholdData/Plate1_meta.csv")
meta2 <-read.csv("ddPCR_thresholdData/Plate2_meta.csv")
meta3 <-read.csv("ddPCR_thresholdData/Plate3_meta.csv")
meta4 <-read.csv("ddPCR_thresholdData/Plate4_meta.csv")
meta5 <-read.csv("ddPCR_thresholdData/Plate5_meta.csv")
meta6 <-read.csv("ddPCR_thresholdData/Plate6_meta.csv")
meta7 <-read.csv("ddPCR_thresholdData/Plate7_meta.csv")
meta8 <-read.csv("ddPCR_thresholdData/Plate8_meta.csv")
meta9 <-read.csv("ddPCR_thresholdData/Plate9_meta.csv")
meta10 <-read.csv("ddPCR_thresholdData/Plate10_meta.csv")
meta11 <-read.csv("ddPCR_thresholdData/Plate11_meta.csv")
meta12 <-read.csv("ddPCR_thresholdData/Plate12_meta.csv")
meta13 <-read.csv("ddPCR_thresholdData/Plate13_meta.csv")
meta14 <-read.csv("ddPCR_thresholdData/Plate14_meta.csv")
meta15 <-read.csv("ddPCR_thresholdData/Plate15_meta.csv")
meta16 <-read.csv("ddPCR_thresholdData/Plate16_meta.csv")
meta17 <-read.csv("ddPCR_thresholdData/Plate17_meta.csv")
meta18 <-read.csv("ddPCR_thresholdData/Plate18_meta.csv")
meta19 <-read.csv("ddPCR_thresholdData/Plate19_meta.csv")
meta20 <-read.csv("ddPCR_thresholdData/Plate20_meta.csv")

# merge each plates meta with plate
P1<-merge(Plate1, meta1, by="Well")
P2<-merge(Plate2, meta2, by="Well")
P3<-merge(Plate3, meta3, by="Well")
P4<-merge(Plate4, meta4, by="Well")
P5<-merge(Plate5, meta5, by="Well")
P6<-merge(Plate6, meta6, by="Well")
P7<-merge(Plate7, meta7, by="Well")
P8<-merge(Plate8, meta8, by="Well")
P9<-merge(Plate9, meta9, by="Well")
P10<-merge(Plate10, meta10, by="Well")
P11<-merge(Plate11, meta11, by="Well")
P12<-merge(Plate12, meta12, by="Well")
P13<-merge(Plate13, meta13, by="Well")
P14<-merge(Plate14, meta14, by="Well")
P15<-merge(Plate15, meta15, by="Well")
P16<-merge(Plate16, meta16, by="Well")
P17<-merge(Plate17, meta17, by="Well")
P18<-merge(Plate18, meta18, by="Well")
P19<-merge(Plate19, meta19, by="Well")
P20<-merge(Plate20, meta20, by="Well")


#Remove samples that I re-ddPCRd due to low droplet count that now have higher counts (remove olds by plate/well)

# Plate 5
    P5<-P5[!(P5$Well=="B06"),]
    P5<-P5[!(P5$Well=="B09"),]
    P5<-P5[!(P5$Well=="B11"),]
    P5<-P5[!(P5$Well=="C06"),]
    P5<-P5[!(P5$Well=="C09"),]
    P5<-P5[!(P5$Well=="C12"),]
    P5<-P5[!(P5$Well=="D06"),]
    P5<-P5[!(P5$Well=="D10"),]
    P5<-P5[!(P5$Well=="D12"),]
    P5<-P5[!(P5$Well=="H03"),]
    P5<-P5[!(P5$Well=="H04"),]
        P5<-P5[!(P5$Well=="B12"),]#18G

# PLATE 6
    P6<-P6[!(P6$Well=="C12"),]
# PLATE 8
    P8<-P8[!(P8$Well=="A02"),]
    P8<-P8[!(P8$Well=="A04"),]
    P8<-P8[!(P8$Well=="A11"),]
    P8<-P8[!(P8$Well=="A12"),]
    P8<-P8[!(P8$Well=="B02"),]
    P8<-P8[!(P8$Well=="B04"),]
    P8<-P8[!(P8$Well=="B12"),]
    P8<-P8[!(P8$Well=="C02"),]
    P8<-P8[!(P8$Well=="C04"),]
    P8<-P8[!(P8$Well=="C12"),]
    P8<-P8[!(P8$Well=="E04"),]
    P8<-P8[!(P8$Well=="G04"),]
    P8<-P8[!(P8$Well=="G05"),]
    P8<-P8[!(P8$Well=="H04"),]
        P8<-P8[!(P8$Well=="F06"),]#61C
        P8<-P8[!(P8$Well=="C11"),]#66D

# PLATE 9
    P9<-P9[!(P9$Well=="B11"),]
    P9<-P9[!(P9$Well=="C10"),]
    P9<-P9[!(P9$Well=="C11"),]
    P9<-P9[!(P9$Well=="E02"),]
    P9<-P9[!(P9$Well=="E10"),]
    P9<-P9[!(P9$Well=="F04"),]
    P9<-P9[!(P9$Well=="F06"),]
    P9<-P9[!(P9$Well=="G02"),]
    P9<-P9[!(P9$Well=="H03"),]
          P9<-P9[!(P9$Well=="B12"),] ##88D

# PLATE 10
    P10<-P10[!(P10$Well=="C01"),]
    P10<-P10[!(P10$Well=="C07"),]
    P10<-P10[!(P10$Well=="C12"),]
    P10<-P10[!(P10$Well=="D10"),]
    P10<-P10[!(P10$Well=="E05"),]
    P10<-P10[!(P10$Well=="H05"),]
        P10<-P10[!(P10$Well=="E06"),] #106C
        P10<-P10[!(P10$Well=="C10"),] #112F
        P10<-P10[!(P10$Well=="G04"),] #100G


#PLATE 12
    P12<-P12[!(P12$Well=="A09"),]
    P12<-P12[!(P12$Well=="E05"),]
        P12<-P12[!(P12$Well=="E04"),]#95C
        P12<-P12[!(P12$Well=="G05"),]#41G

#PLATE 13
    P13<-P13[!(P13$Well=="A09"),]
    P13<-P13[!(P13$Well=="A12"),]
    P13<-P13[!(P13$Well=="B12"),]
    P13<-P13[!(P13$Well=="C10"),]
    P13<-P13[!(P13$Well=="D10"),]
    P13<-P13[!(P13$Well=="D11"),]
    P13<-P13[!(P13$Well=="E10"),]
    P13<-P13[!(P13$Well=="F05"),]
    P13<-P13[!(P13$Well=="F06"),]
    P13<-P13[!(P13$Well=="A07"),]
    P13<-P13[!(P13$Well=="C12"),]
         P13<-P13[!(P13$Well=="G04"),]#147F

#PLATE 14
    P14<-P14[!(P14$Well=="A09"),]
    P14<-P14[!(P14$Well=="A12"),]
    P14<-P14[!(P14$Well=="B09"),]
        P14<-P14[!(P14$Well=="C03"),] #F1 issue
        P14<-P14[!(P14$Well=="E03"),] #F1 issue
        P14<-P14[!(P14$Well=="B10"),] #165D


#PLATE 15
    P15<-P15[!(P15$Well=="C10"),]
    P15<-P15[!(P15$Well=="D10"),]
    P15<-P15[!(P15$Well=="G03"),]
#PLATE 16
    P16<-P16[!(P16$Well=="D05"),]
    P16<-P16[!(P16$Well=="F04"),]
    P16<-P16[!(P16$Well=="F05"),]
#PLATE 17
    P17<-P17[!(P17$Well=="D09"),]
    P17<-P17[!(P17$Well=="E09"),]
        P17<-P17[!(P17$Well=="H02"),]#178D
        P17<-P17[!(P17$Well=="C09"),]#189F

#PLATE 18
    P18<-P18[!(P18$Well=="E09"),]
    P18<-P18[!(P18$Well=="F04"),]
    P18<-P18[!(P18$Well=="H04"),]
        P18<-P18[!(P18$Well=="G05"),]#205C
        P18<-P18[!(P18$Well=="G04"),]#197G

#PLATE 19
    P19<-P19[!(P19$Well=="C08"),]



#merge all plates
dData1 <- rbind(P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17, P18, P19, P20)

 #write.csv(dData1TEST, "dData1TEST.csv")
#only keep columns you need (Sample, Target, Conc(copies/µL), Copies/20ulWell, Accepted Droplets, Positives, Negatives, Threshold1, metadata)

dData<-dData1[,c(1,2:4,11,16:18,31,66 ,68:79)]
dData$Conc.copies.µL.<-as.numeric(dData$Conc.copies.µL.)
dData$Temp<-as.factor(dData$Temp)
dData$Temp<-factor(dData$Temp, levels=c("27","30","31"))
dData$Day<-as.factor(dData$Day)
dData$Day<-factor(dData$Day, levels=c("3","7","14"))
dData$Pot<-as.factor(dData$Pot)


#Calculate concentration per larvae <- is this correct

# use copies/1ul pcr to calculate how many copies are in 1 larvae. (copies/1ul PCR)*(25ul PCR/y ul.DNA added)*(20uLDNA/1 larvae)
dData$copies.larvae<-(dData$Conc.copies.µL.)*(25/dData$ul.DNA)*20

# divide copies by copy number per clade (CALC IN EXCEL, QCd)
dData$copyNum[dData$Primer=="C1"]<-2
dData$copyNum[dData$Primer=="D1"]<-1
dData$copyNum[dData$Primer=="F1"]<-3
dData$copyNum[dData$Primer=="G3"]<-19

# calc number of Sym cells in larvae
dData$cells.larvae<-dData$copies.larvae/dData$copyNum
  dData<-dData[!(dData$Info=="NTC"),]
  
#Subset data for diff analyses

#subset only copynumber calc samples
CopyNumber<-subset(dData, Info=="CopyNumber")

#subset only FalsePositives
FalsePos<-subset(dData, Info=="CONTROL")
#write.csv(FalsePos, "FalsePos.csv")

#subset Samples
sData<-subset(dData, Info=="ALL"|Info=="C1"|Info=="D1"|Info=="F1"|Info=="G3")
AllAll<-subset(dData, Info=="ALL")
#write.csv(sData, "sData20191221.csv")
#write.csv(AllAll, "AllAll.csv")

#subset D1
#D1data<-subset(dData, Info=="D1")
#write.csv(D1data, "D1data.csv")
#subset F1
#F1data<-subset(dData, Info=="F1")
#write.csv(F1data, "F1data.csv")
```

Decide where your cut off for positive droplets is. Standard is 10,000. You should push down to 9000. 
```{r}
# 9000 cutoff
sData1<-subset(sData, Accepted.Droplets>9000)# remove samples with less than 9000 droplets (we lose 44 ddpcr samples)

#pull to view under 9000 droplet info
ALL1<-subset(sData1, Info=="ALL")
write.csv(ALL1, "Alldroptest9000_20191221.csv")

#Just for the multi-infection (single infection numbers are ok)  
#If we cutoff at 9000:  
#Without adding together sep runs, we lose: 21 Larvae  
#Adding together sep runs, we lose: 18 larvae

#If we cutof at 8000:  
#Without adding together sep runs, we lose:7  Larvae  
#Adding together sep runs, we lose:  6 larvae
# 8000 data code in backup script
```


###9000 droplet Cut off
Subset for each Infection trial (C1, D1, F1, G3, ALL)
```{r} 
C1_9000<-subset(sData1, Info=="C1")
D1_9000<-subset(sData1, Info=="D1")
F1_9000<-subset(sData1, Info=="F1")
G3_9000<-subset(sData1, Info=="G3")
ALL_9000<-subset(sData1, Info=="ALL")
#write.csv(ALL, "Alldroptest9000A.csv")

# for the Alls, cast for Primer
# remove unneeded columns
ALL_9000a<-ALL_9000[,c("ALL.number","Primer","cells.larvae","Day","Temp")]
#write.csv(ALL_9000a, "ALL_9000a.csv")
#cast by primers
 ALLcast_9000_cast<-dcast(ALL_9000a, ALL.number~Primer, value.var = "cells.larvae") # cast()
# this returns 1s and 0s, since I have missing primers in some (20) samples here. In order to get this to work right, I need to remove the rest of those larvae before casting. There needs to be a beter way/ 
 
 # Remove rest of primers/larvae of missing ones (n=21 larvae)
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="136"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="135"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="236"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="227"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="111"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="120"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="137"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="204"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="30"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="188"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="130"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="138"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="231"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="125"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="187"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="209"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="122"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="208"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="232"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="233"),]
  ALL_9000a<-ALL_9000a[!(ALL_9000a$ALL.number=="177"),]


  #Cast with samps removed without data for all 4 zoox types
 ALLcast_9000_cast2<-dcast(ALL_9000a, ALL.number+Temp+Day~Primer, value.var = "cells.larvae") # cast()

# try tidyverse spread
  #library(tidyverse)
  #test<-spread(ALL_9000a,Primer, cells.larvae, fill=NA) #not working, likely due to same error above. 
```




##PLOT SINGLE INFECTIONS_9000 SUBSET, ddPCR only
C1 single infection 9000
```{r}
C1_mean_9000 <- ddply(C1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_mean_9000 #display table

C1_plot_9000<-ggplot(data=C1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_plot_9000
```

D1 single infection
```{r}
D1_mean_9000 <- ddply(D1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_mean_9000 #display table

D1_plot_9000<-ggplot(data=D1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text  
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) + 
  ggtitle("D1_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_plot_9000
```

F1 single infection  
```{r}
F1_mean_9000 <- ddply(F1_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1_mean_9000 #display table

F1_plot_9000<-ggplot(data=F1_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), 
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+ 
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 5000) + #set Y limits 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) + 
  ggtitle("F1_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));F1_plot_9000
```

G3 single infection
```{r}
G3_mean_9000 <- ddply(G3_9000, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3_mean_9000 #display table

G3_plot_9000<-ggplot(data=G3_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines 
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("G3_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));G3_plot_9000
``` 

Plot all four SINGLE INFECTION together:
```{r}
C1_plot_9000<-C1_plot_9000+ theme(legend.position = "none") #remove legend 
D1_plot_9000<-D1_plot_9000+ theme(legend.position = "none") #remove legend
F1_plot_9000<-F1_plot_9000+ theme(legend.position = "none") #remove legend
#G3_plot_9000<-G3_plot_9000+ theme(legend.position = "none") #remove legend

grid.arrange(C1_plot_9000, D1_plot_9000, F1_plot_9000,G3_plot_9000, nrow = 2)
``` 

#Multi-infection 9000 ddPCR only
Subset by Temp treatments
```{r} 
ALL_27_9000c<-subset(ALLcast_9000_cast2, Temp==27)
ALL_30_9000c<-subset(ALLcast_9000_cast2, Temp==30)
ALL_31_9000c<-subset(ALLcast_9000_cast2, Temp==31)

# melt
ALL_27_9000<-melt(ALL_27_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_27_9000)[colnames(ALL_27_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_27_9000)[colnames(ALL_27_9000)=="variable"]<-"Symbiont" #rename value col


ALL_30_9000<-melt(ALL_30_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_30_9000)[colnames(ALL_30_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_30_9000)[colnames(ALL_30_9000)=="variable"]<-"Symbiont" #rename value col


ALL_31_9000<-melt(ALL_31_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_31_9000)[colnames(ALL_31_9000)=="value"]<-"cells.larvae" #rename value col 
colnames(ALL_31_9000)[colnames(ALL_31_9000)=="variable"]<-"Symbiont" #rename value col 
``` 

Ambient 27C
```{r}
ALL_27_9000_mean <- ddply(ALL_27_9000, c("Day", "Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_27_9000_mean #display table

ALL_27_plot_9000<-ggplot(data=ALL_27_9000_mean, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle(" 9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_27_plot_9000
```

High 30C
```{r}
ALL_30_mean_9000 <- ddply(ALL_30_9000, c("Day", "Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_30_mean_9000 #display table

ALL_30_plot_9000<-ggplot(data=ALL_30_mean_9000, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("Multi-infection average infection per larvae; 30C")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_30_plot_9000
```

High 31C
```{r}
ALL_31_mean_9000 <- ddply(ALL_31_9000, c("Day", "Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_31_mean_9000 #display table

ALL_31_plot_9000<-ggplot(data=ALL_31_mean_9000, aes(x=Day, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_31_plot_9000
```

Plot all three ALL temps together:
```{r}
ALL_27_plot_9000<-ALL_27_plot_9000+ theme(legend.position = "none") #remove legend
ALL_30_plot_9000<-ALL_30_plot_9000+ theme(legend.position = "none") #remove legend
#ALL_31_plot_9000<-ALL_31_plot_9000+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_27_plot_9000, ALL_30_plot_9000, ALL_31_plot_9000, nrow = 1)
```

Plot by Day
```{r} 
ALL_D3_9000c<-subset(ALLcast_9000_cast2, Day=="3")
ALL_D7_9000c<-subset(ALLcast_9000_cast2, Day=="7")
ALL_D14_9000c<-subset(ALLcast_9000_cast2, Day=="14")

# melt
ALL_D3_9000<-melt(ALL_D3_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D3_9000)[colnames(ALL_D3_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D3_9000)[colnames(ALL_D3_9000)=="variable"]<-"Symbiont" #rename value col


ALL_D7_9000<-melt(ALL_D7_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D7_9000)[colnames(ALL_D7_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D7_9000)[colnames(ALL_D7_9000)=="variable"]<-"Symbiont" #rename value col

ALL_D14_9000<-melt(ALL_D14_9000c, id=c("ALL.number","Temp","Day"), measure.vars = c("C1","D1","F1","G3"))
colnames(ALL_D14_9000)[colnames(ALL_D14_9000)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_D14_9000)[colnames(ALL_D14_9000)=="variable"]<-"Symbiont" #rename value col
```

Day 3
```{r}
ALL_D3_mean_9000 <- ddply(ALL_D3_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D3_mean_9000 #display table

ALL_D3_plot_9000<-ggplot(data=ALL_D3_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D3_plot_9000
```

Day 7
```{r}
ALL_D7_mean_9000 <- ddply(ALL_D7_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D7_mean_9000 #display table

ALL_D7_plot_9000<-ggplot(data=ALL_D7_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D7_plot_9000
```

Day 14
```{r}
ALL_D14_mean_9000 <- ddply(ALL_D14_9000, c("Temp","Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_D14_mean_9000 #display table
#remove Day 14
ALL_D14_mean_9000<-na.omit(ALL_D14_mean_9000)

ALL_D14_plot_9000<-ggplot(data=ALL_D14_mean_9000, aes(x=Temp, y=mean, group = Symbiont, color=Symbiont)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Symbiont), size=4, show.legend = T)+
  geom_line(aes(color=Symbiont))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred","green"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10, 2500) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  #ggtitle("9000")+
  theme(plot.title = element_text(size=20, face = "italic"));ALL_D14_plot_9000
```

#Plot infection of individual larvae

27C Day 3, stacked bars individuals
```{r}
ALL_27_Day3_9000<-subset(ALL_27_9000, Day==3)
ALL_27_Day3plot_9000<-ggplot() + 
                  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_27_Day3_9000,
                           stat="identity")+
  ylim(0,3500)+
  ggtitle("Day 3, 27C");ALL_27_Day3plot_9000
```

Plot infection of individual larvae
27C Day 7
```{r}
ALL_27_Day7_9000<-subset(ALL_27_9000, Day==7)
ALL_27_Day7plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_27_Day7_9000,
                           stat="identity")+
  ylim(0,3500)+
  ggtitle("Day 7, 27C");ALL_27_Day7plot_9000
```

27C Day 14
```{r}
ALL_27_Day14_9000<-subset(ALL_27_9000, Day==14)
ALL_27_Day14plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_27_Day14_9000,
                           stat="identity")+
  ylim(0,3500)+
  ggtitle("Day 14, 27C");ALL_27_Day14plot_9000 
``` 

Plot all three ALL 27C days together:
```{r}
ALL_27_Day3plot_9000<-ALL_27_Day3plot_9000+ theme(legend.position = "none") #remove legend
ALL_27_Day7plot_9000<-ALL_27_Day7plot_9000+ theme(legend.position = "none") #remove legend

grid.arrange(ALL_27_Day3plot_9000, ALL_27_Day7plot_9000, ALL_27_Day14plot_9000, nrow = 1)
```

30C Day 3
```{r}
ALL_30_Day3_9000<-subset(ALL_30_9000, Day==3) 
ALL_30_Day3plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_30_Day3_9000,
                           stat="identity")+
   ylim(0,11000)+
  ggtitle("Day 3, 30C_9000");ALL_30_Day3plot_9000
```

30C Day 7
```{r}
ALL_30_Day7_9000<-subset(ALL_30_9000, Day==7)
ALL_30_Day7plot_9000<-ggplot() +  
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_30_Day7_9000,
                           stat="identity")+
 ylim(0,11000)+
  ggtitle("Day 7, 27C");ALL_30_Day7plot_9000
```

30C Day 14
```{r}
ALL_30_Day14_9000<-subset(ALL_30_9000, Day==14)
ALL_30_Day14plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_30_Day14_9000,
                           stat="identity")+
   ylim(0,11000)+
  ggtitle("Day 14, 27C");ALL_30_Day14plot_9000
```

Plot all three ALL 30C days together:
```{r}
ALL_30_Day3plot_9000<-ALL_30_Day3plot_9000+ theme(legend.position = "none") #remove legend 
ALL_30_Day7plot_9000<-ALL_30_Day7plot_9000+ theme(legend.position = "none") #remove legend
#ALL_30_Day14plot<-ALL_30_Day14plot+ theme(legend.position = "none") #remove legend  Note that at 31 most larvae are dead.

grid.arrange(ALL_30_Day3plot_9000, ALL_30_Day7plot_9000, ALL_30_Day14plot_9000, nrow = 1)
```

31C Day 3
```{r}
ALL_31_Day3_9000<-subset(ALL_31_9000, Day==3)
ALL_31_Day3plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_31_Day3_9000,
                           stat="identity")+
   #ylim(0,3500)+
  ggtitle("Day 3, 31C");ALL_31_Day3plot_9000
``` 
31C Day 7
```{r}
ALL_31_Day7_9000<-subset(ALL_31_9000, Day==7)
ALL_31_Day7plot_9000<-ggplot() + 
  geom_bar(aes(y = cells.larvae, x = ALL.number, fill = Symbiont), data = ALL_31_Day7_9000,
                           stat="identity")+
   ylim(0,3500)+
  ggtitle("Day 7, 231C");ALL_31_Day7plot_9000
```

Plot all two ALL 31C days together:
```{r}
ALL_31_Day3plot_9000<-ALL_31_Day3plot_9000+ theme(legend.position = "none") #remove legend 
#ALL_33_Day7plot_9000<-ALL_30_Day7plot_9000+ theme(legend.position = "none") #remove legend
 
grid.arrange(ALL_31_Day3plot_9000, ALL_31_Day7plot_9000,nrow = 1)
``` 



# Combine ddPCR with the hemocytometer/count data from each time point for "Full" dataset
Organize data.   

C1
```{r}
#C1
#organize the ddPCR data
C1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
C1_9000b<-C1_9000[C1_vars]
colnames(C1_9000b)[colnames(C1_9000b)=="Info"] <- "Symbiont"
C1_9000b$count.type<-"ddPCR"

#organize hemo data
C1countdat<-subset(Countdat1, Symbiont=="C1")
C1countdat$count.type<-"hemo"

C1Full<-rbind(C1_9000b,C1countdat) #combine hemo and ddPCR

C1Full_mean<- ddply(C1Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1Full_mean #display table

C1Full_mean$code<-paste0(C1Full_mean$Temp, C1Full_mean$Day, C1Full_mean$count.type)

#Compare ddPCR and hemo counts 
#all days
C1Full_Alldayplot<-ggplot(data=C1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day");C1Full_Alldayplot

#Day3 C1
C1Full_Day3<-subset(C1Full, Day=="3")
C1Full_Day3plot<-ggplot(data=C1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 3");C1Full_Day3plot


#Day7 27
C1Full_Day7<-subset(C1Full, Day=="7")
C1Full_Day7plot<-ggplot(data=C1Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 7");C1Full_Day7plot


#Day14 27
C1Full_Day14<-subset(C1Full, Day=="14")
C1Full_Day14plot<-ggplot(data=C1Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("C1 Day 14");C1Full_Day14plot

#plot together
grid.arrange(C1Full_Day3plot,C1Full_Day7plot,C1Full_Day14plot, nrow = 1)
#check on C1 ddPCR higher
```
D1  
```{r}
#D1
#organize the ddPCR data
D1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
D1_9000b<-D1_9000[D1_vars]
colnames(D1_9000b)[colnames(D1_9000b)=="Info"] <- "Symbiont"
D1_9000b$count.type<-"ddPCR"

#organize hemo data
D1countdat<-subset(Countdat1, Symbiont=="D1")
D1countdat$count.type<-"hemo"

D1Full<-rbind(D1_9000b,D1countdat) #combine hemo and ddPCR

D1Full_mean<- ddply(D1Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1Full_mean #display table

D1Full_mean$code<-paste0(D1Full_mean$Temp, D1Full_mean$Day, D1Full_mean$count.type)

#Compare ddPCR and hemo counts 
#All days
D1Full_allDayplot<-ggplot(data=D1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 3");D1Full_allDayplot

#Day3 D1
D1Full_Day3<-subset(D1Full, Day=="3")
D1Full_Day3plot<-ggplot(data=D1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 3");D1Full_Day3plot
# 2 hemo counts high

#Day7 
D1Full_Day7<-subset(D1Full, Day=="7")
D1Full_Day7plot<-ggplot(data=D1Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 7");D1Full_Day7plot
#1 hemo count high

#Day14 
D1Full_Day14<-subset(D1Full, Day=="14")
D1Full_Day14plot<-ggplot(data=D1Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("D1 Day 14");D1Full_Day14plot
#hemo counts higher

#plot together
grid.arrange(D1Full_Day3plot,D1Full_Day7plot,D1Full_Day14plot, nrow = 1)
```

F1
```{r}
#F1

#organize the ddPCR data
F1_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
F1_9000b<-F1_9000[F1_vars]
colnames(F1_9000b)[colnames(F1_9000b)=="Info"] <- "Symbiont"
F1_9000b$count.type<-"ddPCR"

#organize hemo data
F1countdat<-subset(Countdat1, Symbiont=="F1")
F1countdat$count.type<-"hemo"

F1Full<-rbind(F1_9000b,F1countdat) #combine hemo and ddPCR

F1Full_mean<- ddply(F1Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1Full_mean #display table

F1Full_mean$code<-paste0(F1Full_mean$Temp, F1Full_mean$Day, F1Full_mean$count.type)

#Compare ddPCR and hemo counts 
#all Day F1
F1Full_AllDayplot<-ggplot(data=F1Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 3");F1Full_AllDayplot

#Day3 F1
F1Full_Day3<-subset(F1Full, Day=="3")
F1Full_Day3plot<-ggplot(data=F1Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 3");F1Full_Day3plot
#1 ddpcr higher 27

#Day7 
F1Full_Day7<-subset(F1Full, Day=="7")
F1Full_Day7plot<-ggplot(data=F1Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 7");F1Full_Day7plot


#Day14 
F1Full_Day14<-subset(F1Full, Day=="14")
F1Full_Day14plot<-ggplot(data=F1Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("F1 Day 14");F1Full_Day14plot

#plot together
grid.arrange(F1Full_Day3plot,F1Full_Day7plot,F1Full_Day14plot, nrow = 1)

```

G3
```{r}
#G3

#organize the ddPCR data
G3_vars<-c("Temp","Day", "Info","Pot", "Replicate","cells.larvae")
G3_9000b<-G3_9000[G3_vars]
colnames(G3_9000b)[colnames(G3_9000b)=="Info"] <- "Symbiont"
G3_9000b$count.type<-"ddPCR"

#organize hemo data
G3countdat<-subset(Countdat1, Symbiont=="G3")
G3countdat$count.type<-"hemo"

G3Full<-rbind(G3_9000b,G3countdat) #combine hemo and ddPCR

G3Full_mean<- ddply(G3Full, c("Day", "Temp","count.type"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3Full_mean #display table

G3Full_mean$code<-paste0(G3Full_mean$Temp, G3Full_mean$Day, G3Full_mean$count.type)

#Compare ddPCR and hemo counts 
#all day
G3Full_AllDayplot<-ggplot(data=G3Full,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 3");G3Full_AllDayplot
#ddpcr high


#Day3 G3
G3Full_Day3<-subset(G3Full, Day=="3")
G3Full_Day3plot<-ggplot(data=G3Full_Day3,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 3");G3Full_Day3plot
#ddpcr high

#Day7 
G3Full_Day7<-subset(G3Full, Day=="7")
G3Full_Day7plot<-ggplot(data=G3Full_Day7,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 7");G3Full_Day7plot
# ddpcr higher

#Day14 
G3Full_Day14<-subset(G3Full, Day=="14")
G3Full_Day14plot<-ggplot(data=G3Full_Day14,aes(Temp, cells.larvae)) +
  geom_point(aes(colour=factor(count.type)))+
  ggtitle("G3 Day 14");G3Full_Day14plot


#plot together
grid.arrange(G3Full_Day3plot,G3Full_Day7plot,G3Full_Day14plot, nrow = 1)

```

##PLOT SINGLE INFECTIONS_9000 SUBSET
C1 single infection 9000
```{r}
C1Full_mean <- ddply(C1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1Full_mean #display table

C1Full_plot_9000<-ggplot(data=C1Full_mean, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1Full_9000")+
  theme(plot.title = element_text(size=20, face = "italic"));C1Full_plot_9000
```


D1 single infection
```{r}
D1Full_mean_9000 <- ddply(D1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1Full_mean_9000 #display table
```


Plot D1 single infection
```{r}
D1Full_plot_9000<-ggplot(data=D1Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text  
        plot.background =element_blank(), #Set the plot background 
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) + 
  ggtitle("D1Full")+
  theme(plot.title = element_text(size=20, face = "italic"));D1Full_plot_9000
```

F1 single infection  
```{r}
F1Full_mean_9000 <- ddply(F1Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
F1Full_mean_9000 #display table
```
Plot F1 single infection
```{r}
F1Full_plot_9000<-ggplot(data=F1Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  #ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("F1Full")+
  theme(plot.title = element_text(size=20, face = "italic"));F1Full_plot_9000
```

G3 single infection
```{r}
G3Full_mean_9000 <- ddply(G3Full, c("Day", "Temp"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
G3Full_mean_9000 #display table
```
Plot G3 single infection
```{r}
G3Full_plot_9000<-ggplot(data=G3Full_mean_9000, aes(x=Day, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Days") + #Label the X Axis
  ylim(-10, 5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("G3Full")+
  theme(plot.title = element_text(size=20, face = "italic"));G3Full_plot_9000
``` 

Plot all four SINGLE INFECTION together:
```{r}

C1Full_plot_9000<-C1Full_plot_9000+ theme(legend.position = "none") #remove legend
D1Full_plot_9000<-D1Full_plot_9000+ theme(legend.position = "none") #remove legend
F1Full_plot_9000<-F1Full_plot_9000+ theme(legend.position = "none") #remove legend
#G3_plot_9000<-G3_plot_9000+ theme(legend.position = "none") #remove legend

grid.arrange(C1Full_plot_9000, D1Full_plot_9000, F1Full_plot_9000,G3Full_plot_9000, nrow = 2)
```

##Make Relative Abundance dataframe, rerun plots of infection with RA
```{r}
#ALLS
#use ALLcast_9000_cast2
#calc relative abundance for each

ALL_RelA<-ALLcast_9000_cast2 #copy

ALL_RelA$C1RA<-ALL_RelA$C1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$D1RA<-ALL_RelA$D1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$F1RA<-ALL_RelA$F1/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)
ALL_RelA$G3RA<-ALL_RelA$G3/(ALL_RelA$C1+ALL_RelA$D1+ALL_RelA$F1+ALL_RelA$G3)

ALL_RelA<-na.omit(ALL_RelA)# remove any rows without values for primers
ALL_RelAvar<-c("Day", "Temp", "ALL.number","C1RA","D1RA","F1RA" ,"G3RA")
ALL_RelA_a<-ALL_RelA[ALL_RelAvar]
ALL_RelA_b<-melt(ALL_RelA_a, id=c("Day", "Temp", "ALL.number"), measure.vars = c("C1RA","D1RA","F1RA" ,"G3RA"))
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="value"]<-"cells.larvae" #rename value col
colnames(ALL_RelA_b)[colnames(ALL_RelA_b)=="variable"]<-"Symbiont" #rename value col

```

Plot RA as stacked bar plots by Day and then by temp 
```{r}

#pull out by temp
ALL_RelA_27<-subset(ALL_RelA_b, Temp=="27")
ALL_RelA_30<-subset(ALL_RelA_b, Temp=="30")
ALL_RelA_31<-subset(ALL_RelA_b, Temp=="31")

```

27C - relative abundance stacked bar
```{r}
#27C means
ALL_RelA_27_mean <- ddply(ALL_RelA_27, c("Day", "Symbiont"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
ALL_RelA_27_mean #display table

#round to nearest integer
ALL_RelA_27_mean$mean100<-ALL_RelA_27_mean$mean*100
ALL_RelA_27_mean$mean100r<-round(ALL_RelA_27_mean$mean100, digits = 1)

#set bar colors:
library("ggsci")
#using locuszoom https://www.r-bloggers.com/palettes-in-r/

#stacked bar plot 27C by day  ****** not ordering right yet
#ALL_RelA_27_mean <- ddply(ALL_RelA_27_mean, .(Day),
                     #transform, pos = cumsum(mean100r) - (0.5 * mean100r))

            
 ALL_STP_27<-ggplot(ALL_RelA_27_mean, aes(y=mean100r, x=Day, fill=Symbiont, label=mean100r)) + 
           geom_bar(stat="identity")+
            geom_text(size=10, position=position_stack(vjust = 0.5))+
            scale_fill_locuszoom()+
   xlab("Day")+
 theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae (%)"))) +
  ggtitle("Reabund ALL 27C");ALL_STP_27           
            
```








#Statistics

Single infections
```{r}
hist(C1Full$cells.larvae) #not normal
hist(D1Full$cells.larvae) #not normal
hist(F1Full$cells.larvae) #not normal
hist(G3Full$cells.larvae) #not normal

#log transform  __ When I add +1, the histograms aren't as nice anymore...Issue?
C1Full$cells.larvae_log<-log(C1Full$cells.larvae+1)
  hist(C1Full$cells.larvae_log) #more normal
D1Full$cells.larvae_log<-log(D1Full$cells.larvae+1)
  hist(D1Full$cells.larvae_log) #more normal
F1Full$cells.larvae_log<-log(F1Full$cells.larvae+1)
  hist(F1Full$cells.larvae_log) #more normal
G3Full$cells.larvae_log<-log(G3Full$cells.larvae+1)
  hist(G3Full$cells.larvae_log) #more normal, scewed right
```

Model 1: lm(cell.counts~Day*Temp) using log transformed! Raw counts
```{r}
#C1

## lm()
C1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), C1Full)
summary(C1mod)
  qqPlot(residuals(C1mod))
#Significant: Day, 

  #test if poisson changes
  #C1mod2<-lm(log(cells.larvae+1)~Day*Temp, C1Full, family=poisson)
  #summary(C1mod2)
  #model.sel(C1mod, C1mod2) #models same, go with non poisson
  
#conduct post hoc test
emm_C1mod = emmeans(C1mod, ~ Day*Temp, adjust="tukey")
cld(emm_C1mod, Letters=c(LETTERS)) #letter display

D1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), D1Full)
summary(D1mod)
  qqPlot(residuals(D1mod)) #not amazing but not entirely awful
#conduct post hoc test
emm_D1mod = emmeans(D1mod, ~ Day*Temp, adjust="tukey")
cld(emm_D1mod, Letters=c(LETTERS)) #letter display

F1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), F1Full)
summary(F1mod)
  qqPlot(residuals(F1mod)) #not amazing but not entirely awful
#conduct post hoc test
emm_F1mod = emmeans(F1mod, ~ Day*Temp, adjust="tukey")
cld(emm_F1mod, Letters=c(LETTERS)) #letter display
  
  G3mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), G3Full)
summary(G3mod)
  qqPlot(residuals(G3mod)) #good
#conduct post hoc test
emm_G3mod = emmeans(G3mod, ~ Day*Temp, adjust="tukey")
cld(emm_G3mod, Letters=c(LETTERS)) #letter display
```
Model 1: lm(cell.counts~Day*Temp) using log transformed! USE RELATIVE ABUNDANCE (compare to raw)

```{r}


#C1
## lm()
C1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), C1Full)
summary(C1mod)
  qqPlot(residuals(C1mod))
#Significant: Day, 

  #test if poisson changes
  #C1mod2<-lm(log(cells.larvae+1)~Day*Temp, C1Full, family=poisson)
  #summary(C1mod2)
  #model.sel(C1mod, C1mod2) #models same, go with non poisson
  
#conduct post hoc test
emm_C1mod = emmeans(C1mod, ~ Day*Temp, adjust="tukey")
cld(emm_C1mod, Letters=c(LETTERS)) #letter display

D1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), D1Full)
summary(D1mod)
  qqPlot(residuals(D1mod)) #not amazing but not entirely awful
#conduct post hoc test
emm_D1mod = emmeans(D1mod, ~ Day*Temp, adjust="tukey")
cld(emm_D1mod, Letters=c(LETTERS)) #letter display

F1mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), F1Full)
summary(F1mod)
  qqPlot(residuals(F1mod)) #not amazing but not entirely awful
#conduct post hoc test
emm_F1mod = emmeans(F1mod, ~ Day*Temp, adjust="tukey")
cld(emm_F1mod, Letters=c(LETTERS)) #letter display
  
  G3mod<-lmer(log(cells.larvae+1)~Day*Temp+(1|Pot), G3Full)
summary(G3mod)
  qqPlot(residuals(G3mod)) #good
#conduct post hoc test
emm_G3mod = emmeans(G3mod, ~ Day*Temp, adjust="tukey")
cld(emm_G3mod, Letters=c(LETTERS)) #letter display
```






Multi-infection data, ALL1 data (cutoff 9000)
```{r}
#ALL everything (this is way too big)
Allmod<-lmer(log(cells.larvae+1)~Day*Temp*Primer+(1|Pot), ALL1)  #All.number is the larvae ID
summary(Allmod)

#is Pot significant
Pottest<-lm(log(cells.larvae+1)~Pot, ALL1)  #All.number is the larvae ID
summary(Pottest) #nothing is significant but the intercept. could argue not needed. 

#conduct post hoc test
emm_Allmod = emmeans(Allmod, ~ Day * Temp * Primer, adjust="tukey")
  #letter display
cld(emm_Allmod, Letters=c(LETTERS))

#run ALL by dates
#ALL Day 3
AllDay3<-subset(ALL1, Day=="3")
AllmodDay3<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay3)  #All.number is the larvae ID
summary(AllmodDay3)
#conduct post hoc test
emm_AllmodDay3 = emmeans(AllmodDay3, ~ Temp * Primer, adjust="tukey")
  #letter display
cld(emm_AllmodDay3, Letters=c(LETTERS))

#ALL Day 7
AllDay7<-subset(ALL1, Day=="7")
AllmodDay7<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay7)  #All.number is the larvae ID
summary(AllmodDay7)
#conduct post hoc test
emm_AllmodDay7 = emmeans(AllmodDay7, ~ Temp * Primer, adjust="tukey")
  #letter display
cld(emm_AllmodDay7, Letters=c(LETTERS))

#ALL Day 14
AllDay14<-subset(ALL1, Day=="14")
all14<-c("Temp","Primer", "ALL.number","cells.larvae")
AllDay14<-AllDay14[all14]
AllDay14<-  AllDay14[!(AllDay14$Temp=="31"),] #remove 31
AllmodDay14<-lmer(log(cells.larvae+1)~Temp*Primer+(1|ALL.number), AllDay14)  #All.number is the larvae ID
summary(AllmodDay14)
#conduct post hoc test
emm_AllmodDay14 = emmeans(AllmodDay14, ~ Temp * Primer, adjust="tukey")
  #letter display
cld(emm_AllmodDay14, Letters=c(LETTERS))
```

Compare expected vs observed. Do this at each Time point (2-way easier to interpret)
C1
```{r}
#single infection, add new column "single.multi"
C1Full$single.multi<-"single"
C1Full$single.multi<-factor(C1Full$single.multi, levels=c("single","multi"))

#multi infection, add new column "single.multi"
C1ALL<-subset(ALL1, Primer=="C1") #subset Primer
C1ALL$single.multi<-"multi" #multi
C1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
C1ALLb<-C1ALL[C1ALLvars]
C1ALLb$cells.larvae_log<-log(C1ALLb$cells.larvae+1) #log
colnames(C1ALLb)[colnames(C1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
C1_EO<-rbind(C1ALLb, C1Full)
```
C1 Day 3
```{r}
# Day 3
C1_EO.D3<-subset(C1_EO, Day=="3")
C1_EOmodD3<-lm(cells.larvae_log~Temp*single.multi, C1_EO.D3)
summary(C1_EOmodD3)
emm_C1_EOmodD3 = emmeans(C1_EOmodD3, ~ Temp*single.multi, adjust="tukey")
cld(emm_C1_EOmodD3, Letters=c(LETTERS)) #letter display

#means
C1_EO.D3mean <- ddply(C1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D3mean #display table


C1_EO.D3_plot<-ggplot(data=C1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1_Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_EO.D3_plot
```

C1 Day 7 
```{r}
# Day 7
C1_EO.D7<-subset(C1_EO, Day=="7")

C1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, C1_EO.D7)
summary(C1_EOmodD7)
emm_C1_EOmodD7 = emmeans(C1_EOmodD7, ~ Temp*single.multi, adjust="tukey")
cld(emm_C1_EOmodD7, Letters=c(LETTERS)) #letter display

#means
C1_EO.D7mean <- ddply(C1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D7mean #display table


C1_EO.D7_plot<-ggplot(data=C1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1_Day7 Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_EO.D7_plot
```


Day 14
```{r}
# Day 14
C1_EO.D14<-subset(C1_EO, Day=="14")

C1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, C1_EO.D14)
summary(C1_EOmodD14)
emm_C1_EOmodD14 = emmeans(C1_EOmodD14, ~ Temp*single.multi, adjust="tukey")
cld(emm_C1_EOmodD14, Letters=c(LETTERS)) #letter display


#means
C1_EO.D14mean <- ddply(C1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
C1_EO.D14mean #display table
#C1_EO.D14mean<-na.omit(C1_EO.D14mean)

C1_EO.D14_plot<-ggplot(data=C1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("C1_Day14 Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));C1_EO.D14_plot

```

D1
```{r}
#single infection, add new column "single.multi"
D1Full$single.multi<-"single"
D1Full$single.multi<-factor(D1Full$single.multi, levels=c("single","multi"))

#multi infection, add new column "single.multi"
D1ALL<-subset(ALL1, Primer=="D1") #subset Primer
D1ALL$single.multi<-"multi" #multi
D1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
D1ALLb<-D1ALL[D1ALLvars]
D1ALLb$cells.larvae_log<-log(D1ALLb$cells.larvae+1) #log
colnames(D1ALLb)[colnames(D1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
D1_EO<-rbind(D1ALLb, D1Full)
```

DAY3
```{R}
# Day 3
D1_EO.D3<-subset(D1_EO, Day=="3")

D1_EOmod<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D3)
summary(D1_EOmod)
emm_D1_EOmod = emmeans(D1_EOmod, ~ Temp*single.multi, adjust="tukey")
cld(emm_D1_EOmod, Letters=c(LETTERS)) #letter display

#means
D1_EO.D3mean <- ddply(D1_EO.D3, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D3mean #display table


D1_EO.D3_plot<-ggplot(data=D1_EO.D3mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1_27C_Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_EO.D3_plot

```



DAY7
```{R}
# Day 7
D1_EO.D7<-subset(D1_EO, Day=="7")

D1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D7)
summary(D1_EOmodD7)
emm_D1_EOmodD7 = emmeans(D1_EOmodD7, ~ Temp*single.multi, adjust="tukey")
cld(emm_D1_EOmodD7, Letters=c(LETTERS)) #letter display


#means
D1_EO.D7mean <- ddply(D1_EO.D7, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D7mean #display table


D1_EO.D7_plot<-ggplot(data=D1_EO.D7mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1_Day7 Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_EO.D7_plot
```

DAY14
```{R}
# Day 14
D1_EO.D14<-subset(D1_EO, Day=="14")

D1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, D1_EO.D14)
summary(D1_EOmodD14)
emm_D1_EOmodD14 = emmeans(D1_EOmodD14, ~ Temp*single.multi, adjust="tukey")
cld(emm_D1_EOmodD14, Letters=c(LETTERS)) #letter display

#means
D1_EO.D14mean <- ddply(D1_EO.D14, c( "Temp","single.multi"), summarise, #summarize cell counts
                 N    = length(cells.larvae[!is.na(cells.larvae)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(cells.larvae, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(cells.larvae, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(cells.larvae, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
D1_EO.D14mean #display table
#C1_EO.D14mean<-na.omit(C1_EO.D14mean)

D1_EO.D14_plot<-ggplot(data=D1_EO.D14mean, aes(x=single.multi, y=mean, group = Temp, color=Temp)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Temp), size=4, show.legend = T)+
  geom_line(aes(color=Temp))+
  scale_color_manual(values=c("dodgerblue3", "orange", "darkred"))+
  xlab("Temp") + #Label the X Axis
  #ylim(-10,5000) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Cells/Larvae"))) +
  ggtitle("D1_Day14 Expected vs Observed")+
  theme(plot.title = element_text(size=20, face = "italic"));D1_EO.D14_plot
```


F1
```{r}
#single infection, add new column "single.multi"
F1Full$single.multi<-"single"
F1Full$single.multi<-factor(F1Full$single.multi, levels=c("single","multi"))

#multi infection, add new column "single.multi"
F1ALL<-subset(ALL1, Primer=="F1") #subset Primer
F1ALL$single.multi<-"multi" #multi
F1ALLvars<-c("Temp","Day", "Primer", "Pot", "Replicate","cells.larvae","single.multi")
F1ALLb<-F1ALL[F1ALLvars]
F1ALLb$cells.larvae_log<-log(F1ALLb$cells.larvae+1) #log
colnames(F1ALLb)[colnames(F1ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
F1_EO<-rbind(F1ALLb, F1Full)

# Day 3
F1_EO.D3<-subset(F1_EO, Day=="3")

F1_EOmod<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D3)
summary(F1_EOmod)
emm_F1_EOmod = emmeans(F1_EOmod, ~ Temp*single.multi, adjust="tukey")
cld(emm_F1_EOmod, Letters=c(LETTERS)) #letter display

# Day 7
F1_EO.D7<-subset(F1_EO, Day=="7")

F1_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D7)
summary(F1_EOmodD7)
emm_F1_EOmodD7 = emmeans(F1_EOmodD7, ~ Temp*single.multi, adjust="tukey")
cld(emm_F1_EOmodD7, Letters=c(LETTERS)) #letter display

# Day 14
F1_EO.D14<-subset(F1_EO, Day=="14")

F1_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, F1_EO.D14)
summary(F1_EOmodD14)
emm_F1_EOmodD14 = emmeans(F1_EOmodD14, ~ Temp*single.multi, adjust="tukey")
cld(emm_F1_EOmodD14, Letters=c(LETTERS)) #letter display
```

G3
```{r}
#single infection, add new column "single.multi"
G3Full$single.multi<-"single"
G3Full$single.multi<-factor(G3Full$single.multi, levels=c("single","multi"))

#multi infection, add new column "single.multi"
G3ALL<-subset(ALL1, Primer=="G3") #subset Primer
G3ALL$single.multi<-"multi" #multi
G3ALLvars<-c("Temp","Day", "Symbiont", "Pot", "Replicate","cells.larvae","single.multi")
G3ALLb<-D1ALL[G3ALLvars]
G3ALLb$cells.larvae_log<-log(G3ALLb$cells.larvae+1) #log
colnames(G3ALLb)[colnames(G3ALLb)=="Primer"] <- "Symbiont"

#combine the dataframes
G3_EO<-rbind(G3ALLb, G3Full)

# Day 3
G3_EO.D3<-subset(G3_EO, Day=="3")

G3_EOmod<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D3)
summary(G3_EOmod)
emm_G3_EOmod = emmeans(G3_EOmod, ~ Temp*single.multi, adjust="tukey")
cld(emm_G3_EOmod, Letters=c(LETTERS)) #letter display

# Day 7
G3_EO.D7<-subset(G3_EO, Day=="7")

G3_EOmodD7<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D7)
summary(G3_EOmodD7)
emm_G3_EOmodD7 = emmeans(G3_EOmodD7, ~ Temp*single.multi, adjust="tukey")
cld(emm_G3_EOmodD7, Letters=c(LETTERS)) #letter display

# Day 14
G3_EO.D14<-subset(G3_EO, Day=="14")

G3_EOmodD14<-lm(cells.larvae_log~Temp*single.multi, G3_EO.D14)
summary(G3_EOmodD14)
emm_G3_EOmodD14 = emmeans(G3_EOmodD14, ~ Temp*single.multi, adjust="tukey")
cld(emm_G3_EOmodD14, Letters=c(LETTERS)) #letter display
```


## Relative abundances for NMDS for ALLs
```{r}


#NMDS
set.seed(1)

```

